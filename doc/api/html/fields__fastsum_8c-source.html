<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.1.1 API Reference - NFFT: fields_fastsum.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.1.1 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>fields_fastsum.c</h1><a href="fields__fastsum_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;complex.h&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#include "<a class="code" href="fastsum_8h.html" title="Header file for the fast NFFT-based summation algorithm.">fastsum.h</a>"</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include "<a class="code" href="fields__fastsum_8h.html" title="Header file for calculation of 3d space-charge fields of bunches of charged particles...">fields_fastsum.h</a>"</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include "<a class="code" href="kernels_8h.html" title="Header file with predefined kernels for the fast summation algorithm.">kernels.h</a>"</span>
<a name="l00017"></a>00017 
<a name="l00019"></a><a class="code" href="fields__fastsum_8h.html#26861315f9fe7049bfb07f2ac12f9128">00019</a> <span class="keywordtype">void</span> <a class="code" href="fields__fastsum_8c.html#26861315f9fe7049bfb07f2ac12f9128" title="initialize fast calculation plan">fields_fastsum_init</a>(<a class="code" href="structfields__fastsum__plan.html" title="plan for fast calculation of 3D space-charge fields of bunches of charged particles...">fields_fastsum_plan</a> *plan, <span class="keywordtype">int</span> N_total, <span class="keywordtype">unsigned</span> flags, <span class="keywordtype">int</span> nn, <span class="keywordtype">int</span> m, <span class="keywordtype">int</span> p, <span class="keywordtype">double</span> eps_I, <span class="keywordtype">double</span> eps_B) {
<a name="l00020"></a>00020   <span class="keywordtype">double</span> *kernel_param;
<a name="l00021"></a>00021 
<a name="l00022"></a>00022   kernel_param = (<span class="keywordtype">double</span> *)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00023"></a>00023   kernel_param[0] = 0.0;
<a name="l00024"></a>00024   plan-&gt;<a class="code" href="structfields__fastsum__plan.html#9e6c7fdded131315c670e971b29fb5e0" title="api">N_total</a> = N_total;
<a name="l00025"></a>00025   plan-&gt;<a class="code" href="structfields__fastsum__plan.html#f4fa4d98cd696cbb734a85b154c1f86d" title="charges">q</a> = (<span class="keywordtype">double</span> *)malloc(N_total*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
<a name="l00026"></a>00026   plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a> = (<span class="keywordtype">double</span> *)malloc(3*N_total*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
<a name="l00027"></a>00027   plan-&gt;<a class="code" href="structfields__fastsum__plan.html#77d68a77ebcefd9cf9d8ec75a5fd6007" title="self-induced field at each source knot">E</a> = (<span class="keywordtype">double</span> *)malloc(3*N_total*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
<a name="l00028"></a>00028 
<a name="l00029"></a>00029   <a class="code" href="group__applications__fastsum.html#g9a053d513b2eb19c5f1c70f16e0ae149" title="initialization of fastsum plan">fastsum_init_guru</a>(&amp;plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>, 3, N_total, N_total, <a class="code" href="group__applications__fastsum.html#g1deb0e10a0d6cf7f11d8b90ee008eb53">one_over_cube</a>, kernel_param, flags, nn, m, p, eps_I, eps_B);
<a name="l00030"></a>00030 }
<a name="l00031"></a>00031 
<a name="l00033"></a><a class="code" href="fields__fastsum_8h.html#2866991fa6166c26b2bcbab1b9d2bddb">00033</a> <span class="keywordtype">void</span> <a class="code" href="fields__fastsum_8c.html#2866991fa6166c26b2bcbab1b9d2bddb" title="initialize fast calculation plan">fields_fastsum_finalize</a>(<a class="code" href="structfields__fastsum__plan.html" title="plan for fast calculation of 3D space-charge fields of bunches of charged particles...">fields_fastsum_plan</a> *plan) {
<a name="l00034"></a>00034   free(plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#e494d11cd336be135f7a93d112a16852" title="parameters for kernel function">kernel_param</a>);
<a name="l00035"></a>00035   <a class="code" href="group__applications__fastsum.html#gb989ea4659fe681bd4c025e82756f769" title="finalization of fastsum plan">fastsum_finalize</a>(&amp;plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>);
<a name="l00036"></a>00036 
<a name="l00037"></a>00037   free(plan-&gt;<a class="code" href="structfields__fastsum__plan.html#77d68a77ebcefd9cf9d8ec75a5fd6007" title="self-induced field at each source knot">E</a>);
<a name="l00038"></a>00038   free(plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a>);
<a name="l00039"></a>00039   free(plan-&gt;<a class="code" href="structfields__fastsum__plan.html#f4fa4d98cd696cbb734a85b154c1f86d" title="charges">q</a>);
<a name="l00040"></a>00040 }
<a name="l00041"></a>00041 
<a name="l00043"></a><a class="code" href="fields__fastsum_8h.html#d68ea2b869d29cb4dae19a3f75d89a98">00043</a> <span class="keywordtype">void</span> <a class="code" href="fields__fastsum_8c.html#d68ea2b869d29cb4dae19a3f75d89a98" title="direct calculation">fields_fastsum_exact</a>(<a class="code" href="structfields__fastsum__plan.html" title="plan for fast calculation of 3D space-charge fields of bunches of charged particles...">fields_fastsum_plan</a> *plan) {
<a name="l00044"></a>00044   <span class="keywordtype">int</span> j;
<a name="l00045"></a>00045   <span class="keywordtype">int</span> l;
<a name="l00046"></a>00046   <span class="keywordtype">double</span> s;
<a name="l00047"></a>00047   <span class="keywordtype">double</span> E_pre = 1 / (4*<a class="code" href="group__nfftutil.html#g598a3330b3c21701223ee0ca14316eca" title="Formerly known to be an irrational number.">PI</a>*<a class="code" href="fields__fastsum_8h.html#2a807074b712c3124ad6e69887077b89" title="Include header for C99 complex datatype.">EPSILON_0</a>);
<a name="l00048"></a>00048   <span class="keywordtype">double</span> diff[3];
<a name="l00049"></a>00049   <span class="keywordtype">double</span> sum[3];
<a name="l00050"></a>00050 
<a name="l00051"></a>00051   <span class="keywordflow">for</span>(j = 0; j &lt; plan-&gt;<a class="code" href="structfields__fastsum__plan.html#9e6c7fdded131315c670e971b29fb5e0" title="api">N_total</a>; j++) {
<a name="l00052"></a>00052     sum[0] = 0.0;
<a name="l00053"></a>00053     sum[1] = 0.0;
<a name="l00054"></a>00054     sum[2] = 0.0;
<a name="l00055"></a>00055     <span class="keywordflow">for</span>(l = 0; l &lt; plan-&gt;<a class="code" href="structfields__fastsum__plan.html#9e6c7fdded131315c670e971b29fb5e0" title="api">N_total</a>; l++) {
<a name="l00056"></a>00056       <span class="keywordflow">if</span> (j == l) {
<a name="l00057"></a>00057         <span class="keywordflow">continue</span>;
<a name="l00058"></a>00058       }
<a name="l00059"></a>00059       diff[0] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a>[j*3] - plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a>[l*3];
<a name="l00060"></a>00060       diff[1] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a>[j*3+1] - plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a>[l*3+1];
<a name="l00061"></a>00061       diff[2] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a>[j*3+2] - plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a>[l*3+2];
<a name="l00062"></a>00062       s = diff[0] * diff[0] + diff[1] * diff[1] + diff[2] * diff[2];
<a name="l00063"></a>00063       s = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#f4fa4d98cd696cbb734a85b154c1f86d" title="charges">q</a>[l] / sqrt(s*s*s);
<a name="l00064"></a>00064       sum[0] += s * diff[0];
<a name="l00065"></a>00065       sum[1] += s * diff[1];
<a name="l00066"></a>00066       sum[2] += s * diff[2];
<a name="l00067"></a>00067     }
<a name="l00068"></a>00068     plan-&gt;<a class="code" href="structfields__fastsum__plan.html#77d68a77ebcefd9cf9d8ec75a5fd6007" title="self-induced field at each source knot">E</a>[j*3] = E_pre * sum[0];
<a name="l00069"></a>00069     plan-&gt;<a class="code" href="structfields__fastsum__plan.html#77d68a77ebcefd9cf9d8ec75a5fd6007" title="self-induced field at each source knot">E</a>[j*3+1] = E_pre * sum[1];
<a name="l00070"></a>00070     plan-&gt;<a class="code" href="structfields__fastsum__plan.html#77d68a77ebcefd9cf9d8ec75a5fd6007" title="self-induced field at each source knot">E</a>[j*3+2] = E_pre * sum[2];
<a name="l00071"></a>00071   }
<a name="l00072"></a>00072 }
<a name="l00073"></a>00073 
<a name="l00075"></a><a class="code" href="fields__fastsum_8h.html#5bb47ec8c6a2680a66846e7c8cc4ce50">00075</a> <span class="keywordtype">void</span> <a class="code" href="fields__fastsum_8c.html#5bb47ec8c6a2680a66846e7c8cc4ce50" title="simple NFFT-based summation algorithm">fields_fastsum_simple</a>(<a class="code" href="structfields__fastsum__plan.html" title="plan for fast calculation of 3D space-charge fields of bunches of charged particles...">fields_fastsum_plan</a> *plan) {
<a name="l00076"></a>00076   <span class="keywordtype">int</span> k;
<a name="l00077"></a>00077   <span class="keywordtype">int</span> t;
<a name="l00078"></a>00078   <span class="keywordtype">int</span> j;
<a name="l00079"></a>00079   <span class="keywordtype">int</span> l;
<a name="l00080"></a>00080   <span class="keywordtype">double</span> E_pre = 1 / (4*<a class="code" href="group__nfftutil.html#g598a3330b3c21701223ee0ca14316eca" title="Formerly known to be an irrational number.">PI</a>*<a class="code" href="fields__fastsum_8h.html#2a807074b712c3124ad6e69887077b89" title="Include header for C99 complex datatype.">EPSILON_0</a>);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082   <span class="keywordflow">for</span>(k = 0; k &lt; plan-&gt;<a class="code" href="structfields__fastsum__plan.html#9e6c7fdded131315c670e971b29fb5e0" title="api">N_total</a>; k++) {
<a name="l00083"></a>00083     <span class="keywordflow">for</span>(t = 0; t &lt; 3; t++) {
<a name="l00084"></a>00084       plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#590dd3d6fd12f3e8cbd72b8a83905760" title="source knots in d-ball with radius 1/4-eps_b/2">x</a>[k*3+t] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a>[k*3+t];
<a name="l00085"></a>00085       plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#79615d0f0d38b754742c3ff445b6c733" title="target knots in d-ball with radius 1/4-eps_b/2">y</a>[k*3+t] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a>[k*3+t];
<a name="l00086"></a>00086     }
<a name="l00087"></a>00087     plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#f36c72276fd20ef9c8c1b484f6cbf834" title="source coefficients">alpha</a>[k] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#f4fa4d98cd696cbb734a85b154c1f86d" title="charges">q</a>[k];
<a name="l00088"></a>00088   }
<a name="l00089"></a>00089 
<a name="l00090"></a>00090   <span class="comment">/* steps 1, 2, 3, 6, 7 */</span>
<a name="l00091"></a>00091   <a class="code" href="group__applications__fastsum.html#g197c16fcec7935886fc97d140f2b20ff" title="precomputation for fastsum">fastsum_precompute</a>(&amp;plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>);
<a name="l00092"></a>00092   <a class="code" href="group__applications__fastsum.html#gab2cc691ba59064c18d439c9fd2185e8" title="fast NFFT-based summation">fastsum_trafo</a>(&amp;plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>);
<a name="l00093"></a>00093   <span class="keywordflow">for</span>(j = 0; j &lt; plan-&gt;<a class="code" href="structfields__fastsum__plan.html#9e6c7fdded131315c670e971b29fb5e0" title="api">N_total</a>; j++) {
<a name="l00094"></a>00094     <span class="keywordflow">for</span>(t = 0; t &lt; 3; t++) {
<a name="l00095"></a>00095       plan-&gt;<a class="code" href="structfields__fastsum__plan.html#77d68a77ebcefd9cf9d8ec75a5fd6007" title="self-induced field at each source knot">E</a>[j*3+t] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a>[j*3+t] * creal(plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#3bb9a1eea981916a97336ac6eb19d292" title="target evaluations">f</a>[j]);
<a name="l00096"></a>00096     }
<a name="l00097"></a>00097   }
<a name="l00098"></a>00098 
<a name="l00099"></a>00099   <span class="keywordflow">for</span>(t = 0; t &lt; 3; t++) {
<a name="l00100"></a>00100     <span class="keywordflow">for</span>(k = 0; k &lt; plan-&gt;<a class="code" href="structfields__fastsum__plan.html#9e6c7fdded131315c670e971b29fb5e0" title="api">N_total</a>; k++) {
<a name="l00101"></a>00101       <span class="keywordflow">for</span>(l = 0; l &lt; 3; l++) {
<a name="l00102"></a>00102         plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#590dd3d6fd12f3e8cbd72b8a83905760" title="source knots in d-ball with radius 1/4-eps_b/2">x</a>[k*3+l] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a>[k*3+l];
<a name="l00103"></a>00103         plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#79615d0f0d38b754742c3ff445b6c733" title="target knots in d-ball with radius 1/4-eps_b/2">y</a>[k*3+l] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a>[k*3+l];
<a name="l00104"></a>00104       }
<a name="l00105"></a>00105     }
<a name="l00106"></a>00106     <span class="keywordflow">for</span>(l = 0; l &lt; plan-&gt;<a class="code" href="structfields__fastsum__plan.html#9e6c7fdded131315c670e971b29fb5e0" title="api">N_total</a>; l++) {
<a name="l00107"></a>00107       plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#f36c72276fd20ef9c8c1b484f6cbf834" title="source coefficients">alpha</a>[l] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#f4fa4d98cd696cbb734a85b154c1f86d" title="charges">q</a>[l] * plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a>[l*3+t];
<a name="l00108"></a>00108     }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110     <span class="comment">/* steps 1, 4, 5, 6, 7 */</span>
<a name="l00111"></a>00111     <a class="code" href="group__applications__fastsum.html#g197c16fcec7935886fc97d140f2b20ff" title="precomputation for fastsum">fastsum_precompute</a>(&amp;plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>);
<a name="l00112"></a>00112     <a class="code" href="group__applications__fastsum.html#gab2cc691ba59064c18d439c9fd2185e8" title="fast NFFT-based summation">fastsum_trafo</a>(&amp;plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>);
<a name="l00113"></a>00113     <span class="keywordflow">for</span>(j = 0; j &lt; plan-&gt;<a class="code" href="structfields__fastsum__plan.html#9e6c7fdded131315c670e971b29fb5e0" title="api">N_total</a>; j++) {
<a name="l00114"></a>00114       plan-&gt;<a class="code" href="structfields__fastsum__plan.html#77d68a77ebcefd9cf9d8ec75a5fd6007" title="self-induced field at each source knot">E</a>[j*3+t] -= creal(plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#3bb9a1eea981916a97336ac6eb19d292" title="target evaluations">f</a>[j]);
<a name="l00115"></a>00115       plan-&gt;<a class="code" href="structfields__fastsum__plan.html#77d68a77ebcefd9cf9d8ec75a5fd6007" title="self-induced field at each source knot">E</a>[j*3+t] *= E_pre;
<a name="l00116"></a>00116     }
<a name="l00117"></a>00117   }
<a name="l00118"></a>00118 }
<a name="l00119"></a>00119 
<a name="l00121"></a><a class="code" href="fields__fastsum_8c.html#d4e032eccbc6fa9063f7d4b74f2667f6">00121</a> <span class="keywordtype">void</span> <a class="code" href="fields__fastsum_8c.html#d4e032eccbc6fa9063f7d4b74f2667f6" title="fast search in tree of source knots for near field computation, modified version...">FieldsSearchTree</a>(<span class="keywordtype">double</span> *result, <span class="keywordtype">int</span> t, <span class="keywordtype">double</span> *x, complex *alpha, <span class="keywordtype">double</span> *xmin, <span class="keywordtype">double</span> *xmax, <span class="keywordtype">int</span> N, complex (*<a class="code" href="group__applications__fastsum.html#g9227ba3791b3360dc4a0d6fbf82034c6" title="Include header for C99 complex datatype.">kernel</a>)(<span class="keywordtype">double</span> , <span class="keywordtype">int</span> , <span class="keyword">const</span> <span class="keywordtype">double</span> *), <span class="keyword">const</span> <span class="keywordtype">double</span> *param, <span class="keywordtype">int</span> Ad, <span class="keywordtype">double</span> *Add, <span class="keywordtype">int</span> p, <span class="keywordtype">unsigned</span> flags)
<a name="l00122"></a>00122 {
<a name="l00123"></a>00123   <span class="keywordtype">int</span> m=N/2;
<a name="l00124"></a>00124   <span class="keywordtype">double</span> Min=xmin[t], Max=xmax[t], Median=x[m*3+t];
<a name="l00125"></a>00125   <span class="keywordtype">double</span> a=fabs(Max-Min)/2;
<a name="l00126"></a>00126   <span class="keywordtype">double</span> r;
<a name="l00127"></a>00127   <span class="keywordtype">double</span> kernel_value;
<a name="l00128"></a>00128   <span class="keywordtype">double</span> q;
<a name="l00129"></a>00129 
<a name="l00130"></a>00130   <span class="keywordflow">if</span> (N==0)
<a name="l00131"></a>00131     <span class="keywordflow">return</span>;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133   <span class="keywordflow">if</span> (Min&gt;Median)
<a name="l00134"></a>00134     <a class="code" href="fields__fastsum_8c.html#d4e032eccbc6fa9063f7d4b74f2667f6" title="fast search in tree of source knots for near field computation, modified version...">FieldsSearchTree</a>(result, (t+1)%3,x+(m+1)*3,alpha+(m+1),xmin,xmax,N-m-1,<a class="code" href="group__applications__fastsum.html#g9227ba3791b3360dc4a0d6fbf82034c6" title="Include header for C99 complex datatype.">kernel</a>,param,Ad,Add,p,flags);
<a name="l00135"></a>00135   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Max&lt;Median)
<a name="l00136"></a>00136     <a class="code" href="fields__fastsum_8c.html#d4e032eccbc6fa9063f7d4b74f2667f6" title="fast search in tree of source knots for near field computation, modified version...">FieldsSearchTree</a>(result, (t+1)%3,x,alpha,xmin,xmax,m,<a class="code" href="group__applications__fastsum.html#g9227ba3791b3360dc4a0d6fbf82034c6" title="Include header for C99 complex datatype.">kernel</a>,param,Ad,Add,p,flags);
<a name="l00137"></a>00137   <span class="keywordflow">else</span>
<a name="l00138"></a>00138   {
<a name="l00139"></a>00139     <span class="keywordflow">if</span> (x[m*3]&gt;xmin[0] &amp;&amp; x[m*3]&lt;xmax[0] &amp;&amp; x[m*3+1]&gt;xmin[1] &amp;&amp; x[m*3+1]&lt;xmax[1] &amp;&amp; x[m*3+2]&gt;xmin[2] &amp;&amp; x[m*3+2]&lt;xmax[2])
<a name="l00140"></a>00140     {
<a name="l00141"></a>00141       r = (xmin[0]+a-x[m*3])*(xmin[0]+a-x[m*3]) + (xmin[1]+a-x[m*3+1])*(xmin[1]+a-x[m*3+1]) + (xmin[2]+a-x[m*3+2])*(xmin[2]+a-x[m*3+2]);
<a name="l00142"></a>00142         <span class="comment">/* remember: xmin+a = y */</span>
<a name="l00143"></a>00143       r=sqrt(r);
<a name="l00144"></a>00144       <span class="keywordflow">if</span> (fabs(r)&lt;a)
<a name="l00145"></a>00145       {
<a name="l00146"></a>00146         kernel_value = <a class="code" href="group__applications__fastsum.html#g9227ba3791b3360dc4a0d6fbf82034c6" title="Include header for C99 complex datatype.">kernel</a>(r,0,param);
<a name="l00147"></a>00147         <span class="keywordflow">if</span> (flags &amp; <a class="code" href="group__applications__fastsum.html#gc22376cb30edef9131c592a355d1030d" title="Constant symbols.">EXACT_NEARFIELD</a>)
<a name="l00148"></a>00148           kernel_value -= <a class="code" href="group__applications__fastsum.html#g247527ab67657107225fa69882f0208c" title="regularized kernel with K_I arbitrary and K_B smooth to zero">regkern</a>(<a class="code" href="group__applications__fastsum.html#g9227ba3791b3360dc4a0d6fbf82034c6" title="Include header for C99 complex datatype.">kernel</a>,r,p,param,a,1.0/16.0);      <span class="comment">/* exact value  */</span>
<a name="l00149"></a>00149         <span class="keywordflow">else</span>
<a name="l00150"></a>00150           kernel_value -= <a class="code" href="group__applications__fastsum.html#g67103860c05f7296f7c302e7f0dbfe79" title="cubic spline interpolation in near field with even kernels">kubintkern</a>(r,Add,Ad,a);                    <span class="comment">/* spline approximation */</span>
<a name="l00151"></a>00151 
<a name="l00152"></a>00152         q = creal(alpha[m]);
<a name="l00153"></a>00153 
<a name="l00154"></a>00154         result[0] += (xmin[0]+a-x[m*3])*q*kernel_value;              <span class="comment">/* alpha*(kern-regkern) */</span>
<a name="l00155"></a>00155         result[1] += (xmin[1]+a-x[m*3+1])*q*kernel_value;
<a name="l00156"></a>00156         result[2] += (xmin[2]+a-x[m*3+2])*q*kernel_value;
<a name="l00157"></a>00157       }
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159     <a class="code" href="fields__fastsum_8c.html#d4e032eccbc6fa9063f7d4b74f2667f6" title="fast search in tree of source knots for near field computation, modified version...">FieldsSearchTree</a>(result,(t+1)%3,x+(m+1)*3,alpha+(m+1),xmin,xmax,N-m-1,<a class="code" href="group__applications__fastsum.html#g9227ba3791b3360dc4a0d6fbf82034c6" title="Include header for C99 complex datatype.">kernel</a>,param,Ad,Add,p,flags);
<a name="l00160"></a>00160     <a class="code" href="fields__fastsum_8c.html#d4e032eccbc6fa9063f7d4b74f2667f6" title="fast search in tree of source knots for near field computation, modified version...">FieldsSearchTree</a>(result,(t+1)%3,x,alpha,xmin,xmax,m,<a class="code" href="group__applications__fastsum.html#g9227ba3791b3360dc4a0d6fbf82034c6" title="Include header for C99 complex datatype.">kernel</a>,param,Ad,Add,p,flags);
<a name="l00161"></a>00161   }
<a name="l00162"></a>00162 }
<a name="l00163"></a>00163 
<a name="l00165"></a><a class="code" href="fields__fastsum_8h.html#8225d50556d5717a1ea9fa02baf87805">00165</a> <span class="keywordtype">void</span> <a class="code" href="fields__fastsum_8c.html#8225d50556d5717a1ea9fa02baf87805" title="fast NFFT-based summation, precomputation">fields_fastsum_precompute</a>(<a class="code" href="structfields__fastsum__plan.html" title="plan for fast calculation of 3D space-charge fields of bunches of charged particles...">fields_fastsum_plan</a> *plan) {
<a name="l00166"></a>00166   <span class="keywordtype">int</span> k;
<a name="l00167"></a>00167   <span class="keywordtype">int</span> t;
<a name="l00168"></a>00168   <span class="keywordtype">double</span> time;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170   time=<a class="code" href="group__nfftutil.html#gae7e89f8691419d4a5bc972db7a3abd7" title="Actual used CPU time in seconds; calls getrusage, limited accuracy.">nfft_second</a>();
<a name="l00171"></a>00171 
<a name="l00172"></a>00172   <span class="keywordflow">for</span>(k = 0; k &lt; plan-&gt;<a class="code" href="structfields__fastsum__plan.html#9e6c7fdded131315c670e971b29fb5e0" title="api">N_total</a>; k++) {
<a name="l00173"></a>00173     <span class="keywordflow">for</span>(t = 0; t &lt; 3; t++) {
<a name="l00174"></a>00174       plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#590dd3d6fd12f3e8cbd72b8a83905760" title="source knots in d-ball with radius 1/4-eps_b/2">x</a>[k*3+t] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a>[k*3+t];
<a name="l00175"></a>00175       plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#79615d0f0d38b754742c3ff445b6c733" title="target knots in d-ball with radius 1/4-eps_b/2">y</a>[k*3+t] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a>[k*3+t];
<a name="l00176"></a>00176     }
<a name="l00177"></a>00177     plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#f36c72276fd20ef9c8c1b484f6cbf834" title="source coefficients">alpha</a>[k] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#f4fa4d98cd696cbb734a85b154c1f86d" title="charges">q</a>[k];
<a name="l00178"></a>00178   }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180   <a class="code" href="group__applications__fastsum.html#g197c16fcec7935886fc97d140f2b20ff" title="precomputation for fastsum">fastsum_precompute</a>(&amp;plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>);
<a name="l00181"></a>00181 }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 
<a name="l00185"></a><a class="code" href="fields__fastsum_8h.html#84515922e07f67f68009e96933d9cfc7">00185</a> <span class="keywordtype">void</span> <a class="code" href="fields__fastsum_8c.html#84515922e07f67f68009e96933d9cfc7" title="fast NFFT-based summation algorithm">fields_fastsum_trafo</a>(<a class="code" href="structfields__fastsum__plan.html" title="plan for fast calculation of 3D space-charge fields of bunches of charged particles...">fields_fastsum_plan</a> *plan) {
<a name="l00186"></a>00186   <span class="keywordtype">int</span> j,k,t;
<a name="l00187"></a>00187   <span class="keywordtype">double</span> E_pre = 1 / (4*<a class="code" href="group__nfftutil.html#g598a3330b3c21701223ee0ca14316eca" title="Formerly known to be an irrational number.">PI</a>*<a class="code" href="fields__fastsum_8h.html#2a807074b712c3124ad6e69887077b89" title="Include header for C99 complex datatype.">EPSILON_0</a>);
<a name="l00188"></a>00188 
<a name="l00190"></a>00190   <span class="keywordtype">double</span> ymin[3], ymax[3];
<a name="l00191"></a>00191 
<a name="l00193"></a>00193   <a class="code" href="group__nfft.html#g4b44c1dd52026dcb494dc735f0fa5b08" title="Computes an adjoint NFFT, see the definition.">nfft_adjoint</a>(&amp;(plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#41da99ba24cced38e30e886ccc9d46b5" title="source nfft plan">mv1</a>));
<a name="l00194"></a>00194 
<a name="l00196"></a>00196   <span class="keywordflow">for</span> (k=0; k&lt;plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#4e16f1a797a3217e54bbd5b4fe057dcb" title="target nfft plan">mv2</a>.<a class="code" href="structnfft__plan.html#d33daddf76670c8731c759bf74ad0d22" title="Total number of Fourier \ coefficients.">N_total</a>; k++)
<a name="l00197"></a>00197     plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#4e16f1a797a3217e54bbd5b4fe057dcb" title="target nfft plan">mv2</a>.<a class="code" href="structnfft__plan.html#23409aec68871e9a56f11711e2891691" title="Vector of Fourier coefficients, \ size is N_total float_types.">f_hat</a>[k] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#f8e5c612c9a1bb2a1a8ad30d37fba10c" title="expansion coefficients">b</a>[k] * plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#41da99ba24cced38e30e886ccc9d46b5" title="source nfft plan">mv1</a>.<a class="code" href="structnfft__plan.html#23409aec68871e9a56f11711e2891691" title="Vector of Fourier coefficients, \ size is N_total float_types.">f_hat</a>[k];
<a name="l00198"></a>00198 
<a name="l00200"></a>00200   <a class="code" href="group__nfft.html#g9f1e6bd9f7f956a8679e6b413c97b421" title="Computes a NFFT, see the definition.">nfft_trafo</a>(&amp;(plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#4e16f1a797a3217e54bbd5b4fe057dcb" title="target nfft plan">mv2</a>));
<a name="l00201"></a>00201   <span class="keywordflow">for</span>(j = 0; j &lt; plan-&gt;<a class="code" href="structfields__fastsum__plan.html#9e6c7fdded131315c670e971b29fb5e0" title="api">N_total</a>; j++) {
<a name="l00202"></a>00202     plan-&gt;<a class="code" href="structfields__fastsum__plan.html#77d68a77ebcefd9cf9d8ec75a5fd6007" title="self-induced field at each source knot">E</a>[j*3] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a>[j*3] * creal(plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#4e16f1a797a3217e54bbd5b4fe057dcb" title="target nfft plan">mv2</a>.<a class="code" href="structnfft__plan.html#fa27a166f809acf70ae27e5e6f28daa5" title="Vector of samples, \ size is M_total float types.">f</a>[j]);
<a name="l00203"></a>00203     plan-&gt;<a class="code" href="structfields__fastsum__plan.html#77d68a77ebcefd9cf9d8ec75a5fd6007" title="self-induced field at each source knot">E</a>[j*3+1] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a>[j*3+1] * creal(plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#4e16f1a797a3217e54bbd5b4fe057dcb" title="target nfft plan">mv2</a>.<a class="code" href="structnfft__plan.html#fa27a166f809acf70ae27e5e6f28daa5" title="Vector of samples, \ size is M_total float types.">f</a>[j]);
<a name="l00204"></a>00204     plan-&gt;<a class="code" href="structfields__fastsum__plan.html#77d68a77ebcefd9cf9d8ec75a5fd6007" title="self-induced field at each source knot">E</a>[j*3+2] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#14b91ce119e2a1926250d22ee4b47748" title="source knots in ball with radius 1/4-eps_b/2">r</a>[j*3+2] * creal(plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#4e16f1a797a3217e54bbd5b4fe057dcb" title="target nfft plan">mv2</a>.<a class="code" href="structnfft__plan.html#fa27a166f809acf70ae27e5e6f28daa5" title="Vector of samples, \ size is M_total float types.">f</a>[j]);
<a name="l00205"></a>00205   }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207   <span class="keywordflow">for</span>(t = 0; t &lt; 3; t++) {
<a name="l00209"></a>00209     <span class="keywordflow">for</span>(k = 0; k &lt; plan-&gt;<a class="code" href="structfields__fastsum__plan.html#9e6c7fdded131315c670e971b29fb5e0" title="api">N_total</a>; k++)
<a name="l00210"></a>00210       plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#41da99ba24cced38e30e886ccc9d46b5" title="source nfft plan">mv1</a>.<a class="code" href="structnfft__plan.html#fa27a166f809acf70ae27e5e6f28daa5" title="Vector of samples, \ size is M_total float types.">f</a>[k] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#f36c72276fd20ef9c8c1b484f6cbf834" title="source coefficients">alpha</a>[k] * plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#590dd3d6fd12f3e8cbd72b8a83905760" title="source knots in d-ball with radius 1/4-eps_b/2">x</a>[3*k+t];
<a name="l00211"></a>00211     <a class="code" href="group__nfft.html#g4b44c1dd52026dcb494dc735f0fa5b08" title="Computes an adjoint NFFT, see the definition.">nfft_adjoint</a>(&amp;(plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#41da99ba24cced38e30e886ccc9d46b5" title="source nfft plan">mv1</a>));
<a name="l00212"></a>00212 
<a name="l00214"></a>00214     <span class="keywordflow">for</span> (k=0; k&lt;plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#4e16f1a797a3217e54bbd5b4fe057dcb" title="target nfft plan">mv2</a>.<a class="code" href="structnfft__plan.html#d33daddf76670c8731c759bf74ad0d22" title="Total number of Fourier \ coefficients.">N_total</a>; k++)
<a name="l00215"></a>00215       plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#4e16f1a797a3217e54bbd5b4fe057dcb" title="target nfft plan">mv2</a>.<a class="code" href="structnfft__plan.html#23409aec68871e9a56f11711e2891691" title="Vector of Fourier coefficients, \ size is N_total float_types.">f_hat</a>[k] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#f8e5c612c9a1bb2a1a8ad30d37fba10c" title="expansion coefficients">b</a>[k] * plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#41da99ba24cced38e30e886ccc9d46b5" title="source nfft plan">mv1</a>.<a class="code" href="structnfft__plan.html#23409aec68871e9a56f11711e2891691" title="Vector of Fourier coefficients, \ size is N_total float_types.">f_hat</a>[k];
<a name="l00216"></a>00216 
<a name="l00218"></a>00218     <a class="code" href="group__nfft.html#g9f1e6bd9f7f956a8679e6b413c97b421" title="Computes a NFFT, see the definition.">nfft_trafo</a>(&amp;(plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#4e16f1a797a3217e54bbd5b4fe057dcb" title="target nfft plan">mv2</a>));
<a name="l00219"></a>00219     <span class="keywordflow">for</span>(j = 0; j &lt; plan-&gt;<a class="code" href="structfields__fastsum__plan.html#9e6c7fdded131315c670e971b29fb5e0" title="api">N_total</a>; j++)
<a name="l00220"></a>00220       plan-&gt;<a class="code" href="structfields__fastsum__plan.html#77d68a77ebcefd9cf9d8ec75a5fd6007" title="self-induced field at each source knot">E</a>[j*3+t] -= creal(plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#4e16f1a797a3217e54bbd5b4fe057dcb" title="target nfft plan">mv2</a>.<a class="code" href="structnfft__plan.html#fa27a166f809acf70ae27e5e6f28daa5" title="Vector of samples, \ size is M_total float types.">f</a>[j]);
<a name="l00221"></a>00221   }
<a name="l00222"></a>00222 
<a name="l00224"></a>00224   <span class="keywordflow">for</span> (j=0; j&lt;plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#7c55ef5f14439f86f01b4e06281aa01d" title="number of target knots">M_total</a>; j++)
<a name="l00225"></a>00225   {
<a name="l00226"></a>00226     ymin[0] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#79615d0f0d38b754742c3ff445b6c733" title="target knots in d-ball with radius 1/4-eps_b/2">y</a>[3*j] - plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#02e7e2f5e7b0f5713331bd129aad8192" title="inner boundary">eps_I</a>;
<a name="l00227"></a>00227     ymax[0] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#79615d0f0d38b754742c3ff445b6c733" title="target knots in d-ball with radius 1/4-eps_b/2">y</a>[3*j] + plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#02e7e2f5e7b0f5713331bd129aad8192" title="inner boundary">eps_I</a>;
<a name="l00228"></a>00228     ymin[1] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#79615d0f0d38b754742c3ff445b6c733" title="target knots in d-ball with radius 1/4-eps_b/2">y</a>[3*j+1] - plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#02e7e2f5e7b0f5713331bd129aad8192" title="inner boundary">eps_I</a>;
<a name="l00229"></a>00229     ymax[1] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#79615d0f0d38b754742c3ff445b6c733" title="target knots in d-ball with radius 1/4-eps_b/2">y</a>[3*j+1] + plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#02e7e2f5e7b0f5713331bd129aad8192" title="inner boundary">eps_I</a>;
<a name="l00230"></a>00230     ymin[2] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#79615d0f0d38b754742c3ff445b6c733" title="target knots in d-ball with radius 1/4-eps_b/2">y</a>[3*j+2] - plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#02e7e2f5e7b0f5713331bd129aad8192" title="inner boundary">eps_I</a>;
<a name="l00231"></a>00231     ymax[2] = plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#79615d0f0d38b754742c3ff445b6c733" title="target knots in d-ball with radius 1/4-eps_b/2">y</a>[3*j+2] + plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#02e7e2f5e7b0f5713331bd129aad8192" title="inner boundary">eps_I</a>;
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     <a class="code" href="fields__fastsum_8c.html#d4e032eccbc6fa9063f7d4b74f2667f6" title="fast search in tree of source knots for near field computation, modified version...">FieldsSearchTree</a>(plan-&gt;<a class="code" href="structfields__fastsum__plan.html#77d68a77ebcefd9cf9d8ec75a5fd6007" title="self-induced field at each source knot">E</a>+3*j, 0, plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#590dd3d6fd12f3e8cbd72b8a83905760" title="source knots in d-ball with radius 1/4-eps_b/2">x</a>, plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#f36c72276fd20ef9c8c1b484f6cbf834" title="source coefficients">alpha</a>, ymin, ymax, plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#45fd4a73ba0f2b5795364d6d3a239a85" title="number of source knots">N_total</a>, plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.kernel, plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#e494d11cd336be135f7a93d112a16852" title="parameters for kernel function">kernel_param</a>, plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#d0217e28060b4f3992de52511b6b8a04" title="near field">Ad</a>, plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#cc2829808e91847449790147ee775943" title="spline values">Add</a>, plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#50bdfe4efb1b7df3556347cc7cffe945" title="degree of smoothness of regularization">p</a>, plan-&gt;<a class="code" href="structfields__fastsum__plan.html#3d6cdb7e962a19abec6faa6e532e2745" title="internal">fsum</a>.<a class="code" href="structfastsum__plan.html#3d264dc33ae01a71908311ac9b7eadc2" title="flags precomp.">flags</a>);
<a name="l00234"></a>00234 
<a name="l00235"></a>00235     plan-&gt;<a class="code" href="structfields__fastsum__plan.html#77d68a77ebcefd9cf9d8ec75a5fd6007" title="self-induced field at each source knot">E</a>[j*3] *= E_pre;
<a name="l00236"></a>00236     plan-&gt;<a class="code" href="structfields__fastsum__plan.html#77d68a77ebcefd9cf9d8ec75a5fd6007" title="self-induced field at each source knot">E</a>[j*3+1] *= E_pre;
<a name="l00237"></a>00237     plan-&gt;<a class="code" href="structfields__fastsum__plan.html#77d68a77ebcefd9cf9d8ec75a5fd6007" title="self-induced field at each source knot">E</a>[j*3+2] *= E_pre;
<a name="l00238"></a>00238   }
<a name="l00239"></a>00239 }
<a name="l00240"></a>00240 
</pre></div>    <hr size="1"/>
    Generated on 17 Aug 2009 by Doxygen 1.5.3
  </body>
</html>
