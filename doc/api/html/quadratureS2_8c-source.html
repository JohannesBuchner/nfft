<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.3 API Reference - NFFT: quadratureS2.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.3 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000006.html">applications</a>&nbsp;/&nbsp;<a class="el" href="dir_000014.html">quadratureS2</a></div>
<h1>quadratureS2.c</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">/* $Id: quadratureS2.c 1157 2006-10-30 16:35:43Z keiner $</span>
00002 <span class="comment"> *</span>
00003 <span class="comment"> * fastsumS2 - Fast summation of spherical radial functions</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * Copyright (C) 2005 Jens Keiner</span>
00006 <span class="comment"> *</span>
00007 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
00008 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
00009 <span class="comment"> * the Free Software Foundation; either version 2, or (at your option)</span>
00010 <span class="comment"> * any later version.</span>
00011 <span class="comment"> *</span>
00012 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
00013 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00014 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00015 <span class="comment"> * GNU General Public License for more details.</span>
00016 <span class="comment"> *</span>
00017 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
00018 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
00019 <span class="comment"> * Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
00020 <span class="comment"> */</span>
00021 
00028 <span class="comment">/* Include standard C headers. */</span>
00029 <span class="preprocessor">#include &lt;math.h&gt;</span>
00030 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00031 <span class="comment">/* extern double drand48 (void) __THROW; */</span>
00032 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00033 <span class="preprocessor">#include &lt;string.h&gt;</span>
00034 <span class="preprocessor">#include &lt;time.h&gt;</span>
00035 
00036 <span class="comment">/* Include FFTW header. */</span>
00037 <span class="preprocessor">#include &lt;fftw3.h&gt;</span>
00038 
00039 <span class="comment">/* Include NFFT 3 library header. */</span>
00040 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00041 
00042 <span class="comment">/* Include NFFT 3 utilities headers. */</span>
00043 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00044 
<a name="l00046"></a><a class="code" href="group__applications__quadratureS2__test.html#ga1">00046</a> <span class="keyword">enum</span> <span class="keywordtype">boolean</span> {NO = 0, YES = 1};
00047 
<a name="l00049"></a><a class="code" href="group__applications__quadratureS2__test.html#ga2">00049</a> <span class="keyword">enum</span> <a class="code" href="group__applications__quadratureS2__test.html#ga2">testtype</a> {ERROR = 0, TIMING = 1};
00050 
<a name="l00052"></a><a class="code" href="group__applications__quadratureS2__test.html#ga3">00052</a> <span class="keyword">enum</span> <a class="code" href="group__applications__quadratureS2__test.html#ga3">gridtype</a> {GRID_GAUSS_LEGENDRE = 0, GRID_CLENSHAW_CURTIS = 1,
00053   GRID_HEALPIX = 2, GRID_EQUIDISTRIBUTION = 3, GRID_EQUIDISTRIBUTION_UNIFORM = 4};
00054 
<a name="l00056"></a><a class="code" href="group__applications__quadratureS2__test.html#ga4">00056</a> <span class="keyword">enum</span> <a class="code" href="group__applications__quadratureS2__test.html#ga4">functiontype</a> {FUNCTION_RANDOM_BANDLIMITED = 0, FUNCTION_F1 = 1,
00057   FUNCTION_F2 = 2, FUNCTION_F3 = 3, FUNCTION_F4 = 4, FUNCTION_F5 = 5,
00058   FUNCTION_F6 = 6};
00059 
<a name="l00061"></a><a class="code" href="group__applications__quadratureS2__test.html#ga5">00061</a> <span class="keyword">enum</span> <a class="code" href="group__applications__quadratureS2__test.html#ga5">modes</a> {USE_GRID = 0, RANDOM = 1};
00062 
<a name="l00071"></a><a class="code" href="group__applications__quadratureS2__test.html#ga0">00071</a> <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
00072 {
00073   <span class="keywordtype">int</span> tc;                      
00074   <span class="keywordtype">int</span> tc_max;                  
00076   <span class="keywordtype">int</span> *NQ;                     
00078   <span class="keywordtype">int</span> NQ_max;                  
00080   <span class="keywordtype">int</span> *SQ;                     
00082   <span class="keywordtype">int</span> SQ_max;                  
00083   <span class="keywordtype">int</span> *RQ;                     
00085   <span class="keywordtype">int</span> iNQ;                     
00086   <span class="keywordtype">int</span> iNQ_max;                 
00087   <span class="keywordtype">int</span> testfunction;            
00088   <span class="keywordtype">int</span> N;                       
00090   <span class="keywordtype">int</span> use_nfsft;               
00091   <span class="keywordtype">int</span> use_nfft;                
00092   <span class="keywordtype">int</span> use_fpt;                 
00093   <span class="keywordtype">int</span> cutoff;                  
00094   <span class="keywordtype">double</span> threshold;            
00096   <span class="keywordtype">int</span> <a class="code" href="group__applications__quadratureS2__test.html#ga3">gridtype</a>;                
00097   <span class="keywordtype">int</span> repetitions;             
00098   <span class="keywordtype">int</span> mode;                    
00100   <span class="keywordtype">double</span> *w;                   
00101   <span class="keywordtype">double</span> *x_grid;              
00102   <span class="keywordtype">double</span> *x_compare;           
00103   <span class="keywordtype">double</span> complex *f_grid;             
00104   <span class="keywordtype">double</span> complex *f_compare;          
00105   <span class="keywordtype">double</span> complex *f;                  
00106   <span class="keywordtype">double</span> complex *f_hat_gen;         
00108   <span class="keywordtype">double</span> complex *f_hat;              
00110   <a class="code" href="structnfsft__plan.html">nfsft_plan</a> plan_adjoint;     
00111   <a class="code" href="structnfsft__plan.html">nfsft_plan</a> plan;             
00112   <a class="code" href="structnfsft__plan.html">nfsft_plan</a> plan_gen;         
00114   <span class="keywordtype">double</span> t;                    
00116   <span class="keywordtype">double</span> t_avg;                
00117   <span class="keywordtype">double</span> err_infty_avg;        
00118   <span class="keywordtype">double</span> err_2_avg;            
00120   <span class="keywordtype">int</span> i;                       
00121   <span class="keywordtype">int</span> k;                       
00122   <span class="keywordtype">int</span> n;                       
00123   <span class="keywordtype">int</span> d;                       
00125   <span class="keywordtype">int</span> m_theta;                 
00127   <span class="keywordtype">int</span> m_phi;                   
00129   <span class="keywordtype">int</span> m_total;                 
00130   <span class="keywordtype">double</span> *theta;               
00132   <span class="keywordtype">double</span> *phi;                 
00134   fftw_plan fplan;             
00136   <span class="comment">//int nside;                   /**&lt; The size parameter for the HEALPix grid   */</span>
00137   <span class="keywordtype">int</span> d2;
00138   <span class="keywordtype">int</span> M;
00139   <span class="keywordtype">double</span> theta_s;
00140   <span class="keywordtype">double</span> x1,x2,x3,temp;
00141   <span class="keywordtype">int</span> m_compare;
00142   <a class="code" href="structnfsft__plan.html">nfsft_plan</a> *plan_adjoint_ptr;
00143   <a class="code" href="structnfsft__plan.html">nfsft_plan</a> *plan_ptr;
00144   <span class="keywordtype">double</span> *w_temp;
00145   <span class="keywordtype">int</span> testmode;
00146 
00147   <span class="comment">/* Read the number of testcases. */</span>
00148   fscanf(stdin,<span class="stringliteral">"testcases=%d\n"</span>,&amp;tc_max);
00149   fprintf(stdout,<span class="stringliteral">"%d\n"</span>,tc_max);
00150 
00151   <span class="comment">/* Process each testcase. */</span>
00152   <span class="keywordflow">for</span> (tc = 0; tc &lt; tc_max; tc++)
00153   {
00154     <span class="comment">/* Check if the fast transform shall be used. */</span>
00155     fscanf(stdin,<span class="stringliteral">"nfsft=%d\n"</span>,&amp;use_nfsft);
00156     fprintf(stdout,<span class="stringliteral">"%d\n"</span>,use_nfsft);
00157     <span class="keywordflow">if</span> (use_nfsft != NO)
00158     {
00159       <span class="comment">/* Check if the NFFT shall be used. */</span>
00160       fscanf(stdin,<span class="stringliteral">"nfft=%d\n"</span>,&amp;use_nfft);
00161       fprintf(stdout,<span class="stringliteral">"%d\n"</span>,use_nfsft);
00162       <span class="keywordflow">if</span> (use_nfft != NO)
00163       {
00164         <span class="comment">/* Read the cut-off parameter. */</span>
00165         fscanf(stdin,<span class="stringliteral">"cutoff=%d\n"</span>,&amp;cutoff);
00166         fprintf(stdout,<span class="stringliteral">"%d\n"</span>,cutoff);
00167       }
00168       <span class="keywordflow">else</span>
00169       {
00170         <span class="comment">/* TODO remove this */</span>
00171         <span class="comment">/* Initialize unused variable with dummy value. */</span>
00172         cutoff = 1;
00173       }
00174       <span class="comment">/* Check if the fast polynomial transform shall be used. */</span>
00175       fscanf(stdin,<span class="stringliteral">"fpt=%d\n"</span>,&amp;use_fpt);
00176       fprintf(stdout,<span class="stringliteral">"%d\n"</span>,use_fpt);
00177       <span class="keywordflow">if</span> (use_fpt != NO)
00178       {
00179         <span class="comment">/* Read the NFSFT threshold parameter. */</span>
00180         fscanf(stdin,<span class="stringliteral">"threshold=%lf\n"</span>,&amp;threshold);
00181         fprintf(stdout,<span class="stringliteral">"%lf\n"</span>,threshold);
00182       }
00183       <span class="keywordflow">else</span>
00184       {
00185         <span class="comment">/* TODO remove this */</span>
00186         <span class="comment">/* Initialize unused variable with dummy value. */</span>
00187         threshold = 1000.0;
00188       }
00189     }
00190     <span class="keywordflow">else</span>
00191     {
00192       <span class="comment">/* TODO remove this */</span>
00193       <span class="comment">/* Set dummy values. */</span>
00194       use_nfft = NO;
00195       use_fpt = NO;
00196       cutoff = 3;
00197       threshold = 1000.0;
00198     }
00199 
00200     <span class="comment">/* Read the testmode type. */</span>
00201     fscanf(stdin,<span class="stringliteral">"testmode=%d\n"</span>,&amp;testmode);
00202     fprintf(stdout,<span class="stringliteral">"%d\n"</span>,testmode);
00203 
00204     <span class="keywordflow">if</span> (testmode == ERROR)
00205     {
00206       <span class="comment">/* Read the quadrature grid type. */</span>
00207       fscanf(stdin,<span class="stringliteral">"gridtype=%d\n"</span>,&amp;<a class="code" href="group__applications__quadratureS2__test.html#ga3">gridtype</a>);
00208       fprintf(stdout,<span class="stringliteral">"%d\n"</span>,<a class="code" href="group__applications__quadratureS2__test.html#ga3">gridtype</a>);
00209 
00210       <span class="comment">/* Read the test function. */</span>
00211       fscanf(stdin,<span class="stringliteral">"testfunction=%d\n"</span>,&amp;testfunction);
00212       fprintf(stdout,<span class="stringliteral">"%d\n"</span>,testfunction);
00213 
00214       <span class="comment">/* Check if random bandlimited function has been chosen. */</span>
00215       <span class="keywordflow">if</span> (testfunction == FUNCTION_RANDOM_BANDLIMITED)
00216       {
00217         <span class="comment">/* Read the bandwidht. */</span>
00218         fscanf(stdin,<span class="stringliteral">"bandlimit=%d\n"</span>,&amp;N);
00219         fprintf(stdout,<span class="stringliteral">"%d\n"</span>,N);
00220       }
00221       <span class="keywordflow">else</span>
00222       {
00223         N = 1;
00224       }
00225 
00226       <span class="comment">/* Read the number of repetitions. */</span>
00227       fscanf(stdin,<span class="stringliteral">"repetitions=%d\n"</span>,&amp;repetitions);
00228       fprintf(stdout,<span class="stringliteral">"%d\n"</span>,repetitions);
00229 
00230       fscanf(stdin,<span class="stringliteral">"mode=%d\n"</span>,&amp;mode);
00231       fprintf(stdout,<span class="stringliteral">"%d\n"</span>,mode);
00232 
00233       <span class="keywordflow">if</span> (mode == RANDOM)
00234       {
00235         <span class="comment">/* Read the bandwidht. */</span>
00236         fscanf(stdin,<span class="stringliteral">"points=%d\n"</span>,&amp;m_compare);
00237         fprintf(stdout,<span class="stringliteral">"%d\n"</span>,m_compare);
00238         x_compare = (<span class="keywordtype">double</span>*) malloc(2*m_compare*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00239         d = 0;
00240         <span class="keywordflow">while</span> (d &lt; m_compare)
00241         {
00242           x1 = 2.0*(((double)rand())/RAND_MAX) - 1.0;
00243           x2 = 2.0*(((double)rand())/RAND_MAX) - 1.0;
00244           x3 = 2.0*(((double)rand())/RAND_MAX) - 1.0;
00245           temp = sqrt(x1*x1+x2*x2+x3*x3);
00246           <span class="keywordflow">if</span> (temp &lt;= 1)
00247           {
00248             x_compare[2*d+1] = acos(x3);
00249             <span class="keywordflow">if</span> (x_compare[2*d+1] == 0 || x_compare[2*d+1] == <a class="code" href="group__nfftutil.html#ga57">PI</a>)
00250             {
00251               x_compare[2*d] = 0.0;
00252             }
00253             <span class="keywordflow">else</span>
00254             {
00255               x_compare[2*d] = atan2(x2/sin(x_compare[2*d+1]),x1/sin(x_compare[2*d+1]));
00256             }
00257             x_compare[2*d] *= 1.0/(2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00258             x_compare[2*d+1] *= 1.0/(2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00259             d++;
00260           }
00261         }
00262         f_compare = (<span class="keywordtype">double</span> complex*) malloc(m_compare*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00263         f = (<span class="keywordtype">double</span> complex*) malloc(m_compare*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00264       }
00265     }
00266 
00267     <span class="comment">/* Initialize maximum cut-off degree and grid size parameter. */</span>
00268     NQ_max = 0;
00269     SQ_max = 0;
00270 
00271     <span class="comment">/* Read the number of cut-off degrees. */</span>
00272     fscanf(stdin,<span class="stringliteral">"bandwidths=%d\n"</span>,&amp;iNQ_max);
00273     fprintf(stdout,<span class="stringliteral">"%d\n"</span>,iNQ_max);
00274 
00275     <span class="comment">/* Allocate memory for the cut-off degrees and grid size parameters. */</span>
00276     NQ = (<span class="keywordtype">int</span>*) malloc(iNQ_max*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
00277     SQ = (<span class="keywordtype">int</span>*) malloc(iNQ_max*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
00278     <span class="keywordflow">if</span> (testmode == TIMING)
00279     {
00280       RQ = (<span class="keywordtype">int</span>*) malloc(iNQ_max*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
00281     }
00282 
00283     <span class="comment">/* Read the cut-off degrees and grid size parameters. */</span>
00284     <span class="keywordflow">for</span> (iNQ = 0; iNQ &lt; iNQ_max; iNQ++)
00285     {
00286       <span class="keywordflow">if</span> (testmode == TIMING)
00287       {
00288         <span class="comment">/* Read cut-off degree and grid size parameter. */</span>
00289         fscanf(stdin,<span class="stringliteral">"%d %d %d\n"</span>,&amp;NQ[iNQ],&amp;SQ[iNQ],&amp;RQ[iNQ]);
00290         fprintf(stdout,<span class="stringliteral">"%d %d %d\n"</span>,NQ[iNQ],SQ[iNQ],RQ[iNQ]);
00291         NQ_max = <a class="code" href="group__nfftutil.html#ga58">NFFT_MAX</a>(NQ_max,NQ[iNQ]);
00292         SQ_max = <a class="code" href="group__nfftutil.html#ga58">NFFT_MAX</a>(SQ_max,SQ[iNQ]);
00293       }
00294       <span class="keywordflow">else</span>
00295       {
00296         <span class="comment">/* Read cut-off degree and grid size parameter. */</span>
00297         fscanf(stdin,<span class="stringliteral">"%d %d\n"</span>,&amp;NQ[iNQ],&amp;SQ[iNQ]);
00298         fprintf(stdout,<span class="stringliteral">"%d %d\n"</span>,NQ[iNQ],SQ[iNQ]);
00299         NQ_max = <a class="code" href="group__nfftutil.html#ga58">NFFT_MAX</a>(NQ_max,NQ[iNQ]);
00300         SQ_max = <a class="code" href="group__nfftutil.html#ga58">NFFT_MAX</a>(SQ_max,SQ[iNQ]);
00301       }
00302     }
00303 
00304     <span class="comment">/* Do precomputation. */</span>
00305     <span class="comment">//fprintf(stderr,"NFSFT Precomputation\n");</span>
00306     <span class="comment">//fflush(stderr);</span>
00307     <a class="code" href="group__nfsft.html#ga4">nfsft_precompute</a>(NQ_max, threshold,
00308       ((use_nfsft==NO)?(<a class="code" href="group__nfsft.html#ga38">NFSFT_NO_FAST_ALGORITHM</a>):(0U)), 0U);
00309 
00310     <span class="keywordflow">if</span> (testmode == TIMING)
00311     {
00312       <span class="comment">/* Allocate data structures. */</span>
00313       f_hat = (<span class="keywordtype">double</span> complex*) malloc(<a class="code" href="group__nfsft.html#ga41">NFSFT_F_HAT_SIZE</a>(NQ_max)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00314       f = (<span class="keywordtype">double</span> complex*) malloc(SQ_max*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00315       x_grid = (<span class="keywordtype">double</span>*) malloc(2*SQ_max*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00316       <span class="keywordflow">for</span> (d = 0; d &lt; SQ_max; d++)
00317       {
00318         f[d] = (((double)rand())/RAND_MAX)-0.5 + I*((((double)rand())/RAND_MAX)-0.5);
00319         x_grid[2*d] = (((double)rand())/RAND_MAX) - 0.5;
00320         x_grid[2*d+1] = (((double)rand())/RAND_MAX) * 0.5;
00321       }
00322     }
00323 
00324     <span class="comment">//fprintf(stderr,"Entering loop\n");</span>
00325     <span class="comment">//fflush(stderr);</span>
00326     <span class="comment">/* Process all cut-off bandwidths. */</span>
00327     <span class="keywordflow">for</span> (iNQ = 0; iNQ &lt; iNQ_max; iNQ++)
00328     {
00329       <span class="keywordflow">if</span> (testmode == TIMING)
00330       {
00331         <a class="code" href="group__nfsft.html#ga3">nfsft_init_guru</a>(&amp;plan,NQ[iNQ],SQ[iNQ], <a class="code" href="group__nfsft.html#ga25">NFSFT_NORMALIZED</a> |
00332           ((use_nfft!=NO)?(0U):(<a class="code" href="group__nfsft.html#ga26">NFSFT_USE_NDFT</a>)) |
00333           ((use_fpt!=NO)?(0U):(<a class="code" href="group__nfsft.html#ga27">NFSFT_USE_DPT</a>)),
00334           <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a> | <a class="code" href="group__nfft.html#ga20">PRE_PSI</a> | <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a> | FFTW_MEASURE | <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00335           cutoff);
00336 
00337         plan.<a class="code" href="structnfsft__plan.html#o2">f_hat</a> = f_hat;
00338         plan.<a class="code" href="structnfsft__plan.html#o5">x</a> = x_grid;
00339         plan.<a class="code" href="structnfsft__plan.html#o3">f</a> = f;
00340 
00341         nfsft_precompute_x(&amp;plan);
00342 
00343         t_avg = 0.0;
00344 
00345         <span class="keywordflow">for</span> (i = 0; i &lt; RQ[iNQ]; i++)
00346         {
00347           t = <a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00348 
00349           <span class="keywordflow">if</span> (use_nfsft != NO)
00350           {
00351             <span class="comment">/* Execute the adjoint NFSFT transformation. */</span>
00352             <a class="code" href="group__nfsft.html#ga9">nfsft_adjoint</a>(&amp;plan);
00353           }
00354           <span class="keywordflow">else</span>
00355           {
00356             <span class="comment">/* Execute the adjoint direct NDSFT transformation. */</span>
00357             <a class="code" href="group__nfsft.html#ga7">ndsft_adjoint</a>(&amp;plan);
00358           }
00359 
00360           t_avg += <a class="code" href="group__nfftutil.html#ga0">nfft_second</a>() - t;
00361         }
00362 
00363         t_avg = t_avg/((double)RQ[iNQ]);
00364 
00365         <a class="code" href="group__nfsft.html#ga10">nfsft_finalize</a>(&amp;plan);
00366 
00367         fprintf(stdout,<span class="stringliteral">"%+le\n"</span>, t_avg);
00368         fprintf(stderr,<span class="stringliteral">"%d: %4d %4d %+le\n"</span>, tc, NQ[iNQ], SQ[iNQ], t_avg);
00369       }
00370       <span class="keywordflow">else</span>
00371       {
00372         <span class="comment">/* Determine the maximum number of nodes. */</span>
00373         <span class="keywordflow">switch</span> (<a class="code" href="group__applications__quadratureS2__test.html#ga3">gridtype</a>)
00374         {
00375           <span class="keywordflow">case</span> GRID_GAUSS_LEGENDRE:
00376             <span class="comment">/* Calculate grid dimensions. */</span>
00377             m_theta = SQ[iNQ] + 1;
00378             m_phi = 2*SQ[iNQ] + 2;
00379             m_total = m_theta*m_phi;
00380             <span class="keywordflow">break</span>;
00381           <span class="keywordflow">case</span> GRID_CLENSHAW_CURTIS:
00382             <span class="comment">/* Calculate grid dimensions. */</span>
00383             m_theta = 2*SQ[iNQ] + 1;
00384             m_phi = 2*SQ[iNQ] + 2;
00385             m_total = m_theta*m_phi;
00386             <span class="keywordflow">break</span>;
00387           <span class="keywordflow">case</span> GRID_HEALPIX:
00388             m_theta = 1;
00389             m_phi = 12*SQ[iNQ]*SQ[iNQ];
00390             m_total = m_theta * m_phi;
00391             <span class="comment">//fprintf("HEALPix: SQ = %d, m_theta = %d, m_phi= %d, m");</span>
00392             <span class="keywordflow">break</span>;
00393           <span class="keywordflow">case</span> GRID_EQUIDISTRIBUTION:
00394           <span class="keywordflow">case</span> GRID_EQUIDISTRIBUTION_UNIFORM:
00395             m_theta = 2;
00396             <span class="comment">//fprintf(stderr,"ed: m_theta = %d\n",m_theta);</span>
00397             <span class="keywordflow">for</span> (k = 1; k &lt; SQ[iNQ]; k++)
00398             {
00399               m_theta += (int)floor((2*<a class="code" href="group__nfftutil.html#ga57">PI</a>)/acos((cos(<a class="code" href="group__nfftutil.html#ga57">PI</a>/(<span class="keywordtype">double</span>)SQ[iNQ])-
00400                 cos(k*<a class="code" href="group__nfftutil.html#ga57">PI</a>/(<span class="keywordtype">double</span>)SQ[iNQ])*cos(k*<a class="code" href="group__nfftutil.html#ga57">PI</a>/(<span class="keywordtype">double</span>)SQ[iNQ]))/
00401                 (sin(k*<a class="code" href="group__nfftutil.html#ga57">PI</a>/(<span class="keywordtype">double</span>)SQ[iNQ])*sin(k*<a class="code" href="group__nfftutil.html#ga57">PI</a>/(<span class="keywordtype">double</span>)SQ[iNQ]))));
00402               <span class="comment">//fprintf(stderr,"ed: m_theta = %d\n",m_theta);</span>
00403             }
00404             <span class="comment">//fprintf(stderr,"ed: m_theta final = %d\n",m_theta);</span>
00405             m_phi = 1;
00406             m_total = m_theta * m_phi;
00407             <span class="keywordflow">break</span>;
00408         }
00409 
00410         <span class="comment">/* Allocate memory for data structures. */</span>
00411         w = (<span class="keywordtype">double</span>*) malloc(m_theta*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00412         x_grid = (<span class="keywordtype">double</span>*) malloc(2*m_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00413 
00414         <span class="comment">//fprintf(stderr,"NQ = %d\n",NQ[iNQ]);</span>
00415         <span class="comment">//fflush(stderr);</span>
00416         <span class="keywordflow">switch</span> (<a class="code" href="group__applications__quadratureS2__test.html#ga3">gridtype</a>)
00417         {
00418           <span class="keywordflow">case</span> GRID_GAUSS_LEGENDRE:
00419             <span class="comment">//fprintf(stderr,"Generating grid for NQ = %d, SQ = %d\n",NQ[iNQ],SQ[iNQ]);</span>
00420             <span class="comment">//fflush(stderr);</span>
00421 
00422             <span class="comment">/* Read quadrature weights. */</span>
00423             <span class="keywordflow">for</span> (k = 0; k &lt; m_theta; k++)
00424             {
00425               fscanf(stdin,<span class="stringliteral">"%le\n"</span>,&amp;w[k]);
00426               w[k] *= (2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)/((double)m_phi);
00427             }
00428 
00429             <span class="comment">//fprintf(stderr,"Allocating theta and phi\n");</span>
00430             <span class="comment">//fflush(stderr);</span>
00431             <span class="comment">/* Allocate memory to store the grid's angles. */</span>
00432             theta = (<span class="keywordtype">double</span>*) malloc(m_theta*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00433             phi = (<span class="keywordtype">double</span>*) malloc(m_phi*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00434 
00435             <span class="comment">//if (theta == NULL || phi == NULL)</span>
00436             <span class="comment">//{</span>
00437               <span class="comment">//fprintf(stderr,"Couldn't allocate theta and phi\n");</span>
00438               <span class="comment">//fflush(stderr);</span>
00439             <span class="comment">//}</span>
00440 
00441 
00442             <span class="comment">/* Read angles theta. */</span>
00443             <span class="keywordflow">for</span> (k = 0; k &lt; m_theta; k++)
00444             {
00445               fscanf(stdin,<span class="stringliteral">"%le\n"</span>,&amp;theta[k]);
00446             }
00447 
00448             <span class="comment">/* Generate the grid angles phi. */</span>
00449             <span class="keywordflow">for</span> (n = 0; n &lt; m_phi; n++)
00450             {
00451               phi[n] = n/((double)m_phi);
00452               phi[n] -= ((phi[n]&gt;=0.5)?(1.0):(0.0));
00453             }
00454 
00455             <span class="comment">//fprintf(stderr,"Generating grid nodes\n");</span>
00456             <span class="comment">//fflush(stderr);</span>
00457 
00458             <span class="comment">/* Generate the grid's nodes. */</span>
00459             d = 0;
00460             <span class="keywordflow">for</span> (k = 0; k &lt; m_theta; k++)
00461             {
00462               <span class="keywordflow">for</span> (n = 0; n &lt; m_phi; n++)
00463               {
00464                 x_grid[2*d] = phi[n];
00465                 x_grid[2*d+1] = theta[k];
00466                 d++;
00467               }
00468             }
00469 
00470             <span class="comment">//fprintf(stderr,"Freeing theta and phi\n");</span>
00471             <span class="comment">//fflush(stderr);</span>
00472             <span class="comment">/* Free the arrays for the grid's angles. */</span>
00473             free(theta);
00474             free(phi);
00475 
00476             <span class="keywordflow">break</span>;
00477 
00478           <span class="keywordflow">case</span> GRID_CLENSHAW_CURTIS:
00479 
00480             <span class="comment">/* Allocate memory to store the grid's angles. */</span>
00481             theta = (<span class="keywordtype">double</span>*) malloc(m_theta*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00482             phi = (<span class="keywordtype">double</span>*) malloc(m_phi*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00483 
00484             <span class="comment">/* Generate the grid angles theta. */</span>
00485             <span class="keywordflow">for</span> (k = 0; k &lt; m_theta; k++)
00486             {
00487               theta[k] = k/((double)2*(m_theta-1));
00488             }
00489 
00490             <span class="comment">/* Generate the grid angles phi. */</span>
00491             <span class="keywordflow">for</span> (n = 0; n &lt; m_phi; n++)
00492             {
00493               phi[n] = n/((double)m_phi);
00494               phi[n] -= ((phi[n]&gt;=0.5)?(1.0):(0.0));
00495             }
00496 
00497             <span class="comment">/* Generate quadrature weights. */</span>
00498             fplan = fftw_plan_r2r_1d(SQ[iNQ]+1, w, w, FFTW_REDFT00, 0U);
00499             <span class="keywordflow">for</span> (k = 0; k &lt; SQ[iNQ]+1; k++)
00500             {
00501               w[k] = -2.0/(4*k*k-1);
00502             }
00503             fftw_execute(fplan);
00504             w[0] *= 0.5;
00505 
00506             <span class="keywordflow">for</span> (k = 0; k &lt; SQ[iNQ]+1; k++)
00507             {
00508               w[k] *= (2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)/((double)(m_theta-1)*m_phi);
00509               w[m_theta-1-k] = w[k];
00510             }
00511             fftw_destroy_plan(fplan);
00512 
00513             <span class="comment">/* Generate the grid's nodes. */</span>
00514             d = 0;
00515             <span class="keywordflow">for</span> (k = 0; k &lt; m_theta; k++)
00516             {
00517               <span class="keywordflow">for</span> (n = 0; n &lt; m_phi; n++)
00518               {
00519                 x_grid[2*d] = phi[n];
00520                 x_grid[2*d+1] = theta[k];
00521                 d++;
00522               }
00523             }
00524 
00525             <span class="comment">/* Free the arrays for the grid's angles. */</span>
00526             free(theta);
00527             free(phi);
00528 
00529             <span class="keywordflow">break</span>;
00530 
00531           <span class="keywordflow">case</span> GRID_HEALPIX:
00532 
00533             d = 0;
00534             <span class="keywordflow">for</span> (k = 1; k &lt;= SQ[iNQ]-1; k++)
00535             {
00536               <span class="keywordflow">for</span> (n = 0; n &lt;= 4*k-1; n++)
00537               {
00538                 x_grid[2*d+1] = 1 - (k*k)/((double)(3.0*SQ[iNQ]*SQ[iNQ]));
00539                 x_grid[2*d] =  ((n+0.5)/(4*k));
00540                 x_grid[2*d] -= (x_grid[2*d]&gt;=0.5)?(1.0):(0.0);
00541                 d++;
00542               }
00543             }
00544 
00545             d2 = d-1;
00546 
00547             <span class="keywordflow">for</span> (k = SQ[iNQ]; k &lt;= 3*SQ[iNQ]; k++)
00548             {
00549               <span class="keywordflow">for</span> (n = 0; n &lt;= 4*SQ[iNQ]-1; n++)
00550               {
00551                 x_grid[2*d+1] = 2.0/(3*SQ[iNQ])*(2*SQ[iNQ]-k);
00552                 x_grid[2*d] = (n+((k%2==0)?(0.5):(0.0)))/(4*SQ[iNQ]);
00553                 x_grid[2*d] -= (x_grid[2*d]&gt;=0.5)?(1.0):(0.0);
00554                 d++;
00555               }
00556             }
00557 
00558             <span class="keywordflow">for</span> (k = 1; k &lt;= SQ[iNQ]-1; k++)
00559             {
00560               <span class="keywordflow">for</span> (n = 0; n &lt;= 4*k-1; n++)
00561               {
00562                 x_grid[2*d+1] = -x_grid[2*d2+1];
00563                 x_grid[2*d] =  x_grid[2*d2];
00564                 d++;
00565                 d2--;
00566               }
00567             }
00568 
00569             <span class="keywordflow">for</span> (d = 0; d &lt; m_total; d++)
00570             {
00571               x_grid[2*d+1] = acos(x_grid[2*d+1])/(2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00572             }
00573 
00574             w[0] = (4.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)/(m_total);
00575             <span class="keywordflow">break</span>;
00576 
00577           <span class="keywordflow">case</span> GRID_EQUIDISTRIBUTION:
00578           <span class="keywordflow">case</span> GRID_EQUIDISTRIBUTION_UNIFORM:
00579             <span class="comment">/* TODO Compute the weights. */</span>
00580 
00581             <span class="keywordflow">if</span> (<a class="code" href="group__applications__quadratureS2__test.html#ga3">gridtype</a> == GRID_EQUIDISTRIBUTION)
00582             {
00583               w_temp = (<span class="keywordtype">double</span>*) malloc((SQ[iNQ]+1)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00584               fplan = fftw_plan_r2r_1d(SQ[iNQ]/2+1, w_temp, w_temp, FFTW_REDFT00, 0U);
00585               <span class="keywordflow">for</span> (k = 0; k &lt; SQ[iNQ]/2+1; k++)
00586               {
00587                 w_temp[k] = -2.0/(4*k*k-1);
00588               }
00589               fftw_execute(fplan);
00590               w_temp[0] *= 0.5;
00591 
00592               <span class="keywordflow">for</span> (k = 0; k &lt; SQ[iNQ]/2+1; k++)
00593               {
00594                 w_temp[k] *= (2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)/((double)(SQ[iNQ]));
00595                 w_temp[SQ[iNQ]-k] = w_temp[k];
00596               }
00597               fftw_destroy_plan(fplan);
00598             }
00599 
00600             d = 0;
00601             x_grid[2*d] = -0.5;
00602             x_grid[2*d+1] = 0.0;
00603             <span class="keywordflow">if</span> (<a class="code" href="group__applications__quadratureS2__test.html#ga3">gridtype</a> == GRID_EQUIDISTRIBUTION)
00604             {
00605               w[d] = w_temp[0];
00606             }
00607             <span class="keywordflow">else</span>
00608             {
00609               w[d] = (4.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)/(m_total);
00610             }
00611             d = 1;
00612             x_grid[2*d] = -0.5;
00613             x_grid[2*d+1] = 0.5;
00614             <span class="keywordflow">if</span> (<a class="code" href="group__applications__quadratureS2__test.html#ga3">gridtype</a> == GRID_EQUIDISTRIBUTION)
00615             {
00616               w[d] = w_temp[SQ[iNQ]];
00617             }
00618             <span class="keywordflow">else</span>
00619             {
00620               w[d] = (4.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)/(m_total);
00621             }
00622             d = 2;
00623 
00624             <span class="keywordflow">for</span> (k = 1; k &lt; SQ[iNQ]; k++)
00625             {
00626               theta_s = (double)k*<a class="code" href="group__nfftutil.html#ga57">PI</a>/(double)SQ[iNQ];
00627               M = (int)floor((2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)/acos((cos(<a class="code" href="group__nfftutil.html#ga57">PI</a>/(<span class="keywordtype">double</span>)SQ[iNQ])-
00628                 cos(theta_s)*cos(theta_s))/(sin(theta_s)*sin(theta_s))));
00629 
00630               <span class="keywordflow">for</span> (n = 0; n &lt; M; n++)
00631               {
00632                 x_grid[2*d] = (n + 0.5)/M;
00633                 x_grid[2*d] -= (x_grid[2*d]&gt;=0.5)?(1.0):(0.0);
00634                 x_grid[2*d+1] = theta_s/(2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00635                 <span class="keywordflow">if</span> (<a class="code" href="group__applications__quadratureS2__test.html#ga3">gridtype</a> == GRID_EQUIDISTRIBUTION)
00636                 {
00637                   w[d] = w_temp[k]/((double)(M));
00638                 }
00639                 <span class="keywordflow">else</span>
00640                 {
00641                   w[d] = (4.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)/(m_total);
00642                 }
00643                 d++;
00644               }
00645             }
00646 
00647             <span class="keywordflow">if</span> (<a class="code" href="group__applications__quadratureS2__test.html#ga3">gridtype</a> == GRID_EQUIDISTRIBUTION)
00648             {
00649               free(w_temp);
00650             }
00651             <span class="keywordflow">break</span>;
00652 
00653           <span class="keywordflow">default</span>:
00654             <span class="keywordflow">break</span>;
00655         }
00656 
00657         <span class="comment">/* Allocate memory for grid values. */</span>
00658         f_grid = (<span class="keywordtype">double</span> complex*) malloc(m_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00659 
00660         <span class="keywordflow">if</span> (mode == RANDOM)
00661         {
00662         }
00663         <span class="keywordflow">else</span>
00664         {
00665           m_compare = m_total;
00666           f_compare = (<span class="keywordtype">double</span> complex*) malloc(m_compare*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00667           x_compare = x_grid;
00668           f = f_grid;
00669         }
00670 
00671         <span class="comment">//fprintf(stderr,"Generating test function\n");</span>
00672         <span class="comment">//fflush(stderr);</span>
00673         <span class="keywordflow">switch</span> (testfunction)
00674         {
00675           <span class="keywordflow">case</span> FUNCTION_RANDOM_BANDLIMITED:
00676             f_hat_gen = (<span class="keywordtype">double</span> complex*) malloc(<a class="code" href="group__nfsft.html#ga41">NFSFT_F_HAT_SIZE</a>(N)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00677             <span class="comment">//fprintf(stderr,"Generating random test function\n");</span>
00678             <span class="comment">//fflush(stderr);</span>
00679             <span class="comment">/* Generate random function samples by sampling a bandlimited</span>
00680 <span class="comment">             * function. */</span>
00681             <a class="code" href="group__nfsft.html#ga3">nfsft_init_guru</a>(&amp;plan_gen,N,m_total, <a class="code" href="group__nfsft.html#ga25">NFSFT_NORMALIZED</a> |
00682               ((use_nfft!=NO)?(0U):(<a class="code" href="group__nfsft.html#ga26">NFSFT_USE_NDFT</a>)) |
00683               ((use_fpt!=NO)?(0U):(<a class="code" href="group__nfsft.html#ga27">NFSFT_USE_DPT</a>)),
00684               ((N&gt;512)?(0U):(<a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a> | <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)) | <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a> |
00685               <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>, cutoff);
00686 
00687             plan_gen.<a class="code" href="structnfsft__plan.html#o2">f_hat</a> = f_hat_gen;
00688             plan_gen.<a class="code" href="structnfsft__plan.html#o5">x</a> = x_grid;
00689             plan_gen.<a class="code" href="structnfsft__plan.html#o3">f</a> = f_grid;
00690 
00691             nfsft_precompute_x(&amp;plan_gen);
00692 
00693             <span class="keywordflow">for</span> (k = 0; k &lt; plan_gen.<a class="code" href="structnfsft__plan.html#o0">N_total</a>; k++)
00694             {
00695               f_hat_gen[k] = 0.0;
00696             }
00697 
00698             <span class="keywordflow">for</span> (k = 0; k &lt;= N; k++)
00699             {
00700               <span class="keywordflow">for</span> (n = -k; n &lt;= k; n++)
00701               {
00702                 f_hat_gen[<a class="code" href="group__nfsft.html#ga40">NFSFT_INDEX</a>(k,n,&amp;plan_gen)] =
00703                 (((double)rand())/RAND_MAX)-0.5 + I*((((double)rand())/RAND_MAX)-0.5);
00704               }
00705             }
00706 
00707             <span class="keywordflow">if</span> (use_nfsft != NO)
00708             {
00709               <span class="comment">/* Execute the NFSFT transformation. */</span>
00710               <a class="code" href="group__nfsft.html#ga8">nfsft_trafo</a>(&amp;plan_gen);
00711             }
00712             <span class="keywordflow">else</span>
00713             {
00714               <span class="comment">/* Execute the direct NDSFT transformation. */</span>
00715               <a class="code" href="group__nfsft.html#ga6">ndsft_trafo</a>(&amp;plan_gen);
00716             }
00717 
00718             <a class="code" href="group__nfsft.html#ga10">nfsft_finalize</a>(&amp;plan_gen);
00719 
00720             <span class="keywordflow">if</span> (mode == RANDOM)
00721             {
00722               <a class="code" href="group__nfsft.html#ga3">nfsft_init_guru</a>(&amp;plan_gen,N,m_compare, <a class="code" href="group__nfsft.html#ga25">NFSFT_NORMALIZED</a> |
00723                 ((use_nfft!=NO)?(0U):(<a class="code" href="group__nfsft.html#ga26">NFSFT_USE_NDFT</a>)) |
00724                 ((use_fpt!=NO)?(0U):(<a class="code" href="group__nfsft.html#ga27">NFSFT_USE_DPT</a>)),
00725                 ((N&gt;512)?(0U):(<a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a> | <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)) | <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a> |
00726                 <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>, cutoff);
00727 
00728               plan_gen.<a class="code" href="structnfsft__plan.html#o2">f_hat</a> = f_hat_gen;
00729               plan_gen.<a class="code" href="structnfsft__plan.html#o5">x</a> = x_compare;
00730               plan_gen.<a class="code" href="structnfsft__plan.html#o3">f</a> = f_compare;
00731 
00732               nfsft_precompute_x(&amp;plan_gen);
00733 
00734               <span class="keywordflow">if</span> (use_nfsft != NO)
00735               {
00736                 <span class="comment">/* Execute the NFSFT transformation. */</span>
00737                 <a class="code" href="group__nfsft.html#ga8">nfsft_trafo</a>(&amp;plan_gen);
00738               }
00739               <span class="keywordflow">else</span>
00740               {
00741                 <span class="comment">/* Execute the direct NDSFT transformation. */</span>
00742                 <a class="code" href="group__nfsft.html#ga6">ndsft_trafo</a>(&amp;plan_gen);
00743               }
00744 
00745               <a class="code" href="group__nfsft.html#ga10">nfsft_finalize</a>(&amp;plan_gen);
00746             }
00747             <span class="keywordflow">else</span>
00748             {
00749               memcpy(f_compare,f_grid,m_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00750             }
00751 
00752             free(f_hat_gen);
00753 
00754             <span class="keywordflow">break</span>;
00755 
00756           <span class="keywordflow">case</span> FUNCTION_F1:
00757             <span class="keywordflow">for</span> (d = 0; d &lt; m_total; d++)
00758             {
00759               x1 = sin(x_grid[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*cos(x_grid[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00760               x2 = sin(x_grid[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*sin(x_grid[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00761               x3 = cos(x_grid[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00762               f_grid[d] = x1*x2*x3;
00763             }
00764             <span class="keywordflow">if</span> (mode == RANDOM)
00765             {
00766               <span class="keywordflow">for</span> (d = 0; d &lt; m_compare; d++)
00767               {
00768                 x1 = sin(x_compare[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*cos(x_compare[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00769                 x2 = sin(x_compare[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*sin(x_compare[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00770                 x3 = cos(x_compare[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00771                 f_compare[d] = x1*x2*x3;
00772               }
00773             }
00774             <span class="keywordflow">else</span>
00775             {
00776               memcpy(f_compare,f_grid,m_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00777             }
00778             <span class="keywordflow">break</span>;
00779           <span class="keywordflow">case</span> FUNCTION_F2:
00780             <span class="keywordflow">for</span> (d = 0; d &lt; m_total; d++)
00781             {
00782               x1 = sin(x_grid[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*cos(x_grid[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00783               x2 = sin(x_grid[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*sin(x_grid[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00784               x3 = cos(x_grid[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00785               f_grid[d] = 0.1*exp(x1+x2+x3);
00786             }
00787             <span class="keywordflow">if</span> (mode == RANDOM)
00788             {
00789               <span class="keywordflow">for</span> (d = 0; d &lt; m_compare; d++)
00790               {
00791                 x1 = sin(x_compare[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*cos(x_compare[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00792                 x2 = sin(x_compare[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*sin(x_compare[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00793                 x3 = cos(x_compare[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00794                 f_compare[d] = 0.1*exp(x1+x2+x3);
00795               }
00796             }
00797             <span class="keywordflow">else</span>
00798             {
00799               memcpy(f_compare,f_grid,m_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00800             }
00801             <span class="keywordflow">break</span>;
00802           <span class="keywordflow">case</span> FUNCTION_F3:
00803             <span class="keywordflow">for</span> (d = 0; d &lt; m_total; d++)
00804             {
00805               x1 = sin(x_grid[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*cos(x_grid[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00806               x2 = sin(x_grid[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*sin(x_grid[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00807               x3 = cos(x_grid[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00808               temp = sqrt(x1*x1)+sqrt(x2*x2)+sqrt(x3*x3);
00809               f_grid[d] = 0.1*temp;
00810             }
00811             <span class="keywordflow">if</span> (mode == RANDOM)
00812             {
00813               <span class="keywordflow">for</span> (d = 0; d &lt; m_compare; d++)
00814               {
00815                 x1 = sin(x_compare[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*cos(x_compare[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00816                 x2 = sin(x_compare[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*sin(x_compare[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00817                 x3 = cos(x_compare[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00818                 temp = sqrt(x1*x1)+sqrt(x2*x2)+sqrt(x3*x3);
00819                 f_compare[d] = 0.1*temp;
00820               }
00821             }
00822             <span class="keywordflow">else</span>
00823             {
00824               memcpy(f_compare,f_grid,m_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00825             }
00826             <span class="keywordflow">break</span>;
00827           <span class="keywordflow">case</span> FUNCTION_F4:
00828             <span class="keywordflow">for</span> (d = 0; d &lt; m_total; d++)
00829             {
00830               x1 = sin(x_grid[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*cos(x_grid[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00831               x2 = sin(x_grid[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*sin(x_grid[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00832               x3 = cos(x_grid[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00833               temp = sqrt(x1*x1)+sqrt(x2*x2)+sqrt(x3*x3);
00834               f_grid[d] = 1.0/(temp);
00835             }
00836             <span class="keywordflow">if</span> (mode == RANDOM)
00837             {
00838               <span class="keywordflow">for</span> (d = 0; d &lt; m_compare; d++)
00839               {
00840                 x1 = sin(x_compare[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*cos(x_compare[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00841                 x2 = sin(x_compare[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*sin(x_compare[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00842                 x3 = cos(x_compare[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00843                 temp = sqrt(x1*x1)+sqrt(x2*x2)+sqrt(x3*x3);
00844                 f_compare[d] = 1.0/(temp);
00845               }
00846             }
00847             <span class="keywordflow">else</span>
00848             {
00849               memcpy(f_compare,f_grid,m_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00850             }
00851             <span class="keywordflow">break</span>;
00852           <span class="keywordflow">case</span> FUNCTION_F5:
00853             <span class="keywordflow">for</span> (d = 0; d &lt; m_total; d++)
00854             {
00855               x1 = sin(x_grid[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*cos(x_grid[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00856               x2 = sin(x_grid[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*sin(x_grid[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00857               x3 = cos(x_grid[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00858               temp = sqrt(x1*x1)+sqrt(x2*x2)+sqrt(x3*x3);
00859               f_grid[d] = 0.1*sin(1+temp)*sin(1+temp);
00860             }
00861             <span class="keywordflow">if</span> (mode == RANDOM)
00862             {
00863               <span class="keywordflow">for</span> (d = 0; d &lt; m_compare; d++)
00864               {
00865                 x1 = sin(x_compare[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*cos(x_compare[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00866                 x2 = sin(x_compare[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>)*sin(x_compare[2*d]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00867                 x3 = cos(x_compare[2*d+1]*2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00868                 temp = sqrt(x1*x1)+sqrt(x2*x2)+sqrt(x3*x3);
00869                 f_compare[d] = 0.1*sin(1+temp)*sin(1+temp);
00870               }
00871             }
00872             <span class="keywordflow">else</span>
00873             {
00874               memcpy(f_compare,f_grid,m_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00875             }
00876             <span class="keywordflow">break</span>;
00877           <span class="keywordflow">case</span> FUNCTION_F6:
00878             <span class="keywordflow">for</span> (d = 0; d &lt; m_total; d++)
00879             {
00880               <span class="keywordflow">if</span> (x_grid[2*d+1] &lt;= 0.25)
00881               {
00882                 f_grid[d] = 1.0;
00883               }
00884               <span class="keywordflow">else</span>
00885               {
00886                 f_grid[d] = 1.0/(sqrt(1+3*cos(2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>*x_grid[2*d+1])*cos(2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>*x_grid[2*d+1])));
00887               }
00888             }
00889             <span class="keywordflow">if</span> (mode == RANDOM)
00890             {
00891               <span class="keywordflow">for</span> (d = 0; d &lt; m_compare; d++)
00892               {
00893                 <span class="keywordflow">if</span> (x_compare[2*d+1] &lt;= 0.25)
00894                 {
00895                   f_compare[d] = 1.0;
00896                 }
00897                 <span class="keywordflow">else</span>
00898                 {
00899                   f_compare[d] = 1.0/(sqrt(1+3*cos(2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>*x_compare[2*d+1])*cos(2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>*x_compare[2*d+1])));
00900                 }
00901               }
00902             }
00903             <span class="keywordflow">else</span>
00904             {
00905               memcpy(f_compare,f_grid,m_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00906             }
00907             <span class="keywordflow">break</span>;
00908           <span class="keywordflow">default</span>:
00909             <span class="comment">//fprintf(stderr,"Generating one function\n");</span>
00910             <span class="comment">//fflush(stderr);</span>
00911             <span class="keywordflow">for</span> (d = 0; d &lt; m_total; d++)
00912             {
00913               f_grid[d] = 1.0;
00914             }
00915             <span class="keywordflow">if</span> (mode == RANDOM)
00916             {
00917               <span class="keywordflow">for</span> (d = 0; d &lt; m_compare; d++)
00918               {
00919                 f_compare[d] = 1.0;
00920               }
00921             }
00922             <span class="keywordflow">else</span>
00923             {
00924               memcpy(f_compare,f_grid,m_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00925             }
00926             <span class="keywordflow">break</span>;
00927         }
00928 
00929         <span class="comment">//fprintf(stderr,"Initializing trafo\n");</span>
00930         <span class="comment">//fflush(stderr);</span>
00931         <span class="comment">/* Init transform plan. */</span>
00932         <a class="code" href="group__nfsft.html#ga3">nfsft_init_guru</a>(&amp;plan_adjoint,NQ[iNQ],m_total, <a class="code" href="group__nfsft.html#ga25">NFSFT_NORMALIZED</a> |
00933           ((use_nfft!=NO)?(0U):(<a class="code" href="group__nfsft.html#ga26">NFSFT_USE_NDFT</a>)) |
00934           ((use_fpt!=NO)?(0U):(<a class="code" href="group__nfsft.html#ga27">NFSFT_USE_DPT</a>)),
00935           ((NQ[iNQ]&gt;512)?(0U):(<a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a> | <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)) | <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a> |
00936           <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>, cutoff);
00937 
00938         plan_adjoint_ptr = &amp;plan_adjoint;
00939 
00940         <span class="keywordflow">if</span> (mode == RANDOM)
00941         {
00942           <a class="code" href="group__nfsft.html#ga3">nfsft_init_guru</a>(&amp;plan,NQ[iNQ],m_compare, <a class="code" href="group__nfsft.html#ga25">NFSFT_NORMALIZED</a> |
00943             ((use_nfft!=NO)?(0U):(<a class="code" href="group__nfsft.html#ga26">NFSFT_USE_NDFT</a>)) |
00944             ((use_fpt!=NO)?(0U):(<a class="code" href="group__nfsft.html#ga27">NFSFT_USE_DPT</a>)),
00945             ((NQ[iNQ]&gt;512)?(0U):(<a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a> | <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)) | <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a> |
00946             <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>, cutoff);
00947           plan_ptr = &amp;plan;
00948         }
00949         <span class="keywordflow">else</span>
00950         {
00951           plan_ptr = &amp;plan_adjoint;
00952         }
00953 
00954         f_hat = (<span class="keywordtype">double</span> complex*) malloc(<a class="code" href="group__nfsft.html#ga41">NFSFT_F_HAT_SIZE</a>(NQ[iNQ])*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00955 
00956         plan_adjoint_ptr-&gt;<a class="code" href="structnfsft__plan.html#o2">f_hat</a> = f_hat;
00957         plan_adjoint_ptr-&gt;<a class="code" href="structnfsft__plan.html#o5">x</a> = x_grid;
00958         plan_adjoint_ptr-&gt;<a class="code" href="structnfsft__plan.html#o3">f</a> = f_grid;
00959 
00960         plan_ptr-&gt;<a class="code" href="structnfsft__plan.html#o2">f_hat</a> = f_hat;
00961         plan_ptr-&gt;<a class="code" href="structnfsft__plan.html#o5">x</a> = x_compare;
00962         plan_ptr-&gt;<a class="code" href="structnfsft__plan.html#o3">f</a> = f;
00963 
00964         <span class="comment">//fprintf(stderr,"Precomputing for x\n");</span>
00965         <span class="comment">//fflush(stderr);</span>
00966         nfsft_precompute_x(plan_adjoint_ptr);
00967         <span class="keywordflow">if</span> (plan_adjoint_ptr != plan_ptr)
00968         {
00969           nfsft_precompute_x(plan_ptr);
00970         }
00971 
00972         <span class="comment">/* Initialize cumulative time variable. */</span>
00973         t_avg = 0.0;
00974         err_infty_avg = 0.0;
00975         err_2_avg = 0.0;
00976 
00977         <span class="comment">/* Cycle through all runs. */</span>
00978         <span class="keywordflow">for</span> (i = 0; i &lt; 1<span class="comment">/*repetitions*/</span>; i++)
00979         {
00980           <span class="comment">//fprintf(stderr,"Copying original values\n");</span>
00981           <span class="comment">//fflush(stderr);</span>
00982           <span class="comment">/* Copy exact funtion values to working array. */</span>
00983           <span class="comment">//memcpy(f,f_grid,m_total*sizeof(double complex));</span>
00984 
00985           <span class="comment">/* Initialize time measurement. */</span>
00986           t = <a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00987 
00988           <span class="comment">//fprintf(stderr,"Multiplying with quadrature weights\n");</span>
00989           <span class="comment">//fflush(stderr);</span>
00990           <span class="comment">/* Multiplication with the quadrature weights. */</span>
00991           <span class="comment">/*fprintf(stderr,"\n");*/</span>
00992           d = 0;
00993           <span class="keywordflow">for</span> (k = 0; k &lt; m_theta; k++)
00994           {
00995             <span class="keywordflow">for</span> (n = 0; n &lt; m_phi; n++)
00996             {
00997               <span class="comment">/*fprintf(stderr,"f_ref[%d] = %le + I*%le,\t f[%d] = %le + I*%le,  \t w[%d] = %le\n",</span>
00998 <span class="comment">              d,creal(f_ref[d]),cimag(f_ref[d]),d,creal(f[d]),cimag(f[d]),k,</span>
00999 <span class="comment">              w[k]);*/</span>
01000               f_grid[d] *= w[k];
01001               d++;
01002             }
01003           }
01004 
01005           t_avg += <a class="code" href="group__nfftutil.html#ga0">nfft_second</a>() - t;
01006 
01007           free(w);
01008 
01009           t = <a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
01010 
01011           <span class="comment">/*fprintf(stderr,"\n");</span>
01012 <span class="comment">          d = 0;</span>
01013 <span class="comment">          for (d = 0; d &lt; grid_total; d++)</span>
01014 <span class="comment">          {</span>
01015 <span class="comment">            fprintf(stderr,"f[%d] = %le + I*%le, theta[%d] = %le, phi[%d] = %le\n",</span>
01016 <span class="comment">                    d,creal(f[d]),cimag(f[d]),d,x[2*d+1],d,x[2*d]);</span>
01017 <span class="comment">          }*/</span>
01018 
01019           <span class="comment">//fprintf(stderr,"Executing adjoint\n");</span>
01020           <span class="comment">//fflush(stderr);</span>
01021           <span class="comment">/* Check if the fast NFSFT algorithm shall be tested. */</span>
01022           <span class="keywordflow">if</span> (use_nfsft != NO)
01023           {
01024             <span class="comment">/* Execute the adjoint NFSFT transformation. */</span>
01025             <a class="code" href="group__nfsft.html#ga9">nfsft_adjoint</a>(plan_adjoint_ptr);
01026           }
01027           <span class="keywordflow">else</span>
01028           {
01029             <span class="comment">/* Execute the adjoint direct NDSFT transformation. */</span>
01030             <a class="code" href="group__nfsft.html#ga7">ndsft_adjoint</a>(plan_adjoint_ptr);
01031           }
01032 
01033           <span class="comment">/* Multiplication with the Fourier-Legendre coefficients. */</span>
01034           <span class="comment">/*for (k = 0; k &lt;= m[im]; k++)</span>
01035 <span class="comment">          {</span>
01036 <span class="comment">            for (n = -k; n &lt;= k; n++)</span>
01037 <span class="comment">            {</span>
01038 <span class="comment">              fprintf(stderr,"f_hat[%d,%d] = %le\t + I*%le\n",k,n,</span>
01039 <span class="comment">                      creal(f_hat[NFSFT_INDEX(k,n,&amp;plan_adjoint)]),</span>
01040 <span class="comment">                      cimag(f_hat[NFSFT_INDEX(k,n,&amp;plan_adjoint)]));</span>
01041 <span class="comment">            }</span>
01042 <span class="comment">          }*/</span>
01043 
01044           <span class="comment">//fprintf(stderr,"Executing trafo\n");</span>
01045           <span class="comment">//fflush(stderr);</span>
01046           <span class="keywordflow">if</span> (use_nfsft != NO)
01047           {
01048             <span class="comment">/* Execute the NFSFT transformation. */</span>
01049             <a class="code" href="group__nfsft.html#ga8">nfsft_trafo</a>(plan_ptr);
01050           }
01051           <span class="keywordflow">else</span>
01052           {
01053             <span class="comment">/* Execute the direct NDSFT transformation. */</span>
01054             <a class="code" href="group__nfsft.html#ga6">ndsft_trafo</a>(plan_ptr);
01055           }
01056 
01057           t_avg += <a class="code" href="group__nfftutil.html#ga0">nfft_second</a>() - t;
01058 
01059           <span class="comment">//fprintf(stderr,"Finalizing\n");</span>
01060           <span class="comment">//fflush(stderr);</span>
01061           <span class="comment">/* Finalize the NFSFT plans */</span>
01062           <a class="code" href="group__nfsft.html#ga10">nfsft_finalize</a>(plan_adjoint_ptr);
01063           <span class="keywordflow">if</span> (plan_ptr != plan_adjoint_ptr)
01064           {
01065             <a class="code" href="group__nfsft.html#ga10">nfsft_finalize</a>(plan_ptr);
01066           }
01067 
01068           <span class="comment">/* Free data arrays. */</span>
01069           free(f_hat);
01070           free(x_grid);
01071 
01072           err_infty_avg += <a class="code" href="group__nfftutil.html#ga37">nfft_error_l_infty_complex</a>(f, f_compare, m_compare);
01073           err_2_avg += <a class="code" href="group__nfftutil.html#ga41">nfft_error_l_2_complex</a>(f, f_compare, m_compare);
01074 
01075           free(f_grid);
01076 
01077           <span class="keywordflow">if</span> (mode == RANDOM)
01078           {
01079           }
01080           <span class="keywordflow">else</span>
01081           {
01082             free(f_compare);
01083           }
01084 
01085           <span class="comment">/*for (d = 0; d &lt; m_total; d++)</span>
01086 <span class="comment">          {</span>
01087 <span class="comment">            fprintf(stderr,"f_ref[%d] = %le + I*%le,\t f[%d] = %le + I*%le\n",</span>
01088 <span class="comment">              d,creal(f_ref[d]),cimag(f_ref[d]),d,creal(f[d]),cimag(f[d]));</span>
01089 <span class="comment">          }*/</span>
01090         }
01091 
01092         <span class="comment">//fprintf(stderr,"Calculating the error\n");</span>
01093         <span class="comment">//fflush(stderr);</span>
01094         <span class="comment">/* Calculate average time needed. */</span>
01095         t_avg = t_avg/((double)repetitions);
01096 
01097         <span class="comment">/* Calculate the average error. */</span>
01098         err_infty_avg = err_infty_avg/((double)repetitions);
01099 
01100         <span class="comment">/* Calculate the average error. */</span>
01101         err_2_avg = err_2_avg/((double)repetitions);
01102 
01103         <span class="comment">/* Print out the error measurements. */</span>
01104         fprintf(stdout,<span class="stringliteral">"%+le %+le %+le\n"</span>, t_avg, err_infty_avg, err_2_avg);
01105         fprintf(stderr,<span class="stringliteral">"%d: %4d %4d %+le %+le %+le\n"</span>, tc, NQ[iNQ], SQ[iNQ],
01106           t_avg, err_infty_avg, err_2_avg);
01107       }
01108     } <span class="comment">/* for (im = 0; im &lt; im_max; im++) - Process all cut-off</span>
01109 <span class="comment">       * bandwidths.*/</span>
01110     fprintf(stderr,<span class="stringliteral">"\n"</span>);
01111 
01112     <span class="comment">/* Delete precomputed data. */</span>
01113     <a class="code" href="group__nfsft.html#ga5">nfsft_forget</a>();
01114 
01115     <span class="comment">/* Free memory for cut-off bandwidths and grid size parameters. */</span>
01116     free(NQ);
01117     free(SQ);
01118     <span class="keywordflow">if</span> (testmode == TIMING)
01119     {
01120       free(RQ);
01121     }
01122 
01123     <span class="keywordflow">if</span> (mode == RANDOM)
01124     {
01125       free(x_compare);
01126       free(f_compare);
01127       free(f);
01128     }
01129 
01130     <span class="keywordflow">if</span> (testmode == TIMING)
01131     {
01132       <span class="comment">/* Allocate data structures. */</span>
01133       free(f_hat);
01134       free(f);
01135       free(x_grid);
01136     }
01137 
01138   } <span class="comment">/* for (tc = 0; tc &lt; tc_max; tc++) - Process each testcase. */</span>
01139 
01140   <span class="comment">/* Return exit code for successful run. */</span>
01141   <span class="keywordflow">return</span> EXIT_SUCCESS;
01142 }
01143 <span class="comment">/* \} */</span>
</pre></div>    <hr size="1"/>
    Generated on 5 Feb 2007 by Doxygen 1.4.1
  </body>
</html>
