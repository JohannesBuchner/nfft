<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.2 API Reference - NFFT: linogram_fft_test.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.2 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000006.html">applications</a>&nbsp;/&nbsp;<a class="el" href="dir_000013.html">polarFFT</a></div>
<h1>linogram_fft_test.c</h1><a href="linogram__fft__test_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00009 <span class="preprocessor">#include &lt;math.h&gt;</span>
00010 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00011 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00013 
00020 <span class="keywordtype">double</span> GLOBAL_elapsed_time;
00021 
<a name="l00025"></a><a class="code" href="group__applications__polarFFT__linogramm.html#ga1">00025</a> <span class="keywordtype">int</span> <a class="code" href="group__applications__polarFFT__linogramm.html#ga1">linogram_grid</a>(<span class="keywordtype">int</span> T, <span class="keywordtype">int</span> R, <span class="keywordtype">double</span> *x, <span class="keywordtype">double</span> *w)
00026 {
00027   <span class="keywordtype">int</span> t, r;
00028   <span class="keywordtype">double</span> W=(double)T*(((double)R/2.0)*((double)R/2.0)+1.0/4.0);
00029 
00030   <span class="keywordflow">for</span>(t=-T/2; t&lt;T/2; t++)
00031   {
00032     <span class="keywordflow">for</span>(r=-R/2; r&lt;R/2; r++)
00033     {
00034       <span class="keywordflow">if</span>(t&lt;0)
00035       {
00036         x[2*((t+T/2)*R+(r+R/2))+0] = (double)r/R;
00037         x[2*((t+T/2)*R+(r+R/2))+1] = (double)4*(t+T/4)/T*r/R;
00038       }
00039       <span class="keywordflow">else</span>
00040       {
00041         x[2*((t+T/2)*R+(r+R/2))+0] = -(double)4*(t-T/4)/T*r/R;
00042         x[2*((t+T/2)*R+(r+R/2))+1] = (double)r/R;
00043       }
00044       <span class="keywordflow">if</span> (r==0)
00045         w[(t+T/2)*R+(r+R/2)] = 1.0/4.0/W;
00046       <span class="keywordflow">else</span>
00047         w[(t+T/2)*R+(r+R/2)] = fabs((<span class="keywordtype">double</span>)r)/W;
00048     }
00049   }
00050 
00051   <span class="keywordflow">return</span> T*R;                           
00052 }
00053 
<a name="l00055"></a><a class="code" href="group__applications__polarFFT__linogramm.html#ga2">00055</a> <span class="keywordtype">int</span> <a class="code" href="group__applications__polarFFT__linogramm.html#ga2">linogram_dft</a>(fftw_complex *f_hat, <span class="keywordtype">int</span> NN, fftw_complex *f, <span class="keywordtype">int</span> T, <span class="keywordtype">int</span> R, <span class="keywordtype">int</span> m)
00056 {
00057   <span class="keywordtype">int</span> j,k;                              
00058   <a class="code" href="structnfft__plan.html">nfft_plan</a> my_nfft_plan;               
00060   <span class="keywordtype">double</span> *x, *w;                        
00062   <span class="keywordtype">int</span> N[2],n[2];
00063   <span class="keywordtype">int</span> M=T*R;                            
00065   N[0]=NN; n[0]=2*N[0];                 
00066   N[1]=NN; n[1]=2*N[1];                 
00068   x = (<span class="keywordtype">double</span> *)malloc(2*T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00069   <span class="keywordflow">if</span> (x==NULL)
00070     <span class="keywordflow">return</span> -1;
00071 
00072   w = (<span class="keywordtype">double</span> *)malloc(T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00073   <span class="keywordflow">if</span> (w==NULL)
00074     <span class="keywordflow">return</span> -1;
00075 
00077   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;my_nfft_plan, 2, N, M, n, m,
00078                   <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>| <a class="code" href="group__nfft.html#ga22">MALLOC_X</a> | <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>| <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>| <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a> | <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00079                   FFTW_MEASURE| FFTW_DESTROY_INPUT);
00080 
00082   <a class="code" href="group__applications__polarFFT__linogramm.html#ga1">linogram_grid</a>(T,R,x,w);
00083   <span class="keywordflow">for</span>(j=0;j&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++)
00084   {
00085     my_nfft_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+0] = x[2*j+0];
00086     my_nfft_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+1] = x[2*j+1];
00087   }
00088 
00089 
00091   <span class="keywordflow">for</span>(k=0;k&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o0">N_total</a>;k++)
00092     my_nfft_plan.<a class="code" href="structnfft__plan.html#o2">f_hat</a>[k] = f_hat[k];
00093 
00095   GLOBAL_elapsed_time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00096   <a class="code" href="group__nfft.html#ga0">ndft_trafo</a>(&amp;my_nfft_plan);
00097   GLOBAL_elapsed_time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-GLOBAL_elapsed_time;
00098 
00100   <span class="keywordflow">for</span>(j=0;j&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++)
00101     f[j] = my_nfft_plan.<a class="code" href="structnfft__plan.html#o3">f</a>[j];
00102 
00104   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;my_nfft_plan);
00105   free(x);
00106   free(w);
00107 
00108   <span class="keywordflow">return</span> EXIT_SUCCESS;
00109 }
00110 
<a name="l00112"></a><a class="code" href="group__applications__polarFFT__linogramm.html#ga3">00112</a> <span class="keywordtype">int</span> <a class="code" href="group__applications__polarFFT__linogramm.html#ga3">linogram_fft</a>(fftw_complex *f_hat, <span class="keywordtype">int</span> NN, fftw_complex *f, <span class="keywordtype">int</span> T, <span class="keywordtype">int</span> R, <span class="keywordtype">int</span> m)
00113 {
00114   <span class="keywordtype">int</span> j,k;                              
00115   <a class="code" href="structnfft__plan.html">nfft_plan</a> my_nfft_plan;               
00117   <span class="keywordtype">double</span> *x, *w;                        
00119   <span class="keywordtype">int</span> N[2],n[2];
00120   <span class="keywordtype">int</span> M=T*R;                            
00122   N[0]=NN; n[0]=2*N[0];                 
00123   N[1]=NN; n[1]=2*N[1];                 
00125   x = (<span class="keywordtype">double</span> *)malloc(2*T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00126   <span class="keywordflow">if</span> (x==NULL)
00127     <span class="keywordflow">return</span> -1;
00128 
00129   w = (<span class="keywordtype">double</span> *)malloc(T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00130   <span class="keywordflow">if</span> (w==NULL)
00131     <span class="keywordflow">return</span> -1;
00132 
00134   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;my_nfft_plan, 2, N, M, n, m,
00135                   <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>| <a class="code" href="group__nfft.html#ga22">MALLOC_X</a> | <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>| <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>| <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a> | <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00136                   FFTW_MEASURE| FFTW_DESTROY_INPUT);
00137 
00139   <a class="code" href="group__applications__polarFFT__linogramm.html#ga1">linogram_grid</a>(T,R,x,w);
00140   <span class="keywordflow">for</span>(j=0;j&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++)
00141   {
00142     my_nfft_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+0] = x[2*j+0];
00143     my_nfft_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+1] = x[2*j+1];
00144   }
00145 
00147   <span class="keywordflow">if</span>(my_nfft_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga18">PRE_LIN_PSI</a>)
00148     <a class="code" href="group__nfft.html#ga13">nfft_precompute_lin_psi</a>(&amp;my_nfft_plan);
00149 
00150   <span class="keywordflow">if</span>(my_nfft_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00151     <a class="code" href="group__nfft.html#ga12">nfft_precompute_psi</a>(&amp;my_nfft_plan);
00152 
00153   <span class="keywordflow">if</span>(my_nfft_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>)
00154     <a class="code" href="group__nfft.html#ga11">nfft_precompute_full_psi</a>(&amp;my_nfft_plan);
00155 
00157   <span class="keywordflow">for</span>(k=0;k&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o0">N_total</a>;k++)
00158     my_nfft_plan.<a class="code" href="structnfft__plan.html#o2">f_hat</a>[k] = f_hat[k];
00159 
00161   GLOBAL_elapsed_time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00162   <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;my_nfft_plan);
00163   GLOBAL_elapsed_time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-GLOBAL_elapsed_time;
00164 
00166   <span class="keywordflow">for</span>(j=0;j&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++)
00167     f[j] = my_nfft_plan.<a class="code" href="structnfft__plan.html#o3">f</a>[j];
00168 
00170   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;my_nfft_plan);
00171   free(x);
00172   free(w);
00173 
00174   <span class="keywordflow">return</span> EXIT_SUCCESS;
00175 }
00176 
<a name="l00178"></a><a class="code" href="group__applications__polarFFT__linogramm.html#ga4">00178</a> <span class="keywordtype">int</span> <a class="code" href="group__applications__polarFFT__linogramm.html#ga4">inverse_linogram_fft</a>(fftw_complex *f, <span class="keywordtype">int</span> T, <span class="keywordtype">int</span> R, fftw_complex *f_hat, <span class="keywordtype">int</span> NN, <span class="keywordtype">int</span> max_i, <span class="keywordtype">int</span> m)
00179 {
00180   <span class="keywordtype">int</span> j,k;                              
00181   <a class="code" href="structnfft__plan.html">nfft_plan</a> my_nfft_plan;               
00182   <a class="code" href="structinfft__plan.html">infft_plan</a> my_infft_plan;             
00184   <span class="keywordtype">double</span> *x, *w;                        
00185   <span class="keywordtype">int</span> l;                                
00187   <span class="keywordtype">int</span> N[2],n[2];
00188   <span class="keywordtype">int</span> M=T*R;                            
00190   N[0]=NN; n[0]=2*N[0];                 
00191   N[1]=NN; n[1]=2*N[1];                 
00193   x = (<span class="keywordtype">double</span> *)malloc(2*T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00194   <span class="keywordflow">if</span> (x==NULL)
00195     <span class="keywordflow">return</span> -1;
00196 
00197   w = (<span class="keywordtype">double</span> *)malloc(T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00198   <span class="keywordflow">if</span> (w==NULL)
00199     <span class="keywordflow">return</span> -1;
00200 
00202   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;my_nfft_plan, 2, N, M, n, m,
00203                   <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>| <a class="code" href="group__nfft.html#ga22">MALLOC_X</a> | <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>| <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>| <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a> | <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00204                   FFTW_MEASURE| FFTW_DESTROY_INPUT);
00205 
00207   <a class="code" href="group__solver.html#ga1">infft_init_advanced</a>(&amp;my_infft_plan,&amp;my_nfft_plan, <a class="code" href="group__solver.html#ga37">CGNR</a> | <a class="code" href="group__solver.html#ga40">PRECOMPUTE_WEIGHT</a> );
00208 
00210   <a class="code" href="group__applications__polarFFT__linogramm.html#ga1">linogram_grid</a>(T,R,x,w);
00211   <span class="keywordflow">for</span>(j=0;j&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++)
00212   {
00213     my_nfft_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+0] = x[2*j+0];
00214     my_nfft_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+1] = x[2*j+1];
00215     my_infft_plan.<a class="code" href="structinfft__plan.html#o4">y</a>[j]    = f[j];
00216     my_infft_plan.<a class="code" href="structinfft__plan.html#o2">w</a>[j]    = w[j];
00217   }
00218 
00220   <span class="keywordflow">if</span>(my_nfft_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga18">PRE_LIN_PSI</a>)
00221     <a class="code" href="group__nfft.html#ga13">nfft_precompute_lin_psi</a>(&amp;my_nfft_plan);
00222 
00223   <span class="keywordflow">if</span>(my_nfft_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00224     <a class="code" href="group__nfft.html#ga12">nfft_precompute_psi</a>(&amp;my_nfft_plan);
00225 
00226   <span class="keywordflow">if</span>(my_nfft_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>)
00227     <a class="code" href="group__nfft.html#ga11">nfft_precompute_full_psi</a>(&amp;my_nfft_plan);
00228 
00230   <span class="keywordflow">if</span>(my_infft_plan.<a class="code" href="structinfft__plan.html#o1">flags</a> &amp; <a class="code" href="group__solver.html#ga41">PRECOMPUTE_DAMP</a>)
00231     <span class="keywordflow">for</span>(j=0;j&lt;my_infft_plan.<a class="code" href="structinfft__plan.html#o0">mv</a>-&gt;<a class="code" href="structnfft__plan.html#o5">N</a>[0];j++)
00232       <span class="keywordflow">for</span>(k=0;k&lt;my_infft_plan.<a class="code" href="structinfft__plan.html#o0">mv</a>-&gt;<a class="code" href="structnfft__plan.html#o5">N</a>[1];k++)
00233   {
00234     my_infft_plan.<a class="code" href="structinfft__plan.html#o3">w_hat</a>[j*my_infft_plan.<a class="code" href="structinfft__plan.html#o0">mv</a>-&gt;<a class="code" href="structnfft__plan.html#o5">N</a>[1]+k]=
00235         (sqrt(pow(j-my_infft_plan.<a class="code" href="structinfft__plan.html#o0">mv</a>-&gt;<a class="code" href="structnfft__plan.html#o5">N</a>[0]/2,2)+pow(k-my_infft_plan.<a class="code" href="structinfft__plan.html#o0">mv</a>-&gt;<a class="code" href="structnfft__plan.html#o5">N</a>[1]/2,2))&gt;(my_infft_plan.<a class="code" href="structinfft__plan.html#o0">mv</a>-&gt;<a class="code" href="structnfft__plan.html#o5">N</a>[0]/2)?0:1);
00236   }
00237 
00239   <span class="keywordflow">for</span>(k=0;k&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o0">N_total</a>;k++)
00240     my_infft_plan.<a class="code" href="structinfft__plan.html#o5">f_hat_iter</a>[k] = 0.0 + I*0.0;
00241 
00242   GLOBAL_elapsed_time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00244   <a class="code" href="group__solver.html#ga2">infft_before_loop</a>(&amp;my_infft_plan);
00245 
00246   <span class="keywordflow">if</span> (max_i&lt;1)
00247   {
00248     l=1;
00249     <span class="keywordflow">for</span>(k=0;k&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o0">N_total</a>;k++)
00250       my_infft_plan.<a class="code" href="structinfft__plan.html#o5">f_hat_iter</a>[k] = my_infft_plan.<a class="code" href="structinfft__plan.html#o8">p_hat_iter</a>[k];
00251   }
00252   <span class="keywordflow">else</span>
00253   {
00254     <span class="keywordflow">for</span>(l=1;l&lt;=max_i;l++)
00255     {
00256       <a class="code" href="group__solver.html#ga3">infft_loop_one_step</a>(&amp;my_infft_plan);
00257     }
00258   }
00259 
00260   GLOBAL_elapsed_time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-GLOBAL_elapsed_time;
00261 
00263   <span class="keywordflow">for</span>(k=0;k&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o0">N_total</a>;k++)
00264     f_hat[k] = my_infft_plan.<a class="code" href="structinfft__plan.html#o5">f_hat_iter</a>[k];
00265 
00267   <a class="code" href="group__solver.html#ga4">infft_finalize</a>(&amp;my_infft_plan);
00268   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;my_nfft_plan);
00269   free(x);
00270   free(w);
00271 
00272   <span class="keywordflow">return</span> EXIT_SUCCESS;
00273 }
00274 
<a name="l00276"></a><a class="code" href="group__applications__polarFFT__linogramm.html#ga5">00276</a> <span class="keywordtype">int</span> <a class="code" href="group__applications__polarFFT__linogramm.html#ga5">comparison_fft</a>(FILE *fp, <span class="keywordtype">int</span> N, <span class="keywordtype">int</span> T, <span class="keywordtype">int</span> R)
00277 {
00278   fftw_plan my_fftw_plan;
00279   fftw_complex *f_hat,*f;
00280   <span class="keywordtype">int</span> m,k;
00281   <span class="keywordtype">double</span> t_fft, t_dft_linogram;
00282 
00283   f_hat = (fftw_complex *)fftw_malloc(<span class="keyword">sizeof</span>(fftw_complex)*N*N);
00284   f     = (fftw_complex *)fftw_malloc(<span class="keyword">sizeof</span>(fftw_complex)*(T*R/4)*5);
00285 
00286   my_fftw_plan = fftw_plan_dft_2d(N,N,f_hat,f,FFTW_BACKWARD,FFTW_MEASURE);
00287 
00288   <span class="keywordflow">for</span>(k=0; k&lt;N*N; k++)
00289     f_hat[k] = (((double)rand())/RAND_MAX) + I* (((double)rand())/RAND_MAX);
00290   
00291   GLOBAL_elapsed_time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00292   <span class="keywordflow">for</span>(m=0;m&lt;65536/N;m++)
00293     {
00294       fftw_execute(my_fftw_plan);
00295       <span class="comment">/* touch */</span>
00296       f_hat[2]=2*f_hat[0];
00297     }
00298   GLOBAL_elapsed_time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-GLOBAL_elapsed_time;
00299   t_fft=N*GLOBAL_elapsed_time/65536;
00300 
00301   <span class="keywordflow">if</span>(N&lt;256)
00302     {
00303       <a class="code" href="group__applications__polarFFT__linogramm.html#ga2">linogram_dft</a>(f_hat,N,f,T,R,m);
00304       t_dft_linogram=GLOBAL_elapsed_time;
00305     }
00306       
00307   <span class="keywordflow">for</span> (m=3; m&lt;=9; m+=3)
00308     {
00309       <span class="keywordflow">if</span>((m==3)&amp;&amp;(N&lt;256))
00310         fprintf(fp,<span class="stringliteral">"%d\t&amp;\t&amp;\t%1.1e&amp;\t%1.1e&amp;\t%d\t"</span>,N,t_fft,t_dft_linogram,m);
00311       <span class="keywordflow">else</span>
00312         <span class="keywordflow">if</span>(m==3)
00313     fprintf(fp,<span class="stringliteral">"%d\t&amp;\t&amp;\t%1.1e&amp;\t       &amp;\t%d\t"</span>,N,t_fft,m);
00314   <span class="keywordflow">else</span>
00315     fprintf(fp,<span class="stringliteral">"  \t&amp;\t&amp;\t       &amp;\t       &amp;\t%d\t"</span>,m);  
00316 
00317       printf(<span class="stringliteral">"N=%d\tt_fft=%1.1e\tt_dft_linogram=%1.1e\tm=%d\t"</span>,N,t_fft,t_dft_linogram,m);              
00318    
00319       <a class="code" href="group__applications__polarFFT__linogramm.html#ga3">linogram_fft</a>(f_hat,N,f,T,R,m);
00320       fprintf(fp,<span class="stringliteral">"%1.1e&amp;\t"</span>,GLOBAL_elapsed_time);
00321       printf(<span class="stringliteral">"t_linogram=%1.1e\t"</span>,GLOBAL_elapsed_time);
00322       <a class="code" href="group__applications__polarFFT__linogramm.html#ga4">inverse_linogram_fft</a>(f,T,R,f_hat,N,m+3,m);
00323       <span class="keywordflow">if</span>(m==9)
00324   fprintf(fp,<span class="stringliteral">"%1.1e\\\\\\hline\n"</span>,GLOBAL_elapsed_time);
00325       <span class="keywordflow">else</span>
00326   fprintf(fp,<span class="stringliteral">"%1.1e\\\\\n"</span>,GLOBAL_elapsed_time);
00327       printf(<span class="stringliteral">"t_ilinogram=%1.1e\n"</span>,GLOBAL_elapsed_time);
00328     }
00329 
00330   fflush(fp);
00331 
00332   fftw_free(f);
00333   fftw_free(f_hat);  
00334 
00335   <span class="keywordflow">return</span> EXIT_SUCCESS;
00336 }
00337 
<a name="l00339"></a><a class="code" href="group__applications__polarFFT__linogramm.html#ga6">00339</a> <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a>(<span class="keywordtype">int</span> argc,<span class="keywordtype">char</span> **argv)
00340 {
00341   <span class="keywordtype">int</span> N;                                
00342   <span class="keywordtype">int</span> T, R;                             
00343   <span class="keywordtype">int</span> M;                                
00344   <span class="keywordtype">double</span> *x, *w;                        
00345   fftw_complex *f_hat, *f, *f_direct, *f_tilde;
00346   <span class="keywordtype">int</span> k;
00347   <span class="keywordtype">int</span> max_i;                            
00348   <span class="keywordtype">int</span> m;
00349   <span class="keywordtype">double</span> temp1, temp2, E_max=0.0;
00350   FILE *fp1, *fp2;
00351   <span class="keywordtype">char</span> filename[30];
00352   <span class="keywordtype">int</span> logN;
00353 
00354   <span class="keywordflow">if</span>( argc!=4 )
00355   {
00356     printf(<span class="stringliteral">"linogram_fft_test N T R \n"</span>);
00357     printf(<span class="stringliteral">"\n"</span>);
00358     printf(<span class="stringliteral">"N          linogram FFT of size NxN    \n"</span>);
00359     printf(<span class="stringliteral">"T          number of slopes          \n"</span>);
00360     printf(<span class="stringliteral">"R          number of offsets         \n"</span>);
00361 
00363     printf(<span class="stringliteral">"\nHence, comparison FFTW, linogram FFT and inverse linogram FFT\n"</span>);
00364     fp1=fopen(<span class="stringliteral">"linogram_comparison_fft.dat"</span>,<span class="stringliteral">"w"</span>);
00365     <span class="keywordflow">if</span> (fp1==NULL)
00366   <span class="keywordflow">return</span>(-1);
00367     <span class="keywordflow">for</span> (logN=4; logN&lt;=8; logN++)
00368   <a class="code" href="group__applications__polarFFT__linogramm.html#ga5">comparison_fft</a>(fp1,(1U&lt;&lt; logN), 3*(1U&lt;&lt; logN), 3*(1U&lt;&lt; (logN-1)));
00369     fclose(fp1);
00370 
00371     exit(-1);
00372   }
00373 
00374   N = atoi(argv[1]);
00375   T = atoi(argv[2]);
00376   R = atoi(argv[3]);
00377   printf(<span class="stringliteral">"N=%d, linogram grid with T=%d, R=%d =&gt; "</span>,N,T,R);
00378 
00379   x = (<span class="keywordtype">double</span> *)malloc(2*1.25*T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00380   w = (<span class="keywordtype">double</span> *)malloc(1.25*T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00381 
00382   f_hat    = (fftw_complex *)fftw_malloc(<span class="keyword">sizeof</span>(fftw_complex)*N*N);
00383   f        = (fftw_complex *)fftw_malloc(<span class="keyword">sizeof</span>(fftw_complex)*1.25*T*R);  <span class="comment">/* 4/pi*log(1+sqrt(2)) = 1.122... &lt; 1.25 */</span>
00384   f_direct = (fftw_complex *)fftw_malloc(<span class="keyword">sizeof</span>(fftw_complex)*1.25*T*R);
00385   f_tilde  = (fftw_complex *)fftw_malloc(<span class="keyword">sizeof</span>(fftw_complex)*N*N);
00386 
00388   M=<a class="code" href="group__applications__polarFFT__linogramm.html#ga1">linogram_grid</a>(T,R,x,w); printf(<span class="stringliteral">"M=%d.\n"</span>,M);
00389 
00391   fp1=fopen(<span class="stringliteral">"input_data_r.dat"</span>,<span class="stringliteral">"r"</span>);
00392   fp2=fopen(<span class="stringliteral">"input_data_i.dat"</span>,<span class="stringliteral">"r"</span>);
00393   <span class="keywordflow">if</span> ((fp1==NULL) || (fp2==NULL))
00394     <span class="keywordflow">return</span>(-1);
00395   <span class="keywordflow">for</span>(k=0;k&lt;N*N;k++)
00396   {
00397     fscanf(fp1,<span class="stringliteral">"%le "</span>,&amp;temp1);
00398     fscanf(fp2,<span class="stringliteral">"%le "</span>,&amp;temp2);
00399     f_hat[k]=temp1+I*temp2;
00400   }
00401   fclose(fp1);
00402   fclose(fp2);
00403 
00405       <a class="code" href="group__applications__polarFFT__linogramm.html#ga2">linogram_dft</a>(f_hat,N,f_direct,T,R,m);
00406   <span class="comment">//  linogram_fft(f_hat,N,f_direct,T,R,12);</span>
00407 
00409   printf(<span class="stringliteral">"\nTest of the linogram FFT: \n"</span>);
00410   fp1=fopen(<span class="stringliteral">"linogram_fft_error.dat"</span>,<span class="stringliteral">"w+"</span>);
00411   <span class="keywordflow">for</span> (m=1; m&lt;=12; m++)
00412   {
00414     <a class="code" href="group__applications__polarFFT__linogramm.html#ga3">linogram_fft</a>(f_hat,N,f,T,R,m);
00415 
00417     E_max=<a class="code" href="group__nfftutil.html#ga37">nfft_error_l_infty_complex</a>(f_direct,f,M);
00418     <span class="comment">//E_max=nfft_error_l_2_complex(f_direct,f,M);</span>
00419 
00420     printf(<span class="stringliteral">"m=%2d: E_max = %e\n"</span>,m,E_max);
00421     fprintf(fp1,<span class="stringliteral">"%e\n"</span>,E_max);
00422   }
00423   fclose(fp1);
00424 
00426   <span class="keywordflow">for</span> (m=3; m&lt;=9; m+=3)
00427   {
00428     printf(<span class="stringliteral">"\nTest of the inverse linogram FFT for m=%d: \n"</span>,m);
00429     sprintf(filename,<span class="stringliteral">"linogram_ifft_error%d.dat"</span>,m);
00430     fp1=fopen(filename,<span class="stringliteral">"w+"</span>);
00431     <span class="keywordflow">for</span> (max_i=0; max_i&lt;=20; max_i+=2)
00432     {
00434       <a class="code" href="group__applications__polarFFT__linogramm.html#ga4">inverse_linogram_fft</a>(f_direct,T,R,f_tilde,N,max_i,m);
00435 
00437       E_max=<a class="code" href="group__nfftutil.html#ga37">nfft_error_l_infty_complex</a>(f_hat,f_tilde,N*N);
00438       printf(<span class="stringliteral">"%3d iterations: E_max = %e\n"</span>,max_i,E_max);
00439       fprintf(fp1,<span class="stringliteral">"%e\n"</span>,E_max);
00440     }
00441     fclose(fp1);
00442   }
00443 
00445   free(x);
00446   free(w);
00447   free(f_hat);
00448   free(f);
00449   free(f_direct);
00450   free(f_tilde);
00451 
00452   <span class="keywordflow">return</span> 0;
00453 }
00454 <span class="comment">/* \} */</span>
</pre></div>    <hr size="1"/>
    Generated on 22 Jan 2007 by Doxygen 1.4.1
  </body>
</html>
