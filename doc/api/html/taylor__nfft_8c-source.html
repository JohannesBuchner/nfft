<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.1.3 API Reference - NFFT: taylor_nfft.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.1.3 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>taylor_nfft.c</h1><a href="taylor__nfft_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c) 2002, 2009 Jens Keiner, Stefan Kunis, Daniel Potts</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or modify it under</span>
<a name="l00005"></a>00005 <span class="comment"> * the terms of the GNU General Public License as published by the Free Software</span>
<a name="l00006"></a>00006 <span class="comment"> * Foundation; either version 2 of the License, or (at your option) any later</span>
<a name="l00007"></a>00007 <span class="comment"> * version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful, but WITHOUT</span>
<a name="l00010"></a>00010 <span class="comment"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span>
<a name="l00011"></a>00011 <span class="comment"> * FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more</span>
<a name="l00012"></a>00012 <span class="comment"> * details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License along with</span>
<a name="l00015"></a>00015 <span class="comment"> * this program; if not, write to the Free Software Foundation, Inc., 51</span>
<a name="l00016"></a>00016 <span class="comment"> * Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> */</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="comment">/* $Id: taylor_nfft.c 3198 2009-05-27 14:16:50Z keiner $ */</span>
<a name="l00020"></a>00020 
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;complex.h&gt;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#include "<a class="code" href="nfft3util_8h.html" title="Header file for utility functions used by the nfft3 library.">nfft3util.h</a>"</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html" title="Header file for the nfft3 library.">nfft3.h</a>"</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="keyword">typedef</span> <span class="keyword">struct</span>
<a name="l00040"></a>00040 {
<a name="l00041"></a>00041   <a class="code" href="structnfft__plan.html" title="Structure for a NFFT plan.">nfft_plan</a> p;                          
<a name="l00043"></a>00043   <span class="keywordtype">int</span> *idx0;                            
<a name="l00045"></a>00045   <span class="keywordtype">double</span> *deltax0;                      
<a name="l00046"></a>00046 } taylor_plan;
<a name="l00047"></a>00047 
<a name="l00059"></a><a class="code" href="taylor__nfft_8c.html#da6e884cc7de499c4ef27fdbbe9f4164">00059</a> <span class="keywordtype">void</span> <a class="code" href="taylor__nfft_8c.html#da6e884cc7de499c4ef27fdbbe9f4164" title="Initialisation of a transform plan.">taylor_init</a>(taylor_plan *ths, <span class="keywordtype">int</span> N, <span class="keywordtype">int</span> M, <span class="keywordtype">int</span> n, <span class="keywordtype">int</span> m)
<a name="l00060"></a>00060 {
<a name="l00061"></a>00061   <span class="comment">/* Note: no nfft precomputation! */</span>
<a name="l00062"></a>00062   <a class="code" href="group__nfft.html#g406f05717c6299b918261c61aaa9de23" title="Initialisation of a transform plan, guru.">nfft_init_guru</a>((<a class="code" href="structnfft__plan.html" title="Structure for a NFFT plan.">nfft_plan</a>*)ths, 1, &amp;N, M, &amp;n, m,
<a name="l00063"></a>00063                  <a class="code" href="group__nfft.html#g353185384f87de0dc4320a82652ef724" title="If this flag is set, (de)allocation of the node vector is done.">MALLOC_X</a>| <a class="code" href="group__nfft.html#g02d52cb02b6cfdbc3e4d5fd4de1aef9e" title="If this flag is set, (de)allocation of the vector of Fourier coefficients is done...">MALLOC_F_HAT</a>| <a class="code" href="group__nfft.html#ga7b5098f4136080bbe0dd989973e2a69" title="If this flag is set, (de)allocation of the vector of samples is done.">MALLOC_F</a>|
<a name="l00064"></a>00064      <a class="code" href="group__nfft.html#gd3fe6867a3351441c6f44dd5a3746f5b" title="If this flag is set, fftw_init/fftw_finalize is called.">FFTW_INIT</a>| <a class="code" href="group__nfft.html#g9193f768d5839892d0e303080c370eaf" title="If this flag is set, FFTW uses disjoint input/output vectors.">FFT_OUT_OF_PLACE</a>,
<a name="l00065"></a>00065      FFTW_ESTIMATE| FFTW_PRESERVE_INPUT);
<a name="l00066"></a>00066 
<a name="l00067"></a>00067   ths-&gt;idx0=(<span class="keywordtype">int</span>*)<a class="code" href="nfft3_8h.html#afe6167438c5de4d3d4c509f66a6694e" title="Include header for FFTW3 library for its complex type.">nfft_malloc</a>(M*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00068"></a>00068   ths-&gt;deltax0=(<span class="keywordtype">double</span>*)<a class="code" href="nfft3_8h.html#afe6167438c5de4d3d4c509f66a6694e" title="Include header for FFTW3 library for its complex type.">nfft_malloc</a>(M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00069"></a>00069 }
<a name="l00070"></a>00070 
<a name="l00078"></a><a class="code" href="taylor__nfft_8c.html#8c616287400cae47e4f0701a5425c1d4">00078</a> <span class="keywordtype">void</span> <a class="code" href="taylor__nfft_8c.html#8c616287400cae47e4f0701a5425c1d4" title="Precomputation of weights and indices in Taylor expansion.">taylor_precompute</a>(taylor_plan *ths)
<a name="l00079"></a>00079 {
<a name="l00080"></a>00080   <span class="keywordtype">int</span> j;
<a name="l00081"></a>00081 
<a name="l00082"></a>00082   <a class="code" href="structnfft__plan.html" title="Structure for a NFFT plan.">nfft_plan</a>* cths=(<a class="code" href="structnfft__plan.html" title="Structure for a NFFT plan.">nfft_plan</a>*)ths;
<a name="l00083"></a>00083 
<a name="l00084"></a>00084   <span class="keywordflow">for</span>(j=0;j&lt;cths-&gt;<a class="code" href="structnfft__plan.html#df33ce87c35b396c50d214d9bdeeefe6" title="Total number of samples.">M_total</a>;j++)
<a name="l00085"></a>00085     {
<a name="l00086"></a>00086       ths-&gt;idx0[j] = ((int)round((cths-&gt;<a class="code" href="structnfft__plan.html#7eb64fb5fedfba0ec75261e777e020c0" title="Nodes in time/spatial domain, size is  doubles.">x</a>[j]+0.5)*cths-&gt;<a class="code" href="structnfft__plan.html#a8db04bb03357b831a1958f9a802e0ae" title="FFTW length, equal to sigma*N, default is the power of 2 such that .">n</a>[0]) +
<a name="l00087"></a>00087                                  cths-&gt;<a class="code" href="structnfft__plan.html#a8db04bb03357b831a1958f9a802e0ae" title="FFTW length, equal to sigma*N, default is the power of 2 such that .">n</a>[0]/2)%cths-&gt;<a class="code" href="structnfft__plan.html#a8db04bb03357b831a1958f9a802e0ae" title="FFTW length, equal to sigma*N, default is the power of 2 such that .">n</a>[0];
<a name="l00088"></a>00088       ths-&gt;deltax0[j] = cths-&gt;<a class="code" href="structnfft__plan.html#7eb64fb5fedfba0ec75261e777e020c0" title="Nodes in time/spatial domain, size is  doubles.">x</a>[j] - (round((cths-&gt;<a class="code" href="structnfft__plan.html#7eb64fb5fedfba0ec75261e777e020c0" title="Nodes in time/spatial domain, size is  doubles.">x</a>[j]+0.5)*cths-&gt;<a class="code" href="structnfft__plan.html#a8db04bb03357b831a1958f9a802e0ae" title="FFTW length, equal to sigma*N, default is the power of 2 such that .">n</a>[0]) /
<a name="l00089"></a>00089                                       cths-&gt;<a class="code" href="structnfft__plan.html#a8db04bb03357b831a1958f9a802e0ae" title="FFTW length, equal to sigma*N, default is the power of 2 such that .">n</a>[0] - 0.5);
<a name="l00090"></a>00090     }
<a name="l00091"></a>00091 }
<a name="l00092"></a>00092 
<a name="l00100"></a><a class="code" href="taylor__nfft_8c.html#ea63140d36ed574c45ec63310b561273">00100</a> <span class="keywordtype">void</span> <a class="code" href="taylor__nfft_8c.html#ea63140d36ed574c45ec63310b561273" title="Destroys a transform plan.">taylor_finalize</a>(taylor_plan *ths)
<a name="l00101"></a>00101 {
<a name="l00102"></a>00102   <a class="code" href="nfft3_8h.html#b8a0db03dda1317a8a3d922e0e4e8aaa">nfft_free</a>(ths-&gt;deltax0);
<a name="l00103"></a>00103   <a class="code" href="nfft3_8h.html#b8a0db03dda1317a8a3d922e0e4e8aaa">nfft_free</a>(ths-&gt;idx0);
<a name="l00104"></a>00104 
<a name="l00105"></a>00105   <a class="code" href="group__nfft.html#g614f9f7af5b0d5491afa9495393c4dc3" title="Destroys a transform plan.">nfft_finalize</a>((<a class="code" href="structnfft__plan.html" title="Structure for a NFFT plan.">nfft_plan</a>*)ths);
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00118"></a><a class="code" href="taylor__nfft_8c.html#506cce59a9b1353e569e5c308d5d1069">00118</a> <span class="keywordtype">void</span> <a class="code" href="taylor__nfft_8c.html#506cce59a9b1353e569e5c308d5d1069" title="Executes a Taylor-NFFT, see equation (1.1) in [Guide], computes fast and approximate...">taylor_trafo</a>(taylor_plan *ths)
<a name="l00119"></a>00119 {
<a name="l00120"></a>00120   <span class="keywordtype">int</span> j,k,l,ll;
<a name="l00121"></a>00121   <span class="keywordtype">double</span> _Complex *f, *f_hat, *g1;
<a name="l00122"></a>00122   <span class="keywordtype">double</span> *deltax;
<a name="l00123"></a>00123   <span class="keywordtype">int</span> *idx;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   <a class="code" href="structnfft__plan.html" title="Structure for a NFFT plan.">nfft_plan</a> *cths=(<a class="code" href="structnfft__plan.html" title="Structure for a NFFT plan.">nfft_plan</a>*)ths;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127   <span class="keywordflow">for</span>(j=0, f=cths-&gt;<a class="code" href="structnfft__plan.html#fa27a166f809acf70ae27e5e6f28daa5" title="Vector of samples, \ size is M_total float types.">f</a>; j&lt;cths-&gt;M_total; j++)
<a name="l00128"></a>00128     *f++ = 0;
<a name="l00129"></a>00129 
<a name="l00130"></a>00130   <span class="keywordflow">for</span>(k=0; k&lt;cths-&gt;<a class="code" href="structnfft__plan.html#d8a5fdac5bcf62d86479c800768fdeb7" title="Total size of FFTW.">n_total</a>; k++)
<a name="l00131"></a>00131     cths-&gt;<a class="code" href="structnfft__plan.html#2190e7201c55214d153b4d91eaa7efda" title="Input of fftw.">g1</a>[k]=0;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133   <span class="keywordflow">for</span>(k=-cths-&gt;<a class="code" href="structnfft__plan.html#d33daddf76670c8731c759bf74ad0d22" title="Total number of Fourier \ coefficients.">N_total</a>/2, g1=cths-&gt;<a class="code" href="structnfft__plan.html#2190e7201c55214d153b4d91eaa7efda" title="Input of fftw.">g1</a>+cths-&gt;<a class="code" href="structnfft__plan.html#d8a5fdac5bcf62d86479c800768fdeb7" title="Total size of FFTW.">n_total</a>-cths-&gt;<a class="code" href="structnfft__plan.html#d33daddf76670c8731c759bf74ad0d22" title="Total number of Fourier \ coefficients.">N_total</a>/2,
<a name="l00134"></a>00134       f_hat=cths-&gt;<a class="code" href="structnfft__plan.html#23409aec68871e9a56f11711e2891691" title="Vector of Fourier coefficients, \ size is N_total float_types.">f_hat</a>; k&lt;0; k++)
<a name="l00135"></a>00135     (*g1++)=cpow( - 2*<a class="code" href="group__nfftutil.html#g598a3330b3c21701223ee0ca14316eca" title="Formerly known to be an irrational number.">PI</a>*_Complex_I*k,cths-&gt;<a class="code" href="structnfft__plan.html#dbac137859fb87be7be73a5443de8cef" title="Cut-off parameter of the window function, default value is 6 (KAISER_BESSEL), 9 (SINC_POWER)...">m</a>)* (*f_hat++);
<a name="l00136"></a>00136 
<a name="l00137"></a>00137   cths-&gt;<a class="code" href="structnfft__plan.html#2190e7201c55214d153b4d91eaa7efda" title="Input of fftw.">g1</a>[0]=cths-&gt;<a class="code" href="structnfft__plan.html#23409aec68871e9a56f11711e2891691" title="Vector of Fourier coefficients, \ size is N_total float_types.">f_hat</a>[cths-&gt;<a class="code" href="structnfft__plan.html#d33daddf76670c8731c759bf74ad0d22" title="Total number of Fourier \ coefficients.">N_total</a>/2];
<a name="l00138"></a>00138 
<a name="l00139"></a>00139   <span class="keywordflow">for</span>(k=1, g1=cths-&gt;<a class="code" href="structnfft__plan.html#2190e7201c55214d153b4d91eaa7efda" title="Input of fftw.">g1</a>+1, f_hat=cths-&gt;<a class="code" href="structnfft__plan.html#23409aec68871e9a56f11711e2891691" title="Vector of Fourier coefficients, \ size is N_total float_types.">f_hat</a>+cths-&gt;<a class="code" href="structnfft__plan.html#d33daddf76670c8731c759bf74ad0d22" title="Total number of Fourier \ coefficients.">N_total</a>/2+1;
<a name="l00140"></a>00140       k&lt;cths-&gt;N_total/2; k++)
<a name="l00141"></a>00141     (*g1++)=cpow( - 2*<a class="code" href="group__nfftutil.html#g598a3330b3c21701223ee0ca14316eca" title="Formerly known to be an irrational number.">PI</a>*_Complex_I*k,cths-&gt;<a class="code" href="structnfft__plan.html#dbac137859fb87be7be73a5443de8cef" title="Cut-off parameter of the window function, default value is 6 (KAISER_BESSEL), 9 (SINC_POWER)...">m</a>)* (*f_hat++);
<a name="l00142"></a>00142 
<a name="l00143"></a>00143   <span class="keywordflow">for</span>(l=cths-&gt;<a class="code" href="structnfft__plan.html#dbac137859fb87be7be73a5443de8cef" title="Cut-off parameter of the window function, default value is 6 (KAISER_BESSEL), 9 (SINC_POWER)...">m</a>-1; l&gt;=0; l--)
<a name="l00144"></a>00144     {
<a name="l00145"></a>00145       <span class="keywordflow">for</span>(k=-cths-&gt;<a class="code" href="structnfft__plan.html#d33daddf76670c8731c759bf74ad0d22" title="Total number of Fourier \ coefficients.">N_total</a>/2, g1=cths-&gt;<a class="code" href="structnfft__plan.html#2190e7201c55214d153b4d91eaa7efda" title="Input of fftw.">g1</a>+cths-&gt;<a class="code" href="structnfft__plan.html#d8a5fdac5bcf62d86479c800768fdeb7" title="Total size of FFTW.">n_total</a>-cths-&gt;<a class="code" href="structnfft__plan.html#d33daddf76670c8731c759bf74ad0d22" title="Total number of Fourier \ coefficients.">N_total</a>/2;
<a name="l00146"></a>00146           k&lt;0; k++)
<a name="l00147"></a>00147         (*g1++) /= (-2*<a class="code" href="group__nfftutil.html#g598a3330b3c21701223ee0ca14316eca" title="Formerly known to be an irrational number.">PI</a>*_Complex_I*k);
<a name="l00148"></a>00148 
<a name="l00149"></a>00149       <span class="keywordflow">for</span>(k=1, g1=cths-&gt;<a class="code" href="structnfft__plan.html#2190e7201c55214d153b4d91eaa7efda" title="Input of fftw.">g1</a>+1; k&lt;cths-&gt;N_total/2; k++)
<a name="l00150"></a>00150         (*g1++) /= (-2*<a class="code" href="group__nfftutil.html#g598a3330b3c21701223ee0ca14316eca" title="Formerly known to be an irrational number.">PI</a>*_Complex_I*k);
<a name="l00151"></a>00151 
<a name="l00152"></a>00152       fftw_execute(cths-&gt;<a class="code" href="structnfft__plan.html#84d87c06b22ddb3e725c61061cf4d46d" title="Forward FFTW plan.">my_fftw_plan1</a>);
<a name="l00153"></a>00153 
<a name="l00154"></a>00154       ll=(l==0?1:l);
<a name="l00155"></a>00155       <span class="keywordflow">for</span>(j=0, f=cths-&gt;<a class="code" href="structnfft__plan.html#fa27a166f809acf70ae27e5e6f28daa5" title="Vector of samples, \ size is M_total float types.">f</a>, deltax=ths-&gt;deltax0, idx=ths-&gt;idx0; j&lt;cths-&gt;M_total;
<a name="l00156"></a>00156           j++, f++)
<a name="l00157"></a>00157   (*f) = ((*f) * (*deltax++) + cths-&gt;<a class="code" href="structnfft__plan.html#d96e0aa935ea3589e999c131c43d8a78" title="Output of fftw.">g2</a>[*idx++]) /ll;
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159 }
<a name="l00160"></a>00160 
<a name="l00174"></a><a class="code" href="taylor__nfft_8c.html#dcac16b056210ccff5d865731a8fb4bc">00174</a> <span class="keywordtype">void</span> <a class="code" href="taylor__nfft_8c.html#dcac16b056210ccff5d865731a8fb4bc" title="Compares NDFT, NFFT, and Taylor-NFFT.">taylor_time_accuracy</a>(<span class="keywordtype">int</span> N, <span class="keywordtype">int</span> M, <span class="keywordtype">int</span> n, <span class="keywordtype">int</span> m, <span class="keywordtype">int</span> n_taylor,
<a name="l00175"></a>00175                           <span class="keywordtype">int</span> m_taylor, <span class="keywordtype">unsigned</span> test_accuracy)
<a name="l00176"></a>00176 {
<a name="l00177"></a>00177   <span class="keywordtype">int</span> r;
<a name="l00178"></a>00178   <span class="keywordtype">double</span> t_ndft, t_nfft, t_taylor, t;
<a name="l00179"></a>00179   <span class="keywordtype">double</span> _Complex *swapndft;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181   taylor_plan tp;
<a name="l00182"></a>00182   <a class="code" href="structnfft__plan.html" title="Structure for a NFFT plan.">nfft_plan</a> np;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   printf(<span class="stringliteral">"%d\t%d\t"</span>,N, M);
<a name="l00185"></a>00185 
<a name="l00186"></a>00186   <a class="code" href="taylor__nfft_8c.html#da6e884cc7de499c4ef27fdbbe9f4164" title="Initialisation of a transform plan.">taylor_init</a>(&amp;tp,N,M,n_taylor,m_taylor);
<a name="l00187"></a>00187 
<a name="l00188"></a>00188   <a class="code" href="group__nfft.html#g406f05717c6299b918261c61aaa9de23" title="Initialisation of a transform plan, guru.">nfft_init_guru</a>(&amp;np, 1, &amp;N, M, &amp;n, m,
<a name="l00189"></a>00189                  <a class="code" href="group__nfft.html#gda3a356fdaf5840f98374a0a7aaf3e9c" title="If this flag is set, the deconvolution step (the multiplication with the diagonal...">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#g9c5a5ab61009a801082897ca40a1658c" title="If this flag is set, the convolution step (the multiplication with the sparse matrix...">PRE_FG_PSI</a>|
<a name="l00190"></a>00190      <a class="code" href="group__nfft.html#gd3fe6867a3351441c6f44dd5a3746f5b" title="If this flag is set, fftw_init/fftw_finalize is called.">FFTW_INIT</a>| <a class="code" href="group__nfft.html#g9193f768d5839892d0e303080c370eaf" title="If this flag is set, FFTW uses disjoint input/output vectors.">FFT_OUT_OF_PLACE</a>,
<a name="l00191"></a>00191      FFTW_ESTIMATE| FFTW_DESTROY_INPUT);
<a name="l00192"></a>00192 
<a name="l00194"></a>00194   np.<a class="code" href="structnfft__plan.html#7eb64fb5fedfba0ec75261e777e020c0" title="Nodes in time/spatial domain, size is  doubles.">x</a>=tp.p.x;
<a name="l00195"></a>00195   np.<a class="code" href="structnfft__plan.html#23409aec68871e9a56f11711e2891691" title="Vector of Fourier coefficients, \ size is N_total float_types.">f_hat</a>=tp.p.f_hat;
<a name="l00196"></a>00196   np.<a class="code" href="structnfft__plan.html#fa27a166f809acf70ae27e5e6f28daa5" title="Vector of samples, \ size is M_total float types.">f</a>=tp.p.f;
<a name="l00197"></a>00197 
<a name="l00199"></a>00199   <span class="keywordflow">if</span>(test_accuracy)
<a name="l00200"></a>00200     swapndft=(<span class="keywordtype">double</span> _Complex*)<a class="code" href="nfft3_8h.html#afe6167438c5de4d3d4c509f66a6694e" title="Include header for FFTW3 library for its complex type.">nfft_malloc</a>(M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> _Complex));
<a name="l00201"></a>00201 
<a name="l00203"></a>00203   <a class="code" href="group__nfftutil.html#ga44184ac2c1452221508e7640f391c34" title="Inits a vector of random double numbers in .">nfft_vrand_shifted_unit_double</a>(np.<a class="code" href="structnfft__plan.html#7eb64fb5fedfba0ec75261e777e020c0" title="Nodes in time/spatial domain, size is  doubles.">x</a>, np.<a class="code" href="structnfft__plan.html#df33ce87c35b396c50d214d9bdeeefe6" title="Total number of samples.">M_total</a>);
<a name="l00204"></a>00204 
<a name="l00206"></a>00206   <a class="code" href="taylor__nfft_8c.html#8c616287400cae47e4f0701a5425c1d4" title="Precomputation of weights and indices in Taylor expansion.">taylor_precompute</a>(&amp;tp);
<a name="l00207"></a>00207 
<a name="l00209"></a>00209   <span class="keywordflow">if</span>(np.<a class="code" href="structnfft__plan.html#2721da68a3a5b1846ecca8395d76bb1d" title="Flags for precomputation, (de)allocation, and FFTW usage, default setting is PRE_PHI_HUT|...">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#g44c85197c6bdcf4b632aeff5e94d5329" title="Summarises if precomputation is used within the convolution step (the multiplication...">PRE_ONE_PSI</a>)
<a name="l00210"></a>00210     <a class="code" href="group__nfft.html#gfd7b278b6ed04d929212b4807dd195f0" title="Precomputation for a transform plan.">nfft_precompute_one_psi</a>(&amp;np);
<a name="l00211"></a>00211 
<a name="l00213"></a>00213   <a class="code" href="group__nfftutil.html#g5f53c8cd0b2f33200fce15ecf75a0685" title="Inits a vector of random complex numbers in .">nfft_vrand_unit_complex</a>(np.<a class="code" href="structnfft__plan.html#23409aec68871e9a56f11711e2891691" title="Vector of Fourier coefficients, \ size is N_total float_types.">f_hat</a>, np.<a class="code" href="structnfft__plan.html#d33daddf76670c8731c759bf74ad0d22" title="Total number of Fourier \ coefficients.">N_total</a>);
<a name="l00214"></a>00214 
<a name="l00216"></a>00216   <span class="keywordflow">if</span>(test_accuracy)
<a name="l00217"></a>00217     {
<a name="l00218"></a>00218       <a class="code" href="group__nfftutil.html#g4df074728562efbb458f6662e649d1d5" title="Swapping of two vectors.">NFFT_SWAP_complex</a>(np.<a class="code" href="structnfft__plan.html#fa27a166f809acf70ae27e5e6f28daa5" title="Vector of samples, \ size is M_total float types.">f</a>,swapndft);
<a name="l00219"></a>00219 
<a name="l00220"></a>00220       t_ndft=0;
<a name="l00221"></a>00221       r=0;
<a name="l00222"></a>00222       <span class="keywordflow">while</span>(t_ndft&lt;0.01)
<a name="l00223"></a>00223         {
<a name="l00224"></a>00224           r++;
<a name="l00225"></a>00225           t=<a class="code" href="group__nfftutil.html#gae7e89f8691419d4a5bc972db7a3abd7" title="Actual used CPU time in seconds; calls getrusage, limited accuracy.">nfft_second</a>();
<a name="l00226"></a>00226           <a class="code" href="group__nfft.html#g27ef1bcb8dd3a3fc1cdbeee368ec1acf" title="Computes a NDFT, see the definition.">ndft_trafo</a>(&amp;np);
<a name="l00227"></a>00227           t=<a class="code" href="group__nfftutil.html#gae7e89f8691419d4a5bc972db7a3abd7" title="Actual used CPU time in seconds; calls getrusage, limited accuracy.">nfft_second</a>()-t;
<a name="l00228"></a>00228           t_ndft+=t;
<a name="l00229"></a>00229         }
<a name="l00230"></a>00230       t_ndft/=r;
<a name="l00231"></a>00231 
<a name="l00232"></a>00232       <a class="code" href="group__nfftutil.html#g4df074728562efbb458f6662e649d1d5" title="Swapping of two vectors.">NFFT_SWAP_complex</a>(np.<a class="code" href="structnfft__plan.html#fa27a166f809acf70ae27e5e6f28daa5" title="Vector of samples, \ size is M_total float types.">f</a>,swapndft);
<a name="l00233"></a>00233       printf(<span class="stringliteral">"%.2e\t"</span>,t_ndft);
<a name="l00234"></a>00234     }
<a name="l00235"></a>00235   <span class="keywordflow">else</span>
<a name="l00236"></a>00236     printf(<span class="stringliteral">"nan\t\t"</span>);
<a name="l00237"></a>00237 
<a name="l00239"></a>00239   t_nfft=0;
<a name="l00240"></a>00240   r=0;
<a name="l00241"></a>00241   <span class="keywordflow">while</span>(t_nfft&lt;0.01)
<a name="l00242"></a>00242     {
<a name="l00243"></a>00243       r++;
<a name="l00244"></a>00244       t=<a class="code" href="group__nfftutil.html#gae7e89f8691419d4a5bc972db7a3abd7" title="Actual used CPU time in seconds; calls getrusage, limited accuracy.">nfft_second</a>();
<a name="l00245"></a>00245       <a class="code" href="group__nfft.html#g9f1e6bd9f7f956a8679e6b413c97b421" title="Computes a NFFT, see the definition.">nfft_trafo</a>(&amp;np);
<a name="l00246"></a>00246       t=<a class="code" href="group__nfftutil.html#gae7e89f8691419d4a5bc972db7a3abd7" title="Actual used CPU time in seconds; calls getrusage, limited accuracy.">nfft_second</a>()-t;
<a name="l00247"></a>00247       t_nfft+=t;
<a name="l00248"></a>00248     }
<a name="l00249"></a>00249   t_nfft/=r;
<a name="l00250"></a>00250 
<a name="l00251"></a>00251   printf(<span class="stringliteral">"%.2f\t%d\t%.2e\t"</span>,((<span class="keywordtype">double</span>)n)/N, m, t_nfft);
<a name="l00252"></a>00252 
<a name="l00253"></a>00253   <span class="keywordflow">if</span>(test_accuracy)
<a name="l00254"></a>00254     printf(<span class="stringliteral">"%.2e\t"</span>,<a class="code" href="group__nfftutil.html#g76b384a2f6c54e2686544e312f9ada5d" title="Computes .">nfft_error_l_infty_complex</a>(swapndft, np.<a class="code" href="structnfft__plan.html#fa27a166f809acf70ae27e5e6f28daa5" title="Vector of samples, \ size is M_total float types.">f</a>, np.<a class="code" href="structnfft__plan.html#df33ce87c35b396c50d214d9bdeeefe6" title="Total number of samples.">M_total</a>));
<a name="l00255"></a>00255   <span class="keywordflow">else</span>
<a name="l00256"></a>00256     printf(<span class="stringliteral">"nan\t\t"</span>);
<a name="l00257"></a>00257 
<a name="l00259"></a>00259   t_taylor=0;
<a name="l00260"></a>00260   r=0;
<a name="l00261"></a>00261   <span class="keywordflow">while</span>(t_taylor&lt;0.01)
<a name="l00262"></a>00262     {
<a name="l00263"></a>00263       r++;
<a name="l00264"></a>00264       t=<a class="code" href="group__nfftutil.html#gae7e89f8691419d4a5bc972db7a3abd7" title="Actual used CPU time in seconds; calls getrusage, limited accuracy.">nfft_second</a>();
<a name="l00265"></a>00265       <a class="code" href="taylor__nfft_8c.html#506cce59a9b1353e569e5c308d5d1069" title="Executes a Taylor-NFFT, see equation (1.1) in [Guide], computes fast and approximate...">taylor_trafo</a>(&amp;tp);
<a name="l00266"></a>00266       t=<a class="code" href="group__nfftutil.html#gae7e89f8691419d4a5bc972db7a3abd7" title="Actual used CPU time in seconds; calls getrusage, limited accuracy.">nfft_second</a>()-t;
<a name="l00267"></a>00267       t_taylor+=t;
<a name="l00268"></a>00268     }
<a name="l00269"></a>00269   t_taylor/=r;
<a name="l00270"></a>00270 
<a name="l00271"></a>00271 
<a name="l00272"></a>00272   printf(<span class="stringliteral">"%.2f\t%d\t%.2e\t"</span>,((<span class="keywordtype">double</span>)n_taylor)/N,m_taylor,t_taylor);
<a name="l00273"></a>00273 
<a name="l00274"></a>00274   <span class="keywordflow">if</span>(test_accuracy)
<a name="l00275"></a>00275     printf(<span class="stringliteral">"%.2e\n"</span>,<a class="code" href="group__nfftutil.html#g76b384a2f6c54e2686544e312f9ada5d" title="Computes .">nfft_error_l_infty_complex</a>(swapndft, np.<a class="code" href="structnfft__plan.html#fa27a166f809acf70ae27e5e6f28daa5" title="Vector of samples, \ size is M_total float types.">f</a>, np.<a class="code" href="structnfft__plan.html#df33ce87c35b396c50d214d9bdeeefe6" title="Total number of samples.">M_total</a>));
<a name="l00276"></a>00276   <span class="keywordflow">else</span>
<a name="l00277"></a>00277     printf(<span class="stringliteral">"nan\t\n"</span>);
<a name="l00278"></a>00278 
<a name="l00279"></a>00279   fflush(stdout);
<a name="l00280"></a>00280 
<a name="l00282"></a>00282   <span class="keywordflow">if</span>(test_accuracy)
<a name="l00283"></a>00283     <a class="code" href="nfft3_8h.html#b8a0db03dda1317a8a3d922e0e4e8aaa">nfft_free</a>(swapndft);
<a name="l00284"></a>00284 
<a name="l00285"></a>00285   <a class="code" href="group__nfft.html#g614f9f7af5b0d5491afa9495393c4dc3" title="Destroys a transform plan.">nfft_finalize</a>(&amp;np);
<a name="l00286"></a>00286   <a class="code" href="taylor__nfft_8c.html#ea63140d36ed574c45ec63310b561273" title="Destroys a transform plan.">taylor_finalize</a>(&amp;tp);
<a name="l00287"></a>00287 }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 <span class="keywordtype">int</span> <a class="code" href="group__examples__solver__glacier.html#g3c04138a5bfe5d72780bb7e82a18e627" title="Main routine.">main</a>(<span class="keywordtype">int</span> argc,<span class="keywordtype">char</span> **argv)
<a name="l00290"></a>00290 {
<a name="l00291"></a>00291   <span class="keywordtype">int</span> l,m,trial,N;
<a name="l00292"></a>00292 
<a name="l00293"></a>00293   <span class="keywordflow">if</span>(argc&lt;=2)
<a name="l00294"></a>00294     {
<a name="l00295"></a>00295       fprintf(stderr,<span class="stringliteral">"taylor_nfft type first last trials sigma_nfft sigma_taylor.\n"</span>);
<a name="l00296"></a>00296       <span class="keywordflow">return</span> -1;
<a name="l00297"></a>00297     }
<a name="l00298"></a>00298 
<a name="l00299"></a>00299   fprintf(stderr,<span class="stringliteral">"Testing the Nfft &amp; a Taylor expansion based version.\n\n"</span>);
<a name="l00300"></a>00300   fprintf(stderr,<span class="stringliteral">"Columns: N, M, t_ndft, sigma_nfft, m_nfft, t_nfft, e_nfft"</span>);
<a name="l00301"></a>00301   fprintf(stderr,<span class="stringliteral">", sigma_taylor, m_taylor, t_taylor, e_taylor\n"</span>);
<a name="l00302"></a>00302 
<a name="l00303"></a>00303   <span class="comment">/* time vs. N=M */</span>
<a name="l00304"></a>00304   <span class="keywordflow">if</span>(atoi(argv[1])==0)
<a name="l00305"></a>00305     {
<a name="l00306"></a>00306       fprintf(stderr,<span class="stringliteral">"Fixed target accuracy, timings.\n\n"</span>);
<a name="l00307"></a>00307       <span class="keywordflow">for</span>(l=atoi(argv[2]); l&lt;=atoi(argv[3]); l++)
<a name="l00308"></a>00308         <span class="keywordflow">for</span>(trial=0; trial&lt;atoi(argv[4]); trial++)
<a name="l00309"></a>00309           <span class="keywordflow">if</span>(l&lt;=10)
<a name="l00310"></a>00310             <a class="code" href="taylor__nfft_8c.html#dcac16b056210ccff5d865731a8fb4bc" title="Compares NDFT, NFFT, and Taylor-NFFT.">taylor_time_accuracy</a>((1U&lt;&lt; l), (1U&lt;&lt; l), (<span class="keywordtype">int</span>)(atof(argv[5])*
<a name="l00311"></a>00311                                  (1U&lt;&lt; l)), 6, (<span class="keywordtype">int</span>)(atof(argv[6])*(1U&lt;&lt; l)),
<a name="l00312"></a>00312                                  6, 1);
<a name="l00313"></a>00313           <span class="keywordflow">else</span>
<a name="l00314"></a>00314             <a class="code" href="taylor__nfft_8c.html#dcac16b056210ccff5d865731a8fb4bc" title="Compares NDFT, NFFT, and Taylor-NFFT.">taylor_time_accuracy</a>((1U&lt;&lt; l), (1U&lt;&lt; l), (<span class="keywordtype">int</span>)(atof(argv[5])*
<a name="l00315"></a>00315                                  (1U&lt;&lt; l)), 6, (<span class="keywordtype">int</span>)(atof(argv[6])*(1U&lt;&lt; l)),
<a name="l00316"></a>00316                                  6, 0);
<a name="l00317"></a>00317     }
<a name="l00318"></a>00318 
<a name="l00319"></a>00319   <span class="comment">/* error vs. m */</span>
<a name="l00320"></a>00320   <span class="keywordflow">if</span>(atoi(argv[1])==1)
<a name="l00321"></a>00321     {
<a name="l00322"></a>00322       N=atoi(argv[7]);
<a name="l00323"></a>00323       fprintf(stderr,<span class="stringliteral">"Fixed N=M=%d, error vs. m.\n\n"</span>,N);
<a name="l00324"></a>00324       <span class="keywordflow">for</span>(m=atoi(argv[2]); m&lt;=atoi(argv[3]); m++)
<a name="l00325"></a>00325         <span class="keywordflow">for</span>(trial=0; trial&lt;atoi(argv[4]); trial++)
<a name="l00326"></a>00326           <a class="code" href="taylor__nfft_8c.html#dcac16b056210ccff5d865731a8fb4bc" title="Compares NDFT, NFFT, and Taylor-NFFT.">taylor_time_accuracy</a>(N,N, (<span class="keywordtype">int</span>)(atof(argv[5])*N), m,
<a name="l00327"></a>00327                                     (<span class="keywordtype">int</span>)(atof(argv[6])*N), m, 1);
<a name="l00328"></a>00328     }
<a name="l00329"></a>00329 
<a name="l00330"></a>00330   <span class="keywordflow">return</span> 1;
<a name="l00331"></a>00331 }
</pre></div></div>
    <hr size="1"/>
    Generated on 23 Dec 2009 by Doxygen 1.5.6
  </body>
</html>
