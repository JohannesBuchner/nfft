<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.3 API Reference - NFFT: taylor_nfft.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.3 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">examples</a>&nbsp;/&nbsp;<a class="el" href="dir_000018.html">nfft</a></div>
<h1>taylor_nfft.c</h1><a href="taylor__nfft_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00010 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00011 <span class="preprocessor">#include &lt;math.h&gt;</span>
00012 <span class="preprocessor">#include &lt;string.h&gt;</span>
00013 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00014 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00016 
00017 <span class="keyword">typedef</span> <span class="keyword">struct</span>
00018 <span class="keyword"></span>{
00019   <a class="code" href="structnfft__plan.html">nfft_plan</a> p;                          
00021   <span class="keywordtype">int</span> *idx0;                            
00023   <span class="keywordtype">double</span> *deltax0;                      
00024 } taylor_plan;
00025 
<a name="l00037"></a><a class="code" href="taylor__nfft_8c.html#a0">00037</a> <span class="keywordtype">void</span> <a class="code" href="taylor__nfft_8c.html#a0">taylor_init</a>(taylor_plan *ths, <span class="keywordtype">int</span> N, <span class="keywordtype">int</span> M, <span class="keywordtype">int</span> n, <span class="keywordtype">int</span> m)
00038 {
00039   <span class="comment">/* Note: no nfft precomputation! */</span>
00040   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>((<a class="code" href="structnfft__plan.html">nfft_plan</a>*)ths, 1, &amp;N, M, &amp;n, m,
00041                  <a class="code" href="group__nfft.html#ga22">MALLOC_X</a>| <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>| <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>|
00042      <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a>| <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00043      FFTW_ESTIMATE| FFTW_PRESERVE_INPUT);
00044 
00045   ths-&gt;idx0=(<span class="keywordtype">int</span>*)fftw_malloc(M*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
00046   ths-&gt;deltax0=(<span class="keywordtype">double</span>*)fftw_malloc(M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00047 }
00048 
<a name="l00056"></a><a class="code" href="taylor__nfft_8c.html#a1">00056</a> <span class="keywordtype">void</span> <a class="code" href="taylor__nfft_8c.html#a1">taylor_precompute</a>(taylor_plan *ths)
00057 {
00058   <span class="keywordtype">int</span> j;
00059 
00060   <a class="code" href="structnfft__plan.html">nfft_plan</a>* cths=(<a class="code" href="structnfft__plan.html">nfft_plan</a>*)ths;
00061 
00062   <span class="keywordflow">for</span>(j=0;j&lt;cths-&gt;<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++)
00063     {
00064       ths-&gt;idx0[j] = ((int)round((cths-&gt;<a class="code" href="structnfft__plan.html#o14">x</a>[j]+0.5)*cths-&gt;<a class="code" href="structnfft__plan.html#o7">n</a>[0]) +
00065                                  cths-&gt;<a class="code" href="structnfft__plan.html#o7">n</a>[0]/2)%cths-&gt;<a class="code" href="structnfft__plan.html#o7">n</a>[0];
00066       ths-&gt;deltax0[j] = cths-&gt;<a class="code" href="structnfft__plan.html#o14">x</a>[j] - (round((cths-&gt;<a class="code" href="structnfft__plan.html#o14">x</a>[j]+0.5)*cths-&gt;<a class="code" href="structnfft__plan.html#o7">n</a>[0]) /
00067                                       cths-&gt;<a class="code" href="structnfft__plan.html#o7">n</a>[0] - 0.5);
00068     }
00069 }
00070 
<a name="l00078"></a><a class="code" href="taylor__nfft_8c.html#a2">00078</a> <span class="keywordtype">void</span> <a class="code" href="taylor__nfft_8c.html#a2">taylor_finalize</a>(taylor_plan *ths)
00079 {
00080   fftw_free(ths-&gt;deltax0);
00081   fftw_free(ths-&gt;idx0);
00082 
00083   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>((<a class="code" href="structnfft__plan.html">nfft_plan</a>*)ths);
00084 }
00085 
<a name="l00096"></a><a class="code" href="taylor__nfft_8c.html#a3">00096</a> <span class="keywordtype">void</span> <a class="code" href="taylor__nfft_8c.html#a3">taylor_trafo</a>(taylor_plan *ths)
00097 {
00098   <span class="keywordtype">int</span> j,k,l,ll;
00099   <span class="keywordtype">double</span> complex *f, *f_hat, *g1;
00100   <span class="keywordtype">double</span> *deltax;
00101   <span class="keywordtype">int</span> *idx;
00102 
00103   <a class="code" href="structnfft__plan.html">nfft_plan</a> *cths=(<a class="code" href="structnfft__plan.html">nfft_plan</a>*)ths;
00104 
00105   <span class="keywordflow">for</span>(j=0, f=cths-&gt;<a class="code" href="structnfft__plan.html#o3">f</a>; j&lt;cths-&gt;<a class="code" href="structnfft__plan.html#o1">M_total</a>; j++)
00106     *f++ = 0;
00107 
00108   <span class="keywordflow">for</span>(k=0; k&lt;cths-&gt;<a class="code" href="structnfft__plan.html#o8">n_total</a>; k++)
00109     cths-&gt;<a class="code" href="structnfft__plan.html#o24">g1</a>[k]=0;
00110 
00111   <span class="keywordflow">for</span>(k=-cths-&gt;<a class="code" href="structnfft__plan.html#o0">N_total</a>/2, g1=cths-&gt;<a class="code" href="structnfft__plan.html#o24">g1</a>+cths-&gt;<a class="code" href="structnfft__plan.html#o8">n_total</a>-cths-&gt;<a class="code" href="structnfft__plan.html#o0">N_total</a>/2,
00112       f_hat=cths-&gt;<a class="code" href="structnfft__plan.html#o2">f_hat</a>; k&lt;0; k++)
00113     (*g1++)=cpow( - 2*<a class="code" href="group__nfftutil.html#ga57">PI</a>*I*k,cths-&gt;<a class="code" href="structnfft__plan.html#o9">m</a>)* (*f_hat++);
00114    
00115   cths-&gt;<a class="code" href="structnfft__plan.html#o24">g1</a>[0]=cths-&gt;<a class="code" href="structnfft__plan.html#o2">f_hat</a>[cths-&gt;<a class="code" href="structnfft__plan.html#o0">N_total</a>/2];
00116 
00117   <span class="keywordflow">for</span>(k=1, g1=cths-&gt;<a class="code" href="structnfft__plan.html#o24">g1</a>+1, f_hat=cths-&gt;<a class="code" href="structnfft__plan.html#o2">f_hat</a>+cths-&gt;<a class="code" href="structnfft__plan.html#o0">N_total</a>/2+1;
00118       k&lt;cths-&gt;<a class="code" href="structnfft__plan.html#o0">N_total</a>/2; k++)
00119     (*g1++)=cpow( - 2*<a class="code" href="group__nfftutil.html#ga57">PI</a>*I*k,cths-&gt;<a class="code" href="structnfft__plan.html#o9">m</a>)* (*f_hat++);
00120 
00121   <span class="keywordflow">for</span>(l=cths-&gt;<a class="code" href="structnfft__plan.html#o9">m</a>-1; l&gt;=0; l--)
00122     {
00123       <span class="keywordflow">for</span>(k=-cths-&gt;<a class="code" href="structnfft__plan.html#o0">N_total</a>/2, g1=cths-&gt;<a class="code" href="structnfft__plan.html#o24">g1</a>+cths-&gt;<a class="code" href="structnfft__plan.html#o8">n_total</a>-cths-&gt;<a class="code" href="structnfft__plan.html#o0">N_total</a>/2;
00124           k&lt;0; k++)
00125         (*g1++) /= (-2*<a class="code" href="group__nfftutil.html#ga57">PI</a>*I*k);
00126 
00127       <span class="keywordflow">for</span>(k=1, g1=cths-&gt;<a class="code" href="structnfft__plan.html#o24">g1</a>+1; k&lt;cths-&gt;<a class="code" href="structnfft__plan.html#o0">N_total</a>/2; k++)
00128         (*g1++) /= (-2*<a class="code" href="group__nfftutil.html#ga57">PI</a>*I*k);
00129 
00130       fftw_execute(cths-&gt;<a class="code" href="structnfft__plan.html#o16">my_fftw_plan1</a>);
00131 
00132       ll=(l==0?1:l);
00133       <span class="keywordflow">for</span>(j=0, f=cths-&gt;<a class="code" href="structnfft__plan.html#o3">f</a>, deltax=ths-&gt;deltax0, idx=ths-&gt;idx0; j&lt;cths-&gt;<a class="code" href="structnfft__plan.html#o1">M_total</a>;
00134           j++, f++)
00135   (*f) = ((*f) * (*deltax++) + cths-&gt;<a class="code" href="structnfft__plan.html#o25">g2</a>[*idx++]) /ll;
00136     }
00137 }
00138 
<a name="l00152"></a><a class="code" href="taylor__nfft_8c.html#a4">00152</a> <span class="keywordtype">void</span> <a class="code" href="taylor__nfft_8c.html#a4">taylor_time_accuracy</a>(<span class="keywordtype">int</span> N, <span class="keywordtype">int</span> M, <span class="keywordtype">int</span> n, <span class="keywordtype">int</span> m, <span class="keywordtype">int</span> n_taylor,
00153                           <span class="keywordtype">int</span> m_taylor, <span class="keywordtype">unsigned</span> test_accuracy)
00154 {
00155   <span class="keywordtype">int</span> r;
00156   <span class="keywordtype">double</span> t_ndft, t_nfft, t_taylor, t;
00157   <span class="keywordtype">double</span> complex *swapndft;
00158 
00159   taylor_plan tp;
00160   <a class="code" href="structnfft__plan.html">nfft_plan</a> np;
00161 
00162   printf(<span class="stringliteral">"%d\t%d\t"</span>,N, M);
00163 
00164   <a class="code" href="taylor__nfft_8c.html#a0">taylor_init</a>(&amp;tp,N,M,n_taylor,m_taylor);
00165 
00166   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;np, 1, &amp;N, M, &amp;n, m,
00167                  <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#ga19">PRE_FG_PSI</a>|
00168      <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a>| <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00169      FFTW_ESTIMATE| FFTW_DESTROY_INPUT);
00170 
00172   np.<a class="code" href="structnfft__plan.html#o14">x</a>=tp.p.<a class="code" href="structnfft__plan.html#o14">x</a>;
00173   np.<a class="code" href="structnfft__plan.html#o2">f_hat</a>=tp.p.<a class="code" href="structnfft__plan.html#o2">f_hat</a>;
00174   np.<a class="code" href="structnfft__plan.html#o3">f</a>=tp.p.<a class="code" href="structnfft__plan.html#o3">f</a>;
00175   
00177   <span class="keywordflow">if</span>(test_accuracy)
00178     swapndft=(<span class="keywordtype">double</span> complex*)fftw_malloc(M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00179 
00181   <a class="code" href="group__nfftutil.html#ga47">nfft_vrand_shifted_unit_double</a>(np.<a class="code" href="structnfft__plan.html#o14">x</a>, np.<a class="code" href="structnfft__plan.html#o1">M_total</a>);
00182 
00184   <a class="code" href="taylor__nfft_8c.html#a1">taylor_precompute</a>(&amp;tp);
00185 
00187   <span class="keywordflow">if</span>(np.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga27">PRE_ONE_PSI</a>)
00188     <a class="code" href="group__nfft.html#ga10">nfft_precompute_one_psi</a>(&amp;np);
00189 
00191   <a class="code" href="group__nfftutil.html#ga46">nfft_vrand_unit_complex</a>(np.<a class="code" href="structnfft__plan.html#o2">f_hat</a>, np.<a class="code" href="structnfft__plan.html#o0">N_total</a>);
00192 
00194   <span class="keywordflow">if</span>(test_accuracy)
00195     {
00196       <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(np.<a class="code" href="structnfft__plan.html#o3">f</a>,swapndft);
00197       
00198       t_ndft=0;
00199       r=0; 
00200       <span class="keywordflow">while</span>(t_ndft&lt;0.01)
00201         {
00202           r++;
00203           t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00204           <a class="code" href="group__nfft.html#ga0">ndft_trafo</a>(&amp;np);
00205           t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-t;
00206           t_ndft+=t;
00207         }
00208       t_ndft/=r;
00209 
00210       <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(np.<a class="code" href="structnfft__plan.html#o3">f</a>,swapndft);
00211       printf(<span class="stringliteral">"%.2e\t"</span>,t_ndft);
00212     }
00213   <span class="keywordflow">else</span> 
00214     printf(<span class="stringliteral">"nan\t\t"</span>);
00215 
00217   t_nfft=0;
00218   r=0;
00219   <span class="keywordflow">while</span>(t_nfft&lt;0.01)
00220     {
00221       r++;
00222       t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00223       <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;np);
00224       t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-t;
00225       t_nfft+=t;
00226     }
00227   t_nfft/=r;
00228 
00229   printf(<span class="stringliteral">"%.2f\t%d\t%.2e\t"</span>,((<span class="keywordtype">double</span>)n)/N, m, t_nfft);
00230 
00231   <span class="keywordflow">if</span>(test_accuracy)
00232     printf(<span class="stringliteral">"%.2e\t"</span>,<a class="code" href="group__nfftutil.html#ga37">nfft_error_l_infty_complex</a>(swapndft, np.<a class="code" href="structnfft__plan.html#o3">f</a>, np.<a class="code" href="structnfft__plan.html#o1">M_total</a>));
00233   <span class="keywordflow">else</span>
00234     printf(<span class="stringliteral">"nan\t\t"</span>);
00235 
00237   t_taylor=0;
00238   r=0;
00239   <span class="keywordflow">while</span>(t_taylor&lt;0.01)
00240     {
00241       r++;
00242       t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00243       <a class="code" href="taylor__nfft_8c.html#a3">taylor_trafo</a>(&amp;tp);
00244       t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-t;
00245       t_taylor+=t;
00246     }
00247   t_taylor/=r;
00248 
00249 
00250   printf(<span class="stringliteral">"%.2f\t%d\t%.2e\t"</span>,((<span class="keywordtype">double</span>)n_taylor)/N,m_taylor,t_taylor);
00251 
00252   <span class="keywordflow">if</span>(test_accuracy)
00253     printf(<span class="stringliteral">"%.2e\n"</span>,<a class="code" href="group__nfftutil.html#ga37">nfft_error_l_infty_complex</a>(swapndft, np.<a class="code" href="structnfft__plan.html#o3">f</a>, np.<a class="code" href="structnfft__plan.html#o1">M_total</a>));
00254   <span class="keywordflow">else</span>
00255     printf(<span class="stringliteral">"nan\t\n"</span>);
00256 
00257   fflush(stdout);
00258   
00260   <span class="keywordflow">if</span>(test_accuracy)
00261     fftw_free(swapndft);
00262 
00263   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;np);
00264   <a class="code" href="taylor__nfft_8c.html#a2">taylor_finalize</a>(&amp;tp);
00265 }
00266 
<a name="l00267"></a><a class="code" href="taylor__nfft_8c.html#a5">00267</a> <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a>(<span class="keywordtype">int</span> argc,<span class="keywordtype">char</span> **argv)
00268 {
00269   <span class="keywordtype">int</span> l,m,trial,N;
00270 
00271   <span class="keywordflow">if</span>(argc&lt;=2)
00272     {
00273       fprintf(stderr,<span class="stringliteral">"taylor_nfft type first last trials sigma_nfft sigma_taylor.\n"</span>);
00274       <span class="keywordflow">return</span> -1;
00275     }
00276   
00277   fprintf(stderr,<span class="stringliteral">"Testing the Nfft &amp; a Taylor expansion based version.\n\n"</span>);
00278   fprintf(stderr,<span class="stringliteral">"Columns: N, M, t_ndft, sigma_nfft, m_nfft, t_nfft, e_nfft"</span>);
00279   fprintf(stderr,<span class="stringliteral">", sigma_taylor, m_taylor, t_taylor, e_taylor\n"</span>);
00280 
00281   <span class="comment">/* time vs. N=M */</span>
00282   <span class="keywordflow">if</span>(atoi(argv[1])==0)
00283     {
00284       fprintf(stderr,<span class="stringliteral">"Fixed target accuracy, timings.\n\n"</span>);
00285       <span class="keywordflow">for</span>(l=atoi(argv[2]); l&lt;=atoi(argv[3]); l++)
00286         <span class="keywordflow">for</span>(trial=0; trial&lt;atoi(argv[4]); trial++)
00287           <span class="keywordflow">if</span>(l&lt;=10)
00288             <a class="code" href="taylor__nfft_8c.html#a4">taylor_time_accuracy</a>((1U&lt;&lt; l), (1U&lt;&lt; l), (<span class="keywordtype">int</span>)(atof(argv[5])*
00289                                  (1U&lt;&lt; l)), 6, (<span class="keywordtype">int</span>)(atof(argv[6])*(1U&lt;&lt; l)),
00290                                  6, 1);
00291           <span class="keywordflow">else</span>
00292             <a class="code" href="taylor__nfft_8c.html#a4">taylor_time_accuracy</a>((1U&lt;&lt; l), (1U&lt;&lt; l), (<span class="keywordtype">int</span>)(atof(argv[5])*
00293                                  (1U&lt;&lt; l)), 6, (<span class="keywordtype">int</span>)(atof(argv[6])*(1U&lt;&lt; l)),
00294                                  6, 0);
00295     }
00296 
00297   <span class="comment">/* error vs. m */</span>
00298   <span class="keywordflow">if</span>(atoi(argv[1])==1)
00299     {
00300       N=atoi(argv[7]);
00301       fprintf(stderr,<span class="stringliteral">"Fixed N=M=%d, error vs. m.\n\n"</span>,N);
00302       <span class="keywordflow">for</span>(m=atoi(argv[2]); m&lt;=atoi(argv[3]); m++)
00303         <span class="keywordflow">for</span>(trial=0; trial&lt;atoi(argv[4]); trial++)
00304           <a class="code" href="taylor__nfft_8c.html#a4">taylor_time_accuracy</a>(N,N, (<span class="keywordtype">int</span>)(atof(argv[5])*N), m,
00305                                     (<span class="keywordtype">int</span>)(atof(argv[6])*N), m, 1);
00306     }
00307 
00308   <span class="keywordflow">return</span> 1;
00309 }
</pre></div>    <hr size="1"/>
    Generated on 5 Feb 2007 by Doxygen 1.4.1
  </body>
</html>
