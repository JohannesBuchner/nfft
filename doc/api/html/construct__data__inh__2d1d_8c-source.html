<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.3 API Reference - NFFT: construct_data_inh_2d1d.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.3 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000006.html">applications</a>&nbsp;/&nbsp;<a class="el" href="dir_000007.html">mri</a>&nbsp;/&nbsp;<a class="el" href="dir_000008.html">mri2d</a></div>
<h1>construct_data_inh_2d1d.c</h1><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00002 <span class="preprocessor">#include &lt;math.h&gt;</span>
00003 <span class="preprocessor">#include &lt;limits.h&gt;</span>
00004 
00005 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00006 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00007 
<a name="l00017"></a><a class="code" href="group__applications__mri2d__construct__data__inh__2d1d.html#ga0">00017</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__mri2d__construct__data__2d.html#ga0">construct</a>(<span class="keywordtype">char</span> * file, <span class="keywordtype">int</span> N, <span class="keywordtype">int</span> M)
00018 {
00019   <span class="keywordtype">int</span> j;                  <span class="comment">/* some variables */</span>
00020   <span class="keywordtype">double</span> real;
00021   <span class="keywordtype">double</span> w;
00022   <span class="keywordtype">double</span> time,min_time,max_time,min_inh,max_inh;
00023   <a class="code" href="structmri__inh__2d1d__plan.html">mri_inh_2d1d_plan</a> my_plan;  
00024   FILE *fp,*fout,*fi,*finh,*ftime;
00025   <span class="keywordtype">int</span> my_N[3],my_n[3];
00026   <span class="keywordtype">int</span> flags = <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#ga20">PRE_PSI</a> |<a class="code" href="group__nfft.html#ga22">MALLOC_X</a>| <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>|
00027                       <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>| <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a>| <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>|
00028                       FFTW_MEASURE| FFTW_DESTROY_INPUT;
00029 
00030   <span class="keywordtype">double</span> Ts;
00031   <span class="keywordtype">double</span> W,T;
00032   <span class="keywordtype">int</span> N3;
00033   <span class="keywordtype">int</span> m=2;
00034   <span class="keywordtype">double</span> sigma = 1.25;
00035 
00036   ftime=fopen(<span class="stringliteral">"readout_time.dat"</span>,<span class="stringliteral">"r"</span>);
00037   finh=fopen(<span class="stringliteral">"inh.dat"</span>,<span class="stringliteral">"r"</span>);
00038 
00039   min_time=INT_MAX; max_time=INT_MIN;
00040   <span class="keywordflow">for</span>(j=0;j&lt;M;j++)
00041   {
00042     fscanf(ftime,<span class="stringliteral">"%le "</span>,&amp;time);
00043     <span class="keywordflow">if</span>(time&lt;min_time)
00044       min_time = time;
00045     <span class="keywordflow">if</span>(time&gt;max_time)
00046       max_time = time;
00047   }
00048 
00049   fclose(ftime);
00050   
00051   Ts=(min_time+max_time)/2.0;
00052 
00053   min_inh=INT_MAX; max_inh=INT_MIN;
00054   <span class="keywordflow">for</span>(j=0;j&lt;N*N;j++)
00055   {
00056     fscanf(finh,<span class="stringliteral">"%le "</span>,&amp;w);
00057     <span class="keywordflow">if</span>(w&lt;min_inh)
00058       min_inh = w;
00059     <span class="keywordflow">if</span>(w&gt;max_inh)
00060       max_inh = w;
00061   }
00062   fclose(finh);
00063 
00064 
00065   N3=ceil((<a class="code" href="group__nfftutil.html#ga58">NFFT_MAX</a>(fabs(min_inh),fabs(max_inh))*(max_time-min_time)/2.0+m/(2*sigma))*4*sigma);
00066   T=((max_time-min_time)/2.0)/(0.5-((double) m)/N3);
00067   W=N3/T;
00068 
00069   my_N[0]=N; my_n[0]=ceil(N*sigma);
00070   my_N[1]=N; my_n[1]=ceil(N*sigma);
00071   my_N[2]=N3; my_n[2]=N3;
00072   
00073   <span class="comment">/* initialise nfft */</span> 
00074   <a class="code" href="group__mri.html#ga2">mri_inh_2d1d_init_guru</a>(&amp;my_plan, my_N, M, my_n, m, sigma, flags,
00075                       FFTW_MEASURE| FFTW_DESTROY_INPUT);
00076 
00077   ftime=fopen(<span class="stringliteral">"readout_time.dat"</span>,<span class="stringliteral">"r"</span>);
00078   fp=fopen(<span class="stringliteral">"knots.dat"</span>,<span class="stringliteral">"r"</span>);
00079   
00080   <span class="keywordflow">for</span>(j=0;j&lt;my_plan.<a class="code" href="structmri__inh__2d1d__plan.html#o1">M_total</a>;j++)
00081   {
00082     fscanf(fp,<span class="stringliteral">"%le %le "</span>,&amp;my_plan.<a class="code" href="structmri__inh__2d1d__plan.html#o4">plan</a>.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+0],&amp;my_plan.<a class="code" href="structmri__inh__2d1d__plan.html#o4">plan</a>.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+1]);
00083     fscanf(ftime,<span class="stringliteral">"%le "</span>,&amp;my_plan.<a class="code" href="structmri__inh__2d1d__plan.html#o7">t</a>[j]);
00084     my_plan.<a class="code" href="structmri__inh__2d1d__plan.html#o7">t</a>[j] = (my_plan.<a class="code" href="structmri__inh__2d1d__plan.html#o7">t</a>[j]-Ts)/T;
00085   }
00086   fclose(fp);
00087   fclose(ftime);
00088 
00089   finh=fopen(<span class="stringliteral">"inh.dat"</span>,<span class="stringliteral">"r"</span>);
00090   <span class="keywordflow">for</span>(j=0;j&lt;N*N;j++)
00091   {
00092     fscanf(finh,<span class="stringliteral">"%le "</span>,&amp;my_plan.<a class="code" href="structmri__inh__2d1d__plan.html#o8">w</a>[j]);
00093     my_plan.<a class="code" href="structmri__inh__2d1d__plan.html#o8">w</a>[j]/=W;
00094   }
00095   fclose(finh);
00096 
00097 
00098   fi=fopen(<span class="stringliteral">"input_f.dat"</span>,<span class="stringliteral">"r"</span>);
00099   <span class="keywordflow">for</span>(j=0;j&lt;N*N;j++)
00100   {
00101     fscanf(fi,<span class="stringliteral">"%le "</span>,&amp;real);
00102     my_plan.<a class="code" href="structmri__inh__2d1d__plan.html#o2">f_hat</a>[j] = real*cexp(2.0*I*<a class="code" href="group__nfftutil.html#ga57">PI</a>*Ts*my_plan.<a class="code" href="structmri__inh__2d1d__plan.html#o8">w</a>[j]*W);
00103   }
00104   
00105   <span class="keywordflow">if</span>(my_plan.<a class="code" href="structmri__inh__2d1d__plan.html#o4">plan</a>.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00106     <a class="code" href="group__nfft.html#ga12">nfft_precompute_psi</a>(&amp;my_plan.<a class="code" href="structmri__inh__2d1d__plan.html#o4">plan</a>);
00107 
00108   <a class="code" href="group__mri.html#ga0">mri_inh_2d1d_trafo</a>(&amp;my_plan);
00109 
00110   fout=fopen(file,<span class="stringliteral">"w"</span>);
00111   
00112   <span class="keywordflow">for</span>(j=0;j&lt;my_plan.<a class="code" href="structmri__inh__2d1d__plan.html#o1">M_total</a>;j++)
00113   {
00114     fprintf(fout,<span class="stringliteral">"%le %le %le %le\n"</span>,my_plan.<a class="code" href="structmri__inh__2d1d__plan.html#o4">plan</a>.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+0],my_plan.<a class="code" href="structmri__inh__2d1d__plan.html#o4">plan</a>.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+1],creal(my_plan.<a class="code" href="structmri__inh__2d1d__plan.html#o3">f</a>[j]),cimag(my_plan.<a class="code" href="structmri__inh__2d1d__plan.html#o3">f</a>[j]));
00115   }
00116 
00117   fclose(fout);
00118 
00119   <a class="code" href="group__mri.html#ga3">mri_inh_2d1d_finalize</a>(&amp;my_plan);
00120 }
00121 
00122 <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
00123 { 
00124   <span class="keywordflow">if</span> (argc &lt;= 3) {
00125     printf(<span class="stringliteral">"usage: ./construct_data_inh_2d1d FILENAME N M\n"</span>);
00126     <span class="keywordflow">return</span> 1;
00127   }
00128   
00129   <a class="code" href="group__applications__mri2d__construct__data__2d.html#ga0">construct</a>(argv[1],atoi(argv[2]),atoi(argv[3]));
00130   
00131   <span class="keywordflow">return</span> 1;
00132 }
00133 <span class="comment">/* \} */</span>
</pre></div>    <hr size="1"/>
    Generated on 5 Feb 2007 by Doxygen 1.4.1
  </body>
</html>
