<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.3 API Reference - NFFT: solver_adjoint.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.3 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000003.html">kernel</a>&nbsp;/&nbsp;<a class="el" href="dir_000034.html">solver</a></div>
<h1>solver_adjoint.c</h1><div class="fragment"><pre class="fragment">00001 
00005 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00006 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00007 
00027 <span class="preprocessor">#define F(MV, FLT, FLT_TYPE, NAME, ...) void i ## MV ## _ ## NAME(__VA_ARGS__)</span>
00028 <span class="preprocessor"></span>
00029 
00030 <span class="preprocessor">#define MACRO_SOLVER_ADJOINT_IMPL(MV, FLT, FLT_TYPE)                          \</span>
00031 <span class="preprocessor">                                                                              \</span>
00032 <span class="preprocessor">F(MV, FLT, FLT_TYPE, init_advanced, i ## MV ## _adjoint_plan *ths,             \</span>
00033 <span class="preprocessor">MV ## _adjoint_plan *mv, unsigned adjoint ## MV ## _flags)                     \</span>
00034 <span class="preprocessor">{                                                                             \</span>
00035 <span class="preprocessor">  ths-&gt;mv = mv;                                                               \</span>
00036 <span class="preprocessor">  ths-&gt;flags = i ## MV ## _flags;                                             \</span>
00037 <span class="preprocessor">                                                                              \</span>
00038 <span class="preprocessor">  ths-&gt;y_hat      = (FLT_TYPE*)fftw_malloc(ths-&gt;mv-&gt;N_total*sizeof(FLT_TYPE));\</span>
00039 <span class="preprocessor">  ths-&gt;r_hat_iter = (FLT_TYPE*)fftw_malloc(ths-&gt;mv-&gt;N_total*sizeof(FLT_TYPE));\</span>
00040 <span class="preprocessor">  ths-&gt;f_iter = (FLT_TYPE*)fftw_malloc(ths-&gt;mv-&gt;M_total*sizeof(FLT_TYPE));    \</span>
00041 <span class="preprocessor">  ths-&gt;p_iter = (FLT_TYPE*)fftw_malloc(ths-&gt;mv-&gt;M_total*sizeof(FLT_TYPE));    \</span>
00042 <span class="preprocessor">                                                                              \</span>
00043 <span class="preprocessor">  if(ths-&gt;flags &amp; LANDWEBER)                                                  \</span>
00044 <span class="preprocessor">    ths-&gt;z_iter = ths-&gt;p_iter;                                                \</span>
00045 <span class="preprocessor">                                                                              \</span>
00046 <span class="preprocessor">  if(ths-&gt;flags &amp; STEEPEST_DESCENT)                                           \</span>
00047 <span class="preprocessor">    {                                                                         \</span>
00048 <span class="preprocessor">      ths-&gt;z_iter = ths-&gt;p_iter;                                              \</span>
00049 <span class="preprocessor">      ths-&gt;v_hat_iter     = (FLT_TYPE*)fftw_malloc(ths-&gt;mv-&gt;N_total*          \</span>
00050 <span class="preprocessor">                                               sizeof(FLT_TYPE));             \</span>
00051 <span class="preprocessor">    }                                                                         \</span>
00052 <span class="preprocessor">                                                                              \</span>
00053 <span class="preprocessor">  if(ths-&gt;flags &amp; CGNR)                                                       \</span>
00054 <span class="preprocessor">    {                                                                         \</span>
00055 <span class="preprocessor">      ths-&gt;z_iter = (FLT_TYPE*)fftw_malloc(ths-&gt;mv-&gt;M_total*                  \</span>
00056 <span class="preprocessor">                                               sizeof(FLT_TYPE));             \</span>
00057 <span class="preprocessor">      ths-&gt;v_hat_iter     = (FLT_TYPE*)fftw_malloc(ths-&gt;mv-&gt;N_total*          \</span>
00058 <span class="preprocessor">                                               sizeof(FLT_TYPE));             \</span>
00059 <span class="preprocessor">    }                                                                         \</span>
00060 <span class="preprocessor">                                                                              \</span>
00061 <span class="preprocessor">  if(ths-&gt;flags &amp; CGNE)                                                       \</span>
00062 <span class="preprocessor">    ths-&gt;z_iter = ths-&gt;p_iter;                                                \</span>
00063 <span class="preprocessor">                                                                              \</span>
00064 <span class="preprocessor">  if(ths-&gt;flags &amp; PRECOMPUTE_WEIGHT)                                          \</span>
00065 <span class="preprocessor">\</span>
00066 <span class="preprocessor">    ths-&gt;w = (double*) fftw_malloc(ths-&gt;mv-&gt;M_total*sizeof(double));          \</span>
00067 <span class="preprocessor">                                                                              \</span>
00068 <span class="preprocessor">  if(ths-&gt;flags &amp; PRECOMPUTE_DAMP)                                            \</span>
00069 <span class="preprocessor">    ths-&gt;w_hat = (double*) fftw_malloc(ths-&gt;mv-&gt;N_total*sizeof(double));      \</span>
00070 <span class="preprocessor">}                                                                             \</span>
00071 <span class="preprocessor">                                                                              \</span>
00072 <span class="preprocessor">                                                                              \</span>
00073 <span class="preprocessor">                                                 \</span>
00074 <span class="preprocessor">F(MV, FLT, FLT_TYPE, init, i ## MV ## _adjoint_plan *ths, MV ## _plan *mv)     \</span>
00075 <span class="preprocessor">{                                                                             \</span>
00076 <span class="preprocessor">  adjoint ## MV ## _init_advanced(ths, mv, CGNR);                             \</span>
00077 <span class="preprocessor">} </span><span class="comment">/* void adjoint&lt;mv&gt;_init */</span>                                                 \
00078                                                                               \
00079                                           \
00080 F(MV, FLT, FLT_TYPE, before_loop,   i ## MV ## _adjoint_plan *ths)             \
00081 {                                                                             \
00082    \
00083                                                                               \
00084    nfft_cp_ ## FLT(ths-&gt;mv-&gt;f, ths-&gt;f_iter, ths-&gt;mv-&gt;M_total);                \
00085                                              \
00086                                                                               \
00087    NFFT_SWAP_ ## FLT(ths-&gt;r_hat_iter, ths-&gt;mv-&gt;f_hat);                        \
00088    MV ## _adjoint(ths-&gt;mv);                                                    \
00089    NFFT_SWAP_ ## FLT(ths-&gt;r_hat_iter, ths-&gt;mv-&gt;f_hat);                        \
00090                                                                               \
00091                                                                               \
00092    nfft_upd_axpy_ ## FLT(ths-&gt;r_hat_iter, -1.0, ths-&gt;y_hat, ths-&gt;mv-&gt;N_total);\
00093                                                                               \
00094  if((!(ths-&gt;flags &amp; LANDWEBER)) || (ths-&gt;flags &amp; NORMS_FOR_LANDWEBER))        \
00095     {                                                                         \
00096       if(ths-&gt;flags &amp; PRECOMPUTE_WEIGHT)                                      \
00097   ths-&gt;dot_r_hat_iter =                                                       \
00098       nfft_dot_w_ ## FLT(ths-&gt;r_hat_iter, ths-&gt;w, ths-&gt;mv-&gt;N_total);          \
00099       else                                                                    \
00100   ths-&gt;dot_r_hat_iter = nfft_dot_ ## FLT(ths-&gt;r_hat_iter, ths-&gt;mv-&gt;N_total);  \
00101     }                                                                         \
00102                                                                               \
00103                                                                               \
00104 <span class="comment">/*-----------------*/</span>                                                         \
00105   if(ths-&gt;flags &amp; PRECOMPUTE_WEIGHT)                                          \
00106     nfft_cp_w_ ## FLT(ths-&gt;mv-&gt;f_hat, ths-&gt;w_hat, ths-&gt;r_hat_iter, ths-&gt;mv-&gt;N_total);     \
00107   else                                                                          \
00108     nfft_cp_ ## FLT(ths-&gt;mv-&gt;f_hat, ths-&gt;r_hat_iter, ths-&gt;mv-&gt;N_total);         \
00109                                                                                 \
00110 \
00113                                                                                 \
00114   if((!(ths-&gt;flags &amp; LANDWEBER)) || (ths-&gt;flags &amp; NORMS_FOR_LANDWEBER))       \
00115     {                                                                         \
00116       if(ths-&gt;flags &amp; PRECOMPUTE_DAMP)                                        \
00117         ths-&gt;dot_z_iter =                                                     \
00118           nfft_dot_w_ ## FLT(ths-&gt;z_iter, ths-&gt;w, ths-&gt;mv-&gt;M_total);          \
00119       else                                                                    \
00120          ths-&gt;dot_z_iter = nfft_dot_ ## FLT(ths-&gt;z_iter, ths-&gt;mv-&gt;M_total);   \
00121     }                                                                         \
00122                                                                               \
00123   if(ths-&gt;flags &amp; CGNE)                                                       \
00124     ths-&gt;dot_p_iter = ths-&gt;dot_z_iter;                                        \
00125                                                                               \
00126   if(ths-&gt;flags &amp; CGNR)                                                       \
00127     nfft_cp_ ## FLT(ths-&gt;p_iter, ths-&gt;z_iter, ths-&gt;mv-&gt;M_total);              \
00128 } <span class="comment">/* void i&lt;mv&gt;_before_loop */</span>                                                \
00129                                                                               \
00130                                                                     \
00131                                                                               \
00132                                           \
00133 F(MV, FLT, FLT_TYPE, loop_one_step_cgne, i ## MV ## _adjoint_plan *ths)       \
00134 {                                                                             \
00135             \
00136   ths-&gt;alpha_iter = ths-&gt;dot_r_hat_iter / ths-&gt;dot_p_iter;                    \
00137                                                                               \
00138   <span class="comment">/*-----------------*/</span>                                                       \
00139   if(ths-&gt;flags &amp; PRECOMPUTE_DAMP)                                            \
00140     nfft_upd_xpawy_ ## FLT(ths-&gt;f_iter, ths-&gt;alpha_iter, ths-&gt;w,              \
00141           ths-&gt;p_iter, ths-&gt;mv-&gt;M_total);                                     \
00142   else                                                                        \
00143     nfft_upd_xpay_ ## FLT(ths-&gt;f_ter, ths-&gt;alpha_iter, ths-&gt;p_iter,           \
00144                           ths-&gt;mv-&gt;M_total);                                  \
00145                                                                               \
00146   <span class="comment">/*-----------------*/</span>                                                       \
00147   if(ths-&gt;flags &amp; PRECOMPUTE_DAMP)                                            \
00148     nfft_cp_w_ ## FLT(ths-&gt;mv-&gt;f, ths-&gt;w, ths-&gt;p_iter,                        \
00149                       ths-&gt;mv-&gt;M_total);                                      \
00150   else                                                                        \
00151     nfft_cp_ ## FLT(ths-&gt;mv-&gt;f, ths-&gt;p_iter, ths-&gt;mv-&gt;M_total);               \
00152                                                                               \
00153 \
00154    MV ## _adjoint(ths-&gt;mv);                                                   \
00155                                                                               \
00156   nfft_upd_xpay_ ## FLT(ths-&gt;r_hat_iter, -ths-&gt;alpha_iter, ths-&gt;mv-&gt;f_hat,    \
00157                         ths-&gt;mv-&gt;N_total);                                    \
00158                                                                               \
00159   ths-&gt;dot_r_hat_iter_old = ths-&gt;dot_r_hat_iter;                              \
00160   if(ths-&gt;flags &amp; PRECOMPUTE_WEIGHT)                                          \
00161     ths-&gt;dot_r_hat_iter = nfft_dot_w_ ## FLT(ths-&gt;r_hat_iter, ths-&gt;w_hat, \
00162                                          ths-&gt;mv-&gt;N_total);                   \
00163   else                                                                        \
00164     ths-&gt;dot_r_hat_iter = nfft_dot_ ## FLT(ths-&gt;r_hat_iter, ths-&gt;mv-&gt;N_total);\
00165                                                                               \
00166   <span class="comment">/*-----------------*/</span>                                                       \
00167   ths-&gt;beta_iter = ths-&gt;dot_r_hat_iter / ths-&gt;dot_r_hat_iter_old;             \
00168                                                                               \
00169   <span class="comment">/*-----------------*/</span>                                                       \
00170   if(ths-&gt;flags &amp; PRECOMPUTE_WEIGHT)                                          \
00171     nfft_cp_w_ ## FLT(ths-&gt;mv-&gt;f_hat, ths-&gt;w_hat, ths-&gt;r_hat_iter, ths-&gt;mv-&gt;N_total);     \
00172   else                                                                        \
00173     nfft_cp_ ## FLT(ths-&gt;mv-&gt;f_hat, ths-&gt;r_hat_iter, ths-&gt;mv-&gt;N_total);       \
00174                                                                               \
00175 \
00176     MV ## _trafo(ths-&gt;mv);                                                    \
00177                                                                               \
00178                                                                               \
00179                                                                               \
00180                                                                               \
00181                                                                               \
00182   nfft_upd_axpy_ ## FLT(ths-&gt;p_iter, ths-&gt;beta_iter, ths-&gt;mv-&gt;f,      \
00183        ths-&gt;mv-&gt;M_total);                                                     \
00184                                                                               \
00185   if(ths-&gt;flags &amp; PRECOMPUTE_DAMP)                                            \
00186     ths-&gt;dot_p_hat_iter =                                                     \
00187       nfft_dot_w_ ## FLT(ths-&gt;p_hat_iter, ths-&gt;w_hat, ths-&gt;mv-&gt;N_total);      \
00188   else                                                                        \
00189     ths-&gt;dot_p_hat_iter = nfft_dot_ ## FLT(ths-&gt;p_hat_iter, ths-&gt;mv-&gt;N_total);\
00190 } <span class="comment">/* void i&lt;mv&gt;_adjoint_loop_one_step_cgne */</span>                                 \
00191                                                                               \
00192                                                                               \
00193                                                                               \
00194                                                                               \
00195                                                                               \
00196                                                                               \
00197                                        \
00198 F(MV, FLT, FLT_TYPE, adjoint_loop_one_step, i ## MV ## _adjoint_plan *ths)    \
00199 {                                                                             \
00200                                                                           \
00211   if(ths-&gt;flags &amp; CGNE)                                                       \
00212     i ## MV ## _adjoint_loop_one_step_cgne(ths);                              \
00213 } <span class="comment">/* void i&lt;mv&gt;_adjoint_loop_one_step */</span>                                      \
00214                                                                               \
00215                                             \
00216 F(MV, FLT, FLT_TYPE, adjoint_finalize, i ## MV ## _adjoint_plan *ths)         \
00217 {                                                                             \
00218   if(ths-&gt;flags &amp; PRECOMPUTE_WEIGHT)                                          \
00219     fftw_free(ths-&gt;w);                                                        \
00220                                                                               \
00221   if(ths-&gt;flags &amp; PRECOMPUTE_DAMP)                                            \
00222     fftw_free(ths-&gt;w_hat);                                                    \
00223                                                                               \
00224   if(ths-&gt;flags &amp; CGNR)                                                       \
00225     {                                                                         \
00226       fftw_free(ths-&gt;v_hatiter);                                              \
00227       fftw_free(ths-&gt;z_iter);                                                 \
00228     }                                                                         \
00229                                                                               \
00230   if(ths-&gt;flags &amp; STEEPEST_DESCENT)                                           \
00231     fftw_free(ths-&gt;v_hat_iter);                                               \
00232                                                                               \
00233   fftw_free(ths-&gt;p_iter);                                                     \
00234   fftw_free(ths-&gt;f_iter);                                                     \
00235                                                                               \
00236   fftw_free(ths-&gt;r_hat_iter);                                                 \
00237   fftw_free(ths-&gt;y);                                                          \
00238 }                                            \
00239 MACRO_SOLVER_ADJOINT_IMPL(nfsft, complex, double complex)
00240 
</pre></div>    <hr size="1"/>
    Generated on 5 Feb 2007 by Doxygen 1.4.1
  </body>
</html>
