<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.2 API Reference - NFFT: construct_data_inh_3d.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.2 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000006.html">applications</a>&nbsp;/&nbsp;<a class="el" href="dir_000007.html">mri</a>&nbsp;/&nbsp;<a class="el" href="dir_000008.html">mri2d</a></div>
<h1>construct_data_inh_3d.c</h1><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00002 <span class="preprocessor">#include &lt;math.h&gt;</span>
00003 <span class="preprocessor">#include &lt;limits.h&gt;</span>
00004 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00005 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00006 
<a name="l00016"></a><a class="code" href="group__applications__mri2d__construct__data__inh__3d.html#ga0">00016</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__mri2d__construct__data__2d.html#ga0">construct</a>(<span class="keywordtype">char</span> * file, <span class="keywordtype">int</span> N, <span class="keywordtype">int</span> M)
00017 {
00018   <span class="keywordtype">int</span> j;                  <span class="comment">/* some variables */</span>
00019   <span class="keywordtype">double</span> real;
00020   <span class="keywordtype">double</span> w;
00021   <span class="keywordtype">double</span> time,min_time,max_time,min_inh,max_inh;
00022   <a class="code" href="structmri__inh__3d__plan.html">mri_inh_3d_plan</a> my_plan;  
00023   FILE *fp,*fout,*fi,*finh,*ftime;
00024   <span class="keywordtype">int</span> my_N[3],my_n[3];
00025   <span class="keywordtype">int</span> flags = <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#ga20">PRE_PSI</a> |<a class="code" href="group__nfft.html#ga22">MALLOC_X</a>| <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>|
00026                       <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>| <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a>| <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>|
00027                       FFTW_MEASURE| FFTW_DESTROY_INPUT;
00028 
00029   <span class="keywordtype">double</span> Ts;
00030   <span class="keywordtype">double</span> W;
00031   <span class="keywordtype">int</span> N3;
00032   <span class="keywordtype">int</span> m=2;
00033   <span class="keywordtype">double</span> sigma = 1.25;
00034 
00035   ftime=fopen(<span class="stringliteral">"readout_time.dat"</span>,<span class="stringliteral">"r"</span>);
00036   finh=fopen(<span class="stringliteral">"inh.dat"</span>,<span class="stringliteral">"r"</span>);
00037 
00038   min_time=INT_MAX; max_time=INT_MIN;
00039   <span class="keywordflow">for</span>(j=0;j&lt;M;j++)
00040   {
00041     fscanf(ftime,<span class="stringliteral">"%le "</span>,&amp;time);
00042     <span class="keywordflow">if</span>(time&lt;min_time)
00043       min_time = time;
00044     <span class="keywordflow">if</span>(time&gt;max_time)
00045       max_time = time;
00046   }
00047 
00048   fclose(ftime);
00049   
00050   Ts=(min_time+max_time)/2.0;
00051 
00052   min_inh=INT_MAX; max_inh=INT_MIN;
00053   <span class="keywordflow">for</span>(j=0;j&lt;N*N;j++)
00054   {
00055     fscanf(finh,<span class="stringliteral">"%le "</span>,&amp;w);
00056     <span class="keywordflow">if</span>(w&lt;min_inh)
00057       min_inh = w;
00058     <span class="keywordflow">if</span>(w&gt;max_inh)
00059       max_inh = w;
00060   }
00061   fclose(finh);
00062 
00063   N3=ceil((<a class="code" href="group__nfftutil.html#ga58">NFFT_MAX</a>(fabs(min_inh),fabs(max_inh))*(max_time-min_time)/2.0+m/(2*sigma))*4*sigma);
00064 
00065   W= <a class="code" href="group__nfftutil.html#ga58">NFFT_MAX</a>(fabs(min_inh),fabs(max_inh))/(0.5-((double)m)/N3);
00066 
00067   my_N[0]=N; my_n[0]=ceil(N*sigma);
00068   my_N[1]=N; my_n[1]=ceil(N*sigma);
00069   my_N[2]=N3; my_n[2]=ceil(N3*sigma);
00070   
00071   <span class="comment">/* initialise nfft */</span> 
00072   mri_inh_3d_init_guru(&amp;my_plan, my_N, M, my_n, m, sigma, flags,
00073                       FFTW_MEASURE| FFTW_DESTROY_INPUT);
00074 
00075   ftime=fopen(<span class="stringliteral">"readout_time.dat"</span>,<span class="stringliteral">"r"</span>);
00076   fp=fopen(<span class="stringliteral">"knots.dat"</span>,<span class="stringliteral">"r"</span>);
00077   
00078   <span class="keywordflow">for</span>(j=0;j&lt;my_plan.<a class="code" href="structmri__inh__3d__plan.html#o1">M_total</a>;j++)
00079   {
00080     fscanf(fp,<span class="stringliteral">"%le %le"</span>,&amp;my_plan.<a class="code" href="structmri__inh__3d__plan.html#o4">plan</a>.<a class="code" href="structnfft__plan.html#o14">x</a>[3*j+0],&amp;my_plan.<a class="code" href="structmri__inh__3d__plan.html#o4">plan</a>.<a class="code" href="structnfft__plan.html#o14">x</a>[3*j+1]);
00081     fscanf(ftime,<span class="stringliteral">"%le "</span>,&amp;my_plan.<a class="code" href="structmri__inh__3d__plan.html#o4">plan</a>.<a class="code" href="structnfft__plan.html#o14">x</a>[3*j+2]);
00082     my_plan.<a class="code" href="structmri__inh__3d__plan.html#o4">plan</a>.<a class="code" href="structnfft__plan.html#o14">x</a>[3*j+2] = (my_plan.<a class="code" href="structmri__inh__3d__plan.html#o4">plan</a>.<a class="code" href="structnfft__plan.html#o14">x</a>[3*j+2]-Ts)*W/N3;
00083   }
00084   fclose(fp);
00085   fclose(ftime);
00086 
00087   finh=fopen(<span class="stringliteral">"inh.dat"</span>,<span class="stringliteral">"r"</span>);
00088   <span class="keywordflow">for</span>(j=0;j&lt;N*N;j++)
00089   {
00090     fscanf(finh,<span class="stringliteral">"%le "</span>,&amp;my_plan.<a class="code" href="structmri__inh__3d__plan.html#o8">w</a>[j]);
00091     my_plan.<a class="code" href="structmri__inh__3d__plan.html#o8">w</a>[j]/=W;
00092   }
00093   fclose(finh);
00094 
00095 
00096   fi=fopen(<span class="stringliteral">"input_f.dat"</span>,<span class="stringliteral">"r"</span>);
00097   <span class="keywordflow">for</span>(j=0;j&lt;N*N;j++)
00098   {
00099     fscanf(fi,<span class="stringliteral">"%le "</span>,&amp;real);
00100     my_plan.<a class="code" href="structmri__inh__3d__plan.html#o2">f_hat</a>[j] = real*cexp(2.0*I*<a class="code" href="group__nfftutil.html#ga57">PI</a>*Ts*my_plan.<a class="code" href="structmri__inh__3d__plan.html#o8">w</a>[j]*W);
00101   }
00102   
00103   <span class="keywordflow">if</span>(my_plan.<a class="code" href="structmri__inh__3d__plan.html#o4">plan</a>.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00104     <a class="code" href="group__nfft.html#ga12">nfft_precompute_psi</a>(&amp;my_plan.<a class="code" href="structmri__inh__3d__plan.html#o4">plan</a>);
00105 
00106   <a class="code" href="group__mri.html#ga4">mri_inh_3d_trafo</a>(&amp;my_plan);
00107 
00108   fout=fopen(file,<span class="stringliteral">"w"</span>);
00109   
00110   <span class="keywordflow">for</span>(j=0;j&lt;my_plan.<a class="code" href="structmri__inh__3d__plan.html#o1">M_total</a>;j++)
00111   {
00112     fprintf(fout,<span class="stringliteral">"%le %le %le %le\n"</span>,my_plan.<a class="code" href="structmri__inh__3d__plan.html#o4">plan</a>.<a class="code" href="structnfft__plan.html#o14">x</a>[3*j+0],my_plan.<a class="code" href="structmri__inh__3d__plan.html#o4">plan</a>.<a class="code" href="structnfft__plan.html#o14">x</a>[3*j+1],creal(my_plan.<a class="code" href="structmri__inh__3d__plan.html#o3">f</a>[j]),cimag(my_plan.<a class="code" href="structmri__inh__3d__plan.html#o3">f</a>[j]));
00113   }
00114 
00115   fclose(fout);
00116 
00117   <a class="code" href="group__mri.html#ga7">mri_inh_3d_finalize</a>(&amp;my_plan);
00118 }
00119 
00120 <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
00121 { 
00122   <span class="keywordflow">if</span> (argc &lt;= 3) {
00123     printf(<span class="stringliteral">"usage: ./construct_data_inh_3d FILENAME N M\n"</span>);
00124     <span class="keywordflow">return</span> 1;
00125   }
00126   
00127   <a class="code" href="group__applications__mri2d__construct__data__2d.html#ga0">construct</a>(argv[1],atoi(argv[2]),atoi(argv[3]));
00128   
00129   <span class="keywordflow">return</span> 1;
00130 }
00131 <span class="comment">/* \} */</span>
</pre></div>    <hr size="1"/>
    Generated on 22 Jan 2007 by Doxygen 1.4.1
  </body>
</html>
