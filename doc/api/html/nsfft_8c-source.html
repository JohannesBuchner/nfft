<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.3 API Reference - NFFT: nsfft.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.3 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000003.html">kernel</a>&nbsp;/&nbsp;<a class="el" href="dir_000028.html">nsfft</a></div>
<h1>nsfft.c</h1><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00002 <span class="preprocessor">#include &lt;math.h&gt;</span>
00003 <span class="preprocessor">#include &lt;string.h&gt;</span>
00004 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00005 
00006 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00007 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00008 <span class="preprocessor">#include "options.h"</span>
00009 
00010 <span class="comment">/* computes a 2d ndft by 1d nfft along the dimension 1 times</span>
00011 <span class="comment">   1d ndft along dimension 0</span>
00012 <span class="comment">*/</span>
00013 <span class="keywordtype">void</span> short_nfft_trafo_2d(<a class="code" href="structnfft__plan.html">nfft_plan</a>* ths, <a class="code" href="structnfft__plan.html">nfft_plan</a>* plan_1d)
00014 {
00015   <span class="keywordtype">int</span> j,k0;
00016   <span class="keywordtype">double</span> omega;
00017 
00018   <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++)
00019     {
00020       ths-&gt;f[j]= 0;      
00021       plan_1d-&gt;x[j] = ths-&gt;x[ths-&gt;d * j + 1]; 
00022     }
00023 
00024   <span class="keywordflow">for</span>(k0=0;k0&lt;ths-&gt;N[0];k0++) <span class="comment">/* for shorties */</span>
00025     {
00026       plan_1d-&gt;f_hat = ths-&gt;f_hat + k0*ths-&gt;N[1];
00027    
00028       <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(plan_1d);
00029       
00030       <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++)
00031   {
00032     omega = ((double)(k0 - ths-&gt;N[0]/2)) * ths-&gt;x[ths-&gt;d * j + 0];
00033           ths-&gt;f[j] += plan_1d-&gt;f[j] * cexp( - I*2*PI*omega);
00034   }
00035     }
00036 }
00037 
00038 <span class="keywordtype">void</span> short_nfft_adjoint_2d(<a class="code" href="structnfft__plan.html">nfft_plan</a>* ths, <a class="code" href="structnfft__plan.html">nfft_plan</a>* plan_1d)
00039 {
00040   <span class="keywordtype">int</span> j,k0;
00041   <span class="keywordtype">double</span> omega;
00042 
00043   <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++)     
00044     plan_1d-&gt;x[j] = ths-&gt;x[ths-&gt;d * j + 1];
00045 
00046   <span class="keywordflow">for</span>(k0=0;k0&lt;ths-&gt;N[0];k0++) <span class="comment">/* for shorties */</span>
00047     {
00048       <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++)
00049   {
00050     omega = ((double)(k0 - ths-&gt;N[0]/2)) * ths-&gt;x[ths-&gt;d * j + 0];
00051           plan_1d-&gt;f[j] = ths-&gt;f[j] * cexp( + I*2*PI*omega);
00052   }
00053    
00054       plan_1d-&gt;f_hat = ths-&gt;f_hat + k0*ths-&gt;N[1];
00055 
00056       <a class="code" href="group__nfft.html#ga3">nfft_adjoint</a>(plan_1d);
00057     }
00058 }
00059 
00060 <span class="comment">/* computes a 3d ndft by 1d nfft along the dimension 2 times</span>
00061 <span class="comment">   2d ndft along dimension 0,1</span>
00062 <span class="comment">*/</span>
00063 <span class="keywordtype">void</span> short_nfft_trafo_3d_1(<a class="code" href="structnfft__plan.html">nfft_plan</a>* ths, <a class="code" href="structnfft__plan.html">nfft_plan</a>* plan_1d)
00064 {
00065   <span class="keywordtype">int</span> j,k0,k1;
00066   <span class="keywordtype">double</span> omega;
00067 
00068   <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++)
00069     {
00070       ths-&gt;f[j] = 0;
00071       plan_1d-&gt;x[j] = ths-&gt;x[ths-&gt;d * j + 2]; 
00072     }
00073 
00074   <span class="keywordflow">for</span>(k0=0;k0&lt;ths-&gt;N[0];k0++) <span class="comment">/* for shorties */</span>
00075     <span class="keywordflow">for</span>(k1=0;k1&lt;ths-&gt;N[1];k1++) 
00076       {
00077   plan_1d-&gt;f_hat = ths-&gt;f_hat + (k0*ths-&gt;N[1]+k1)*ths-&gt;N[2];
00078   
00079   <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(plan_1d);
00080   
00081   <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++)
00082     {
00083       omega = ((double)(k0 - ths-&gt;N[0]/2)) * ths-&gt;x[ths-&gt;d * j + 0]
00084         +     ((double)(k1 - ths-&gt;N[1]/2)) * ths-&gt;x[ths-&gt;d * j + 1];
00085             ths-&gt;f[j] += plan_1d-&gt;f[j] * cexp( - I*2*PI*omega);
00086     }
00087       }
00088 }
00089 
00090 <span class="keywordtype">void</span> short_nfft_adjoint_3d_1(<a class="code" href="structnfft__plan.html">nfft_plan</a>* ths, <a class="code" href="structnfft__plan.html">nfft_plan</a>* plan_1d)
00091 {
00092   <span class="keywordtype">int</span> j,k0,k1;
00093   <span class="keywordtype">double</span> omega;
00094 
00095   <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++)
00096     plan_1d-&gt;x[j] = ths-&gt;x[ths-&gt;d * j + 2]; 
00097  
00098   <span class="keywordflow">for</span>(k0=0;k0&lt;ths-&gt;N[0];k0++) <span class="comment">/* for shorties */</span>
00099     <span class="keywordflow">for</span>(k1=0;k1&lt;ths-&gt;N[1];k1++) 
00100       {
00101   <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++)
00102     {
00103       omega = ((double)(k0 - ths-&gt;N[0]/2)) * ths-&gt;x[ths-&gt;d * j + 0]
00104         +     ((double)(k1 - ths-&gt;N[1]/2)) * ths-&gt;x[ths-&gt;d * j + 1];
00105             plan_1d-&gt;f[j] = ths-&gt;f[j] * cexp( + I*2*PI*omega);
00106     }
00107 
00108   plan_1d-&gt;f_hat = ths-&gt;f_hat + (k0*ths-&gt;N[1]+k1)*ths-&gt;N[2];
00109   
00110   <a class="code" href="group__nfft.html#ga3">nfft_adjoint</a>(plan_1d);
00111       }
00112 }
00113 
00114 <span class="comment">/* computes a 3d ndft by 2d nfft along the dimension 1,2 times</span>
00115 <span class="comment">   1d ndft along dimension 0</span>
00116 <span class="comment">*/</span>
00117 <span class="keywordtype">void</span> short_nfft_trafo_3d_2(<a class="code" href="structnfft__plan.html">nfft_plan</a>* ths, <a class="code" href="structnfft__plan.html">nfft_plan</a>* plan_2d)
00118 {
00119   <span class="keywordtype">int</span> j,k0;
00120   <span class="keywordtype">double</span> omega;
00121 
00122   <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++)
00123     {
00124       ths-&gt;f[j] = 0;
00125       plan_2d-&gt;x[2*j+0] = ths-&gt;x[ths-&gt;d * j + 1];
00126       plan_2d-&gt;x[2*j+1] = ths-&gt;x[ths-&gt;d * j + 2];
00127     }
00128 
00129   <span class="keywordflow">for</span>(k0=0;k0&lt;ths-&gt;N[0];k0++) <span class="comment">/* for shorties */</span>
00130     {
00131       plan_2d-&gt;f_hat = ths-&gt;f_hat + k0*ths-&gt;N[1]*ths-&gt;N[2];
00132    
00133       <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(plan_2d);
00134       
00135       <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++)
00136   {
00137     omega = ((double)(k0 - ths-&gt;N[0]/2)) * ths-&gt;x[ths-&gt;d * j + 0];
00138     ths-&gt;f[j] += plan_2d-&gt;f[j] * cexp( - I*2*PI*omega);
00139   }
00140     }
00141 }
00142 
00143 <span class="keywordtype">void</span> short_nfft_adjoint_3d_2(<a class="code" href="structnfft__plan.html">nfft_plan</a>* ths, <a class="code" href="structnfft__plan.html">nfft_plan</a>* plan_2d)
00144 {
00145   <span class="keywordtype">int</span> j,k0;
00146   <span class="keywordtype">double</span> omega;
00147 
00148   <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++)
00149     {
00150       plan_2d-&gt;x[2*j+0] = ths-&gt;x[ths-&gt;d * j + 1];
00151       plan_2d-&gt;x[2*j+1] = ths-&gt;x[ths-&gt;d * j + 2];
00152     }
00153 
00154   <span class="keywordflow">for</span>(k0=0;k0&lt;ths-&gt;N[0];k0++) <span class="comment">/* for shorties */</span>
00155     {     
00156       <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++)
00157   {
00158     omega = ((double)(k0 - ths-&gt;N[0]/2)) * ths-&gt;x[ths-&gt;d * j + 0];
00159     plan_2d-&gt;f[j] = ths-&gt;f[j] * cexp( + I*2*PI*omega);
00160   }
00161 
00162       plan_2d-&gt;f_hat = ths-&gt;f_hat + k0*ths-&gt;N[1]*ths-&gt;N[2];
00163    
00164       <a class="code" href="group__nfft.html#ga3">nfft_adjoint</a>(plan_2d);
00165     }
00166 }
00167 
00168 <span class="comment">/*---------------------------------------------------------------------------*/</span>
00169 
00170 <span class="keywordtype">int</span> index_sparse_to_full_direct_2d(<span class="keywordtype">int</span> J, <span class="keywordtype">int</span> k)
00171 {
00172     <span class="keywordtype">int</span> N=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J+2);               <span class="comment">/* number of full coeffs             */</span>
00173     <span class="keywordtype">int</span> N_B=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J);               <span class="comment">/* number in each sparse block       */</span>
00174 
00175     <span class="keywordtype">int</span> j=k/N_B;                        <span class="comment">/* consecutive number of Block       */</span>
00176     <span class="keywordtype">int</span> r=j/4;                          <span class="comment">/* level of block                    */</span>
00177 
00178     <span class="keywordtype">int</span> i, o, a, b,s,l,m1,m2;
00179     <span class="keywordtype">int</span> k1,k2;
00180 
00181     <span class="keywordflow">if</span> (k&gt;=(J+4)*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J+1))
00182       {
00183   printf(<span class="stringliteral">"Fehler!\n"</span>);
00184   <span class="keywordflow">return</span>(-1);
00185       }
00186     <span class="keywordflow">else</span>
00187       {
00188   <span class="keywordflow">if</span> (r&gt;(J+1)/2)                  <span class="comment">/* center block                      */</span>
00189     {
00190       i=k-4*((J+1)/2+1)*N_B;
00191       a=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J/2+1);
00192       m1=i/a;
00193       m2=i%a;
00194       k1=N/2-a/2+m1;
00195       k2=N/2-a/2+m2;
00196     }
00197   <span class="keywordflow">else</span>                            <span class="comment">/* no center block                   */</span>
00198     {
00199       i=k-j*N_B;                  <span class="comment">/* index in specific block           */</span>
00200       o=j%4;                      <span class="comment">/* kind of specific block            */</span>
00201       a=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(r);
00202       b=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-r);
00203       l=<a class="code" href="group__nfftutil.html#ga58">NFFT_MAX</a>(a,b);                 <span class="comment">/* long dimension of block           */</span>
00204       s=<a class="code" href="group__nfftutil.html#ga59">NFFT_MIN</a>(a,b);                 <span class="comment">/* short dimension of block          */</span>
00205       m1=i/l;
00206       m2=i%l;
00207       
00208       <span class="keywordflow">switch</span>(o)
00209         {
00210         <span class="keywordflow">case</span> 0:
00211     {
00212       k1=N/2-a/2 ;
00213       k2=N/2+ b  ;
00214       
00215       <span class="keywordflow">if</span> (b&gt;=a)
00216         {
00217           k1+=m1;
00218           k2+=m2;
00219         }
00220       <span class="keywordflow">else</span>
00221         {
00222           k1+=m2;
00223           k2+=m1;
00224         }
00225       <span class="keywordflow">break</span>;
00226     }
00227         <span class="keywordflow">case</span> 1:
00228     {
00229       k1=N/2+ b  ;
00230       k2=N/2-a/2 ;
00231       
00232       <span class="keywordflow">if</span> (b&gt;a)
00233         {
00234           k1+=m2;
00235           k2+=m1;
00236         }
00237       <span class="keywordflow">else</span>
00238         {
00239           k1+=m1;
00240           k2+=m2;
00241         }
00242       <span class="keywordflow">break</span>;
00243     }
00244         <span class="keywordflow">case</span> 2:
00245     {
00246       k1=N/2-a/2 ;
00247       k2=N/2-2*b ;
00248       
00249       <span class="keywordflow">if</span> (b&gt;=a)
00250         {
00251           k1+=m1;
00252           k2+=m2;
00253         }
00254       <span class="keywordflow">else</span>
00255         {
00256           k1+=m2;
00257           k2+=m1;
00258         }
00259       <span class="keywordflow">break</span>;
00260     }
00261         <span class="keywordflow">case</span> 3:
00262     {
00263       k1=N/2-2*b ;
00264       k2=N/2-a/2 ;
00265       
00266       <span class="keywordflow">if</span> (b&gt;a)
00267         {
00268           k1+=m2;
00269           k2+=m1;
00270         }
00271       <span class="keywordflow">else</span>
00272         {
00273           k1+=m1;
00274           k2+=m2;
00275         }   
00276       <span class="keywordflow">break</span>;         
00277     }
00278         <span class="keywordflow">default</span>:
00279     {
00280       k1=-1;
00281       k2=-1;
00282     }
00283         }
00284     }
00285   <span class="comment">//printf("m1=%d, m2=%d\n",m1,m2);</span>
00286   <span class="keywordflow">return</span>(k1*N+k2);
00287       }
00288 }
00289 
00290 <span class="keyword">inline</span> <span class="keywordtype">int</span> index_sparse_to_full_2d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths, <span class="keywordtype">int</span> k)
00291 {
00292   <span class="comment">/* only by lookup table */</span>
00293   <span class="keywordflow">if</span>( k &lt; ths-&gt;N_total)
00294     <span class="keywordflow">return</span> ths-&gt;index_sparse_to_full[k];
00295   <span class="keywordflow">else</span>
00296     <span class="keywordflow">return</span> -1;
00297 }
00298  
00299 <span class="keywordtype">int</span> index_full_to_sparse_2d(<span class="keywordtype">int</span> J, <span class="keywordtype">int</span> k)
00300 {
00301     <span class="keywordtype">int</span> N=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J+2);               <span class="comment">/* number of full coeffs       */</span>
00302     <span class="keywordtype">int</span> N_B=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J);               <span class="comment">/* number in each sparse block */</span>
00303 
00304     <span class="keywordtype">int</span> k1=k/N-N/2;                     <span class="comment">/* coordinates in the full grid */</span>
00305     <span class="keywordtype">int</span> k2=k%N-N/2;                     <span class="comment">/* k1: row, k2: column          */</span>
00306 
00307     <span class="keywordtype">int</span> r,a,b;
00308 
00309     a=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J/2+1);
00310 
00311     <span class="keywordflow">if</span> ( (k1&gt;=-(a/2)) &amp;&amp; (k1&lt;a/2) &amp;&amp; (k2&gt;=(-a/2)) &amp;&amp; (k2&lt;a/2) )
00312       {
00313   <span class="keywordflow">return</span>(4*((J+1)/2+1)*N_B+(k1+a/2)*a+(k2+a/2));
00314       }
00315 
00316     <span class="keywordflow">for</span> (r=0; r&lt;=(J+1)/2; r++)
00317       {
00318   b=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(r);
00319   a=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-r);
00320   <span class="keywordflow">if</span> ( (k1&gt;=-(b/2)) &amp;&amp; (k1&lt;(b+1)/2) &amp;&amp; (k2&gt;=a) &amp;&amp; (k2&lt;2*a) )
00321     {
00322             <span class="keywordflow">if</span> (a&gt;=b)
00323         return((4*r+0)*N_B+(k1+b/2)*a+(k2-a));
00324       else 
00325         return((4*r+0)*N_B+(k2-a)*b+(k1+b/2));
00326     }
00327   else if ( (k1&gt;=a) &amp;&amp; (k1&lt;2*a) &amp;&amp; (k2&gt;=-(b/2)) &amp;&amp; (k2&lt;(b+1)/2) )
00328     {
00329             <span class="keywordflow">if</span> (a&gt;b)
00330         return((4*r+1)*N_B+(k2+b/2)*a+(k1-a));
00331       else 
00332         return((4*r+1)*N_B+(k1-a)*b+(k2+b/2));
00333     }
00334   else if ( (k1&gt;=-(b/2)) &amp;&amp; (k1&lt;(b+1)/2) &amp;&amp; (k2&gt;=-2*a) &amp;&amp; (k2&lt;-a) )
00335     {
00336             <span class="keywordflow">if</span> (a&gt;=b)
00337         return((4*r+2)*N_B+(k1+b/2)*a+(k2+2*a));
00338       else 
00339         return((4*r+2)*N_B+(k2+2*a)*b+(k1+b/2));
00340     }
00341   else if ( (k1&gt;=-2*a) &amp;&amp; (k1&lt;-a) &amp;&amp; (k2&gt;=-(b/2)) &amp;&amp; (k2&lt;(b+1)/2) )
00342     {
00343             <span class="keywordflow">if</span> (a&gt;b)
00344         return((4*r+3)*N_B+(k2+b/2)*a+(k1+2*a));
00345       else 
00346         return((4*r+3)*N_B+(k1+2*a)*b+(k2+b/2));
00347     }
00348       }
00349     
00350     return(-1);
00351 }
00352 
00353 <span class="keywordtype">void</span> init_index_sparse_to_full_2d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths)
00354 {
00355   <span class="keywordtype">int</span> k_S;
00356 
00357   <span class="keywordflow">for</span> (k_S=0; k_S&lt;ths-&gt;N_total; k_S++)
00358     ths-&gt;index_sparse_to_full[k_S]=index_sparse_to_full_direct_2d(ths-&gt;J, k_S);
00359 }
00360 
00361 inline <span class="keywordtype">int</span> index_sparse_to_full_3d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths, <span class="keywordtype">int</span> k)
00362 {
00363   <span class="comment">/* only by lookup table */</span>
00364   <span class="keywordflow">if</span>( k &lt; ths-&gt;N_total)
00365     <span class="keywordflow">return</span> ths-&gt;index_sparse_to_full[k];
00366   <span class="keywordflow">else</span>
00367     <span class="keywordflow">return</span> -1;
00368 }
00369 
00370 <span class="keywordtype">int</span> index_full_to_sparse_3d(<span class="keywordtype">int</span> J, <span class="keywordtype">int</span> k)
00371 {
00372   <span class="keywordtype">int</span> N=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J+2);                 <span class="comment">/* length of the full grid           */</span>
00373   <span class="keywordtype">int</span> N_B_r;                            <span class="comment">/* size of a sparse block in level r */</span>
00374   <span class="keywordtype">int</span> sum_N_B_less_r;                   <span class="comment">/* sum N_B_r                         */</span>
00375 
00376   <span class="keywordtype">int</span> r,a,b;
00377 
00378   <span class="keywordtype">int</span> k3=(k%N)-N/2;                     <span class="comment">/* coordinates in the full grid      */</span>
00379   <span class="keywordtype">int</span> k2=((k/N)%N)-N/2;
00380   <span class="keywordtype">int</span> k1=k/(N*N)-N/2;
00381     
00382   a=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J/2+1);                   <span class="comment">/* length of center block            */</span>
00383 
00384   <span class="keywordflow">if</span>((k1&gt;=-(a/2)) &amp;&amp; (k1&lt;a/2) &amp;&amp; (k2&gt;=(-a/2)) &amp;&amp; (k2&lt;a/2) &amp;&amp; (k3&gt;=(-a/2)) &amp;&amp;
00385      (k3&lt;a/2))  
00386     {
00387       <span class="keywordflow">return</span>(6*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J)*(<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>((J+1)/2+1)-1)+((k1+a/2)*a+(k2+a/2))*a+
00388              (k3+a/2));
00389     }
00390 
00391   sum_N_B_less_r=0;
00392   <span class="keywordflow">for</span> (r=0; r&lt;=(J+1)/2; r++)
00393     {
00394       a=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-r);
00395       b=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(r);
00396 
00397       N_B_r=a*b*b;
00398 
00399       <span class="comment">/* right - rear - top - left - front - bottom */</span>
00400       <span class="keywordflow">if</span> ((k1&gt;=a) &amp;&amp; (k1&lt;2*a) &amp;&amp; (k2&gt;=-(b/2)) &amp;&amp; (k2&lt;(b+1)/2) &amp;&amp;
00401           (k3&gt;=-(b/2)) &amp;&amp; (k3&lt;(b+1)/2)) <span class="comment">/* right */</span>
00402   {
00403     <span class="keywordflow">if</span>(a&gt;b)
00404       <span class="keywordflow">return</span> sum_N_B_less_r+N_B_r*0 + ((k2+b/2)*b+k3+b/2)*a + (k1-a);
00405     <span class="keywordflow">else</span>
00406       <span class="keywordflow">return</span> sum_N_B_less_r+N_B_r*0 + ((k1-a)*b+(k2+b/2))*b + (k3+b/2);
00407   }
00408       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((k2&gt;=a) &amp;&amp; (k2&lt;2*a) &amp;&amp; (k1&gt;=-(b/2)) &amp;&amp; (k1&lt;(b+1)/2) &amp;&amp;
00409                (k3&gt;=-(b/2)) &amp;&amp; (k3&lt;(b+1)/2)) <span class="comment">/* rear */</span>
00410   {
00411     <span class="keywordflow">if</span>(a&gt;b)
00412       <span class="keywordflow">return</span> sum_N_B_less_r+N_B_r*1 + ((k1+b/2)*b+k3+b/2)*a + (k2-a);
00413     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a==b)
00414       return sum_N_B_less_r+N_B_r*1 + ((k1+b/2)*b+(k2-a))*a + (k3+b/2);
00415     else
00416       return sum_N_B_less_r+N_B_r*1 + ((k2-a)*b+(k1+b/2))*b + (k3+b/2);
00417   }
00418        else if ((k3&gt;=a) &amp;&amp; (k3&lt;2*a) &amp;&amp; (k1&gt;=-(b/2)) &amp;&amp; (k1&lt;(b+1)/2) &amp;&amp;
00419                 (k2&gt;=-(b/2)) &amp;&amp; (k2&lt;(b+1)/2)) <span class="comment">/* top */</span>
00420   {
00421     <span class="keywordflow">if</span>(a&gt;=b)
00422       <span class="keywordflow">return</span> sum_N_B_less_r+N_B_r*2 + ((k1+b/2)*b+k2+b/2)*a + (k3-a);
00423     <span class="keywordflow">else</span>
00424       <span class="keywordflow">return</span> sum_N_B_less_r+N_B_r*2 + ((k3-a)*b+(k1+b/2))*b + (k2+b/2);
00425   }
00426 
00427       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((k1&gt;=-2*a) &amp;&amp; (k1&lt;-a) &amp;&amp; (k2&gt;=-(b/2)) &amp;&amp; (k2&lt;(b+1)/2) &amp;&amp;
00428                (k3&gt;=-(b/2)) &amp;&amp; (k3&lt;(b+1)/2)) <span class="comment">/* left */</span>
00429   {
00430     <span class="keywordflow">if</span>(a&gt;b)
00431       <span class="keywordflow">return</span> sum_N_B_less_r+N_B_r*3 + ((k2+b/2)*b+k3+b/2)*a + (k1+2*a);
00432     <span class="keywordflow">else</span>
00433       <span class="keywordflow">return</span> sum_N_B_less_r+N_B_r*3 + ((k1+2*a)*b+(k2+b/2))*b + (k3+b/2);
00434   }
00435       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((k2&gt;=-2*a) &amp;&amp; (k2&lt;-a) &amp;&amp; (k1&gt;=-(b/2)) &amp;&amp; (k1&lt;(b+1)/2) &amp;&amp;
00436                (k3&gt;=-(b/2)) &amp;&amp; (k3&lt;(b+1)/2)) <span class="comment">/* front */</span>
00437   {
00438     <span class="keywordflow">if</span>(a&gt;b)
00439       <span class="keywordflow">return</span> sum_N_B_less_r+N_B_r*4 + ((k1+b/2)*b+k3+b/2)*a + (k2+2*a);
00440     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a==b)
00441       return sum_N_B_less_r+N_B_r*4 + ((k1+b/2)*b+(k2+2*a))*a + (k3+b/2);
00442     else
00443       return sum_N_B_less_r+N_B_r*4 + ((k2+2*a)*b+(k1+b/2))*b + (k3+b/2);
00444   }
00445        else if ((k3&gt;=-2*a) &amp;&amp; (k3&lt;-a) &amp;&amp; (k1&gt;=-(b/2)) &amp;&amp; (k1&lt;(b+1)/2) &amp;&amp;
00446                 (k2&gt;=-(b/2)) &amp;&amp; (k2&lt;(b+1)/2)) <span class="comment">/* bottom */</span>
00447   {
00448     <span class="keywordflow">if</span>(a&gt;=b)
00449       <span class="keywordflow">return</span> sum_N_B_less_r+N_B_r*5 + ((k1+b/2)*b+k2+b/2)*a + (k3+2*a);
00450     <span class="keywordflow">else</span>
00451       <span class="keywordflow">return</span> sum_N_B_less_r+N_B_r*5 + ((k3+2*a)*b+(k1+b/2))*b + (k2+b/2);
00452   }
00453 
00454       sum_N_B_less_r+=6*N_B_r;
00455     } <span class="comment">/* for(r) */</span>
00456   
00457   <span class="keywordflow">return</span>(-1);
00458 }
00459 
00460 <span class="keywordtype">void</span> init_index_sparse_to_full_3d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths)
00461 {
00462   <span class="keywordtype">int</span> k1,k2,k3,k_s,r;
00463   <span class="keywordtype">int</span> a,b;
00464   <span class="keywordtype">int</span> N=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(ths-&gt;J+2);            <span class="comment">/* length of the full grid           */</span>
00465   <span class="keywordtype">int</span> Nc=ths-&gt;center_nfft_plan-&gt;N[0];   <span class="comment">/* length of the center block        */</span>
00466 
00467   <span class="keywordflow">for</span> (k_s=0, r=0; r&lt;=(ths-&gt;J+1)/2; r++)
00468     {
00469       a=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(ths-&gt;J-r);
00470       b=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(r);
00471 
00472       <span class="comment">/* right - rear - top - left - front - bottom */</span>
00473 
00474       <span class="comment">/* right */</span>
00475       <span class="keywordflow">if</span>(a&gt;b)
00476   <span class="keywordflow">for</span>(k2=-b/2;k2&lt;(b+1)/2;k2++)
00477     <span class="keywordflow">for</span>(k3=-b/2;k3&lt;(b+1)/2;k3++)
00478       <span class="keywordflow">for</span>(k1=a; k1&lt;2*a; k1++,k_s++)
00479         ths-&gt;index_sparse_to_full[k_s]=((k1+N/2)*N+k2+N/2)*N+k3+N/2;
00480       <span class="keywordflow">else</span>
00481   <span class="keywordflow">for</span>(k1=a; k1&lt;2*a; k1++)
00482     <span class="keywordflow">for</span>(k2=-b/2;k2&lt;(b+1)/2;k2++)
00483       <span class="keywordflow">for</span>(k3=-b/2;k3&lt;(b+1)/2;k3++,k_s++)
00484         ths-&gt;index_sparse_to_full[k_s]=((k1+N/2)*N+k2+N/2)*N+k3+N/2;
00485   
00486       <span class="comment">/* rear */</span>
00487       <span class="keywordflow">if</span>(a&gt;b)
00488   <span class="keywordflow">for</span>(k1=-b/2;k1&lt;(b+1)/2;k1++)
00489     <span class="keywordflow">for</span>(k3=-b/2;k3&lt;(b+1)/2;k3++)
00490       <span class="keywordflow">for</span>(k2=a; k2&lt;2*a; k2++,k_s++)
00491         ths-&gt;index_sparse_to_full[k_s]=((k1+N/2)*N+k2+N/2)*N+k3+N/2;
00492       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(a==b)
00493   <span class="keywordflow">for</span>(k1=-b/2;k1&lt;(b+1)/2;k1++)
00494     <span class="keywordflow">for</span>(k2=a; k2&lt;2*a; k2++)
00495       <span class="keywordflow">for</span>(k3=-b/2;k3&lt;(b+1)/2;k3++,k_s++)
00496         ths-&gt;index_sparse_to_full[k_s]=((k1+N/2)*N+k2+N/2)*N+k3+N/2;
00497       <span class="keywordflow">else</span>
00498   <span class="keywordflow">for</span>(k2=a; k2&lt;2*a; k2++)
00499     <span class="keywordflow">for</span>(k1=-b/2;k1&lt;(b+1)/2;k1++)
00500       <span class="keywordflow">for</span>(k3=-b/2;k3&lt;(b+1)/2;k3++,k_s++)
00501         ths-&gt;index_sparse_to_full[k_s]=((k1+N/2)*N+k2+N/2)*N+k3+N/2;
00502       
00503       <span class="comment">/* top */</span>
00504       <span class="keywordflow">if</span>(a&gt;=b)
00505   <span class="keywordflow">for</span>(k1=-b/2;k1&lt;(b+1)/2;k1++)
00506     <span class="keywordflow">for</span>(k2=-b/2;k2&lt;(b+1)/2;k2++)
00507       <span class="keywordflow">for</span>(k3=a; k3&lt;2*a; k3++,k_s++)
00508         ths-&gt;index_sparse_to_full[k_s]=((k1+N/2)*N+k2+N/2)*N+k3+N/2;
00509       <span class="keywordflow">else</span>
00510   <span class="keywordflow">for</span>(k3=a; k3&lt;2*a; k3++)
00511     <span class="keywordflow">for</span>(k1=-b/2;k1&lt;(b+1)/2;k1++)
00512       <span class="keywordflow">for</span>(k2=-b/2;k2&lt;(b+1)/2;k2++,k_s++)
00513         ths-&gt;index_sparse_to_full[k_s]=((k1+N/2)*N+k2+N/2)*N+k3+N/2;
00514   
00515       <span class="comment">/* left */</span>
00516       <span class="keywordflow">if</span>(a&gt;b)
00517   <span class="keywordflow">for</span>(k2=-b/2;k2&lt;(b+1)/2;k2++)
00518     <span class="keywordflow">for</span>(k3=-b/2;k3&lt;(b+1)/2;k3++)
00519       <span class="keywordflow">for</span>(k1=-2*a; k1&lt;-a; k1++,k_s++)
00520         ths-&gt;index_sparse_to_full[k_s]=((k1+N/2)*N+k2+N/2)*N+k3+N/2;
00521       <span class="keywordflow">else</span>
00522   <span class="keywordflow">for</span>(k1=-2*a; k1&lt;-a; k1++)
00523     <span class="keywordflow">for</span>(k2=-b/2;k2&lt;(b+1)/2;k2++)
00524       <span class="keywordflow">for</span>(k3=-b/2;k3&lt;(b+1)/2;k3++,k_s++)
00525         ths-&gt;index_sparse_to_full[k_s]=((k1+N/2)*N+k2+N/2)*N+k3+N/2;
00526   
00527       <span class="comment">/* front */</span>
00528       <span class="keywordflow">if</span>(a&gt;b)
00529   <span class="keywordflow">for</span>(k1=-b/2;k1&lt;(b+1)/2;k1++)
00530     <span class="keywordflow">for</span>(k3=-b/2;k3&lt;(b+1)/2;k3++)
00531       <span class="keywordflow">for</span>(k2=-2*a; k2&lt;-a; k2++,k_s++)
00532         ths-&gt;index_sparse_to_full[k_s]=((k1+N/2)*N+k2+N/2)*N+k3+N/2;
00533       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(a==b)
00534   <span class="keywordflow">for</span>(k1=-b/2;k1&lt;(b+1)/2;k1++)
00535     <span class="keywordflow">for</span>(k2=-2*a; k2&lt;-a; k2++)
00536       <span class="keywordflow">for</span>(k3=-b/2;k3&lt;(b+1)/2;k3++,k_s++)
00537         ths-&gt;index_sparse_to_full[k_s]=((k1+N/2)*N+k2+N/2)*N+k3+N/2;
00538       <span class="keywordflow">else</span>
00539   <span class="keywordflow">for</span>(k2=-2*a; k2&lt;-a; k2++)
00540     <span class="keywordflow">for</span>(k1=-b/2;k1&lt;(b+1)/2;k1++)
00541       <span class="keywordflow">for</span>(k3=-b/2;k3&lt;(b+1)/2;k3++,k_s++)
00542         ths-&gt;index_sparse_to_full[k_s]=((k1+N/2)*N+k2+N/2)*N+k3+N/2;
00543       
00544       <span class="comment">/* top */</span>
00545       <span class="keywordflow">if</span>(a&gt;=b)
00546   <span class="keywordflow">for</span>(k1=-b/2;k1&lt;(b+1)/2;k1++)
00547     <span class="keywordflow">for</span>(k2=-b/2;k2&lt;(b+1)/2;k2++)
00548       <span class="keywordflow">for</span>(k3=-2*a; k3&lt;-a; k3++,k_s++)
00549         ths-&gt;index_sparse_to_full[k_s]=((k1+N/2)*N+k2+N/2)*N+k3+N/2;
00550       <span class="keywordflow">else</span>
00551   <span class="keywordflow">for</span>(k3=-2*a; k3&lt;-a; k3++)
00552     <span class="keywordflow">for</span>(k1=-b/2;k1&lt;(b+1)/2;k1++)
00553       <span class="keywordflow">for</span>(k2=-b/2;k2&lt;(b+1)/2;k2++,k_s++)
00554         ths-&gt;index_sparse_to_full[k_s]=((k1+N/2)*N+k2+N/2)*N+k3+N/2;
00555     }
00556 
00557   <span class="comment">/* center */</span>
00558   <span class="keywordflow">for</span>(k1=-Nc/2;k1&lt;Nc/2;k1++)
00559     <span class="keywordflow">for</span>(k2=-Nc/2;k2&lt;Nc/2;k2++)
00560       <span class="keywordflow">for</span>(k3=-Nc/2; k3&lt;Nc/2; k3++,k_s++)
00561   ths-&gt;index_sparse_to_full[k_s]=((k1+N/2)*N+k2+N/2)*N+k3+N/2;
00562 }
00563 
00564 <span class="comment">/* copies ths-&gt;f_hat to ths_plan-&gt;f_hat */</span>
<a name="l00565"></a><a class="code" href="group__nsfft.html#ga4">00565</a> <span class="keywordtype">void</span> <a class="code" href="group__nsfft.html#ga4">nsfft_cp</a>(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths, <a class="code" href="structnfft__plan.html">nfft_plan</a> *ths_full_plan)
00566 {
00567   <span class="keywordtype">int</span> k; 
00568 
00569   <span class="comment">/* initialize f_hat with zero values */</span>
00570   memset(ths_full_plan-&gt;f_hat, 0, ths_full_plan-&gt;N_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00571   
00572    <span class="comment">/* copy values at hyperbolic grid points */</span>
00573   <span class="keywordflow">for</span>(k=0;k&lt;ths-&gt;N_total;k++)
00574     ths_full_plan-&gt;f_hat[ths-&gt;index_sparse_to_full[k]]=ths-&gt;f_hat[k];
00575   
00576   <span class="comment">/* copy nodes */</span>
00577   memcpy(ths_full_plan-&gt;x,ths-&gt;act_nfft_plan-&gt;x,ths-&gt;M_total*ths-&gt;d*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00578 }
00579 
00580 <span class="comment">/* test copy_sparse_to_full */</span>
00581 <span class="keywordtype">void</span> test_copy_sparse_to_full_2d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths, <a class="code" href="structnfft__plan.html">nfft_plan</a> *ths_full_plan)
00582 {
00583   <span class="keywordtype">int</span> r;
00584   <span class="keywordtype">int</span> k1, k2;
00585   <span class="keywordtype">int</span> a,b;
00586   <span class="keyword">const</span> <span class="keywordtype">int</span> J=ths-&gt;J;   <span class="comment">/* N=2^J                  */</span>
00587   <span class="keyword">const</span> <span class="keywordtype">int</span> N=ths_full_plan-&gt;N[0];  <span class="comment">/* size of full NFFT      */</span>
00588   <span class="keyword">const</span> <span class="keywordtype">int</span> N_B=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J);        <span class="comment">/* size of small blocks   */</span>
00589 
00590   <span class="comment">/* copy sparse plan to full plan */</span>
00591   <a class="code" href="group__nsfft.html#ga4">nsfft_cp</a>(ths, ths_full_plan);
00592 
00593   <span class="comment">/* show blockwise f_hat */</span>
00594   printf(<span class="stringliteral">"f_hat blockwise\n"</span>);
00595   <span class="keywordflow">for</span> (r=0; r&lt;=(J+1)/2; r++){
00596     a=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-r); b=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(r);
00597 
00598     printf(<span class="stringliteral">"top\n"</span>);
00599     <span class="keywordflow">for</span> (k1=0; k1&lt;a; k1++){
00600       <span class="keywordflow">for</span> (k2=0; k2&lt;b; k2++){
00601         printf(<span class="stringliteral">"(%1.1f,%1.1f) "</span>, creal(ths-&gt;f_hat[(4*r+1)*N_B+ k1*b+k2]),
00602                            cimag(ths-&gt;f_hat[(4*r+1)*N_B+ k1*b+k2]));
00603       }
00604       printf(<span class="stringliteral">"\n"</span>);
00605     }
00606 
00607     printf(<span class="stringliteral">"bottom\n"</span>);
00608     <span class="keywordflow">for</span> (k1=0; k1&lt;a; k1++){
00609       <span class="keywordflow">for</span> (k2=0; k2&lt;b; k2++){
00610         printf(<span class="stringliteral">"(%1.1f,%1.1f) "</span>, creal(ths-&gt;f_hat[(4*r+3)*N_B+ k1*b+k2]),
00611                                  cimag(ths-&gt;f_hat[(4*r+3)*N_B+ k1*b+k2]));
00612       }
00613       printf(<span class="stringliteral">"\n"</span>);
00614     }
00615 
00616     printf(<span class="stringliteral">"right\n"</span>);
00617     <span class="keywordflow">for</span> (k2=0; k2&lt;b; k2++){
00618       <span class="keywordflow">for</span> (k1=0; k1&lt;a; k1++){
00619         printf(<span class="stringliteral">"(%1.1f,%1.1f) "</span>, creal(ths-&gt;f_hat[(4*r+0)*N_B+ k2*a+k1]),
00620                                  cimag(ths-&gt;f_hat[(4*r+0)*N_B+ k2*a+k1]));
00621       }
00622       printf(<span class="stringliteral">"\n"</span>);
00623     }
00624 
00625     printf(<span class="stringliteral">"left\n"</span>);
00626     <span class="keywordflow">for</span> (k2=0; k2&lt;b; k2++){
00627       <span class="keywordflow">for</span> (k1=0; k1&lt;a; k1++){
00628         printf(<span class="stringliteral">"(%1.1f,%1.1f) "</span>, creal(ths-&gt;f_hat[(4*r+2)*N_B+ k2*a+k1]),
00629                            cimag(ths-&gt;f_hat[(4*r+2)*N_B+ k2*a+k1]));
00630       }
00631       printf(<span class="stringliteral">"\n"</span>);
00632     }
00633   }
00634 
00635   <span class="keywordflow">return</span>;
00636   <span class="comment">/* show full f_hat */</span>
00637   printf(<span class="stringliteral">"full f_hat\n"</span>);
00638   <span class="keywordflow">for</span> (k1=0;k1&lt;N;k1++){
00639     <span class="keywordflow">for</span> (k2=0;k2&lt;N;k2++){
00640       printf(<span class="stringliteral">"(%1.1f,%1.1f) "</span>, creal(ths_full_plan-&gt;f_hat[k1*N+k2]),
00641                                cimag(ths_full_plan-&gt;f_hat[k1*N+k2]));
00642     }
00643     printf(<span class="stringliteral">"\n"</span>);
00644   }
00645 }
00646 
00647 <span class="keywordtype">void</span> test_sparse_to_full_2d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a>* ths)
00648 {
00649   <span class="keywordtype">int</span> k_S,k1,k2;
00650   <span class="keywordtype">int</span> N=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(ths-&gt;J+2);
00651 
00652   printf(<span class="stringliteral">"N=%d\n\n"</span>,N);
00653 
00654   <span class="keywordflow">for</span>(k1=0;k1&lt;N;k1++)
00655     <span class="keywordflow">for</span>(k2=0;k2&lt;N;k2++)
00656       {
00657         k_S=index_full_to_sparse_2d(ths-&gt;J, k1*N+k2);
00658   <span class="keywordflow">if</span>(k_S!=-1)
00659     printf(<span class="stringliteral">"(%+d, %+d)\t= %+d \t= %+d = %+d \n"</span>,k1-N/2,k2-N/2,
00660                  k1*N+k2, k_S, ths-&gt;index_sparse_to_full[k_S]);
00661       }
00662 }
00663 
00664 <span class="keywordtype">void</span> test_sparse_to_full_3d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a>* ths)
00665 {
00666   <span class="keywordtype">int</span> k_S,k1,k2,k3;
00667   <span class="keywordtype">int</span> N=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(ths-&gt;J+2);
00668 
00669   printf(<span class="stringliteral">"N=%d\n\n"</span>,N);
00670 
00671   <span class="keywordflow">for</span>(k1=0;k1&lt;N;k1++)
00672     <span class="keywordflow">for</span>(k2=0;k2&lt;N;k2++)
00673         <span class="keywordflow">for</span>(k3=0;k3&lt;N;k3++)
00674     {
00675       k_S=index_full_to_sparse_3d(ths-&gt;J, (k1*N+k2)*N+k3);
00676       <span class="keywordflow">if</span>(k_S!=-1)
00677         printf(<span class="stringliteral">"(%d, %d, %d)\t= %d \t= %d = %d \n"</span>,k1-N/2,k2-N/2,k3-N/2,
00678                      (k1*N+k2)*N+k3,k_S, ths-&gt;index_sparse_to_full[k_S]);
00679     }
00680 }
00681 
00682 
<a name="l00683"></a><a class="code" href="group__nsfft.html#ga5">00683</a> <span class="keywordtype">void</span> <a class="code" href="group__nsfft.html#ga5">nsfft_init_random_nodes_coeffs</a>(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths)
00684 {
00685   <span class="keywordtype">int</span> j;
00686 
00687   <span class="comment">/* init frequencies */</span>
00688   <a class="code" href="group__nfftutil.html#ga46">nfft_vrand_unit_complex</a>(ths-&gt;f_hat, ths-&gt;N_total);
00689 
00690   <span class="comment">/* init nodes */</span>
00691   <a class="code" href="group__nfftutil.html#ga47">nfft_vrand_shifted_unit_double</a>(ths-&gt;act_nfft_plan-&gt;x, ths-&gt;d * ths-&gt;M_total);
00692 
00693   <span class="keywordflow">if</span>(ths-&gt;d==2)
00694     <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++) 
00695       {
00696         ths-&gt;x_transposed[2*j+0]=ths-&gt;act_nfft_plan-&gt;x[2*j+1];
00697         ths-&gt;x_transposed[2*j+1]=ths-&gt;act_nfft_plan-&gt;x[2*j+0];
00698       }
00699   <span class="keywordflow">else</span> <span class="comment">/* this-&gt;d==3 */</span>
00700     <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++) 
00701       {
00702         ths-&gt;x_102[3*j+0]=ths-&gt;act_nfft_plan-&gt;x[3*j+1];
00703         ths-&gt;x_102[3*j+1]=ths-&gt;act_nfft_plan-&gt;x[3*j+0]; 
00704         ths-&gt;x_102[3*j+2]=ths-&gt;act_nfft_plan-&gt;x[3*j+2];
00705 
00706         ths-&gt;x_201[3*j+0]=ths-&gt;act_nfft_plan-&gt;x[3*j+2];
00707         ths-&gt;x_201[3*j+1]=ths-&gt;act_nfft_plan-&gt;x[3*j+0]; 
00708         ths-&gt;x_201[3*j+2]=ths-&gt;act_nfft_plan-&gt;x[3*j+1];
00709 
00710         ths-&gt;x_120[3*j+0]=ths-&gt;act_nfft_plan-&gt;x[3*j+1];
00711         ths-&gt;x_120[3*j+1]=ths-&gt;act_nfft_plan-&gt;x[3*j+2]; 
00712         ths-&gt;x_120[3*j+2]=ths-&gt;act_nfft_plan-&gt;x[3*j+0];
00713 
00714         ths-&gt;x_021[3*j+0]=ths-&gt;act_nfft_plan-&gt;x[3*j+0];
00715         ths-&gt;x_021[3*j+1]=ths-&gt;act_nfft_plan-&gt;x[3*j+2]; 
00716         ths-&gt;x_021[3*j+2]=ths-&gt;act_nfft_plan-&gt;x[3*j+1];
00717       }
00718 }
00719 
00720 <span class="keywordtype">void</span> nsdft_trafo_2d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths)
00721 {
00722   <span class="keywordtype">int</span> j,k_S,k_L,k0,k1;
00723   <span class="keywordtype">double</span> omega;
00724   <span class="keywordtype">int</span> N=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(ths-&gt;J+2);
00725 
00726   memset(ths-&gt;f,0,ths-&gt;M_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00727 
00728   <span class="keywordflow">for</span>(k_S=0;k_S&lt;ths-&gt;N_total;k_S++)
00729     {
00730       k_L=ths-&gt;index_sparse_to_full[k_S];
00731       k0=k_L / N;
00732       k1=k_L % N;
00733       
00734       <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++)
00735   {
00736     omega =
00737       ((double)(k0 - N/2)) * ths-&gt;act_nfft_plan-&gt;x[2 * j + 0] + 
00738       ((double)(k1 - N/2)) * ths-&gt;act_nfft_plan-&gt;x[2 * j + 1];
00739           ths-&gt;f[j] += ths-&gt;f_hat[k_S] * cexp( - I*2*PI*omega);
00740   }
00741     }
00742 } <span class="comment">/* void nsdft_trafo_2d */</span>
00743 
00744 <span class="keywordtype">void</span> nsdft_trafo_3d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths)
00745 {
00746   <span class="keywordtype">int</span> j,k_S,k0,k1,k2;
00747   <span class="keywordtype">double</span> omega;
00748   <span class="keywordtype">int</span> N=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(ths-&gt;J+2);
00749   <span class="keywordtype">int</span> k_L;
00750 
00751   memset(ths-&gt;f,0,ths-&gt;M_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00752 
00753   <span class="keywordflow">for</span>(k_S=0;k_S&lt;ths-&gt;N_total;k_S++)
00754     {
00755       k_L=ths-&gt;index_sparse_to_full[k_S];
00756 
00757       k0=k_L/(N*N);
00758       k1=(k_L/N)%N;
00759       k2=k_L%N;
00760       
00761       <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++)
00762   {
00763     omega =
00764       ((double)(k0 - N/2)) * ths-&gt;act_nfft_plan-&gt;x[3 * j + 0] + 
00765       ((double)(k1 - N/2)) * ths-&gt;act_nfft_plan-&gt;x[3 * j + 1] +
00766       ((double)(k2 - N/2)) * ths-&gt;act_nfft_plan-&gt;x[3 * j + 2];
00767           ths-&gt;f[j] += ths-&gt;f_hat[k_S] * cexp( - I*2*PI*omega);
00768   }
00769     }
00770 } <span class="comment">/* void nsdft_trafo_3d */</span>
00771 
<a name="l00772"></a><a class="code" href="group__nsfft.html#ga0">00772</a> <span class="keywordtype">void</span> <a class="code" href="group__nsfft.html#ga0">nsdft_trafo</a>(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths)
00773 {
00774   <span class="keywordflow">if</span>(ths-&gt;d==2)
00775     nsdft_trafo_2d(ths);
00776   <span class="keywordflow">else</span>
00777     nsdft_trafo_3d(ths);
00778 }
00779 
00780 <span class="keywordtype">void</span> nsdft_adjoint_2d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths)
00781 {
00782   <span class="keywordtype">int</span> j,k_S,k_L,k0,k1;
00783   <span class="keywordtype">double</span> omega;
00784   <span class="keywordtype">int</span> N=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(ths-&gt;J+2);
00785 
00786   memset(ths-&gt;f_hat,0,ths-&gt;N_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00787 
00788   <span class="keywordflow">for</span>(k_S=0;k_S&lt;ths-&gt;N_total;k_S++)
00789     {
00790       k_L=ths-&gt;index_sparse_to_full[k_S];
00791       k0=k_L / N;
00792       k1=k_L % N;
00793       
00794       <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++)
00795   {
00796     omega =
00797       ((double)(k0 - N/2)) * ths-&gt;act_nfft_plan-&gt;x[2 * j + 0] + 
00798       ((double)(k1 - N/2)) * ths-&gt;act_nfft_plan-&gt;x[2 * j + 1];
00799           ths-&gt;f_hat[k_S] += ths-&gt;f[j] * cexp( + I*2*PI*omega);
00800   }
00801     }
00802 } <span class="comment">/* void nsdft_adjoint_2d */</span>
00803 
00804 <span class="keywordtype">void</span> nsdft_adjoint_3d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths)
00805 {
00806   <span class="keywordtype">int</span> j,k_S,k0,k1,k2;
00807   <span class="keywordtype">double</span> omega;
00808   <span class="keywordtype">int</span> N=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(ths-&gt;J+2);
00809   <span class="keywordtype">int</span> k_L;
00810 
00811   memset(ths-&gt;f_hat,0,ths-&gt;N_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00812 
00813   <span class="keywordflow">for</span>(k_S=0;k_S&lt;ths-&gt;N_total;k_S++)
00814     {
00815       k_L=ths-&gt;index_sparse_to_full[k_S];
00816 
00817       k0=k_L/(N*N);
00818       k1=(k_L/N)%N;
00819       k2=k_L%N;
00820       
00821       <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++)
00822   {
00823     omega =
00824       ((double)(k0 - N/2)) * ths-&gt;act_nfft_plan-&gt;x[3 * j + 0] + 
00825       ((double)(k1 - N/2)) * ths-&gt;act_nfft_plan-&gt;x[3 * j + 1] +
00826       ((double)(k2 - N/2)) * ths-&gt;act_nfft_plan-&gt;x[3 * j + 2];
00827           ths-&gt;f_hat[k_S] += ths-&gt;f[j] * cexp( + I*2*PI*omega);
00828   }
00829     }
00830 } <span class="comment">/* void nsdft_adjoint_3d */</span>
00831 
<a name="l00832"></a><a class="code" href="group__nsfft.html#ga1">00832</a> <span class="keywordtype">void</span> <a class="code" href="group__nsfft.html#ga1">nsdft_adjoint</a>(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths)
00833 {
00834   <span class="keywordflow">if</span>(ths-&gt;d==2)
00835     nsdft_adjoint_2d(ths);
00836   <span class="keywordflow">else</span>
00837     nsdft_adjoint_3d(ths);
00838 }
00839 
00840 <span class="keywordtype">void</span> nsfft_trafo_2d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths)
00841 {
00842   <span class="keywordtype">int</span> r,rr,j;
00843   <span class="keywordtype">double</span> temp;
00844 
00845   <span class="keywordtype">int</span> M=ths-&gt;M_total;
00846   <span class="keywordtype">int</span> J=ths-&gt;J;
00847 
00848   <span class="comment">/* center */</span>
00849   ths-&gt;center_nfft_plan-&gt;f_hat=ths-&gt;f_hat+4*((J+1)/2+1)*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J);
00850   
00851   <span class="keywordflow">if</span> (ths-&gt;center_nfft_plan-&gt;N[0]&lt;=ths-&gt;center_nfft_plan-&gt;m) 
00852     ndft_trafo(ths-&gt;center_nfft_plan);
00853   else
00854     nfft_trafo(ths-&gt;center_nfft_plan);
00855 
00856   for (j=0; j&lt;M; j++) 
00857     ths-&gt;f[j] = ths-&gt;center_nfft_plan-&gt;f[j];
00858 
00859   for(rr=0;rr&lt;=(J+1)/2;rr++)
00860     {
00861       r=<a class="code" href="group__nfftutil.html#ga59">NFFT_MIN</a>(rr,J-rr);
00862       ths-&gt;act_nfft_plan-&gt;my_fftw_plan1 = ths-&gt;set_fftw_plan1[r];
00863       ths-&gt;act_nfft_plan-&gt;N[0]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(r); ths-&gt;act_nfft_plan-&gt;n[0]=ths-&gt;sigma*ths-&gt;act_nfft_plan-&gt;N[0];
00864       ths-&gt;act_nfft_plan-&gt;N[1]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-r); ths-&gt;act_nfft_plan-&gt;n[1]=ths-&gt;sigma*ths-&gt;act_nfft_plan-&gt;N[1];
00865 
00866       <span class="comment">/*printf("%d x %d\n",ths-&gt;act_nfft_plan-&gt;N[0],ths-&gt;act_nfft_plan-&gt;N[1]);*/</span>
00867 
00868       temp=-3.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-rr);
00869 
00870       <span class="comment">/* right */</span>      
00871       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat+(4*rr+0)*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J);
00872       
00873       <span class="keywordflow">if</span>(r&lt;rr)
00874   <a class="code" href="group__nfftutil.html#ga56">NFFT_SWAP_double</a>(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_transposed);
00875 
00876       <span class="keywordflow">if</span>(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
00877   <span class="keywordflow">if</span>(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
00878     <a class="code" href="group__nfft.html#ga0">ndft_trafo</a>(ths-&gt;act_nfft_plan);
00879   <span class="keywordflow">else</span>
00880     short_nfft_trafo_2d(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
00881       <span class="keywordflow">else</span>
00882   <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(ths-&gt;act_nfft_plan);
00883       
00884       <span class="keywordflow">if</span>(r&lt;rr)
00885   <a class="code" href="group__nfftutil.html#ga56">NFFT_SWAP_double</a>(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_transposed);
00886       
00887       <span class="keywordflow">for</span> (j=0; j&lt;M; j++)
00888         ths-&gt;f[j] +=  ths-&gt;act_nfft_plan-&gt;f[j] *
00889                       cexp( + I*temp*ths-&gt;act_nfft_plan-&gt;x[2*j+1]);
00890 
00891       <span class="comment">/* top */</span>
00892       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat+(4*rr+1)*nfft_int_2_pow(J);
00893       
00894       if((r==rr)&amp;&amp;(J-rr!=rr))
00895   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_transposed);
00896 
00897       if(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
00898   if(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
00899     ndft_trafo(ths-&gt;act_nfft_plan);
00900   else
00901     short_nfft_trafo_2d(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
00902       else
00903   nfft_trafo(ths-&gt;act_nfft_plan);
00904 
00905       if((r==rr)&amp;&amp;(J-rr!=rr))
00906   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_transposed);
00907 
00908       for (j=0; j&lt;M; j++)
00909         ths-&gt;f[j] += ths-&gt;act_nfft_plan-&gt;f[j] *
00910                      cexp( + I*temp*ths-&gt;act_nfft_plan-&gt;x[2*j+0]);
00911 
00912       <span class="comment">/* left */</span>
00913       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat+(4*rr+2)*nfft_int_2_pow(J);
00914       
00915       if(r&lt;rr)
00916   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_transposed);
00917 
00918       if(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
00919   if(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
00920     ndft_trafo(ths-&gt;act_nfft_plan);
00921   else
00922     short_nfft_trafo_2d(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
00923       else
00924   nfft_trafo(ths-&gt;act_nfft_plan);
00925 
00926       if(r&lt;rr)
00927   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_transposed);
00928 
00929       for (j=0; j&lt;M; j++)
00930         ths-&gt;f[j] += ths-&gt;act_nfft_plan-&gt;f[j] *
00931                      cexp( - I*temp*ths-&gt;act_nfft_plan-&gt;x[2*j+1]);
00932 
00933       <span class="comment">/* bottom */</span>
00934       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat+(4*rr+3)*nfft_int_2_pow(J);
00935       
00936       if((r==rr)&amp;&amp;(J-rr!=rr))
00937   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_transposed);
00938 
00939       if(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
00940   if(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
00941     ndft_trafo(ths-&gt;act_nfft_plan);
00942   else
00943     short_nfft_trafo_2d(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
00944       else
00945   nfft_trafo(ths-&gt;act_nfft_plan);
00946       
00947       if((r==rr)&amp;&amp;(J-rr!=rr))
00948   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_transposed);
00949 
00950       for (j=0; j&lt;M; j++)
00951         ths-&gt;f[j] += ths-&gt;act_nfft_plan-&gt;f[j] *
00952                      cexp( - I*temp*ths-&gt;act_nfft_plan-&gt;x[2*j+0]);
00953     } <span class="comment">/* for(rr) */</span>
00954 } <span class="comment">/* void nsfft_trafo_2d */</span>
00955 
00956 <span class="keywordtype">void</span> nsfft_adjoint_2d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths)
00957 {
00958   <span class="keywordtype">int</span> r,rr,j;
00959   <span class="keywordtype">double</span> temp;
00960 
00961   <span class="keywordtype">int</span> M=ths-&gt;M_total;
00962   <span class="keywordtype">int</span> J=ths-&gt;J;
00963 
00964   <span class="comment">/* center */</span>
00965   <span class="keywordflow">for</span> (j=0; j&lt;M; j++) 
00966     ths-&gt;center_nfft_plan-&gt;f[j] = ths-&gt;f[j];
00967 
00968   ths-&gt;center_nfft_plan-&gt;f_hat=ths-&gt;f_hat+4*((J+1)/2+1)*nfft_int_2_pow(J);
00969   
00970   if (ths-&gt;center_nfft_plan-&gt;N[0]&lt;=ths-&gt;center_nfft_plan-&gt;m) 
00971     ndft_adjoint(ths-&gt;center_nfft_plan);
00972   else
00973     nfft_adjoint(ths-&gt;center_nfft_plan);
00974 
00975   for(rr=0;rr&lt;=(J+1)/2;rr++)
00976     {
00977       r=<a class="code" href="group__nfftutil.html#ga59">NFFT_MIN</a>(rr,J-rr);
00978       ths-&gt;act_nfft_plan-&gt;my_fftw_plan2 = ths-&gt;set_fftw_plan2[r];
00979       ths-&gt;act_nfft_plan-&gt;N[0]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(r); ths-&gt;act_nfft_plan-&gt;n[0]=ths-&gt;sigma*ths-&gt;act_nfft_plan-&gt;N[0];
00980       ths-&gt;act_nfft_plan-&gt;N[1]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-r); ths-&gt;act_nfft_plan-&gt;n[1]=ths-&gt;sigma*ths-&gt;act_nfft_plan-&gt;N[1];
00981 
00982       <span class="comment">/*printf("%d x %d\n",ths-&gt;act_nfft_plan-&gt;N[0],ths-&gt;act_nfft_plan-&gt;N[1]);*/</span>
00983 
00984       temp=-3.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-rr);
00985 
00986       <span class="comment">/* right */</span>      
00987       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat+(4*rr+0)*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J);
00988       
00989       <span class="keywordflow">for</span> (j=0; j&lt;M; j++)
00990         ths-&gt;act_nfft_plan-&gt;f[j]= ths-&gt;f[j] * 
00991                                   cexp( - I*temp*ths-&gt;act_nfft_plan-&gt;x[2*j+1]);
00992 
00993       if(r&lt;rr)
00994   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_transposed);
00995 
00996       if(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
00997   if(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
00998     ndft_adjoint(ths-&gt;act_nfft_plan);
00999   else
01000     short_nfft_adjoint_2d(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
01001       else
01002   nfft_adjoint(ths-&gt;act_nfft_plan);
01003       
01004       if(r&lt;rr)
01005   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_transposed);
01006 
01007       <span class="comment">/* top */</span>
01008       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat+(4*rr+1)*nfft_int_2_pow(J);
01009 
01010       for (j=0; j&lt;M; j++)
01011         ths-&gt;act_nfft_plan-&gt;f[j]= ths-&gt;f[j] *
01012                                   cexp( - I*temp*ths-&gt;act_nfft_plan-&gt;x[2*j+0]);
01013       
01014       if((r==rr)&amp;&amp;(J-rr!=rr))
01015   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_transposed);
01016 
01017       if(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01018   if(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01019     ndft_adjoint(ths-&gt;act_nfft_plan);
01020   else
01021     short_nfft_adjoint_2d(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
01022       else
01023   nfft_adjoint(ths-&gt;act_nfft_plan);
01024 
01025       if((r==rr)&amp;&amp;(J-rr!=rr))
01026   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_transposed);
01027 
01028       <span class="comment">/* left */</span>
01029       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat+(4*rr+2)*nfft_int_2_pow(J);
01030 
01031       for (j=0; j&lt;M; j++)
01032         ths-&gt;act_nfft_plan-&gt;f[j]= ths-&gt;f[j] *
01033                                   cexp( + I*temp*ths-&gt;act_nfft_plan-&gt;x[2*j+1]);
01034       
01035       if(r&lt;rr)
01036   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_transposed);
01037 
01038       if(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01039   if(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01040     ndft_adjoint(ths-&gt;act_nfft_plan);
01041   else
01042     short_nfft_adjoint_2d(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
01043       else
01044   nfft_adjoint(ths-&gt;act_nfft_plan);
01045 
01046       if(r&lt;rr)
01047   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_transposed);
01048 
01049       <span class="comment">/* bottom */</span>
01050       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat+(4*rr+3)*nfft_int_2_pow(J);
01051       
01052       for (j=0; j&lt;M; j++)
01053         ths-&gt;act_nfft_plan-&gt;f[j]= ths-&gt;f[j] *
01054                                   cexp( + I*temp*ths-&gt;act_nfft_plan-&gt;x[2*j+0]);
01055 
01056       if((r==rr)&amp;&amp;(J-rr!=rr))
01057   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_transposed);
01058 
01059       if(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01060   if(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01061     ndft_adjoint(ths-&gt;act_nfft_plan);
01062   else
01063     short_nfft_adjoint_2d(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
01064       else
01065   nfft_adjoint(ths-&gt;act_nfft_plan);
01066       
01067       if((r==rr)&amp;&amp;(J-rr!=rr))
01068   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_transposed);
01069     } <span class="comment">/* for(rr) */</span>
01070 } <span class="comment">/* void nsfft_adjoint_2d */</span>
01071 
01072 <span class="keywordtype">void</span> nsfft_trafo_3d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths)
01073 {
01074   <span class="keywordtype">int</span> r,rr,j;
01075   <span class="keywordtype">double</span> temp;
01076   <span class="keywordtype">int</span> sum_N_B_less_r,N_B_r,a,b;
01077 
01078   <span class="keywordtype">int</span> M=ths-&gt;M_total;
01079   <span class="keywordtype">int</span> J=ths-&gt;J;
01080 
01081   <span class="comment">/* center */</span>
01082   ths-&gt;center_nfft_plan-&gt;f_hat=ths-&gt;f_hat+6*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J)*(<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>((J+1)/2+1)-1);
01083   
01084   <span class="keywordflow">if</span> (ths-&gt;center_nfft_plan-&gt;N[0]&lt;=ths-&gt;center_nfft_plan-&gt;m)
01085     ndft_trafo(ths-&gt;center_nfft_plan);
01086   else
01087     nfft_trafo(ths-&gt;center_nfft_plan);
01088 
01089   for (j=0; j&lt;M; j++) 
01090     ths-&gt;f[j] = ths-&gt;center_nfft_plan-&gt;f[j];
01091 
01092   sum_N_B_less_r=0;
01093   for(rr=0;rr&lt;=(J+1)/2;rr++)
01094     {
01095       a=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-rr);
01096       b=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(rr);
01097 
01098       N_B_r=a*b*b;
01099 
01100       r=<a class="code" href="group__nfftutil.html#ga59">NFFT_MIN</a>(rr,J-rr);
01101       ths-&gt;act_nfft_plan-&gt;my_fftw_plan1 = ths-&gt;set_fftw_plan1[rr];
01102 
01103       ths-&gt;act_nfft_plan-&gt;N[0]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(r);
01104       <span class="keywordflow">if</span>(a&lt;b)
01105   ths-&gt;act_nfft_plan-&gt;N[1]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-r);
01106       <span class="keywordflow">else</span>
01107   ths-&gt;act_nfft_plan-&gt;N[1]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(r);
01108       ths-&gt;act_nfft_plan-&gt;N[2]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-r);
01109 
01110       <span class="comment">/*printf("\n\n%d x %d x %d:\t",ths-&gt;act_nfft_plan-&gt;N[0],ths-&gt;act_nfft_plan-&gt;N[1],ths-&gt;act_nfft_plan-&gt;N[2]); fflush(stdout);*/</span>
01111 
01112       ths-&gt;act_nfft_plan-&gt;N_total=ths-&gt;act_nfft_plan-&gt;N[0]*ths-&gt;act_nfft_plan-&gt;N[1]*ths-&gt;act_nfft_plan-&gt;N[2];
01113       ths-&gt;act_nfft_plan-&gt;n[0]=ths-&gt;sigma*ths-&gt;act_nfft_plan-&gt;N[0];
01114       ths-&gt;act_nfft_plan-&gt;n[1]=ths-&gt;sigma*ths-&gt;act_nfft_plan-&gt;N[1];
01115       ths-&gt;act_nfft_plan-&gt;n[2]=ths-&gt;sigma*ths-&gt;act_nfft_plan-&gt;N[2];
01116       ths-&gt;act_nfft_plan-&gt;n_total=ths-&gt;act_nfft_plan-&gt;n[0]*ths-&gt;act_nfft_plan-&gt;n[1]*ths-&gt;act_nfft_plan-&gt;n[2];
01117 
01118       <span class="comment">/* only for right - rear - top */</span>
01119       <span class="keywordflow">if</span>((J==0)||((J==1)&amp;&amp;(rr==1)))
01120   temp=-2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>;
01121       <span class="keywordflow">else</span>
01122   temp=-3.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-rr);
01123   
01124       <span class="comment">/* right */</span>      
01125       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat + sum_N_B_less_r + N_B_r*0;
01126 
01127       <span class="keywordflow">if</span>(a&gt;b)
01128   <a class="code" href="group__nfftutil.html#ga56">NFFT_SWAP_double</a>(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_120);
01129 
01130       <span class="keywordflow">if</span>(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01131   <span class="keywordflow">if</span>(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01132     <span class="keywordflow">if</span>(ths-&gt;act_nfft_plan-&gt;N[2]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01133       <a class="code" href="group__nfft.html#ga0">ndft_trafo</a>(ths-&gt;act_nfft_plan);
01134     <span class="keywordflow">else</span>
01135       short_nfft_trafo_3d_1(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
01136   <span class="keywordflow">else</span>
01137     short_nfft_trafo_3d_2(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_2d[r]));
01138       <span class="keywordflow">else</span>
01139   <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(ths-&gt;act_nfft_plan);
01140       
01141       <span class="keywordflow">if</span>(a&gt;b)
01142   <a class="code" href="group__nfftutil.html#ga56">NFFT_SWAP_double</a>(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_120);
01143       
01144       <span class="keywordflow">for</span> (j=0; j&lt;M; j++)
01145         ths-&gt;f[j] += ths-&gt;act_nfft_plan-&gt;f[j] *
01146                      cexp( + I*temp*ths-&gt;act_nfft_plan-&gt;x[3*j+0]);
01147 
01148       <span class="comment">/* rear */</span>      
01149       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat + sum_N_B_less_r + N_B_r*1;
01150 
01151       if(a&gt;b)
01152   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_021);
01153       if(a&lt;b)
01154   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_102);
01155       
01156       if(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01157   if(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01158     if(ths-&gt;act_nfft_plan-&gt;N[2]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01159       ndft_trafo(ths-&gt;act_nfft_plan);
01160     else
01161       short_nfft_trafo_3d_1(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
01162   else
01163     short_nfft_trafo_3d_2(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_2d[r]));
01164       else
01165   nfft_trafo(ths-&gt;act_nfft_plan);
01166       
01167       if(a&gt;b)
01168   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_021);
01169       if(a&lt;b)
01170   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_102);
01171       
01172       for (j=0; j&lt;M; j++)
01173         ths-&gt;f[j] += ths-&gt;act_nfft_plan-&gt;f[j] *
01174                      cexp( + I*temp*ths-&gt;act_nfft_plan-&gt;x[3*j+1]);
01175 
01176       <span class="comment">/* top */</span>      
01177       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat + sum_N_B_less_r + N_B_r*2;
01178 
01179       if(a&lt;b)
01180   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_201);
01181       
01182       if(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01183   if(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01184     if(ths-&gt;act_nfft_plan-&gt;N[2]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01185       ndft_trafo(ths-&gt;act_nfft_plan);
01186     else
01187       short_nfft_trafo_3d_1(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
01188   else
01189     short_nfft_trafo_3d_2(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_2d[r]));
01190       else
01191   nfft_trafo(ths-&gt;act_nfft_plan);
01192       
01193       if(a&lt;b)
01194   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_201);
01195       
01196       for (j=0; j&lt;M; j++)
01197         ths-&gt;f[j] += ths-&gt;act_nfft_plan-&gt;f[j] *
01198                      cexp( + I*temp*ths-&gt;act_nfft_plan-&gt;x[3*j+2]);
01199 
01200       <span class="comment">/* only for left - front - bottom */</span>
01201       if((J==0)||((J==1)&amp;&amp;(rr==1)))
01202   temp=-4.0*PI;
01203       else
01204   temp=-3.0*PI*nfft_int_2_pow(J-rr);
01205 
01206       <span class="comment">/* left */</span>
01207       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat + sum_N_B_less_r + N_B_r*3;
01208 
01209       if(a&gt;b)
01210   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_120);
01211 
01212       if(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01213   if(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01214     if(ths-&gt;act_nfft_plan-&gt;N[2]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01215       ndft_trafo(ths-&gt;act_nfft_plan);
01216     else
01217       short_nfft_trafo_3d_1(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
01218   else
01219     short_nfft_trafo_3d_2(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_2d[r]));
01220       else
01221   nfft_trafo(ths-&gt;act_nfft_plan);
01222       
01223       if(a&gt;b)
01224   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_120);
01225       
01226       for (j=0; j&lt;M; j++)
01227         ths-&gt;f[j] += ths-&gt;act_nfft_plan-&gt;f[j] *
01228                      cexp( - I*temp*ths-&gt;act_nfft_plan-&gt;x[3*j+0]);
01229 
01230       <span class="comment">/* front */</span>      
01231       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat + sum_N_B_less_r + N_B_r*4;
01232 
01233       if(a&gt;b)
01234   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_021);
01235       if(a&lt;b)
01236   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_102);
01237       
01238       if(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01239   if(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01240     if(ths-&gt;act_nfft_plan-&gt;N[2]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01241       ndft_trafo(ths-&gt;act_nfft_plan);
01242     else
01243       short_nfft_trafo_3d_1(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
01244   else
01245     short_nfft_trafo_3d_2(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_2d[r]));
01246       else
01247   nfft_trafo(ths-&gt;act_nfft_plan);
01248       
01249       if(a&gt;b)
01250   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_021);
01251       if(a&lt;b)
01252   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_102);
01253       
01254       for (j=0; j&lt;M; j++)
01255         ths-&gt;f[j] += ths-&gt;act_nfft_plan-&gt;f[j] *
01256                      cexp( - I*temp*ths-&gt;act_nfft_plan-&gt;x[3*j+1]);
01257 
01258       <span class="comment">/* bottom */</span>      
01259       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat + sum_N_B_less_r + N_B_r*5;
01260 
01261       if(a&lt;b)
01262   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_201);
01263       
01264       if(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01265   if(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01266     if(ths-&gt;act_nfft_plan-&gt;N[2]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01267       ndft_trafo(ths-&gt;act_nfft_plan);
01268     else
01269       short_nfft_trafo_3d_1(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
01270   else
01271     short_nfft_trafo_3d_2(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_2d[r]));
01272       else
01273   nfft_trafo(ths-&gt;act_nfft_plan);
01274       
01275       if(a&lt;b)
01276   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_201);
01277       
01278       for (j=0; j&lt;M; j++)
01279         ths-&gt;f[j] += ths-&gt;act_nfft_plan-&gt;f[j] *
01280                      cexp( - I*temp*ths-&gt;act_nfft_plan-&gt;x[3*j+2]);
01281 
01282       sum_N_B_less_r+=6*N_B_r; 
01283     } <span class="comment">/* for(rr) */</span>
01284 } <span class="comment">/* void nsfft_trafo_3d */</span>
01285 
01286 <span class="keywordtype">void</span> nsfft_adjoint_3d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths)
01287 {
01288   <span class="keywordtype">int</span> r,rr,j;
01289   <span class="keywordtype">double</span> temp;
01290   <span class="keywordtype">int</span> sum_N_B_less_r,N_B_r,a,b;
01291 
01292   <span class="keywordtype">int</span> M=ths-&gt;M_total;
01293   <span class="keywordtype">int</span> J=ths-&gt;J;
01294 
01295   <span class="comment">/* center */</span>
01296   <span class="keywordflow">for</span> (j=0; j&lt;M; j++) 
01297     ths-&gt;center_nfft_plan-&gt;f[j] = ths-&gt;f[j];
01298 
01299   ths-&gt;center_nfft_plan-&gt;f_hat=ths-&gt;f_hat+6*nfft_int_2_pow(J)*(nfft_int_2_pow((J+1)/2+1)-1);
01300   
01301   if (ths-&gt;center_nfft_plan-&gt;N[0]&lt;=ths-&gt;center_nfft_plan-&gt;m)
01302     ndft_adjoint(ths-&gt;center_nfft_plan);
01303   else
01304     nfft_adjoint(ths-&gt;center_nfft_plan);
01305 
01306   sum_N_B_less_r=0;
01307   for(rr=0;rr&lt;=(J+1)/2;rr++)
01308     {
01309       a=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-rr);
01310       b=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(rr);
01311 
01312       N_B_r=a*b*b;
01313 
01314       r=<a class="code" href="group__nfftutil.html#ga59">NFFT_MIN</a>(rr,J-rr);
01315       ths-&gt;act_nfft_plan-&gt;my_fftw_plan1 = ths-&gt;set_fftw_plan1[rr];
01316       ths-&gt;act_nfft_plan-&gt;my_fftw_plan2 = ths-&gt;set_fftw_plan2[rr];
01317 
01318       ths-&gt;act_nfft_plan-&gt;N[0]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(r);
01319       <span class="keywordflow">if</span>(a&lt;b)
01320   ths-&gt;act_nfft_plan-&gt;N[1]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-r);
01321       <span class="keywordflow">else</span>
01322   ths-&gt;act_nfft_plan-&gt;N[1]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(r);
01323       ths-&gt;act_nfft_plan-&gt;N[2]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-r);
01324 
01325       <span class="comment">/*printf("\n\n%d x %d x %d:\t",ths-&gt;act_nfft_plan-&gt;N[0],ths-&gt;act_nfft_plan-&gt;N[1],ths-&gt;act_nfft_plan-&gt;N[2]); fflush(stdout);*/</span>
01326 
01327       ths-&gt;act_nfft_plan-&gt;N_total=ths-&gt;act_nfft_plan-&gt;N[0]*ths-&gt;act_nfft_plan-&gt;N[1]*ths-&gt;act_nfft_plan-&gt;N[2];
01328       ths-&gt;act_nfft_plan-&gt;n[0]=ths-&gt;sigma*ths-&gt;act_nfft_plan-&gt;N[0];
01329       ths-&gt;act_nfft_plan-&gt;n[1]=ths-&gt;sigma*ths-&gt;act_nfft_plan-&gt;N[1];
01330       ths-&gt;act_nfft_plan-&gt;n[2]=ths-&gt;sigma*ths-&gt;act_nfft_plan-&gt;N[2];
01331       ths-&gt;act_nfft_plan-&gt;n_total=ths-&gt;act_nfft_plan-&gt;n[0]*ths-&gt;act_nfft_plan-&gt;n[1]*ths-&gt;act_nfft_plan-&gt;n[2];
01332 
01333       <span class="comment">/* only for right - rear - top */</span>
01334       <span class="keywordflow">if</span>((J==0)||((J==1)&amp;&amp;(rr==1)))
01335   temp=-2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>;
01336       <span class="keywordflow">else</span>
01337   temp=-3.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-rr);
01338   
01339       <span class="comment">/* right */</span>      
01340       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat + sum_N_B_less_r + N_B_r*0;
01341 
01342       <span class="keywordflow">for</span> (j=0; j&lt;M; j++)
01343         ths-&gt;act_nfft_plan-&gt;f[j]= ths-&gt;f[j] *
01344                                   cexp( - I*temp*ths-&gt;act_nfft_plan-&gt;x[3*j+0]);
01345 
01346       if(a&gt;b)
01347   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_120);
01348 
01349       if(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01350   if(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01351     if(ths-&gt;act_nfft_plan-&gt;N[2]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01352       ndft_adjoint(ths-&gt;act_nfft_plan);
01353     else
01354       short_nfft_adjoint_3d_1(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
01355   else
01356     short_nfft_adjoint_3d_2(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_2d[r]));
01357       else
01358   nfft_adjoint(ths-&gt;act_nfft_plan);
01359       
01360       if(a&gt;b)
01361   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_120);
01362 
01363       <span class="comment">/* rear */</span>      
01364       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat + sum_N_B_less_r + N_B_r*1;
01365       
01366       for (j=0; j&lt;M; j++)
01367         ths-&gt;act_nfft_plan-&gt;f[j]= ths-&gt;f[j] *
01368                                   cexp( - I*temp*ths-&gt;act_nfft_plan-&gt;x[3*j+1]);
01369 
01370       if(a&gt;b)
01371   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_021);
01372       if(a&lt;b)
01373   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_102);
01374       
01375       if(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01376   if(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01377     if(ths-&gt;act_nfft_plan-&gt;N[2]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01378       ndft_adjoint(ths-&gt;act_nfft_plan);
01379     else
01380       short_nfft_adjoint_3d_1(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
01381   else
01382     short_nfft_adjoint_3d_2(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_2d[r]));
01383       else
01384   nfft_adjoint(ths-&gt;act_nfft_plan);
01385       
01386       if(a&gt;b)
01387   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_021);
01388       if(a&lt;b)
01389   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_102);
01390 
01391       <span class="comment">/* top */</span>      
01392       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat + sum_N_B_less_r + N_B_r*2;
01393       
01394       for (j=0; j&lt;M; j++)
01395         ths-&gt;act_nfft_plan-&gt;f[j]= ths-&gt;f[j] *
01396                                   cexp( - I*temp*ths-&gt;act_nfft_plan-&gt;x[3*j+2]);
01397 
01398       if(a&lt;b)
01399   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_201);
01400       
01401       if(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01402   if(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01403     if(ths-&gt;act_nfft_plan-&gt;N[2]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01404       ndft_adjoint(ths-&gt;act_nfft_plan);
01405     else
01406       short_nfft_adjoint_3d_1(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
01407   else
01408     short_nfft_adjoint_3d_2(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_2d[r]));
01409       else
01410   nfft_adjoint(ths-&gt;act_nfft_plan);
01411       
01412       if(a&lt;b)
01413   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_201);
01414 
01415       <span class="comment">/* only for left - front - bottom */</span>
01416       if((J==0)||((J==1)&amp;&amp;(rr==1)))
01417   temp=-4.0*PI;
01418       else
01419   temp=-3.0*PI*nfft_int_2_pow(J-rr);
01420 
01421       <span class="comment">/* left */</span>
01422       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat + sum_N_B_less_r + N_B_r*3;
01423       
01424       for (j=0; j&lt;M; j++)
01425         ths-&gt;act_nfft_plan-&gt;f[j]= ths-&gt;f[j] *
01426                                   cexp( + I*temp*ths-&gt;act_nfft_plan-&gt;x[3*j+0]);
01427 
01428       if(a&gt;b)
01429   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_120);
01430 
01431       if(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01432   if(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01433     if(ths-&gt;act_nfft_plan-&gt;N[2]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01434       ndft_adjoint(ths-&gt;act_nfft_plan);
01435     else
01436       short_nfft_adjoint_3d_1(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
01437   else
01438     short_nfft_adjoint_3d_2(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_2d[r]));
01439       else
01440   nfft_adjoint(ths-&gt;act_nfft_plan);
01441       
01442       if(a&gt;b)
01443   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_120);
01444 
01445       <span class="comment">/* front */</span>      
01446       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat + sum_N_B_less_r + N_B_r*4;
01447       
01448       for (j=0; j&lt;M; j++)
01449         ths-&gt;act_nfft_plan-&gt;f[j]= ths-&gt;f[j] *
01450                                   cexp( + I*temp*ths-&gt;act_nfft_plan-&gt;x[3*j+1]);
01451 
01452       if(a&gt;b)
01453   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_021);
01454       if(a&lt;b)
01455   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_102);
01456       
01457       if(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01458   if(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01459     if(ths-&gt;act_nfft_plan-&gt;N[2]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01460       ndft_adjoint(ths-&gt;act_nfft_plan);
01461     else
01462       short_nfft_adjoint_3d_1(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
01463   else
01464     short_nfft_adjoint_3d_2(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_2d[r]));
01465       else
01466   nfft_adjoint(ths-&gt;act_nfft_plan);
01467       
01468       if(a&gt;b)
01469   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_021);
01470       if(a&lt;b)
01471   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_102);
01472 
01473       <span class="comment">/* bottom */</span>      
01474       ths-&gt;act_nfft_plan-&gt;f_hat=ths-&gt;f_hat + sum_N_B_less_r + N_B_r*5;
01475       
01476       for (j=0; j&lt;M; j++)
01477         ths-&gt;act_nfft_plan-&gt;f[j]= ths-&gt;f[j] *
01478                                   cexp( + I*temp*ths-&gt;act_nfft_plan-&gt;x[3*j+2]);
01479 
01480       if(a&lt;b)
01481   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_201);
01482       
01483       if(ths-&gt;act_nfft_plan-&gt;N[0]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01484   if(ths-&gt;act_nfft_plan-&gt;N[1]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01485     if(ths-&gt;act_nfft_plan-&gt;N[2]&lt;=ths-&gt;act_nfft_plan-&gt;m)
01486       ndft_adjoint(ths-&gt;act_nfft_plan);
01487     else
01488       short_nfft_adjoint_3d_1(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_1d[r]));
01489   else
01490     short_nfft_adjoint_3d_2(ths-&gt;act_nfft_plan,&amp;(ths-&gt;set_nfft_plan_2d[r]));
01491       else
01492   nfft_adjoint(ths-&gt;act_nfft_plan);
01493       
01494       if(a&lt;b)
01495   NFFT_SWAP_double(ths-&gt;act_nfft_plan-&gt;x,ths-&gt;x_201);
01496 
01497       sum_N_B_less_r+=6*N_B_r; 
01498     } <span class="comment">/* for(rr) */</span>
01499 } <span class="comment">/* void nsfft_adjoint_3d */</span>
01500 
<a name="l01501"></a><a class="code" href="group__nsfft.html#ga2">01501</a> <span class="keywordtype">void</span> nsfft_trafo(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths)
01502 {
01503   <span class="keywordflow">if</span>(ths-&gt;d==2)
01504     nsfft_trafo_2d(ths);
01505   <span class="keywordflow">else</span>
01506     nsfft_trafo_3d(ths);
01507 }
01508 
<a name="l01509"></a><a class="code" href="group__nsfft.html#ga3">01509</a> <span class="keywordtype">void</span> <a class="code" href="group__nsfft.html#ga3">nsfft_adjoint</a>(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths)
01510 {
01511   <span class="keywordflow">if</span>(ths-&gt;d==2)
01512     nsfft_adjoint_2d(ths);
01513   <span class="keywordflow">else</span>
01514     nsfft_adjoint_3d(ths);
01515 }
01516 
01517 
01518 <span class="comment">/*========================================================*/</span>
01519 <span class="comment">/* J &gt;1, no precomputation at all!! */</span>
01520 <span class="keywordtype">void</span> nsfft_init_2d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths, <span class="keywordtype">int</span> J, <span class="keywordtype">int</span> M, <span class="keywordtype">int</span> m, <span class="keywordtype">unsigned</span> snfft_flags)
01521 {
01522   <span class="keywordtype">int</span> r;
01523   <span class="keywordtype">int</span> N[2];
01524   <span class="keywordtype">int</span> n[2];
01525 
01526   ths-&gt;flags=snfft_flags;
01527   ths-&gt;sigma=2;
01528   ths-&gt;J=J;
01529   ths-&gt;M_total=M;
01530   ths-&gt;N_total=(J+4)*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J+1);
01531   
01532   <span class="comment">/* memory allocation */</span>
01533   ths-&gt;f = (<span class="keywordtype">double</span> complex *)fftw_malloc(M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
01534   ths-&gt;f_hat = (<span class="keywordtype">double</span> complex *)fftw_malloc(ths-&gt;N_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
01535   ths-&gt;x_transposed= (<span class="keywordtype">double</span>*)fftw_malloc(2*M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
01536 
01537   ths-&gt;act_nfft_plan = (<a class="code" href="structnfft__plan.html">nfft_plan</a>*)fftw_malloc(<span class="keyword">sizeof</span>(<a class="code" href="structnfft__plan.html">nfft_plan</a>));
01538   ths-&gt;center_nfft_plan = (<a class="code" href="structnfft__plan.html">nfft_plan</a>*)fftw_malloc(<span class="keyword">sizeof</span>(<a class="code" href="structnfft__plan.html">nfft_plan</a>));
01539 
01540   ths-&gt;set_fftw_plan1=(fftw_plan*) fftw_malloc((J/2+1)*<span class="keyword">sizeof</span>(fftw_plan));
01541   ths-&gt;set_fftw_plan2=(fftw_plan*) fftw_malloc((J/2+1)*<span class="keyword">sizeof</span>(fftw_plan));
01542 
01543   ths-&gt;set_nfft_plan_1d = (<a class="code" href="structnfft__plan.html">nfft_plan</a>*) fftw_malloc((<a class="code" href="group__nfftutil.html#ga2">nfft_ld</a>(m)+1)*(<span class="keyword">sizeof</span>(<a class="code" href="structnfft__plan.html">nfft_plan</a>)));
01544   
01545   <span class="comment">/* planning the small nffts */</span>
01546   <span class="comment">/* r=0 */</span>
01547   N[0]=1;            n[0]=ths-&gt;sigma*N[0];
01548   N[1]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J); n[1]=ths-&gt;sigma*N[1];
01549   
01550   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(ths-&gt;act_nfft_plan,2,N,M,n,m, FG_PSI| MALLOC_X| MALLOC_F| FFTW_INIT, FFTW_MEASURE);
01551   
01552   <span class="keywordflow">if</span>(ths-&gt;act_nfft_plan-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga27">PRE_ONE_PSI</a>)
01553     <a class="code" href="group__nfft.html#ga10">nfft_precompute_one_psi</a>(ths-&gt;act_nfft_plan);
01554 
01555   ths-&gt;set_fftw_plan1[0]=ths-&gt;act_nfft_plan-&gt;my_fftw_plan1;
01556   ths-&gt;set_fftw_plan2[0]=ths-&gt;act_nfft_plan-&gt;my_fftw_plan2;
01557 
01558   <span class="keywordflow">for</span>(r=1;r&lt;=J/2;r++)
01559     {
01560       N[0]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(r);   n[0]=ths-&gt;sigma*N[0];
01561       N[1]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-r); n[1]=ths-&gt;sigma*N[1];
01562       ths-&gt;set_fftw_plan1[r] = 
01563   fftw_plan_dft(2, n, ths-&gt;act_nfft_plan-&gt;g1, ths-&gt;act_nfft_plan-&gt;g2,
01564           FFTW_FORWARD, ths-&gt;act_nfft_plan-&gt;fftw_flags);
01565 
01566       ths-&gt;set_fftw_plan2[r] = 
01567   fftw_plan_dft(2, n, ths-&gt;act_nfft_plan-&gt;g2, ths-&gt;act_nfft_plan-&gt;g1,
01568           FFTW_BACKWARD, ths-&gt;act_nfft_plan-&gt;fftw_flags);
01569     }
01570 
01571   <span class="comment">/* planning the 1d nffts */</span>
01572   <span class="keywordflow">for</span>(r=0;r&lt;=<a class="code" href="group__nfftutil.html#ga2">nfft_ld</a>(m);r++)
01573     {
01574       N[0]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-r); n[0]=ths-&gt;sigma*N[0]; <span class="comment">/* ==N[1] of the 2 dimensional plan */</span>
01575 
01576       <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;(ths-&gt;set_nfft_plan_1d[r]),1,N,M,n,m, MALLOC_X| MALLOC_F| FFTW_INIT, FFTW_MEASURE);
01577       ths-&gt;set_nfft_plan_1d[r].nfft_flags = ths-&gt;set_nfft_plan_1d[r].nfft_flags | <a class="code" href="group__nfft.html#ga17">FG_PSI</a>;
01578       ths-&gt;set_nfft_plan_1d[r].K=ths-&gt;act_nfft_plan-&gt;K;
01579       ths-&gt;set_nfft_plan_1d[r].psi=ths-&gt;act_nfft_plan-&gt;psi;
01580     }
01581 
01582   <span class="comment">/* center plan */</span>
01583   <span class="comment">/* J/2 == floor(((double)J) / 2.0) */</span>
01584   N[0]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J/2+1); n[0]=ths-&gt;sigma*N[0];
01585   N[1]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J/2+1); n[1]=ths-&gt;sigma*N[1];
01586   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(ths-&gt;center_nfft_plan,2,N,M,n, m, MALLOC_F| FFTW_INIT,
01587                      FFTW_MEASURE);
01588   ths-&gt;center_nfft_plan-&gt;x= ths-&gt;act_nfft_plan-&gt;x;
01589   ths-&gt;center_nfft_plan-&gt;nfft_flags = ths-&gt;center_nfft_plan-&gt;nfft_flags|
01590                                       <a class="code" href="group__nfft.html#ga17">FG_PSI</a>;
01591   ths-&gt;center_nfft_plan-&gt;K=ths-&gt;act_nfft_plan-&gt;K;
01592   ths-&gt;center_nfft_plan-&gt;psi=ths-&gt;act_nfft_plan-&gt;psi;
01593 
01594   <span class="keywordflow">if</span>(ths-&gt;flags &amp; <a class="code" href="group__nsfft.html#ga8">NSDFT</a>)
01595     {
01596       ths-&gt;index_sparse_to_full=(<span class="keywordtype">int</span>*)fftw_malloc(ths-&gt;N_total*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
01597       init_index_sparse_to_full_2d(ths);
01598     }
01599 }
01600 
01601 <span class="comment">/*========================================================*/</span>
01602 <span class="comment">/* J &gt;1, no precomputation at all!! */</span>
01603 <span class="keywordtype">void</span> nsfft_init_3d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths, <span class="keywordtype">int</span> J, <span class="keywordtype">int</span> M, <span class="keywordtype">int</span> m, <span class="keywordtype">unsigned</span> snfft_flags)
01604 {
01605   <span class="keywordtype">int</span> r,rr,a,b;
01606   <span class="keywordtype">int</span> N[3];
01607   <span class="keywordtype">int</span> n[3];
01608 
01609   ths-&gt;flags=snfft_flags;
01610   ths-&gt;sigma=2;
01611   ths-&gt;J=J;
01612   ths-&gt;M_total=M;
01613   ths-&gt;N_total=6*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J)*(<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>((J+1)/2+1)-1)+<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(3*(J/2+1));
01614   
01615   <span class="comment">/* memory allocation */</span>
01616   ths-&gt;f =     (<span class="keywordtype">double</span> complex *)fftw_malloc(M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
01617   ths-&gt;f_hat = (<span class="keywordtype">double</span> complex *)fftw_malloc(ths-&gt;N_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
01618 
01619   ths-&gt;x_102= (<span class="keywordtype">double</span>*)fftw_malloc(3*M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
01620   ths-&gt;x_201= (<span class="keywordtype">double</span>*)fftw_malloc(3*M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
01621   ths-&gt;x_120= (<span class="keywordtype">double</span>*)fftw_malloc(3*M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
01622   ths-&gt;x_021= (<span class="keywordtype">double</span>*)fftw_malloc(3*M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
01623 
01624   ths-&gt;act_nfft_plan = (<a class="code" href="structnfft__plan.html">nfft_plan</a>*)fftw_malloc(<span class="keyword">sizeof</span>(<a class="code" href="structnfft__plan.html">nfft_plan</a>));
01625   ths-&gt;center_nfft_plan = (<a class="code" href="structnfft__plan.html">nfft_plan</a>*)fftw_malloc(<span class="keyword">sizeof</span>(<a class="code" href="structnfft__plan.html">nfft_plan</a>));
01626 
01627   ths-&gt;set_fftw_plan1=(fftw_plan*) fftw_malloc(((J+1)/2+1)*<span class="keyword">sizeof</span>(fftw_plan));
01628   ths-&gt;set_fftw_plan2=(fftw_plan*) fftw_malloc(((J+1)/2+1)*<span class="keyword">sizeof</span>(fftw_plan));
01629 
01630   ths-&gt;set_nfft_plan_1d = (<a class="code" href="structnfft__plan.html">nfft_plan</a>*) fftw_malloc((<a class="code" href="group__nfftutil.html#ga2">nfft_ld</a>(m)+1)*(<span class="keyword">sizeof</span>(<a class="code" href="structnfft__plan.html">nfft_plan</a>)));
01631   ths-&gt;set_nfft_plan_2d = (<a class="code" href="structnfft__plan.html">nfft_plan</a>*) fftw_malloc((<a class="code" href="group__nfftutil.html#ga2">nfft_ld</a>(m)+1)*(<span class="keyword">sizeof</span>(<a class="code" href="structnfft__plan.html">nfft_plan</a>)));
01632   
01633   <span class="comment">/* planning the small nffts */</span>
01634   <span class="comment">/* r=0 */</span>
01635   N[0]=1;            n[0]=ths-&gt;sigma*N[0];
01636   N[1]=1;            n[1]=ths-&gt;sigma*N[1];
01637   N[2]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J); n[2]=ths-&gt;sigma*N[2];
01638   
01639   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(ths-&gt;act_nfft_plan,3,N,M,n,m, FG_PSI| MALLOC_X| MALLOC_F, FFTW_MEASURE);
01640 
01641   <span class="keywordflow">if</span>(ths-&gt;act_nfft_plan-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga27">PRE_ONE_PSI</a>)
01642     <a class="code" href="group__nfft.html#ga10">nfft_precompute_one_psi</a>(ths-&gt;act_nfft_plan);
01643 
01644   <span class="comment">/* malloc g1, g2 for maximal size */</span>
01645   ths-&gt;act_nfft_plan-&gt;g1 = fftw_malloc(ths-&gt;sigma*ths-&gt;sigma*ths-&gt;sigma*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J+(J+1)/2)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
01646   ths-&gt;act_nfft_plan-&gt;g2 = fftw_malloc(ths-&gt;sigma*ths-&gt;sigma*ths-&gt;sigma*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J+(J+1)/2)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
01647 
01648   ths-&gt;act_nfft_plan-&gt;my_fftw_plan1 =
01649     fftw_plan_dft(3, n, ths-&gt;act_nfft_plan-&gt;g1, ths-&gt;act_nfft_plan-&gt;g2,
01650       FFTW_FORWARD, ths-&gt;act_nfft_plan-&gt;fftw_flags);
01651   ths-&gt;act_nfft_plan-&gt;my_fftw_plan2 =
01652     fftw_plan_dft(3, n, ths-&gt;act_nfft_plan-&gt;g2, ths-&gt;act_nfft_plan-&gt;g1,
01653       FFTW_BACKWARD, ths-&gt;act_nfft_plan-&gt;fftw_flags);
01654 
01655   ths-&gt;set_fftw_plan1[0]=ths-&gt;act_nfft_plan-&gt;my_fftw_plan1;
01656   ths-&gt;set_fftw_plan2[0]=ths-&gt;act_nfft_plan-&gt;my_fftw_plan2;
01657 
01658   <span class="keywordflow">for</span>(rr=1;rr&lt;=(J+1)/2;rr++)
01659     {
01660       a=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-rr);
01661       b=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(rr);
01662 
01663       r=<a class="code" href="group__nfftutil.html#ga59">NFFT_MIN</a>(rr,J-rr);
01664 
01665       n[0]=ths-&gt;sigma*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(r);
01666       <span class="keywordflow">if</span>(a&lt;b)
01667   n[1]=ths-&gt;sigma*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-r);
01668       <span class="keywordflow">else</span>
01669   n[1]=ths-&gt;sigma*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(r);
01670       n[2]=ths-&gt;sigma*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-r);
01671 
01672       ths-&gt;set_fftw_plan1[rr] =
01673   fftw_plan_dft(3, n, ths-&gt;act_nfft_plan-&gt;g1, ths-&gt;act_nfft_plan-&gt;g2,
01674           FFTW_FORWARD, ths-&gt;act_nfft_plan-&gt;fftw_flags);
01675       ths-&gt;set_fftw_plan2[rr] =
01676   fftw_plan_dft(3, n, ths-&gt;act_nfft_plan-&gt;g2, ths-&gt;act_nfft_plan-&gt;g1,
01677           FFTW_BACKWARD, ths-&gt;act_nfft_plan-&gt;fftw_flags);
01678     }
01679 
01680   <span class="comment">/* planning the 1d nffts */</span>
01681   <span class="keywordflow">for</span>(r=0;r&lt;=<a class="code" href="group__nfftutil.html#ga2">nfft_ld</a>(m);r++)
01682     {
01683       N[0]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-r); n[0]=ths-&gt;sigma*N[0];
01684       N[1]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J-r); n[1]=ths-&gt;sigma*N[1];
01685 
01686       <span class="keywordflow">if</span>(N[0]&gt;m)
01687   {
01688     <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;(ths-&gt;set_nfft_plan_1d[r]),1,N,M,n,m, MALLOC_X| MALLOC_F| FFTW_INIT, FFTW_MEASURE);
01689     ths-&gt;set_nfft_plan_1d[r].nfft_flags = ths-&gt;set_nfft_plan_1d[r].nfft_flags | <a class="code" href="group__nfft.html#ga17">FG_PSI</a>;
01690     ths-&gt;set_nfft_plan_1d[r].K=ths-&gt;act_nfft_plan-&gt;K;
01691     ths-&gt;set_nfft_plan_1d[r].psi=ths-&gt;act_nfft_plan-&gt;psi;
01692     <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;(ths-&gt;set_nfft_plan_2d[r]),2,N,M,n,m, MALLOC_X| MALLOC_F| FFTW_INIT, FFTW_MEASURE);
01693     ths-&gt;set_nfft_plan_2d[r].nfft_flags = ths-&gt;set_nfft_plan_2d[r].nfft_flags | <a class="code" href="group__nfft.html#ga17">FG_PSI</a>;
01694     ths-&gt;set_nfft_plan_2d[r].K=ths-&gt;act_nfft_plan-&gt;K;
01695     ths-&gt;set_nfft_plan_2d[r].psi=ths-&gt;act_nfft_plan-&gt;psi;
01696   }
01697     }
01698 
01699   <span class="comment">/* center plan */</span>
01700   <span class="comment">/* J/2 == floor(((double)J) / 2.0) */</span>
01701   N[0]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J/2+1); n[0]=ths-&gt;sigma*N[0];
01702   N[1]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J/2+1); n[1]=ths-&gt;sigma*N[1];
01703   N[2]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J/2+1); n[2]=ths-&gt;sigma*N[2];
01704   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(ths-&gt;center_nfft_plan,3,N,M,n, m, MALLOC_F| FFTW_INIT,
01705                      FFTW_MEASURE);
01706   ths-&gt;center_nfft_plan-&gt;x= ths-&gt;act_nfft_plan-&gt;x;
01707   ths-&gt;center_nfft_plan-&gt;nfft_flags = ths-&gt;center_nfft_plan-&gt;nfft_flags|
01708                                       <a class="code" href="group__nfft.html#ga17">FG_PSI</a>;
01709   ths-&gt;center_nfft_plan-&gt;K=ths-&gt;act_nfft_plan-&gt;K;
01710   ths-&gt;center_nfft_plan-&gt;psi=ths-&gt;act_nfft_plan-&gt;psi;
01711 
01712   <span class="keywordflow">if</span>(ths-&gt;flags &amp; <a class="code" href="group__nsfft.html#ga8">NSDFT</a>)
01713     {
01714       ths-&gt;index_sparse_to_full=(<span class="keywordtype">int</span>*)fftw_malloc(ths-&gt;N_total*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
01715       init_index_sparse_to_full_3d(ths);
01716     }
01717 }
01718 
01719 <span class="preprocessor">#ifdef GAUSSIAN</span>
01720 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="group__nsfft.html#ga6">nsfft_init</a>(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths, <span class="keywordtype">int</span> d, <span class="keywordtype">int</span> J, <span class="keywordtype">int</span> M, <span class="keywordtype">int</span> m, <span class="keywordtype">unsigned</span> flags)
01721 {
01722   ths-&gt;d=d;
01723 
01724   <span class="keywordflow">if</span>(ths-&gt;d==2)
01725     nsfft_init_2d(ths, J, M, m, flags);
01726   <span class="keywordflow">else</span>
01727     nsfft_init_3d(ths, J, M, m, flags);
01728 }
01729 <span class="preprocessor">#else</span>
<a name="l01730"></a><a class="code" href="group__nsfft.html#ga6">01730</a> <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="group__nsfft.html#ga6">nsfft_init</a>(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths, <span class="keywordtype">int</span> d, <span class="keywordtype">int</span> J, <span class="keywordtype">int</span> M, <span class="keywordtype">int</span> m, <span class="keywordtype">unsigned</span> flags)
01731 {
01732   fprintf(stderr,
01733     <span class="stringliteral">"\nError in kernel/nsfft_init: require GAUSSIAN window function\n"</span>);
01734 }
01735 <span class="preprocessor">#endif</span>
01736 <span class="preprocessor"></span>
01737 <span class="keywordtype">void</span> nsfft_finalize_2d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths)
01738 {
01739   <span class="keywordtype">int</span> r;
01740 
01741   <span class="keywordflow">if</span>(ths-&gt;flags &amp; <a class="code" href="group__nsfft.html#ga8">NSDFT</a>)
01742     fftw_free(ths-&gt;index_sparse_to_full);
01743 
01744   <span class="comment">/* center plan */</span>
01745   ths-&gt;center_nfft_plan-&gt;nfft_flags = ths-&gt;center_nfft_plan-&gt;nfft_flags ^ <a class="code" href="group__nfft.html#ga17">FG_PSI</a>;
01746   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(ths-&gt;center_nfft_plan);
01747 
01748   <span class="comment">/* the 1d nffts */</span>
01749   <span class="keywordflow">for</span>(r=0;r&lt;=<a class="code" href="group__nfftutil.html#ga2">nfft_ld</a>(ths-&gt;act_nfft_plan-&gt;m);r++)
01750     {
01751       ths-&gt;set_nfft_plan_1d[r].nfft_flags =
01752         ths-&gt;set_nfft_plan_1d[r].nfft_flags ^ <a class="code" href="group__nfft.html#ga17">FG_PSI</a>;
01753       <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;(ths-&gt;set_nfft_plan_1d[r]));
01754     }
01755   
01756   <span class="comment">/* finalize the small nffts */</span>
01757   ths-&gt;act_nfft_plan-&gt;my_fftw_plan2=ths-&gt;set_fftw_plan2[0];
01758   ths-&gt;act_nfft_plan-&gt;my_fftw_plan1=ths-&gt;set_fftw_plan1[0];
01759 
01760   <span class="keywordflow">for</span>(r=1;r&lt;=ths-&gt;J/2;r++)
01761     {
01762       fftw_destroy_plan(ths-&gt;set_fftw_plan2[r]);
01763       fftw_destroy_plan(ths-&gt;set_fftw_plan1[r]);
01764     }
01765 
01766   <span class="comment">/* r=0 */</span>
01767   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(ths-&gt;act_nfft_plan);
01768 
01769   fftw_free(ths-&gt;set_nfft_plan_1d);
01770 
01771   fftw_free(ths-&gt;set_fftw_plan2);
01772   fftw_free(ths-&gt;set_fftw_plan1);
01773 
01774   fftw_free(ths-&gt;x_transposed);
01775 
01776   fftw_free(ths-&gt;f_hat);
01777   fftw_free(ths-&gt;f);
01778 }
01779 
01780 <span class="keywordtype">void</span> nsfft_finalize_3d(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths)
01781 {
01782   <span class="keywordtype">int</span> r;
01783 
01784   <span class="keywordflow">if</span>(ths-&gt;flags &amp; <a class="code" href="group__nsfft.html#ga8">NSDFT</a>)
01785     fftw_free(ths-&gt;index_sparse_to_full);
01786 
01787   <span class="comment">/* center plan */</span>
01788   ths-&gt;center_nfft_plan-&gt;nfft_flags = ths-&gt;center_nfft_plan-&gt;nfft_flags ^ <a class="code" href="group__nfft.html#ga17">FG_PSI</a>;
01789   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(ths-&gt;center_nfft_plan);
01790 
01791   <span class="comment">/* the 1d and 2d nffts */</span>
01792   <span class="keywordflow">for</span>(r=0;r&lt;=<a class="code" href="group__nfftutil.html#ga2">nfft_ld</a>(ths-&gt;act_nfft_plan-&gt;m);r++)
01793     {
01794       <span class="keywordflow">if</span>(<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(ths-&gt;J-r)&gt;ths-&gt;act_nfft_plan-&gt;m)
01795   {
01796     ths-&gt;set_nfft_plan_2d[r].nfft_flags = ths-&gt;set_nfft_plan_2d[r].nfft_flags ^ <a class="code" href="group__nfft.html#ga17">FG_PSI</a>;
01797     <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;(ths-&gt;set_nfft_plan_2d[r]));
01798     ths-&gt;set_nfft_plan_1d[r].nfft_flags = ths-&gt;set_nfft_plan_1d[r].nfft_flags ^ <a class="code" href="group__nfft.html#ga17">FG_PSI</a>;
01799     <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;(ths-&gt;set_nfft_plan_1d[r]));
01800   }
01801     }
01802   
01803   <span class="comment">/* finalize the small nffts */</span>
01804   ths-&gt;act_nfft_plan-&gt;my_fftw_plan2=ths-&gt;set_fftw_plan2[0];
01805   ths-&gt;act_nfft_plan-&gt;my_fftw_plan1=ths-&gt;set_fftw_plan1[0];
01806 
01807   <span class="keywordflow">for</span>(r=1;r&lt;=(ths-&gt;J+1)/2;r++)
01808     {
01809       fftw_destroy_plan(ths-&gt;set_fftw_plan2[r]);
01810       fftw_destroy_plan(ths-&gt;set_fftw_plan1[r]);
01811     }
01812 
01813   <span class="comment">/* r=0 */</span>
01814   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(ths-&gt;act_nfft_plan);
01815 
01816   fftw_free(ths-&gt;set_nfft_plan_1d);
01817   fftw_free(ths-&gt;set_nfft_plan_2d);
01818 
01819   fftw_free(ths-&gt;set_fftw_plan2);
01820   fftw_free(ths-&gt;set_fftw_plan1);
01821 
01822   fftw_free(ths-&gt;x_102);
01823   fftw_free(ths-&gt;x_201);
01824   fftw_free(ths-&gt;x_120);
01825   fftw_free(ths-&gt;x_021);
01826 
01827   fftw_free(ths-&gt;f_hat);
01828   fftw_free(ths-&gt;f);
01829 }
01830 
<a name="l01831"></a><a class="code" href="group__nsfft.html#ga7">01831</a> <span class="keywordtype">void</span> <a class="code" href="group__nsfft.html#ga7">nsfft_finalize</a>(<a class="code" href="structnsfft__plan.html">nsfft_plan</a> *ths)
01832 {
01833   <span class="keywordflow">if</span>(ths-&gt;d==2)
01834     nsfft_finalize_2d(ths);
01835   <span class="keywordflow">else</span>
01836     nsfft_finalize_3d(ths);
01837 }
</pre></div>    <hr size="1"/>
    Generated on 5 Feb 2007 by Doxygen 1.4.1
  </body>
</html>
