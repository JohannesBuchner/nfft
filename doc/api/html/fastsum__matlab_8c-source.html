<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.2 API Reference - NFFT: fastsum_matlab.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.2 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000006.html">applications</a>&nbsp;/&nbsp;<a class="el" href="dir_000016.html">fastsum</a></div>
<h1>fastsum_matlab.c</h1><a href="fastsum__matlab_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00008 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00009 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00010 <span class="preprocessor">#include &lt;string.h&gt;</span>
00011 <span class="preprocessor">#include &lt;complex.h&gt;</span>
00012 <span class="preprocessor">#include &lt;math.h&gt;</span>
00013 
00014 <span class="preprocessor">#include "<a class="code" href="fastsum_8h.html">fastsum.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="kernels_8h.html">kernels.h</a>"</span>
00016 
00023 <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
00024 {
00025   <span class="keywordtype">int</span> j,k,t;                                         
00026   <span class="keywordtype">int</span> d;                                             
00027   <span class="keywordtype">int</span> N;                                             
00028   <span class="keywordtype">int</span> M;                                             
00029   <span class="keywordtype">int</span> n;                                             
00030   <span class="keywordtype">int</span> m;                                             
00031   <span class="keywordtype">int</span> p;                                             
00032   <span class="keywordtype">char</span> *s;                                           
00033   complex double (*kernel)(double , int , <span class="keyword">const</span> <span class="keywordtype">double</span> *);  
00034   <span class="keywordtype">double</span> c;                                          
00035   <a class="code" href="structfastsum__plan__.html">fastsum_plan</a> my_fastsum_plan;                      
00036   complex <span class="keywordtype">double</span> *direct;                                   
00037   <span class="keywordtype">double</span> time;                                       
00038   <span class="keywordtype">double</span> error=0.0;                                  
00039   <span class="keywordtype">double</span> eps_I;                                      
00040   <span class="keywordtype">double</span> eps_B;                                      
00041   FILE *fid1, *fid2;
00042   <span class="keywordtype">double</span> temp;
00043 
00044   <span class="keywordflow">if</span> (argc!=11)
00045   {
00046     printf(<span class="stringliteral">"\nfastsum_test d N M n m p kernel c\n\n"</span>);
00047     printf(<span class="stringliteral">"  d       dimension                 \n"</span>);
00048     printf(<span class="stringliteral">"  N       number of source nodes    \n"</span>);
00049     printf(<span class="stringliteral">"  M       number of target nodes    \n"</span>);
00050     printf(<span class="stringliteral">"  n       expansion degree          \n"</span>);
00051     printf(<span class="stringliteral">"  m       cut-off parameter         \n"</span>);
00052     printf(<span class="stringliteral">"  p       degree of smoothness      \n"</span>);
00053     printf(<span class="stringliteral">"  kernel  kernel function  (e.g., gaussian)\n"</span>);
00054     printf(<span class="stringliteral">"  c       kernel parameter          \n"</span>);
00055     printf(<span class="stringliteral">"  eps_I   inner boundary            \n"</span>);
00056     printf(<span class="stringliteral">"  eps_B   outer boundary            \n\n"</span>);
00057     exit(-1);
00058   }
00059   <span class="keywordflow">else</span>
00060   {
00061     d=atoi(argv[1]);
00062     N=atoi(argv[2]); c=1.0/pow((<span class="keywordtype">double</span>)N,1.0/(<span class="keywordtype">double</span>)d);
00063     M=atoi(argv[3]);
00064     n=atoi(argv[4]);
00065     m=atoi(argv[5]);
00066     p=atoi(argv[6]);
00067     s=argv[7];
00068     c=atof(argv[8]);
00069     eps_I=atof(argv[9]);
00070     eps_B=atof(argv[10]);
00071     <span class="keywordflow">if</span> (strcmp(s,<span class="stringliteral">"gaussian"</span>)==0)
00072       kernel = gaussian;
00073     else if (strcmp(s,"multiquadric")==0)
00074       kernel = multiquadric;
00075     else if (strcmp(s,"inverse_multiquadric")==0)
00076       kernel = inverse_multiquadric;
00077     else if (strcmp(s,"logarithm")==0)
00078       kernel = logarithm;
00079     else if (strcmp(s,"thinplate_spline")==0)
00080       kernel = thinplate_spline;
00081     else if (strcmp(s,"one_over_square")==0)
00082       kernel = one_over_square;
00083     else if (strcmp(s,"one_over_modulus")==0)
00084       kernel = one_over_modulus;
00085     else if (strcmp(s,"one_over_x")==0)
00086       kernel = one_over_x;
00087     else if (strcmp(s,"inverse_multiquadric3")==0)
00088       kernel = inverse_multiquadric3;
00089     else if (strcmp(s,"sinc_kernel")==0)
00090       kernel = sinc_kernel;
00091     else if (strcmp(s,"cosc")==0)
00092       kernel = cosc;
00093     else if (strcmp(s,"cot")==0)
00094       kernel = cot;
00095     else
00096     {
00097       s=<span class="stringliteral">"multiquadric"</span>;
00098       kernel = multiquadric;
00099     }
00100   }
00101   printf(<span class="stringliteral">"d=%d, N=%d, M=%d, n=%d, m=%d, p=%d, kernel=%s, c=%g, eps_I=%g, eps_B=%g \n"</span>,d,N,M,n,m,p,s,c,eps_I,eps_B);
00102 
00104   <a class="code" href="group__applications__fastsum.html#ga13">fastsum_init_guru</a>(&amp;my_fastsum_plan, d, N, M, kernel, &amp;c, 0, n, m, p, eps_I, eps_B);
00105   <span class="comment">/*fastsum_init_guru(&amp;my_fastsum_plan, d, N, M, kernel, &amp;c, EXACT_NEARFIELD, n, m, p);*/</span>
00106 
00108   fid1=fopen(<span class="stringliteral">"x.dat"</span>,<span class="stringliteral">"r"</span>);
00109   fid2=fopen(<span class="stringliteral">"alpha.dat"</span>,<span class="stringliteral">"r"</span>);
00110   <span class="keywordflow">for</span> (k=0; k&lt;N; k++)
00111   {
00112     <span class="keywordflow">for</span> (t=0; t&lt;d; t++)
00113     {
00114       fscanf(fid1,<span class="stringliteral">"%le"</span>,&amp;my_fastsum_plan.<a class="code" href="structfastsum__plan__.html#o5">x</a>[k*d+t]);
00115     }
00116     fscanf(fid2,<span class="stringliteral">"%le"</span>,&amp;temp); my_fastsum_plan.<a class="code" href="structfastsum__plan__.html#o3">alpha</a>[k] = temp;
00117     fscanf(fid2,<span class="stringliteral">"%le"</span>,&amp;temp); my_fastsum_plan.<a class="code" href="structfastsum__plan__.html#o3">alpha</a>[k] += temp*I;
00118   }
00119   fclose(fid1);
00120   fclose(fid2);
00121 
00123   fid1=fopen(<span class="stringliteral">"y.dat"</span>,<span class="stringliteral">"r"</span>);
00124   <span class="keywordflow">for</span> (j=0; j&lt;M; j++)
00125   {
00126     <span class="keywordflow">for</span> (t=0; t&lt;d; t++)
00127     {
00128       fscanf(fid1,<span class="stringliteral">"%le"</span>,&amp;my_fastsum_plan.<a class="code" href="structfastsum__plan__.html#o6">y</a>[j*d+t]);
00129     }
00130   }
00131   fclose(fid1);
00132 
00134   printf(<span class="stringliteral">"direct computation: "</span>); fflush(NULL);
00135   time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00136   <a class="code" href="group__applications__fastsum.html#ga15">fastsum_exact</a>(&amp;my_fastsum_plan);
00137   time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-time;
00138   printf(<span class="stringliteral">"%fsec\n"</span>,time);
00139 
00141   direct = (complex <span class="keywordtype">double</span> *)malloc(my_fastsum_plan.<a class="code" href="structfastsum__plan__.html#o2">M_total</a>*(<span class="keyword">sizeof</span>(complex <span class="keywordtype">double</span>)));
00142   <span class="keywordflow">for</span> (j=0; j&lt;my_fastsum_plan.<a class="code" href="structfastsum__plan__.html#o2">M_total</a>; j++)
00143     direct[j]=my_fastsum_plan.f[j];
00144 
00146   printf("pre-computation:    "); fflush(NULL);
00147   time=nfft_second();
00148   fastsum_precompute(&amp;my_fastsum_plan);
00149   time=nfft_second()-time;
00150   printf("%fsec\n",time);
00151 
00153   printf("fast computation:   "); fflush(NULL);
00154   time=nfft_second();
00155   fastsum_trafo(&amp;my_fastsum_plan);
00156   time=nfft_second()-time;
00157   printf("%fsec\n",time);
00158 
00160   error=0.0;
00161   for (j=0; j&lt;my_fastsum_plan.M_total; j++)
00162   {
00163    <span class="keywordflow">if</span> (cabs(direct[j]-my_fastsum_plan.f[j])/cabs(direct[j])&gt;error)
00164       error=cabs(direct[j]-my_fastsum_plan.f[j])/cabs(direct[j]);
00165   }
00166   printf("max relative error: %e\n",error);
00167 
00169   fid1=fopen("f.dat","w+");
00170   fid2=fopen("f_direct.dat","w+");
00171   if (fid1==NULL)
00172   {
00173     printf(<span class="stringliteral">"Fehler!\n"</span>);
00174     exit(-1);
00175   }
00176   <span class="keywordflow">for</span> (j=0; j&lt;M; j++)
00177   {
00178     temp=creal(my_fastsum_plan.f[j]);
00179     fprintf(fid1,<span class="stringliteral">"  % .16e"</span>,temp);
00180     temp=cimag(my_fastsum_plan.f[j]);
00181     fprintf(fid1,<span class="stringliteral">"  % .16e\n"</span>,temp);
00182 
00183     temp=creal(direct[j]);
00184     fprintf(fid2,<span class="stringliteral">"  % .16e"</span>,temp);
00185     temp=cimag(direct[j]);
00186     fprintf(fid2,<span class="stringliteral">"  % .16e\n"</span>,temp);
00187   }
00188   fclose(fid1);
00189   fclose(fid2);
00190 
00192   <a class="code" href="group__applications__fastsum.html#ga14">fastsum_finalize</a>(&amp;my_fastsum_plan);
00193 
00194   <span class="keywordflow">return</span> 0;
00195 }
00196 <span class="comment">/* \} */</span>
</pre></div>    <hr size="1"/>
    Generated on 22 Jan 2007 by Doxygen 1.4.1
  </body>
</html>
