<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.2 API Reference - NFFT: fastsum.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.2 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000006.html">applications</a>&nbsp;/&nbsp;<a class="el" href="dir_000016.html">fastsum</a></div>
<h1>fastsum.c</h1><a href="fastsum_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00008 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00009 <span class="preprocessor">#include &lt;complex.h&gt;</span>
00010 <span class="preprocessor">#include &lt;math.h&gt;</span>
00011 
00012 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="fastsum_8h.html">fastsum.h</a>"</span>
00015 
<a name="l00022"></a><a class="code" href="group__applications__fastsum.html#ga1">00022</a> <span class="keywordtype">double</span> <a class="code" href="group__applications__fastsum.html#ga1">fak</a>(<span class="keywordtype">int</span> n)
00023 {
00024   <span class="keywordflow">if</span> (n&lt;=1) <span class="keywordflow">return</span> 1.0;
00025   <span class="keywordflow">else</span> <span class="keywordflow">return</span> (<span class="keywordtype">double</span>)n*<a class="code" href="group__applications__fastsum.html#ga1">fak</a>(n-1);
00026 }
00027 
<a name="l00029"></a><a class="code" href="group__applications__fastsum.html#ga2">00029</a> <span class="keywordtype">double</span> <a class="code" href="group__applications__fastsum.html#ga2">binom</a>(<span class="keywordtype">int</span> n, <span class="keywordtype">int</span> m)
00030 {
00031   <span class="keywordflow">return</span> <a class="code" href="group__applications__fastsum.html#ga1">fak</a>(n)/<a class="code" href="group__applications__fastsum.html#ga1">fak</a>(m)/<a class="code" href="group__applications__fastsum.html#ga1">fak</a>(n-m);
00032 }
00033 
<a name="l00035"></a><a class="code" href="group__applications__fastsum.html#ga3">00035</a> <span class="keywordtype">double</span> <a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(<span class="keywordtype">int</span> m, <span class="keywordtype">int</span> r, <span class="keywordtype">double</span> xx)
00036 {
00037   <span class="keywordtype">int</span> k;
00038   <span class="keywordtype">double</span> sum=0.0;
00039 
00040   <span class="keywordflow">for</span> (k=0; k&lt;=m-r; k++) {
00041     sum+=<a class="code" href="group__applications__fastsum.html#ga2">binom</a>(m+k,k)*pow((xx+1.0)/2.0,(<span class="keywordtype">double</span>)k);
00042   }
00043   <span class="keywordflow">return</span> sum*pow((xx+1.0),(<span class="keywordtype">double</span>)r)*pow(1.0-xx,(<span class="keywordtype">double</span>)(m+1))/(1&lt;&lt;(m+1))/<a class="code" href="group__applications__fastsum.html#ga1">fak</a>(r); <span class="comment">/* 1&lt;&lt;(m+1) = 2^(m+1) */</span>
00044 }
00045 
<a name="l00047"></a><a class="code" href="group__applications__fastsum.html#ga4">00047</a> <span class="keywordtype">double</span> <a class="code" href="group__applications__fastsum.html#ga4">regkern</a>(complex <span class="keywordtype">double</span> (*kernel)(<span class="keywordtype">double</span> , <span class="keywordtype">int</span> , <span class="keyword">const</span> <span class="keywordtype">double</span> *), <span class="keywordtype">double</span> xx, <span class="keywordtype">int</span> p, <span class="keyword">const</span> <span class="keywordtype">double</span> *param, <span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b)
00048 {
00049   <span class="keywordtype">int</span> r;
00050   <span class="keywordtype">double</span> sum=0.0;
00051 
00052   <span class="keywordflow">if</span> (xx&lt;-0.5)
00053     xx=-0.5;
00054   <span class="keywordflow">if</span> (xx&gt;0.5)
00055     xx=0.5;
00056   <span class="keywordflow">if</span> ((xx&gt;=-0.5+b &amp;&amp; xx&lt;=-a) || (xx&gt;=a &amp;&amp; xx&lt;=0.5-b)) {
00057     <span class="keywordflow">return</span> kernel(xx,0,param);
00058   }
00059   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xx&lt;-0.5+b) {
00060     sum=(kernel(-0.5,0,param)+kernel(0.5,0,param))/2.0
00061         *<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,0,2.0*xx/b+(1.0-b)/b);
00062     <span class="keywordflow">for</span> (r=0; r&lt;p; r++) {
00063       sum+=pow(-b/2.0,(<span class="keywordtype">double</span>)r)
00064           *kernel(-0.5+b,r,param)
00065           *<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,-2.0*xx/b+(b-1.0)/b);
00066     }
00067     <span class="keywordflow">return</span> sum;
00068   }
00069   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((xx&gt;-a) &amp;&amp; (xx&lt;a)) {
00070     <span class="keywordflow">for</span> (r=0; r&lt;p; r++) {
00071       sum+=pow(a,(<span class="keywordtype">double</span>)r)
00072           *( kernel(-a,r,param)*<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,xx/a)
00073               +kernel( a,r,param)*<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,-xx/a)*(r &amp; 1 ? -1 : 1));
00074     }
00075     <span class="keywordflow">return</span> sum;
00076   }
00077   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xx&gt;0.5-b) {
00078     sum=(kernel(-0.5,0,param)+kernel(0.5,0,param))/2.0
00079         *<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,0,-2.0*xx/b+(1.0-b)/b);
00080     <span class="keywordflow">for</span> (r=0; r&lt;p; r++) {
00081       sum+=pow(b/2.0,(<span class="keywordtype">double</span>)r)
00082           *kernel(0.5-b,r,param)
00083           *<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,2.0*xx/b-(1.0-b)/b);
00084     }
00085     <span class="keywordflow">return</span> sum;
00086   }
00087   <span class="keywordflow">return</span> kernel(xx,0,param);
00088 }
00089 
<a name="l00093"></a><a class="code" href="group__applications__fastsum.html#ga5">00093</a> <span class="keywordtype">double</span> <a class="code" href="group__applications__fastsum.html#ga5">regkern1</a>(complex <span class="keywordtype">double</span> (*kernel)(<span class="keywordtype">double</span> , <span class="keywordtype">int</span> , <span class="keyword">const</span> <span class="keywordtype">double</span> *), <span class="keywordtype">double</span> xx, <span class="keywordtype">int</span> p, <span class="keyword">const</span> <span class="keywordtype">double</span> *param, <span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b)
00094 {
00095   <span class="keywordtype">int</span> r;
00096   <span class="keywordtype">double</span> sum=0.0;
00097 
00098   <span class="keywordflow">if</span> (xx&lt;-0.5)
00099     xx=-0.5;
00100   <span class="keywordflow">if</span> (xx&gt;0.5)
00101     xx=0.5;
00102   <span class="keywordflow">if</span> ((xx&gt;=-0.5+b &amp;&amp; xx&lt;=-a) || (xx&gt;=a &amp;&amp; xx&lt;=0.5-b))
00103   {
00104     <span class="keywordflow">return</span> kernel(xx,0,param);
00105   }
00106   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((xx&gt;-a) &amp;&amp; (xx&lt;a))
00107   {
00108     <span class="keywordflow">for</span> (r=0; r&lt;p; r++) {
00109       sum+=pow(a,(<span class="keywordtype">double</span>)r)
00110           *( kernel(-a,r,param)*<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,xx/a)
00111               +kernel( a,r,param)*<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,-xx/a)*(r &amp; 1 ? -1 : 1));
00112     }
00113     <span class="keywordflow">return</span> sum;
00114   }
00115   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xx&lt;-0.5+b)
00116   {
00117     <span class="keywordflow">for</span> (r=0; r&lt;p; r++) {
00118       sum+=pow(b,(<span class="keywordtype">double</span>)r)
00119           *( kernel(0.5-b,r,param)*<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,(xx+0.5)/b)
00120               +kernel(-0.5+b,r,param)*<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,-(xx+0.5)/b)*(r &amp; 1 ? -1 : 1));
00121     }
00122     <span class="keywordflow">return</span> sum;
00123   }
00124   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xx&gt;0.5-b)
00125   {
00126     <span class="keywordflow">for</span> (r=0; r&lt;p; r++) {
00127       sum+=pow(b,(<span class="keywordtype">double</span>)r)
00128           *( kernel(0.5-b,r,param)*<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,(xx-0.5)/b)
00129               +kernel(-0.5+b,r,param)*<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,-(xx-0.5)/b)*(r &amp; 1 ? -1 : 1));
00130     }
00131     <span class="keywordflow">return</span> sum;
00132   }
00133   <span class="keywordflow">return</span> kernel(xx,0,param);
00134 }
00135 
<a name="l00137"></a><a class="code" href="group__applications__fastsum.html#ga6">00137</a> <span class="keywordtype">double</span> <a class="code" href="group__applications__fastsum.html#ga6">regkern2</a>(complex <span class="keywordtype">double</span> (*kernel)(<span class="keywordtype">double</span> , <span class="keywordtype">int</span> , <span class="keyword">const</span> <span class="keywordtype">double</span> *), <span class="keywordtype">double</span> xx, <span class="keywordtype">int</span> p, <span class="keyword">const</span> <span class="keywordtype">double</span> *param, <span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b)
00138 {
00139   <span class="keywordtype">int</span> r;
00140   <span class="keywordtype">double</span> sum=0.0;
00141 
00142   xx=fabs(xx);
00143 
00144   <span class="keywordflow">if</span> (xx&gt;0.5) {
00145     <span class="keywordflow">for</span> (r=0; r&lt;p; r++) {
00146       sum+=pow(b,(<span class="keywordtype">double</span>)r)*kernel(0.5-b,r,param)
00147           *(<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,0)+<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,0));
00148     }
00149     <span class="keywordflow">return</span> sum;
00150   }
00151   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((a&lt;=xx) &amp;&amp; (xx&lt;=0.5-b)) {
00152     <span class="keywordflow">return</span> kernel(xx,0,param);
00153   }
00154   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xx&lt;a) {
00155     <span class="keywordflow">for</span> (r=0; r&lt;p; r++) {
00156       sum+=pow(-a,(<span class="keywordtype">double</span>)r)*kernel(a,r,param)
00157           *(<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,xx/a)+<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,-xx/a));
00158     }
00159     <span class="keywordflow">return</span> sum;
00160   }
00161   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((0.5-b&lt;xx) &amp;&amp; (xx&lt;=0.5)) {
00162     <span class="keywordflow">for</span> (r=0; r&lt;p; r++) {
00163       sum+=pow(b,(<span class="keywordtype">double</span>)r)*kernel(0.5-b,r,param)
00164           *(<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,(xx-0.5)/b)+<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,-(xx-0.5)/b));
00165     }
00166     <span class="keywordflow">return</span> sum;
00167   }
00168   <span class="keywordflow">return</span> 0.0;
00169 }
00170 
<a name="l00174"></a><a class="code" href="group__applications__fastsum.html#ga7">00174</a> <span class="keywordtype">double</span> <a class="code" href="group__applications__fastsum.html#ga7">regkern3</a>(complex <span class="keywordtype">double</span> (*kernel)(<span class="keywordtype">double</span> , <span class="keywordtype">int</span> , <span class="keyword">const</span> <span class="keywordtype">double</span> *), <span class="keywordtype">double</span> xx, <span class="keywordtype">int</span> p, <span class="keyword">const</span> <span class="keywordtype">double</span> *param, <span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b)
00175 {
00176   <span class="keywordtype">int</span> r;
00177   <span class="keywordtype">double</span> sum=0.0;
00178 
00179   xx=fabs(xx);
00180 
00181   <span class="keywordflow">if</span> (xx&gt;=0.5) {
00182     <span class="comment">/*return kern(typ,c,0,0.5);*/</span>
00183     xx=0.5;
00184   }
00185   <span class="comment">/* else */</span>
00186   <span class="keywordflow">if</span> ((a&lt;=xx) &amp;&amp; (xx&lt;=0.5-b)) {
00187     <span class="keywordflow">return</span> kernel(xx,0,param);
00188   }
00189   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xx&lt;a) {
00190     <span class="keywordflow">for</span> (r=0; r&lt;p; r++) {
00191       sum+=pow(-a,(<span class="keywordtype">double</span>)r)*kernel(a,r,param)
00192           *(<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,xx/a)+<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,-xx/a));
00193     }
00194     <span class="comment">/*sum=kern(typ,c,0,xx); */</span>
00195     <span class="keywordflow">return</span> sum;
00196   }
00197   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((0.5-b&lt;xx) &amp;&amp; (xx&lt;=0.5)) {
00198     sum=kernel(0.5,0,param)*<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,0,-2.0*xx/b+(1.0-b)/b);
00199     <span class="comment">/* sum=regkern2(typ,c,p,a,b, 0.5)*BasisPoly(p-1,0,-2.0*xx/b+(1.0-b)/b); */</span>
00200     <span class="keywordflow">for</span> (r=0; r&lt;p; r++) {
00201       sum+=pow(b/2.0,(<span class="keywordtype">double</span>)r)
00202           *kernel(0.5-b,r,param)
00203           *<a class="code" href="group__applications__fastsum.html#ga3">BasisPoly</a>(p-1,r,2.0*xx/b-(1.0-b)/b);
00204     }
00205     <span class="keywordflow">return</span> sum;
00206   }
00207   printf(<span class="stringliteral">"hier "</span>);
00208   <span class="keywordflow">return</span> 0.0;
00209 }
00210 
<a name="l00212"></a><a class="code" href="group__applications__fastsum.html#ga8">00212</a> <span class="keywordtype">double</span> <a class="code" href="group__applications__fastsum.html#ga8">kubintkern</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> *Add, <span class="keywordtype">int</span> Ad, <span class="keywordtype">double</span> a)
00213 {
00214   <span class="keywordtype">double</span> c;
00215   <span class="keywordtype">int</span> r;
00216   <span class="keywordtype">double</span> f0,f1,f2,f3,c1,c2,c3,c4;
00217   c=x*Ad/a;
00218   r=c; r=abs(r);
00219   <span class="keywordflow">if</span> (r==0) {f0=Add[r+1];f1=Add[r];f2=Add[r+1];f3=Add[r+2];}
00220   <span class="keywordflow">else</span> { f0=Add[r-1];f1=Add[r];f2=Add[r+1];f3=Add[r+2];}
00221   c=fabs(c);
00222   c1=c-r;
00223   c2=c1+1.0;
00224   c3=c1-1.0;
00225   c4=c1-2.0;
00226   <span class="comment">/* return(-f0*(c-r)*(c-r-1.0)*(c-r-2.0)/6.0+f1*(c-r+1.0)*(c-r-1.0)*(c-r-2.0)/2-</span>
00227 <span class="comment">     f2*(c-r+1.0)*(c-r)*(c-r-2.0)/2+f3*(c-r+1.0)*(c-r)*(c-r-1.0)/6.0); */</span>
00228   <span class="keywordflow">return</span>(-f0*c1*c3*c4/6.0+f1*c2*c3*c4/2.0-f2*c2*c1*c4/2.0+f3*c2*c1*c3/6.0);
00229 }
00230 
<a name="l00232"></a><a class="code" href="group__applications__fastsum.html#ga9">00232</a> <span class="keywordtype">double</span> <a class="code" href="group__applications__fastsum.html#ga9">kubintkern1</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> *Add, <span class="keywordtype">int</span> Ad, <span class="keywordtype">double</span> a)
00233 {
00234   <span class="keywordtype">double</span> c;
00235   <span class="keywordtype">int</span> r;
00236   <span class="keywordtype">double</span> f0,f1,f2,f3,c1,c2,c3,c4;
00237   Add+=2;
00238   c=(x+a)*Ad/2/a;
00239   r=c; r=abs(r);
00240   <span class="comment">/*if (r==0) {f0=Add[r];f1=Add[r];f2=Add[r+1];f3=Add[r+2];}</span>
00241 <span class="comment">  else */</span>
00242   { f0=Add[r-1];f1=Add[r];f2=Add[r+1];f3=Add[r+2];}
00243   c=fabs(c);
00244   c1=c-r;
00245   c2=c1+1.0;
00246   c3=c1-1.0;
00247   c4=c1-2.0;
00248   <span class="comment">/* return(-f0*(c-r)*(c-r-1.0)*(c-r-2.0)/6.0+f1*(c-r+1.0)*(c-r-1.0)*(c-r-2.0)/2-</span>
00249 <span class="comment">     f2*(c-r+1.0)*(c-r)*(c-r-2.0)/2+f3*(c-r+1.0)*(c-r)*(c-r-1.0)/6.0); */</span>
00250   <span class="keywordflow">return</span>(-f0*c1*c3*c4/6.0+f1*c2*c3*c4/2.0-f2*c2*c1*c4/2.0+f3*c2*c1*c3/6.0);
00251 }
00252 
<a name="l00254"></a><a class="code" href="group__applications__fastsum.html#ga10">00254</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__fastsum.html#ga10">quicksort</a>(<span class="keywordtype">int</span> d, <span class="keywordtype">int</span> t, <span class="keywordtype">double</span> *x, complex <span class="keywordtype">double</span> *alpha, <span class="keywordtype">int</span> N)
00255 {
00256   <span class="keywordtype">int</span> lpos=0;
00257   <span class="keywordtype">int</span> rpos=N-1;
00258   <span class="comment">/*double pivot=x[((N-1)/2)*d+t];*/</span>
00259   <span class="keywordtype">double</span> pivot=x[(N/2)*d+t];
00260 
00261   <span class="keywordtype">int</span> k;
00262   <span class="keywordtype">double</span> temp1;
00263   complex <span class="keywordtype">double</span> temp2;
00264 
00265   <span class="keywordflow">while</span> (lpos&lt;=rpos)
00266   {
00267     <span class="keywordflow">while</span> (x[lpos*d+t]&lt;pivot)
00268       lpos++;
00269     <span class="keywordflow">while</span> (x[rpos*d+t]&gt;pivot)
00270       rpos--;
00271     <span class="keywordflow">if</span> (lpos&lt;=rpos)
00272     {
00273       <span class="keywordflow">for</span> (k=0; k&lt;d; k++)
00274       {
00275         temp1=x[lpos*d+k];
00276         x[lpos*d+k]=x[rpos*d+k];
00277         x[rpos*d+k]=temp1;
00278       }
00279       temp2=alpha[lpos];
00280       alpha[lpos]=alpha[rpos];
00281       alpha[rpos]=temp2;
00282 
00283       lpos++;
00284       rpos--;
00285     }
00286   }
00287   <span class="keywordflow">if</span> (0&lt;rpos)
00288     <a class="code" href="group__applications__fastsum.html#ga10">quicksort</a>(d,t,x,alpha,rpos+1);
00289   <span class="keywordflow">if</span> (lpos&lt;N-1)
00290     <a class="code" href="group__applications__fastsum.html#ga10">quicksort</a>(d,t,x+lpos*d,alpha+lpos,N-lpos);
00291 }
00292 
<a name="l00294"></a><a class="code" href="group__applications__fastsum.html#ga11">00294</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__fastsum.html#ga11">BuildTree</a>(<span class="keywordtype">int</span> d, <span class="keywordtype">int</span> t, <span class="keywordtype">double</span> *x, complex <span class="keywordtype">double</span> *alpha, <span class="keywordtype">int</span> N)
00295 {
00296   <span class="keywordflow">if</span> (N&gt;1)
00297   {
00298     <span class="keywordtype">int</span> m=N/2;
00299 
00300     <a class="code" href="group__applications__fastsum.html#ga10">quicksort</a>(d,t,x,alpha,N);
00301 
00302     <a class="code" href="group__applications__fastsum.html#ga11">BuildTree</a>(d, (t+1)%d, x, alpha, m);
00303     <a class="code" href="group__applications__fastsum.html#ga11">BuildTree</a>(d, (t+1)%d, x+(m+1)*d, alpha+(m+1), N-m-1);
00304   }
00305 }
00306 
<a name="l00308"></a><a class="code" href="group__applications__fastsum.html#ga12">00308</a> complex <span class="keywordtype">double</span> <a class="code" href="group__applications__fastsum.html#ga12">SearchTree</a>(<span class="keywordtype">int</span> d, <span class="keywordtype">int</span> t, <span class="keywordtype">double</span> *x, complex <span class="keywordtype">double</span> *alpha, <span class="keywordtype">double</span> *xmin, <span class="keywordtype">double</span> *xmax, <span class="keywordtype">int</span> N, complex <span class="keywordtype">double</span> (*kernel)(<span class="keywordtype">double</span> , <span class="keywordtype">int</span> , <span class="keyword">const</span> <span class="keywordtype">double</span> *), <span class="keyword">const</span> <span class="keywordtype">double</span> *param, <span class="keywordtype">int</span> Ad, <span class="keywordtype">double</span> *Add, <span class="keywordtype">int</span> p, <span class="keywordtype">unsigned</span> flags)
00309 {
00310   <span class="keywordtype">int</span> m=N/2;
00311   <span class="keywordtype">double</span> Min=xmin[t], Max=xmax[t], Median=x[m*d+t];
00312   <span class="keywordtype">double</span> a=fabs(Max-Min)/2;
00313   <span class="keywordtype">int</span> l;
00314   <span class="keywordtype">int</span> E=0;
00315   <span class="keywordtype">double</span> r;
00316   complex <span class="keywordtype">double</span> result=0.0;
00317 
00318   <span class="keywordflow">if</span> (N==0)
00319     <span class="keywordflow">return</span> 0.0;
00320 
00321   <span class="keywordflow">if</span> (Min&gt;Median)
00322     result += <a class="code" href="group__applications__fastsum.html#ga12">SearchTree</a>(d,(t+1)%d,x+(m+1)*d,alpha+(m+1),xmin,xmax,N-m-1,kernel,param,Ad,Add,p,flags);
00323   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Max&lt;Median)
00324     result += <a class="code" href="group__applications__fastsum.html#ga12">SearchTree</a>(d,(t+1)%d,x,alpha,xmin,xmax,m,kernel,param,Ad,Add,p,flags);
00325   <span class="keywordflow">else</span>
00326   {
00327     E=0;
00328     <span class="keywordflow">for</span> (l=0; l&lt;d; l++)
00329     {
00330       <span class="keywordflow">if</span> ( x[m*d+l]&gt;xmin[l] &amp;&amp; x[m*d+l]&lt;xmax[l] )
00331         E++;
00332     }
00333     <span class="keywordflow">if</span> (E==d)
00334     {
00335       <span class="keywordflow">if</span> (d==1)
00336         r = xmin[0]+a-x[m];  <span class="comment">/* remember: xmin+a = y */</span>
00337       <span class="keywordflow">else</span>
00338       {
00339         r=0.0;
00340         <span class="keywordflow">for</span> (l=0; l&lt;d; l++)
00341           r+=(xmin[l]+a-x[m*d+l])*(xmin[l]+a-x[m*d+l]);  <span class="comment">/* remember: xmin+a = y */</span>
00342         r=sqrt(r);
00343       }
00344       <span class="keywordflow">if</span> (fabs(r)&lt;a)
00345       {
00346         result += alpha[m]*kernel(r,0,param);                         <span class="comment">/* alpha*(kern-regkern) */</span>
00347         <span class="keywordflow">if</span> (d==1)
00348         {
00349           <span class="keywordflow">if</span> (flags &amp; <a class="code" href="group__applications__fastsum.html#ga31">EXACT_NEARFIELD</a>)
00350             result -= alpha[m]*<a class="code" href="group__applications__fastsum.html#ga5">regkern1</a>(kernel,r,p,param,a,1.0/16.0); <span class="comment">/* exact value (in 1D)  */</span>
00351           <span class="keywordflow">else</span>
00352             result -= alpha[m]*<a class="code" href="group__applications__fastsum.html#ga9">kubintkern1</a>(r,Add,Ad,a);               <span class="comment">/* spline approximation */</span>
00353         }
00354         <span class="keywordflow">else</span>
00355         {
00356           <span class="keywordflow">if</span> (flags &amp; <a class="code" href="group__applications__fastsum.html#ga31">EXACT_NEARFIELD</a>)
00357             result -= alpha[m]*<a class="code" href="group__applications__fastsum.html#ga4">regkern</a>(kernel,r,p,param,a,1.0/16.0);  <span class="comment">/* exact value (in dD)  */</span>
00358           <span class="keywordflow">else</span>
00359             result -= alpha[m]*<a class="code" href="group__applications__fastsum.html#ga8">kubintkern</a>(r,Add,Ad,a);                <span class="comment">/* spline approximation */</span>
00360         }
00361       }
00362     }
00363     result += <a class="code" href="group__applications__fastsum.html#ga12">SearchTree</a>(d,(t+1)%d,x+(m+1)*d,alpha+(m+1),xmin,xmax,N-m-1,kernel,param,Ad,Add,p,flags);
00364     result += <a class="code" href="group__applications__fastsum.html#ga12">SearchTree</a>(d,(t+1)%d,x,alpha,xmin,xmax,m,kernel,param,Ad,Add,p,flags);
00365   }
00366   <span class="keywordflow">return</span> result;
00367 }
00368 
<a name="l00370"></a><a class="code" href="group__applications__fastsum.html#ga13">00370</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__fastsum.html#ga13">fastsum_init_guru</a>(<a class="code" href="structfastsum__plan__.html">fastsum_plan</a> *ths, <span class="keywordtype">int</span> d, <span class="keywordtype">int</span> N_total, <span class="keywordtype">int</span> M_total, complex <span class="keywordtype">double</span> (*kernel)(), <span class="keywordtype">double</span> *param, <span class="keywordtype">unsigned</span> flags, <span class="keywordtype">int</span> nn, <span class="keywordtype">int</span> m, <span class="keywordtype">int</span> p, <span class="keywordtype">double</span> eps_I, <span class="keywordtype">double</span> eps_B)
00371 {
00372   <span class="keywordtype">int</span> t;
00373   <span class="keywordtype">int</span> N[d], n[d];
00374   <span class="keywordtype">int</span> n_total;
00375 
00376   ths-&gt;d = d;
00377 
00378   ths-&gt;N_total = N_total;
00379   ths-&gt;M_total = M_total;
00380 
00381   ths-&gt;x = (<span class="keywordtype">double</span> *)malloc(d*N_total*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00382   ths-&gt;alpha = (complex <span class="keywordtype">double</span> *)malloc(N_total*(<span class="keyword">sizeof</span>(complex <span class="keywordtype">double</span>)));
00383 
00384   ths-&gt;y = (<span class="keywordtype">double</span> *)malloc(d*M_total*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00385   ths-&gt;f = (complex <span class="keywordtype">double</span> *)malloc(M_total*(<span class="keyword">sizeof</span>(complex <span class="keywordtype">double</span>)));
00386 
00387   ths-&gt;kernel = kernel;
00388   ths-&gt;kernel_param = param;
00389 
00390   ths-&gt;flags = flags;
00391 
00392   ths-&gt;p = p;
00393   ths-&gt;eps_I = eps_I; <span class="comment">/* =(double)ths-&gt;p/(double)nn; */</span>  
00394   ths-&gt;eps_B = eps_B; <span class="comment">/* =1.0/16.0; */</span>                   
00397   <span class="keywordflow">if</span> (!(ths-&gt;flags &amp; <a class="code" href="group__applications__fastsum.html#ga31">EXACT_NEARFIELD</a>))
00398   {
00399     <span class="keywordflow">if</span> (ths-&gt;d==1)
00400     {
00401       ths-&gt;Ad = 4*(ths-&gt;p)*(ths-&gt;p);
00402       ths-&gt;Add = (<span class="keywordtype">double</span> *)malloc((ths-&gt;Ad+5)*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00403     }
00404     <span class="keywordflow">else</span>
00405     {
00406       ths-&gt;Ad = 2*(ths-&gt;p)*(ths-&gt;p);
00407       ths-&gt;Add = (<span class="keywordtype">double</span> *)malloc((ths-&gt;Ad+3)*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00408     }
00409   }
00410 
00412   ths-&gt;n = nn;
00413   <span class="keywordflow">for</span> (t=0; t&lt;d; t++)
00414   {
00415     N[t] = nn;
00416     n[t] = 2*nn;
00417   }
00418   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;(ths-&gt;mv1), d, N, N_total, n, m,
00419                    <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>| <a class="code" href="group__nfft.html#ga22">MALLOC_X</a> | <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>| <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>| <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a> | <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00420                    FFTW_MEASURE| FFTW_DESTROY_INPUT);
00421   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;(ths-&gt;mv2), d, N, M_total, n, m,
00422                    <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>| <a class="code" href="group__nfft.html#ga22">MALLOC_X</a> | <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>| <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>| <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a> | <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00423                    FFTW_MEASURE| FFTW_DESTROY_INPUT);
00424 
00426   n_total = 1;
00427   <span class="keywordflow">for</span> (t=0; t&lt;d; t++)
00428     n_total *= nn;
00429 
00430   ths-&gt;b = (fftw_complex *)fftw_malloc(n_total*<span class="keyword">sizeof</span>(fftw_complex));
00431   ths-&gt;fft_plan = fftw_plan_dft(d,N,ths-&gt;b,ths-&gt;b,FFTW_FORWARD,FFTW_ESTIMATE);
00432 
00433 }
00434 
<a name="l00436"></a><a class="code" href="group__applications__fastsum.html#ga14">00436</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__fastsum.html#ga14">fastsum_finalize</a>(<a class="code" href="structfastsum__plan__.html">fastsum_plan</a> *ths)
00437 {
00438   free(ths-&gt;x);
00439   free(ths-&gt;alpha);
00440   free(ths-&gt;y);
00441   free(ths-&gt;f);
00442 
00443   <span class="keywordflow">if</span> (!(ths-&gt;flags &amp; <a class="code" href="group__applications__fastsum.html#ga31">EXACT_NEARFIELD</a>))
00444     free(ths-&gt;Add);
00445 
00446   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;(ths-&gt;mv1));
00447   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;(ths-&gt;mv2));
00448 
00449   fftw_destroy_plan(ths-&gt;fft_plan);
00450   fftw_free(ths-&gt;b);
00451 }
00452 
<a name="l00454"></a><a class="code" href="group__applications__fastsum.html#ga15">00454</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__fastsum.html#ga15">fastsum_exact</a>(<a class="code" href="structfastsum__plan__.html">fastsum_plan</a> *ths)
00455 {
00456   <span class="keywordtype">int</span> j,k;
00457   <span class="keywordtype">int</span> t;
00458   <span class="keywordtype">double</span> r;
00459 
00460   <span class="keywordflow">for</span> (j=0; j&lt;ths-&gt;M_total; j++)
00461   {
00462     ths-&gt;f[j]=0.0;
00463     <span class="keywordflow">for</span> (k=0; k&lt;ths-&gt;N_total; k++)
00464     {
00465       <span class="keywordflow">if</span> (ths-&gt;d==1)
00466         r = ths-&gt;y[j] - ths-&gt;x[k];
00467       <span class="keywordflow">else</span>
00468       {
00469         r=0.0;
00470         <span class="keywordflow">for</span> (t=0; t&lt;ths-&gt;d; t++)
00471           r += (ths-&gt;y[j*ths-&gt;d+t]-ths-&gt;x[k*ths-&gt;d+t])*(ths-&gt;y[j*ths-&gt;d+t]-ths-&gt;x[k*ths-&gt;d+t]);
00472         r=sqrt(r);
00473       }
00474       ths-&gt;f[j] += ths-&gt;alpha[k] * ths-&gt;kernel(r,0,ths-&gt;kernel_param);
00475     }
00476   }
00477 }
00478 
<a name="l00480"></a><a class="code" href="group__applications__fastsum.html#ga16">00480</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__fastsum.html#ga16">fastsum_precompute</a>(<a class="code" href="structfastsum__plan__.html">fastsum_plan</a> *ths)
00481 {
00482   <span class="keywordtype">int</span> j,k,t;
00483   <span class="keywordtype">int</span> n_total;
00484 
00486   <a class="code" href="group__applications__fastsum.html#ga11">BuildTree</a>(ths-&gt;d,0,ths-&gt;x,ths-&gt;alpha,ths-&gt;N_total);
00487 
00489   <span class="keywordflow">if</span> (!(ths-&gt;flags &amp; <a class="code" href="group__applications__fastsum.html#ga31">EXACT_NEARFIELD</a>))
00490   {
00491     <span class="keywordflow">if</span> (ths-&gt;d==1)
00492       <span class="keywordflow">for</span> (k=-ths-&gt;Ad/2-2; k &lt;= ths-&gt;Ad/2+2; k++)
00493         ths-&gt;Add[k+ths-&gt;Ad/2+2] = <a class="code" href="group__applications__fastsum.html#ga5">regkern1</a>(ths-&gt;kernel, ths-&gt;eps_I*(<span class="keywordtype">double</span>)k/ths-&gt;Ad*2, ths-&gt;p, ths-&gt;kernel_param, ths-&gt;eps_I, ths-&gt;eps_B);
00494     <span class="keywordflow">else</span>
00495       <span class="keywordflow">for</span> (k=0; k &lt;= ths-&gt;Ad+2; k++)
00496         ths-&gt;Add[k] = <a class="code" href="group__applications__fastsum.html#ga7">regkern3</a>(ths-&gt;kernel, ths-&gt;eps_I*(<span class="keywordtype">double</span>)k/ths-&gt;Ad, ths-&gt;p, ths-&gt;kernel_param, ths-&gt;eps_I, ths-&gt;eps_B);
00497   }
00498 
00500   <span class="keywordflow">for</span> (k=0; k&lt;ths-&gt;mv1.M_total; k++)
00501     <span class="keywordflow">for</span> (t=0; t&lt;ths-&gt;mv1.d; t++)
00502       ths-&gt;mv1.x[ths-&gt;mv1.d*k+t] = - ths-&gt;x[ths-&gt;mv1.d*k+t];  <span class="comment">/* note the factor -1 for transposed transform instead of adjoint*/</span>
00503 
00505   <span class="keywordflow">if</span>(ths-&gt;mv1.nfft_flags &amp; <a class="code" href="group__nfft.html#ga18">PRE_LIN_PSI</a>)
00506     <a class="code" href="group__nfft.html#ga13">nfft_precompute_lin_psi</a>(&amp;(ths-&gt;mv1));
00507 
00508   <span class="keywordflow">if</span>(ths-&gt;mv1.nfft_flags &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00509     <a class="code" href="group__nfft.html#ga12">nfft_precompute_psi</a>(&amp;(ths-&gt;mv1));
00510 
00511   <span class="keywordflow">if</span>(ths-&gt;mv1.nfft_flags &amp; <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>)
00512     <a class="code" href="group__nfft.html#ga11">nfft_precompute_full_psi</a>(&amp;(ths-&gt;mv1));
00513 
00515   <span class="keywordflow">for</span>(k=0; k&lt;ths-&gt;mv1.M_total;k++)
00516     ths-&gt;mv1.f[k] = ths-&gt;alpha[k];
00517 
00519   <span class="keywordflow">for</span> (j=0; j&lt;ths-&gt;mv2.M_total; j++)
00520     <span class="keywordflow">for</span> (t=0; t&lt;ths-&gt;mv2.d; t++)
00521       ths-&gt;mv2.x[ths-&gt;mv2.d*j+t] = - ths-&gt;y[ths-&gt;mv2.d*j+t];  <span class="comment">/* note the factor -1 for conjugated transform instead of standard*/</span>
00522 
00524   <span class="keywordflow">if</span>(ths-&gt;mv2.nfft_flags &amp; <a class="code" href="group__nfft.html#ga18">PRE_LIN_PSI</a>)
00525     <a class="code" href="group__nfft.html#ga13">nfft_precompute_lin_psi</a>(&amp;(ths-&gt;mv2));
00526 
00527   <span class="keywordflow">if</span>(ths-&gt;mv2.nfft_flags &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00528     <a class="code" href="group__nfft.html#ga12">nfft_precompute_psi</a>(&amp;(ths-&gt;mv2));
00529 
00530   <span class="keywordflow">if</span>(ths-&gt;mv2.nfft_flags &amp; <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>)
00531     <a class="code" href="group__nfft.html#ga11">nfft_precompute_full_psi</a>(&amp;(ths-&gt;mv2));
00532 
00533 
00535   n_total = 1;
00536   <span class="keywordflow">for</span> (t=0; t&lt;ths-&gt;d; t++)
00537     n_total *= ths-&gt;n;
00538 
00539   <span class="keywordflow">for</span> (j=0; j&lt;n_total; j++)
00540   {
00541     <span class="keywordflow">if</span> (ths-&gt;d==1)
00542       ths-&gt;b[j] = <a class="code" href="group__applications__fastsum.html#ga5">regkern1</a>(ths-&gt;kernel, (<span class="keywordtype">double</span>)j / (ths-&gt;n) - 0.5, ths-&gt;p, ths-&gt;kernel_param, ths-&gt;eps_I, ths-&gt;eps_B)/n_total;
00543     <span class="keywordflow">else</span>
00544     {
00545       k=j;
00546       ths-&gt;b[j]=0.0;
00547       <span class="keywordflow">for</span> (t=0; t&lt;ths-&gt;d; t++)
00548       {
00549         ths-&gt;b[j] += ((double)(k % (ths-&gt;n)) / (ths-&gt;n) - 0.5) * ((double)(k % (ths-&gt;n)) / (ths-&gt;n) - 0.5);
00550         k = k / (ths-&gt;n);
00551       }
00552       ths-&gt;b[j] = <a class="code" href="group__applications__fastsum.html#ga7">regkern3</a>(ths-&gt;kernel, sqrt(ths-&gt;b[j]), ths-&gt;p, ths-&gt;kernel_param, ths-&gt;eps_I, ths-&gt;eps_B)/n_total;
00553     }
00554   }
00555 
00556   <a class="code" href="group__nfftutil.html#ga36">nfft_fftshift_complex</a>(ths-&gt;b, ths-&gt;mv1.d, ths-&gt;mv1.N);
00557   fftw_execute(ths-&gt;fft_plan);
00558   <a class="code" href="group__nfftutil.html#ga36">nfft_fftshift_complex</a>(ths-&gt;b, ths-&gt;mv1.d, ths-&gt;mv1.N);
00559 
00560 }
00561 
<a name="l00563"></a><a class="code" href="group__applications__fastsum.html#ga17">00563</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__fastsum.html#ga17">fastsum_trafo</a>(<a class="code" href="structfastsum__plan__.html">fastsum_plan</a> *ths)
00564 {
00565   <span class="keywordtype">int</span> j,k,t;
00566   <span class="keywordtype">double</span> *ymin, *ymax;   
00568   ymin = (<span class="keywordtype">double</span> *)malloc(ths-&gt;d*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00569   ymax = (<span class="keywordtype">double</span> *)malloc(ths-&gt;d*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00570 
00572   <a class="code" href="group__nfft.html#ga3">nfft_adjoint</a>(&amp;(ths-&gt;mv1));
00573 
00575   <span class="keywordflow">for</span> (k=0; k&lt;ths-&gt;mv2.N_total; k++)
00576     ths-&gt;mv2.f_hat[k] = ths-&gt;b[k] * ths-&gt;mv1.f_hat[k];
00577 
00579   <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;(ths-&gt;mv2));
00580 
00582   <span class="keywordflow">for</span> (j=0; j&lt;ths-&gt;M_total; j++)
00583   {
00584     <span class="keywordflow">for</span> (t=0; t&lt;ths-&gt;d; t++)
00585     {
00586       ymin[t] = ths-&gt;y[ths-&gt;d*j+t] - ths-&gt;eps_I;
00587       ymax[t] = ths-&gt;y[ths-&gt;d*j+t] + ths-&gt;eps_I;
00588     }
00589     ths-&gt;f[j] = ths-&gt;mv2.f[j] + <a class="code" href="group__applications__fastsum.html#ga12">SearchTree</a>(ths-&gt;d,0, ths-&gt;x, ths-&gt;alpha, ymin, ymax, ths-&gt;N_total, ths-&gt;kernel, ths-&gt;kernel_param, ths-&gt;Ad, ths-&gt;Add, ths-&gt;p, ths-&gt;flags);
00590     <span class="comment">/* ths-&gt;f[j] = ths-&gt;mv2.f[j]; */</span>
00591     <span class="comment">/* ths-&gt;f[j] = SearchTree(ths-&gt;d,0, ths-&gt;x, ths-&gt;alpha, ymin, ymax, ths-&gt;N_total, ths-&gt;kernel, ths-&gt;kernel_param, ths-&gt;Ad, ths-&gt;Add, ths-&gt;p, ths-&gt;flags); */</span>
00592   }
00593 }
00594 <span class="comment">/* \} */</span>
00595 
00596 <span class="comment">/* fastsum.c */</span>
</pre></div>    <hr size="1"/>
    Generated on 22 Jan 2007 by Doxygen 1.4.1
  </body>
</html>
