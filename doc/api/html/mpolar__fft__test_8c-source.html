<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.2 API Reference - NFFT: mpolar_fft_test.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.2 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000006.html">applications</a>&nbsp;/&nbsp;<a class="el" href="dir_000013.html">polarFFT</a></div>
<h1>mpolar_fft_test.c</h1><a href="mpolar__fft__test_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00010 <span class="preprocessor">#include &lt;math.h&gt;</span>
00011 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00012 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00014 
00021 <span class="keywordtype">double</span> GLOBAL_elapsed_time;
00022 
<a name="l00036"></a><a class="code" href="group__applications__polarFFT__mpolar.html#ga1">00036</a> <span class="keywordtype">int</span> <a class="code" href="group__applications__polarFFT__mpolar.html#ga1">mpolar_grid</a>(<span class="keywordtype">int</span> T, <span class="keywordtype">int</span> R, <span class="keywordtype">double</span> *x, <span class="keywordtype">double</span> *w)
00037 {
00038   <span class="keywordtype">int</span> t, r;
00039   <span class="keywordtype">double</span> W;
00040   <span class="keywordtype">int</span> R2=2*ceil(sqrt(2)*R/2);
00041   <span class="keywordtype">double</span> xx, yy;
00042   <span class="keywordtype">int</span> M=0;
00043 
00044   <span class="keywordflow">for</span>(t=-T/2; t&lt;T/2; t++)
00045   {
00046     <span class="keywordflow">for</span>(r=-R2/2; r&lt;R2/2; r++)
00047     {
00048       xx = (double)r/R*cos(<a class="code" href="group__nfftutil.html#ga57">PI</a>*t/T);
00049       yy = (double)r/R*sin(<a class="code" href="group__nfftutil.html#ga57">PI</a>*t/T);
00050 
00051       <span class="keywordflow">if</span> ( ((-0.5-1.0/(<span class="keywordtype">double</span>)R)&lt;=xx) &amp; (xx&lt;=(0.5+1.0/(<span class="keywordtype">double</span>)R)) &amp; 
00052         ((-0.5-1.0/(<span class="keywordtype">double</span>)R)&lt;=yy) &amp; (yy&lt;=(0.5+1.0/(<span class="keywordtype">double</span>)R)) )
00053       {
00054         x[2*M+0] = xx;
00055         x[2*M+1] = yy;
00056 
00057         <span class="keywordflow">if</span> (r==0)
00058           w[M] = 1.0/4.0;
00059         <span class="keywordflow">else</span>
00060           w[M] = fabs((<span class="keywordtype">double</span>)r);
00061 
00062         M++; 
00063       }
00064     }
00065   }
00066 
00068    W=0.0;
00069    <span class="keywordflow">for</span> (t=0; t&lt;M; t++)
00070       W+=w[t];
00071 
00072    <span class="keywordflow">for</span> (t=0; t&lt;M; t++)
00073     w[t]/=W;
00074 
00075   <span class="keywordflow">return</span> M;                             
00076 }
00077 
<a name="l00079"></a><a class="code" href="group__applications__polarFFT__mpolar.html#ga2">00079</a> <span class="keywordtype">int</span> <a class="code" href="group__applications__polarFFT__mpolar.html#ga2">mpolar_dft</a>(fftw_complex *f_hat, <span class="keywordtype">int</span> NN, fftw_complex *f, <span class="keywordtype">int</span> T, <span class="keywordtype">int</span> R, <span class="keywordtype">int</span> m)
00080 {
00081   <span class="keywordtype">int</span> j,k;                              
00082   <a class="code" href="structnfft__plan.html">nfft_plan</a> my_nfft_plan;               
00084   <span class="keywordtype">double</span> *x, *w;                        
00086   <span class="keywordtype">int</span> N[2],n[2];
00087   <span class="keywordtype">int</span> M;                                
00089   N[0]=NN; n[0]=2*N[0];                 
00090   N[1]=NN; n[1]=2*N[1];                 
00092   x = (<span class="keywordtype">double</span> *)malloc(2*1.25*T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00093   <span class="keywordflow">if</span> (x==NULL)
00094     <span class="keywordflow">return</span> -1;
00095 
00096   w = (<span class="keywordtype">double</span> *)malloc(1.25*T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00097   <span class="keywordflow">if</span> (w==NULL)
00098     <span class="keywordflow">return</span> -1;
00099 
00101   M=<a class="code" href="group__applications__polarFFT__mpolar.html#ga1">mpolar_grid</a>(T,R,x,w);
00102   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;my_nfft_plan, 2, N, M, n, m,
00103                   <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>| <a class="code" href="group__nfft.html#ga22">MALLOC_X</a> | <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>| <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>| <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a> | <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00104                   FFTW_MEASURE| FFTW_DESTROY_INPUT);
00105 
00107   <span class="keywordflow">for</span>(j=0;j&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++)
00108   {
00109     my_nfft_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+0] = x[2*j+0];
00110     my_nfft_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+1] = x[2*j+1];
00111   }
00112 
00114   <span class="keywordflow">for</span>(k=0;k&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o0">N_total</a>;k++)
00115     my_nfft_plan.<a class="code" href="structnfft__plan.html#o2">f_hat</a>[k] = f_hat[k];
00116 
00117   GLOBAL_elapsed_time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00118 
00120   <a class="code" href="group__nfft.html#ga0">ndft_trafo</a>(&amp;my_nfft_plan);
00121 
00122   GLOBAL_elapsed_time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-GLOBAL_elapsed_time;
00123 
00125   <span class="keywordflow">for</span>(j=0;j&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++)
00126     f[j] = my_nfft_plan.<a class="code" href="structnfft__plan.html#o3">f</a>[j];
00127 
00129   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;my_nfft_plan);
00130   free(x);
00131   free(w);
00132 
00133   <span class="keywordflow">return</span> EXIT_SUCCESS;
00134 }
00135 
<a name="l00137"></a><a class="code" href="group__applications__polarFFT__mpolar.html#ga3">00137</a> <span class="keywordtype">int</span> <a class="code" href="group__applications__polarFFT__mpolar.html#ga3">mpolar_fft</a>(fftw_complex *f_hat, <span class="keywordtype">int</span> NN, fftw_complex *f, <span class="keywordtype">int</span> T, <span class="keywordtype">int</span> R, <span class="keywordtype">int</span> m)
00138 {
00139   <span class="keywordtype">int</span> j,k;                              
00140   <a class="code" href="structnfft__plan.html">nfft_plan</a> my_nfft_plan;               
00142   <span class="keywordtype">double</span> *x, *w;                        
00144   <span class="keywordtype">int</span> N[2],n[2];
00145   <span class="keywordtype">int</span> M;                                
00147   N[0]=NN; n[0]=2*N[0];                 
00148   N[1]=NN; n[1]=2*N[1];                 
00150   x = (<span class="keywordtype">double</span> *)malloc(2*1.25*T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00151   <span class="keywordflow">if</span> (x==NULL)
00152     <span class="keywordflow">return</span> -1;
00153 
00154   w = (<span class="keywordtype">double</span> *)malloc(1.25*T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00155   <span class="keywordflow">if</span> (w==NULL)
00156     <span class="keywordflow">return</span> -1;
00157 
00159   M=<a class="code" href="group__applications__polarFFT__mpolar.html#ga1">mpolar_grid</a>(T,R,x,w);
00160   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;my_nfft_plan, 2, N, M, n, m,
00161                   <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>| <a class="code" href="group__nfft.html#ga22">MALLOC_X</a> | <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>| <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>| <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a> | <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00162                   FFTW_MEASURE| FFTW_DESTROY_INPUT);
00163 
00166   <span class="keywordflow">for</span>(j=0;j&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++)
00167   {
00168     my_nfft_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+0] = x[2*j+0];
00169     my_nfft_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+1] = x[2*j+1];
00170   }
00171 
00173   <span class="keywordflow">if</span>(my_nfft_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga18">PRE_LIN_PSI</a>)
00174     <a class="code" href="group__nfft.html#ga13">nfft_precompute_lin_psi</a>(&amp;my_nfft_plan);
00175 
00176   <span class="keywordflow">if</span>(my_nfft_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00177     <a class="code" href="group__nfft.html#ga12">nfft_precompute_psi</a>(&amp;my_nfft_plan);
00178 
00179   <span class="keywordflow">if</span>(my_nfft_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>)
00180     <a class="code" href="group__nfft.html#ga11">nfft_precompute_full_psi</a>(&amp;my_nfft_plan);
00181 
00183   <span class="keywordflow">for</span>(k=0;k&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o0">N_total</a>;k++)
00184     my_nfft_plan.<a class="code" href="structnfft__plan.html#o2">f_hat</a>[k] = f_hat[k];
00185 
00186   GLOBAL_elapsed_time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00187 
00189   <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;my_nfft_plan);
00190 
00191   GLOBAL_elapsed_time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-GLOBAL_elapsed_time;
00192 
00194   <span class="keywordflow">for</span>(j=0;j&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++)
00195     f[j] = my_nfft_plan.<a class="code" href="structnfft__plan.html#o3">f</a>[j];
00196 
00198   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;my_nfft_plan);
00199   free(x);
00200   free(w);
00201 
00202   <span class="keywordflow">return</span> EXIT_SUCCESS;
00203 }
00204 
<a name="l00206"></a><a class="code" href="group__applications__polarFFT__mpolar.html#ga4">00206</a> <span class="keywordtype">int</span> <a class="code" href="group__applications__polarFFT__mpolar.html#ga4">inverse_mpolar_fft</a>(fftw_complex *f, <span class="keywordtype">int</span> T, <span class="keywordtype">int</span> R, fftw_complex *f_hat, <span class="keywordtype">int</span> NN, <span class="keywordtype">int</span> max_i, <span class="keywordtype">int</span> m)
00207 {
00208   <span class="keywordtype">int</span> j,k;                              
00209   <a class="code" href="structnfft__plan.html">nfft_plan</a> my_nfft_plan;               
00210   <a class="code" href="structinfft__plan.html">infft_plan</a> my_infft_plan;             
00212   <span class="keywordtype">double</span> *x, *w;                        
00213   <span class="keywordtype">int</span> l;                                
00215   <span class="keywordtype">int</span> N[2],n[2];
00216   <span class="keywordtype">int</span> M;                                
00218   N[0]=NN; n[0]=2*N[0];                 
00219   N[1]=NN; n[1]=2*N[1];                 
00221   x = (<span class="keywordtype">double</span> *)malloc(2*1.25*T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00222   <span class="keywordflow">if</span> (x==NULL)
00223     <span class="keywordflow">return</span> -1;
00224 
00225   w = (<span class="keywordtype">double</span> *)malloc(1.25*T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00226   <span class="keywordflow">if</span> (w==NULL)
00227     <span class="keywordflow">return</span> -1;
00228 
00230   M=<a class="code" href="group__applications__polarFFT__mpolar.html#ga1">mpolar_grid</a>(T,R,x,w);
00231   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;my_nfft_plan, 2, N, M, n, m,
00232                   <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>| <a class="code" href="group__nfft.html#ga22">MALLOC_X</a> | <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>| <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>| <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a> | <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00233                   FFTW_MEASURE| FFTW_DESTROY_INPUT);
00234 
00236     <a class="code" href="group__solver.html#ga1">infft_init_advanced</a>(&amp;my_infft_plan,&amp;my_nfft_plan, <a class="code" href="group__solver.html#ga37">CGNR</a> | <a class="code" href="group__solver.html#ga40">PRECOMPUTE_WEIGHT</a> );
00237 
00239   <span class="keywordflow">for</span>(j=0;j&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++)
00240   {
00241     my_nfft_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+0] = x[2*j+0];
00242     my_nfft_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+1] = x[2*j+1];
00243     my_infft_plan.<a class="code" href="structinfft__plan.html#o4">y</a>[j]    = f[j];
00244     my_infft_plan.<a class="code" href="structinfft__plan.html#o2">w</a>[j]    = w[j]; 
00245   }
00246 
00248   <span class="keywordflow">if</span>(my_nfft_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga18">PRE_LIN_PSI</a>)
00249     <a class="code" href="group__nfft.html#ga13">nfft_precompute_lin_psi</a>(&amp;my_nfft_plan);
00250 
00251   <span class="keywordflow">if</span>(my_nfft_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00252     <a class="code" href="group__nfft.html#ga12">nfft_precompute_psi</a>(&amp;my_nfft_plan);
00253 
00254   <span class="keywordflow">if</span>(my_nfft_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>)
00255     <a class="code" href="group__nfft.html#ga11">nfft_precompute_full_psi</a>(&amp;my_nfft_plan);
00256 
00257 
00259  <span class="keywordflow">if</span>(my_infft_plan.<a class="code" href="structinfft__plan.html#o1">flags</a> &amp; <a class="code" href="group__solver.html#ga41">PRECOMPUTE_DAMP</a>)
00260    <span class="keywordflow">for</span>(j=0;j&lt;my_infft_plan.<a class="code" href="structinfft__plan.html#o0">mv</a>-&gt;<a class="code" href="structnfft__plan.html#o5">N</a>[0];j++)
00261      <span class="keywordflow">for</span>(k=0;k&lt;my_infft_plan.<a class="code" href="structinfft__plan.html#o0">mv</a>-&gt;<a class="code" href="structnfft__plan.html#o5">N</a>[1];k++)
00262      {
00263         my_infft_plan.<a class="code" href="structinfft__plan.html#o3">w_hat</a>[j*my_infft_plan.<a class="code" href="structinfft__plan.html#o0">mv</a>-&gt;<a class="code" href="structnfft__plan.html#o5">N</a>[1]+k]=
00264           (sqrt(pow(j-my_infft_plan.<a class="code" href="structinfft__plan.html#o0">mv</a>-&gt;<a class="code" href="structnfft__plan.html#o5">N</a>[0]/2,2)+pow(k-my_infft_plan.<a class="code" href="structinfft__plan.html#o0">mv</a>-&gt;<a class="code" href="structnfft__plan.html#o5">N</a>[1]/2,2))&gt;(my_infft_plan.<a class="code" href="structinfft__plan.html#o0">mv</a>-&gt;<a class="code" href="structnfft__plan.html#o5">N</a>[0]/2)?0:1);
00265      }
00266 
00268   <span class="keywordflow">for</span>(k=0;k&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o0">N_total</a>;k++)
00269       my_infft_plan.<a class="code" href="structinfft__plan.html#o5">f_hat_iter</a>[k] = 0.0 + I*0.0; 
00270 
00271   GLOBAL_elapsed_time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00272 
00274   <a class="code" href="group__solver.html#ga2">infft_before_loop</a>(&amp;my_infft_plan);
00275 
00276   <span class="keywordflow">if</span> (max_i&lt;1)
00277   {
00278     l=1;
00279     <span class="keywordflow">for</span>(k=0;k&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o0">N_total</a>;k++)
00280       my_infft_plan.<a class="code" href="structinfft__plan.html#o5">f_hat_iter</a>[k] = my_infft_plan.<a class="code" href="structinfft__plan.html#o8">p_hat_iter</a>[k];
00281   }
00282   <span class="keywordflow">else</span>
00283   {
00284     <span class="keywordflow">for</span>(l=1;l&lt;=max_i;l++)
00285     {
00286       <a class="code" href="group__solver.html#ga3">infft_loop_one_step</a>(&amp;my_infft_plan);
00287     }
00288   }
00289 
00290   GLOBAL_elapsed_time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-GLOBAL_elapsed_time;
00291 
00293   <span class="keywordflow">for</span>(k=0;k&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o0">N_total</a>;k++)
00294     f_hat[k] = my_infft_plan.<a class="code" href="structinfft__plan.html#o5">f_hat_iter</a>[k];
00295 
00297   <a class="code" href="group__solver.html#ga4">infft_finalize</a>(&amp;my_infft_plan);
00298   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;my_nfft_plan);
00299   free(x);
00300   free(w);
00301 
00302   <span class="keywordflow">return</span> EXIT_SUCCESS;
00303 }
00304 
<a name="l00306"></a><a class="code" href="group__applications__polarFFT__mpolar.html#ga5">00306</a> <span class="keywordtype">int</span> <a class="code" href="group__applications__polarFFT__linogramm.html#ga5">comparison_fft</a>(FILE *fp, <span class="keywordtype">int</span> N, <span class="keywordtype">int</span> T, <span class="keywordtype">int</span> R)
00307 {
00308   fftw_plan my_fftw_plan;
00309   fftw_complex *f_hat,*f;
00310   <span class="keywordtype">int</span> m,k;
00311   <span class="keywordtype">double</span> t_fft, t_dft_mpolar;
00312 
00313   f_hat = (fftw_complex *)fftw_malloc(<span class="keyword">sizeof</span>(fftw_complex)*N*N);
00314   f     = (fftw_complex *)fftw_malloc(<span class="keyword">sizeof</span>(fftw_complex)*(T*R/4)*5);
00315 
00316   my_fftw_plan = fftw_plan_dft_2d(N,N,f_hat,f,FFTW_BACKWARD,FFTW_MEASURE);
00317 
00318   <span class="keywordflow">for</span>(k=0; k&lt;N*N; k++)
00319     f_hat[k] = (((double)rand())/RAND_MAX) + I* (((double)rand())/RAND_MAX);
00320   
00321   GLOBAL_elapsed_time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00322   <span class="keywordflow">for</span>(m=0;m&lt;65536/N;m++)
00323     {
00324       fftw_execute(my_fftw_plan);
00325       <span class="comment">/* touch */</span>
00326       f_hat[2]=2*f_hat[0];
00327     }
00328   GLOBAL_elapsed_time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-GLOBAL_elapsed_time;
00329   t_fft=N*GLOBAL_elapsed_time/65536;
00330 
00331   <span class="keywordflow">if</span>(N&lt;256)
00332     {
00333       <a class="code" href="group__applications__polarFFT__mpolar.html#ga2">mpolar_dft</a>(f_hat,N,f,T,R,m);
00334       t_dft_mpolar=GLOBAL_elapsed_time;
00335     }
00336       
00337   <span class="keywordflow">for</span> (m=3; m&lt;=9; m+=3)
00338     {
00339       <span class="keywordflow">if</span>((m==3)&amp;&amp;(N&lt;256))
00340         fprintf(fp,<span class="stringliteral">"%d\t&amp;\t&amp;\t%1.1e&amp;\t%1.1e&amp;\t%d\t"</span>,N,t_fft,t_dft_mpolar,m);
00341       <span class="keywordflow">else</span>
00342         <span class="keywordflow">if</span>(m==3)
00343     fprintf(fp,<span class="stringliteral">"%d\t&amp;\t&amp;\t%1.1e&amp;\t       &amp;\t%d\t"</span>,N,t_fft,m);
00344   <span class="keywordflow">else</span>
00345     fprintf(fp,<span class="stringliteral">"  \t&amp;\t&amp;\t       &amp;\t       &amp;\t%d\t"</span>,m);  
00346 
00347       printf(<span class="stringliteral">"N=%d\tt_fft=%1.1e\tt_dft_mpolar=%1.1e\tm=%d\t"</span>,N,t_fft,t_dft_mpolar,m);              
00348    
00349       <a class="code" href="group__applications__polarFFT__mpolar.html#ga3">mpolar_fft</a>(f_hat,N,f,T,R,m);
00350       fprintf(fp,<span class="stringliteral">"%1.1e&amp;\t"</span>,GLOBAL_elapsed_time);
00351       printf(<span class="stringliteral">"t_mpolar=%1.1e\t"</span>,GLOBAL_elapsed_time);
00352       <a class="code" href="group__applications__polarFFT__mpolar.html#ga4">inverse_mpolar_fft</a>(f,T,R,f_hat,N,2*m,m);
00353       <span class="keywordflow">if</span>(m==9)
00354   fprintf(fp,<span class="stringliteral">"%1.1e\\\\\\hline\n"</span>,GLOBAL_elapsed_time);
00355       <span class="keywordflow">else</span>
00356   fprintf(fp,<span class="stringliteral">"%1.1e\\\\\n"</span>,GLOBAL_elapsed_time);
00357       printf(<span class="stringliteral">"t_impolar=%1.1e\n"</span>,GLOBAL_elapsed_time);
00358     }
00359 
00360   fflush(fp);
00361 
00362   fftw_free(f);
00363   fftw_free(f_hat);  
00364 
00365   <span class="keywordflow">return</span> EXIT_SUCCESS;
00366 }
00367 
<a name="l00369"></a><a class="code" href="group__applications__polarFFT__mpolar.html#ga6">00369</a> <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a>(<span class="keywordtype">int</span> argc,<span class="keywordtype">char</span> **argv)
00370 {
00371   <span class="keywordtype">int</span> N;                                
00372   <span class="keywordtype">int</span> T, R;                             
00373   <span class="keywordtype">int</span> M;                                
00374   <span class="keywordtype">double</span> *x, *w;                        
00375   fftw_complex *f_hat, *f, *f_direct, *f_tilde;
00376   <span class="keywordtype">int</span> k;
00377   <span class="keywordtype">int</span> max_i;                            
00378   <span class="keywordtype">int</span> m;
00379   <span class="keywordtype">double</span> temp1, temp2, E_max=0.0;
00380   FILE *fp1, *fp2;
00381   <span class="keywordtype">char</span> filename[30];
00382   <span class="keywordtype">int</span> logN;
00383 
00384   <span class="keywordflow">if</span>( argc!=4 )
00385   {
00386     printf(<span class="stringliteral">"mpolar_fft_test N T R \n"</span>);
00387     printf(<span class="stringliteral">"\n"</span>);
00388     printf(<span class="stringliteral">"N          mpolar FFT of size NxN    \n"</span>);
00389     printf(<span class="stringliteral">"T          number of slopes          \n"</span>);
00390     printf(<span class="stringliteral">"R          number of offsets         \n"</span>);
00391 
00393     printf(<span class="stringliteral">"\nHence, comparison FFTW, mpolar FFT and inverse mpolar FFT\n"</span>);
00394     fp1=fopen(<span class="stringliteral">"mpolar_comparison_fft.dat"</span>,<span class="stringliteral">"w"</span>);
00395     <span class="keywordflow">if</span> (fp1==NULL)
00396   <span class="keywordflow">return</span>(-1);
00397     <span class="keywordflow">for</span> (logN=4; logN&lt;=8; logN++)
00398   <a class="code" href="group__applications__polarFFT__linogramm.html#ga5">comparison_fft</a>(fp1,(1U&lt;&lt; logN), 3*(1U&lt;&lt; logN), 3*(1U&lt;&lt; (logN-1)));
00399     fclose(fp1);
00400 
00401     exit(-1);
00402   }
00403 
00404   N = atoi(argv[1]);
00405   T = atoi(argv[2]);
00406   R = atoi(argv[3]);
00407   printf(<span class="stringliteral">"N=%d, modified polar grid with T=%d, R=%d =&gt; "</span>,N,T,R);
00408 
00409   x = (<span class="keywordtype">double</span> *)malloc(2*1.25*T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00410   w = (<span class="keywordtype">double</span> *)malloc(1.25*T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00411 
00412   f_hat    = (fftw_complex *)fftw_malloc(<span class="keyword">sizeof</span>(fftw_complex)*N*N);
00413   f        = (fftw_complex *)fftw_malloc(<span class="keyword">sizeof</span>(fftw_complex)*1.25*T*R);  <span class="comment">/* 4/pi*log(1+sqrt(2)) = 1.122... &lt; 1.25 */</span>
00414   f_direct = (fftw_complex *)fftw_malloc(<span class="keyword">sizeof</span>(fftw_complex)*1.25*T*R);
00415   f_tilde  = (fftw_complex *)fftw_malloc(<span class="keyword">sizeof</span>(fftw_complex)*N*N);
00416 
00418   M=<a class="code" href="group__applications__polarFFT__mpolar.html#ga1">mpolar_grid</a>(T,R,x,w); printf(<span class="stringliteral">"M=%d.\n"</span>,M);
00419 
00421   fp1=fopen(<span class="stringliteral">"input_data_r.dat"</span>,<span class="stringliteral">"r"</span>);
00422   fp2=fopen(<span class="stringliteral">"input_data_i.dat"</span>,<span class="stringliteral">"r"</span>);
00423   <span class="keywordflow">if</span> ((fp1==NULL) || (fp2==NULL))
00424     <span class="keywordflow">return</span>(-1);
00425   <span class="keywordflow">for</span>(k=0;k&lt;N*N;k++)
00426   {
00427     fscanf(fp1,<span class="stringliteral">"%le "</span>,&amp;temp1);
00428     fscanf(fp2,<span class="stringliteral">"%le "</span>,&amp;temp2);
00429     f_hat[k]=temp1+I*temp2;
00430   }
00431   fclose(fp1);
00432   fclose(fp2);
00433 
00435       <a class="code" href="group__applications__polarFFT__mpolar.html#ga2">mpolar_dft</a>(f_hat,N,f_direct,T,R,m);
00436   <span class="comment">//  mpolar_fft(f_hat,N,f_direct,T,R,12);</span>
00437 
00439   printf(<span class="stringliteral">"\nTest of the mpolar FFT: \n"</span>);
00440   fp1=fopen(<span class="stringliteral">"mpolar_fft_error.dat"</span>,<span class="stringliteral">"w+"</span>);
00441   <span class="keywordflow">for</span> (m=1; m&lt;=12; m++)
00442   {
00444     <a class="code" href="group__applications__polarFFT__mpolar.html#ga3">mpolar_fft</a>(f_hat,N,f,T,R,m);
00445 
00447     E_max=<a class="code" href="group__nfftutil.html#ga37">nfft_error_l_infty_complex</a>(f_direct,f,M);
00448     printf(<span class="stringliteral">"m=%2d: E_max = %e\n"</span>,m,E_max);
00449     fprintf(fp1,<span class="stringliteral">"%e\n"</span>,E_max);
00450   }
00451   fclose(fp1);
00452 
00454   <span class="keywordflow">for</span> (m=3; m&lt;=9; m+=3)
00455   {
00456     printf(<span class="stringliteral">"\nTest of the inverse mpolar FFT for m=%d: \n"</span>,m);
00457     sprintf(filename,<span class="stringliteral">"mpolar_ifft_error%d.dat"</span>,m);
00458     fp1=fopen(filename,<span class="stringliteral">"w+"</span>);
00459     <span class="keywordflow">for</span> (max_i=0; max_i&lt;=20; max_i+=2)
00460     {
00462       <a class="code" href="group__applications__polarFFT__mpolar.html#ga4">inverse_mpolar_fft</a>(f_direct,T,R,f_tilde,N,max_i,m);
00463 
00465       E_max=<a class="code" href="group__nfftutil.html#ga37">nfft_error_l_infty_complex</a>(f_hat,f_tilde,N*N);
00466       printf(<span class="stringliteral">"%3d iterations: E_max = %e\n"</span>,max_i,E_max);
00467       fprintf(fp1,<span class="stringliteral">"%e\n"</span>,E_max);
00468     }
00469     fclose(fp1);
00470   }
00471 
00473   free(x);
00474   free(w);
00475   free(f_hat);
00476   free(f);
00477   free(f_direct);
00478   free(f_tilde);
00479 
00480   <span class="keywordflow">return</span> 0;
00481 }
00482 <span class="comment">/* \} */</span>
</pre></div>    <hr size="1"/>
    Generated on 22 Jan 2007 by Doxygen 1.4.1
  </body>
</html>
