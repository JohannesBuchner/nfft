<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.2 API Reference - NFFT: construct_data_2d1d.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.2 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000006.html">applications</a>&nbsp;/&nbsp;<a class="el" href="dir_000007.html">mri</a>&nbsp;/&nbsp;<a class="el" href="dir_000009.html">mri3d</a></div>
<h1>construct_data_2d1d.c</h1><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00002 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00003 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00004 
<a name="l00014"></a><a class="code" href="group__applications__mri3d__construct__data__1d2d.html#ga0">00014</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__mri2d__construct__data__2d.html#ga0">construct</a>(<span class="keywordtype">char</span> * file, <span class="keywordtype">int</span> N, <span class="keywordtype">int</span> M, <span class="keywordtype">int</span> Z, fftw_complex *mem)
00015 {
00016   <span class="keywordtype">int</span> j,z;                <span class="comment">/* some variables */</span>
00017   <span class="keywordtype">double</span> tmp;             <span class="comment">/* a placeholder */</span>
00018   <a class="code" href="structnfft__plan.html">nfft_plan</a> my_plan;      <span class="comment">/* plan for the two dimensional nfft  */</span>
00019   FILE* fp;
00020     
00021   <span class="comment">/* initialise my_plan */</span>
00022   <a class="code" href="group__nfft.html#ga5">nfft_init_2d</a>(&amp;my_plan,N,N,M/Z);
00023 
00024   fp=fopen(<span class="stringliteral">"knots.dat"</span>,<span class="stringliteral">"r"</span>);
00025   
00026   <span class="keywordflow">for</span>(j=0;j&lt;my_plan.<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++)
00027   {
00028     fscanf(fp,<span class="stringliteral">"%le %le %le"</span>,&amp;my_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+0],&amp;my_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+1],&amp;tmp);
00029   }
00030   fclose(fp);
00031 
00032   fp=fopen(file,<span class="stringliteral">"w"</span>);
00033 
00034   <span class="keywordflow">for</span>(z=0;z&lt;Z;z++) {
00035     tmp = (double) z;
00036   
00037     <span class="keywordflow">for</span>(j=0;j&lt;N*N;j++)
00038       my_plan.<a class="code" href="structnfft__plan.html#o2">f_hat</a>[j] = mem[(z*N*N+N*N*Z/2+j)%(N*N*Z)];
00039     
00040     <span class="keywordflow">if</span>(my_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00041       <a class="code" href="group__nfft.html#ga12">nfft_precompute_psi</a>(&amp;my_plan);
00042 
00043     <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;my_plan);
00044 
00045     <span class="keywordflow">for</span>(j=0;j&lt;my_plan.<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++)
00046     {
00047       fprintf(fp,<span class="stringliteral">"%le %le %le %le %le\n"</span>,my_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+0],my_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+1],tmp/Z-0.5,
00048               creal(my_plan.<a class="code" href="structnfft__plan.html#o3">f</a>[j]),cimag(my_plan.<a class="code" href="structnfft__plan.html#o3">f</a>[j]));
00049     }
00050   }
00051   fclose(fp);
00052 
00053   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;my_plan);
00054 }
00055 
<a name="l00060"></a><a class="code" href="group__applications__mri3d__construct__data__1d2d.html#ga1">00060</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__mri3d__construct__data__1d2d.html#ga1">fft</a>(<span class="keywordtype">int</span> N,<span class="keywordtype">int</span> M,<span class="keywordtype">int</span> Z, fftw_complex *mem)
00061 {
00062   fftw_plan plan;
00063   plan = fftw_plan_many_dft(1, &amp;Z, N*N,
00064                                   mem, NULL,
00065                                   N*N, 1,
00066                                   mem, NULL,
00067                                   N*N,1 ,
00068                                   FFTW_FORWARD, FFTW_ESTIMATE);
00069 
00070   fftw_execute(plan); <span class="comment">/* execute the fft */</span>
00071   fftw_destroy_plan(plan);
00072 }
00073 
<a name="l00078"></a><a class="code" href="group__applications__mri3d__construct__data__1d2d.html#ga2">00078</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__mri3d__construct__data__1d2d.html#ga2">read_data</a>(<span class="keywordtype">int</span> N,<span class="keywordtype">int</span> M,<span class="keywordtype">int</span> Z, fftw_complex *mem)
00079 {
00080   <span class="keywordtype">int</span> i,z;
00081   <span class="keywordtype">double</span> real;
00082   FILE* fin;
00083   fin=fopen(<span class="stringliteral">"input_f.dat"</span>,<span class="stringliteral">"r"</span>);
00084 
00085   <span class="keywordflow">for</span>(z=0;z&lt;Z;z++)
00086   {
00087     <span class="keywordflow">for</span>(i=0;i&lt;N*N;i++)
00088     {
00089       fscanf(fin,<span class="stringliteral">"%le "</span>,&amp;real );
00090       mem[(z*N*N+N*N*Z/2+i)%(N*N*Z)]=real;
00091     }
00092   }
00093   fclose(fin);
00094 }
00095 
00096 <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
00097 { 
00098   fftw_complex *mem;
00099   
00100   <span class="keywordflow">if</span> (argc &lt;= 4) {
00101     printf(<span class="stringliteral">"usage: ./construct_data FILENAME N M Z\n"</span>);
00102     <span class="keywordflow">return</span> 1;
00103   }
00104 
00105   mem = (fftw_complex*) fftw_malloc(<span class="keyword">sizeof</span>(fftw_complex) * atoi(argv[2]) * atoi(argv[2]) * atoi(argv[4]));
00106   
00107   <a class="code" href="group__applications__mri3d__construct__data__1d2d.html#ga2">read_data</a>(atoi(argv[2]),atoi(argv[3]),atoi(argv[4]), mem);
00108 
00109   <a class="code" href="group__applications__mri3d__construct__data__1d2d.html#ga1">fft</a>(atoi(argv[2]),atoi(argv[3]),atoi(argv[4]), mem);
00110  
00111   <a class="code" href="group__applications__mri2d__construct__data__2d.html#ga0">construct</a>(argv[1],atoi(argv[2]),atoi(argv[3]),atoi(argv[4]), mem);
00112   
00113   fftw_free(mem);
00114   
00115   <span class="keywordflow">return</span> 1;
00116 }
00117 <span class="comment">/* \} */</span>
</pre></div>    <hr size="1"/>
    Generated on 22 Jan 2007 by Doxygen 1.4.1
  </body>
</html>
