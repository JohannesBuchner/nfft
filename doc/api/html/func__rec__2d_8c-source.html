<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.3 API Reference - NFFT: func_rec_2d.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.3 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">examples</a>&nbsp;/&nbsp;<a class="el" href="dir_000020.html">nfct</a>&nbsp;/&nbsp;<a class="el" href="dir_000021.html">func_rec_2d</a></div>
<h1>func_rec_2d.c</h1><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#include &lt;math.h&gt;</span>
00002 <span class="preprocessor">#include &lt;string.h&gt;</span>
00003 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00004 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00005 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00006 
00007 
00008 
00009 <span class="keywordtype">double</span> norm2( <span class="keywordtype">int</span> k0, <span class="keywordtype">int</span> k1)
00010 {
00011   <span class="keywordflow">return</span> sqrt(k0*k0+k1*k1);
00012 }
00013 
00014 <span class="keywordtype">void</span> func_rec_2d( <span class="keywordtype">int</span> my_N,
00015                   <span class="keywordtype">int</span> M,
00016                   <span class="keywordtype">int</span> iter,
00017                   <span class="keywordtype">int</span> my_M,
00018                   <span class="keywordtype">double</span> border_eps,
00019                   <span class="keywordtype">double</span> mu, <span class="keywordtype">double</span> c, <span class="keywordtype">char</span> *fout_name) 
00020 {
00021 
00022   <span class="keywordtype">int</span> j,j0,j1,k,k0,k1,l;                      <span class="comment">/* nodes, freqencies iterations       */</span>
00023   <a class="code" href="structnfct__plan.html">nfct_plan</a>  my_cplan, my_other_cplan;        <span class="comment">/* plans for the two dimensional nfct */</span>
00024   <a class="code" href="structinfct__plan.html">infct_plan</a> my_icplan;                       <span class="comment">/* plan for the two dimensional infct */</span>
00025 
00026   FILE *fp_in, *fp_out;                       <span class="comment">/* input/output file                  */</span>
00027   <span class="keywordtype">double</span> min_x, max_x, min_y, max_y;
00028 
00029 
00030   printf( <span class="stringliteral">"N=%d  M=%d  iter=%d  rec_M=%d  b_eps=%f  mu=%f  c=%f  fout=%s\n"</span>, 
00031       my_N, M, iter, my_M, border_eps, mu, c, fout_name);
00032 
00033   <a class="code" href="group__nfsct.html#ga1">nfct_init_2d</a>(&amp;my_cplan, my_N, my_N, M);
00034 
00035   <span class="comment">/* initialise my_icplan, specific */</span>
00036   <a class="code" href="group__solver.html#ga6">infct_init_advanced</a>( &amp;my_icplan, &amp;my_cplan, CGNE | PRECOMPUTE_DAMP);
00037 
00038 
00039   <span class="comment">/* init nodes */</span>
00040   <span class="keywordflow">if</span>( (fp_in = fopen( <span class="stringliteral">"input.dat"</span>, <span class="stringliteral">"r"</span>)) == NULL)
00041   {
00042     fprintf( stderr, <span class="stringliteral">"%s\n"</span>, <span class="stringliteral">"Can't open inputfile"</span>);
00043     exit( 1);
00044   }
00045       
00046   
00047   fscanf( fp_in, <span class="stringliteral">"%le %le %le"</span>, &amp;my_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[0], &amp;my_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[1], &amp;my_icplan.<a class="code" href="structinfct__plan.html#o4">y</a>[0]);
00048   min_x = max_x = my_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[0];
00049   min_y = max_y = my_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[1];
00050 
00051   j=0;
00052   <span class="keywordflow">for</span>( j = 1; j &lt; my_cplan.<a class="code" href="structnfct__plan.html#o1">M_total</a>; j++)
00053   {
00054       fscanf(fp_in, <span class="stringliteral">"%le %le %le"</span>, &amp;my_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[2*j+0],
00055                                    &amp;my_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[2*j+1],
00056                                    &amp;my_icplan.<a class="code" href="structinfct__plan.html#o4">y</a>[j]);
00057 
00058       min_x = (my_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[2*j+0] &lt; min_x) ? my_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[2*j+0] : min_x;
00059       max_x = (my_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[2*j+0] &gt; max_x) ? my_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[2*j+0] : max_x;
00060 
00061       min_y = (my_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[2*j+1] &lt; min_y) ? my_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[2*j+1] : min_y;
00062       max_y = (my_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[2*j+1] &gt; max_y) ? my_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[2*j+1] : max_y;
00063   }
00064 
00065   fclose(fp_in);
00066 
00067   <span class="comment">// scale input</span>
00068   <span class="keywordtype">double</span> diff_x = 1.0/(0.5-2*border_eps) * (max_x - min_x);
00069   <span class="keywordtype">double</span> diff_y = 1.0/(0.5-2*border_eps) * (max_y - min_y);
00070   <span class="keywordflow">for</span>( j = 0; j &lt; my_cplan.<a class="code" href="structnfct__plan.html#o1">M_total</a>; j++)
00071   {
00072     my_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[2*j+0] = border_eps + (my_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[2*j+0] - min_x) / diff_x;
00073     my_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[2*j+1] = border_eps + (my_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[2*j+1] - min_y) / diff_y;
00074   }
00075 
00076   <span class="comment">/* precompute psi */</span>
00077   <span class="keywordflow">if</span>(my_cplan.<a class="code" href="structnfct__plan.html#o11">nfct_flags</a> &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00078     <a class="code" href="group__nfsct.html#ga5">nfct_precompute_psi</a>( &amp;my_cplan);
00079 
00080 
00082   <span class="keywordflow">if</span>(my_icplan.<a class="code" href="structinfct__plan.html#o1">flags</a> &amp; <a class="code" href="group__solver.html#ga41">PRECOMPUTE_DAMP</a>)
00083     {
00084       <span class="keywordflow">for</span>(k0=0;k0&lt;my_cplan.<a class="code" href="structnfct__plan.html#o5">N</a>[0];k0++)
00085         <span class="keywordflow">for</span>(k1=0;k1&lt;my_cplan.<a class="code" href="structnfct__plan.html#o5">N</a>[1];k1++)
00086         {
00087           my_icplan.<a class="code" href="structinfct__plan.html#o3">w_hat</a>[k0*my_cplan.<a class="code" href="structnfct__plan.html#o5">N</a>[1]+k1]=
00088             <a class="code" href="group__nfftutil.html#ga54">nfft_modified_multiquadric</a>( mu, c, norm2(k0, k1));
00089         }
00090       
00091 <span class="comment">//      for(k0=0;k0&lt;my_cplan.N[0];k0++)</span>
00092 <span class="comment">//        my_icplan.w_hat[k0*my_cplan.N[1]+my_cplan.N[1]-1]=0;</span>
00093 <span class="comment">//      for(k1=0;k1&lt;my_cplan.N[1];k1++)</span>
00094 <span class="comment">//        my_icplan.w_hat[(my_cplan.N[0]-1)*my_cplan.N[1]+k1]=0;    </span>
00095     }
00096 
00097 
00098   <span class="comment">/* init some guess */</span>
00099   <span class="keywordflow">for</span>( k = 0; k &lt; my_cplan.<a class="code" href="structnfct__plan.html#o0">N_total</a>; k++)
00100     my_icplan.<a class="code" href="structinfct__plan.html#o5">f_hat_iter</a>[k] = 0.0;
00101 
00102   <span class="comment">/* inverse trafo */</span>  
00103   <a class="code" href="group__solver.html#ga7">infct_before_loop</a>( &amp;my_icplan);
00104   <span class="keywordflow">for</span>(l=0; l &lt; iter; l++)
00105   { 
00106       <a class="code" href="group__solver.html#ga8">infct_loop_one_step</a>( &amp;my_icplan);
00107       <span class="comment">//fprintf( stderr, "%e\n", my_icplan.dot_r_iter);</span>
00108   }
00109 
00110 
00111 
00112   <a class="code" href="group__nfsct.html#ga1">nfct_init_2d</a>( &amp;my_other_cplan, my_N, my_N, my_M * my_M);
00113   
00114   <span class="comment">// nodes on grid</span>
00115   <span class="keywordflow">for</span>( j0 = 0; j0 &lt; my_M; j0++) 
00116     <span class="keywordflow">for</span>( j1 = 0; j1 &lt; my_M; j1++)
00117     {
00118       my_other_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[2*(j0 * my_M + j1) + 0] = 
00119   border_eps + ((double)((double)j0*((0.5-2*border_eps)/my_M)));
00120       my_other_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[2*(j0 * my_M + j1) + 1] = 
00121   border_eps + ((double)((double)j1*((0.5-2*border_eps)/my_M)));
00122     }
00123 
00124 
00125   <span class="comment">/* precompute psi */</span>
00126   <span class="keywordflow">if</span>( my_other_cplan.<a class="code" href="structnfct__plan.html#o11">nfct_flags</a> &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00127     <a class="code" href="group__nfsct.html#ga5">nfct_precompute_psi</a>( &amp;my_other_cplan);
00128 
00129   <a class="code" href="group__nfftutil.html#ga56">NFFT_SWAP_double</a>( my_icplan.<a class="code" href="structinfct__plan.html#o5">f_hat_iter</a>, my_other_cplan.<a class="code" href="structnfct__plan.html#o2">f_hat</a>);
00130   <a class="code" href="group__nfsct.html#ga6">nfct_trafo</a>( &amp;my_other_cplan);
00131   <a class="code" href="group__nfftutil.html#ga56">NFFT_SWAP_double</a>( my_icplan.<a class="code" href="structinfct__plan.html#o5">f_hat_iter</a>, my_other_cplan.<a class="code" href="structnfct__plan.html#o2">f_hat</a>);
00132 
00133   
00134   <span class="keywordflow">if</span>( (fp_out = fopen( fout_name, <span class="stringliteral">"w"</span>)) == NULL)
00135   {
00136     fprintf( stderr, <span class="stringliteral">"%s\n"</span>, <span class="stringliteral">"Can't open outputfile"</span>);
00137     exit( 2);
00138   }
00139     
00140   <span class="keywordflow">for</span>( j = 0; j &lt; my_other_cplan.<a class="code" href="structnfct__plan.html#o1">M_total</a>; j++)
00141   {
00142     fprintf( fp_out, <span class="stringliteral">"%f  %f  %f\n"</span>, my_other_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[2*j], 
00143                                      my_other_cplan.<a class="code" href="structnfct__plan.html#o13">x</a>[2*j+1],
00144                                      my_other_cplan.<a class="code" href="structnfct__plan.html#o3">f</a>[j]);
00145   }
00146 
00147   fclose( fp_out);
00148 
00149   <a class="code" href="group__solver.html#ga9">infct_finalize</a>( &amp;my_icplan);  
00150   <a class="code" href="group__nfsct.html#ga10">nfct_finalize</a>( &amp;my_cplan);
00151   <a class="code" href="group__nfsct.html#ga10">nfct_finalize</a>( &amp;my_other_cplan);
00152 }
00153 
00154 
00155 
00156 <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
00157 {
00158   func_rec_2d( atoi( argv[1]), <span class="comment">/* N_0 */</span>
00159                atoi( argv[2]), <span class="comment">/* M   */</span>
00160                atoi( argv[3]), <span class="comment">/* iterations */</span>
00161                atoi( argv[4]), <span class="comment">/* rec_M */</span>
00162                atof( argv[5]), <span class="comment">/* border_eps */</span>
00163                atof( argv[6]), <span class="comment">/* mu (multiquadric damping factors) */</span>
00164                atof( argv[7]), <span class="comment">/*  c (multiquadric damping factors) */</span>
00165                      argv[8]   <span class="comment">/* output filename */</span>
00166                );
00167 
00168   <span class="keywordflow">return</span> 1;
00169 }
</pre></div>    <hr size="1"/>
    Generated on 5 Feb 2007 by Doxygen 1.4.1
  </body>
</html>
