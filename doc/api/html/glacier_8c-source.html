<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.3 API Reference - NFFT: glacier.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.3 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">examples</a>&nbsp;/&nbsp;<a class="el" href="dir_000010.html">solver</a></div>
<h1>glacier.c</h1><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00002 <span class="preprocessor">#include &lt;math.h&gt;</span>
00003 <span class="preprocessor">#include &lt;string.h&gt;</span>
00004 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00005 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00006 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00007 
<a name="l00016"></a><a class="code" href="group__examples__solver__glacier.html#ga0">00016</a> <span class="keywordtype">double</span> <a class="code" href="group__examples__solver__glacier.html#ga0">my_weight</a>(<span class="keywordtype">double</span> z,<span class="keywordtype">double</span> a,<span class="keywordtype">double</span> b,<span class="keywordtype">double</span> c)
00017 {
00018     <span class="keywordflow">return</span> pow(0.25-z*z,b)/(c+pow(fabs(z),2*a));
00019 }
00020 
<a name="l00022"></a><a class="code" href="group__examples__solver__glacier.html#ga1">00022</a> <span class="keywordtype">void</span> <a class="code" href="group__examples__solver__glacier.html#ga1">glacier</a>(<span class="keywordtype">int</span> N,<span class="keywordtype">int</span> M)
00023 {  
00024   <span class="keywordtype">int</span> j,k,k0,k1,l,my_N[2],my_n[2];
00025   <span class="keywordtype">double</span> tmp_y;
00026   <a class="code" href="structnfft__plan.html">nfft_plan</a> p;
00027   <a class="code" href="structinfft__plan.html">infft_plan</a> ip;
00028   FILE* fp;
00029    
00030   <span class="comment">/* initialise p */</span>
00031   my_N[0]=N; my_n[0]=<a class="code" href="group__nfftutil.html#ga4">nfft_next_power_of_2</a>(N);
00032   my_N[1]=N; my_n[1]=<a class="code" href="group__nfftutil.html#ga4">nfft_next_power_of_2</a>(N);
00033   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;p, 2, my_N, M, my_n, 6, 
00034      <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>|
00035      <a class="code" href="group__nfft.html#ga22">MALLOC_X</a>| <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>| <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>|
00036      <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a>| <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00037      FFTW_MEASURE| FFTW_DESTROY_INPUT);
00038 
00039   <span class="comment">/* initialise ip, specific */</span>
00040   <a class="code" href="group__solver.html#ga1">infft_init_advanced</a>(&amp;ip,&amp;p, <a class="code" href="group__solver.html#ga38">CGNE</a>| <a class="code" href="group__solver.html#ga41">PRECOMPUTE_DAMP</a>);
00041 
00042   <span class="comment">/* init nodes */</span>
00043   fp=fopen(<span class="stringliteral">"input_data.dat"</span>,<span class="stringliteral">"r"</span>);
00044   <span class="keywordflow">for</span>(j=0;j&lt;p.<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++)
00045   {
00046       fscanf(fp,<span class="stringliteral">"%le %le %le"</span>,&amp;p.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+0],&amp;p.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+1],&amp;tmp_y);
00047       ip.<a class="code" href="structinfft__plan.html#o4">y</a>[j]=tmp_y;
00048   }
00049   fclose(fp);
00050   
00051   <span class="comment">/* precompute psi */</span>
00052   <span class="keywordflow">if</span>(p.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga27">PRE_ONE_PSI</a>)
00053       <a class="code" href="group__nfft.html#ga10">nfft_precompute_one_psi</a>(&amp;p);
00054   
00055   <span class="comment">/* initialise damping factors */</span>
00056   <span class="keywordflow">if</span>(ip.<a class="code" href="structinfft__plan.html#o1">flags</a> &amp; <a class="code" href="group__solver.html#ga41">PRECOMPUTE_DAMP</a>)
00057     <span class="keywordflow">for</span>(k0=0;k0&lt;p.<a class="code" href="structnfft__plan.html#o5">N</a>[0];k0++)
00058       <span class="keywordflow">for</span>(k1=0;k1&lt;p.<a class="code" href="structnfft__plan.html#o5">N</a>[1];k1++)
00059         ip.<a class="code" href="structinfft__plan.html#o3">w_hat</a>[k0*p.<a class="code" href="structnfft__plan.html#o5">N</a>[1]+k1]=
00060       <a class="code" href="group__examples__solver__glacier.html#ga0">my_weight</a>(((<span class="keywordtype">double</span>)(k0-p.<a class="code" href="structnfft__plan.html#o5">N</a>[0]/2))/p.<a class="code" href="structnfft__plan.html#o5">N</a>[0],0.5,3,0.001)*
00061       <a class="code" href="group__examples__solver__glacier.html#ga0">my_weight</a>(((<span class="keywordtype">double</span>)(k1-p.<a class="code" href="structnfft__plan.html#o5">N</a>[1]/2))/p.<a class="code" href="structnfft__plan.html#o5">N</a>[1],0.5,3,0.001);
00062   
00063   <span class="comment">/* init some guess */</span>
00064   <span class="keywordflow">for</span>(k=0;k&lt;p.<a class="code" href="structnfft__plan.html#o0">N_total</a>;k++)
00065       ip.<a class="code" href="structinfft__plan.html#o5">f_hat_iter</a>[k]=0; 
00066 
00067   <span class="comment">/* inverse trafo */</span>  
00068   <a class="code" href="group__solver.html#ga2">infft_before_loop</a>(&amp;ip);
00069   <span class="keywordflow">for</span>(l=0;l&lt;40;l++)
00070     { 
00071       fprintf(stderr,<span class="stringliteral">"Residual ||r||=%e,\n"</span>,sqrt(ip.<a class="code" href="structinfft__plan.html#o12">dot_r_iter</a>));
00072       <a class="code" href="group__solver.html#ga3">infft_loop_one_step</a>(&amp;ip);
00073     }
00074 
00075   <span class="keywordflow">for</span>(k=0;k&lt;p.<a class="code" href="structnfft__plan.html#o0">N_total</a>;k++)
00076     printf(<span class="stringliteral">"%le %le\n"</span>,creal(ip.<a class="code" href="structinfft__plan.html#o5">f_hat_iter</a>[k]),cimag(ip.<a class="code" href="structinfft__plan.html#o5">f_hat_iter</a>[k]));
00077 
00078   <a class="code" href="group__solver.html#ga4">infft_finalize</a>(&amp;ip);  
00079   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;p);  
00080 }
00081 
<a name="l00083"></a><a class="code" href="group__examples__solver__glacier.html#ga2">00083</a> <span class="keywordtype">void</span> <a class="code" href="group__examples__solver__glacier.html#ga2">glacier_cv</a>(<span class="keywordtype">int</span> N,<span class="keywordtype">int</span> M,<span class="keywordtype">int</span> M_cv,<span class="keywordtype">unsigned</span> infft_flags)
00084 {  
00085   <span class="keywordtype">int</span> j,k,k0,k1,l,my_N[2],my_n[2];
00086   <span class="keywordtype">double</span> tmp_y,r;
00087   <a class="code" href="structnfft__plan.html">nfft_plan</a> p,cp;
00088   <a class="code" href="structinfft__plan.html">infft_plan</a> ip;
00089   <span class="keywordtype">double</span> complex* cp_y;
00090   FILE* fp;
00091   <span class="keywordtype">int</span> M_re=M-M_cv;
00092    
00093   <span class="comment">/* initialise p for reconstruction */</span>
00094   my_N[0]=N; my_n[0]=<a class="code" href="group__nfftutil.html#ga4">nfft_next_power_of_2</a>(N);
00095   my_N[1]=N; my_n[1]=<a class="code" href="group__nfftutil.html#ga4">nfft_next_power_of_2</a>(N);
00096   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;p, 2, my_N, M_re, my_n, 6, 
00097      <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>|
00098      <a class="code" href="group__nfft.html#ga22">MALLOC_X</a>| <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>| <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>|
00099      <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a>| <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00100      FFTW_MEASURE| FFTW_DESTROY_INPUT);
00101 
00102 
00103   <span class="comment">/* initialise ip, specific */</span>
00104   <a class="code" href="group__solver.html#ga1">infft_init_advanced</a>(&amp;ip,&amp;p, infft_flags);
00105 
00106   
00107   
00108   <span class="comment">/* initialise cp for validation */</span>
00109   cp_y = (<span class="keywordtype">double</span> complex*) fftw_malloc(M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00110   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;cp, 2, my_N, M, my_n, 6, 
00111      <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>|
00112      <a class="code" href="group__nfft.html#ga22">MALLOC_X</a>| <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>|
00113      <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a>| <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00114      FFTW_MEASURE| FFTW_DESTROY_INPUT);
00115   
00116   cp.<a class="code" href="structnfft__plan.html#o2">f_hat</a>=ip.<a class="code" href="structinfft__plan.html#o5">f_hat_iter</a>;
00117 
00118   <span class="comment">/* set up data in cp and cp_y */</span>
00119   fp=fopen(<span class="stringliteral">"input_data.dat"</span>,<span class="stringliteral">"r"</span>);
00120   <span class="keywordflow">for</span>(j=0;j&lt;cp.<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++)
00121     {  
00122       fscanf(fp,<span class="stringliteral">"%le %le %le"</span>,&amp;cp.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+0],&amp;cp.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+1],&amp;tmp_y);
00123       cp_y[j]=tmp_y;
00124     }
00125   fclose(fp);
00126 
00127   <span class="comment">/* copy part of the data to p and ip */</span>
00128   <span class="keywordflow">for</span>(j=0;j&lt;p.<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++)
00129   {
00130       p.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+0]=cp.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+0];
00131       p.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+1]=cp.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+1];
00132       ip.<a class="code" href="structinfft__plan.html#o4">y</a>[j]=tmp_y;
00133   }
00134 
00135   <span class="comment">/* precompute psi */</span>
00136   <span class="keywordflow">if</span>(p.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga27">PRE_ONE_PSI</a>)
00137     <a class="code" href="group__nfft.html#ga10">nfft_precompute_one_psi</a>(&amp;p);
00138    
00139   <span class="comment">/* precompute psi */</span>
00140   <span class="keywordflow">if</span>(cp.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga27">PRE_ONE_PSI</a>)
00141     <a class="code" href="group__nfft.html#ga10">nfft_precompute_one_psi</a>(&amp;cp);
00142    
00143   <span class="comment">/* initialise damping factors */</span>
00144   <span class="keywordflow">if</span>(ip.<a class="code" href="structinfft__plan.html#o1">flags</a> &amp; <a class="code" href="group__solver.html#ga41">PRECOMPUTE_DAMP</a>)
00145     <span class="keywordflow">for</span>(k0=0;k0&lt;p.<a class="code" href="structnfft__plan.html#o5">N</a>[0];k0++)
00146       <span class="keywordflow">for</span>(k1=0;k1&lt;p.<a class="code" href="structnfft__plan.html#o5">N</a>[1];k1++)
00147         ip.<a class="code" href="structinfft__plan.html#o3">w_hat</a>[k0*p.<a class="code" href="structnfft__plan.html#o5">N</a>[1]+k1]=
00148       <a class="code" href="group__examples__solver__glacier.html#ga0">my_weight</a>(((<span class="keywordtype">double</span>)(k0-p.<a class="code" href="structnfft__plan.html#o5">N</a>[0]/2))/p.<a class="code" href="structnfft__plan.html#o5">N</a>[0],0.5,3,0.001)*
00149       <a class="code" href="group__examples__solver__glacier.html#ga0">my_weight</a>(((<span class="keywordtype">double</span>)(k1-p.<a class="code" href="structnfft__plan.html#o5">N</a>[1]/2))/p.<a class="code" href="structnfft__plan.html#o5">N</a>[1],0.5,3,0.001);
00150   
00151   <span class="comment">/* init some guess */</span>
00152   <span class="keywordflow">for</span>(k=0;k&lt;p.<a class="code" href="structnfft__plan.html#o0">N_total</a>;k++)
00153       ip.<a class="code" href="structinfft__plan.html#o5">f_hat_iter</a>[k]=0;
00154 
00155   <span class="comment">/* inverse trafo */</span>  
00156   <a class="code" href="group__solver.html#ga2">infft_before_loop</a>(&amp;ip);
00157   <span class="comment">//  fprintf(stderr,"iteration starts,\t");</span>
00158   <span class="keywordflow">for</span>(l=0;l&lt;40;l++)
00159     <a class="code" href="group__solver.html#ga3">infft_loop_one_step</a>(&amp;ip);
00160 
00161   <span class="comment">//fprintf(stderr,"r=%1.2e, ",sqrt(ip.dot_r_iter)/M_re);</span>
00162 
00163   <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(p.<a class="code" href="structnfft__plan.html#o2">f_hat</a>,ip.<a class="code" href="structinfft__plan.html#o5">f_hat_iter</a>);
00164   <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;p);
00165   <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(p.<a class="code" href="structnfft__plan.html#o2">f_hat</a>,ip.<a class="code" href="structinfft__plan.html#o5">f_hat_iter</a>);
00166   <a class="code" href="group__nfftutil.html#ga26">nfft_upd_axpy_complex</a>(p.<a class="code" href="structnfft__plan.html#o3">f</a>,-1,ip.<a class="code" href="structinfft__plan.html#o4">y</a>,M_re);
00167   r=sqrt(<a class="code" href="group__nfftutil.html#ga15">nfft_dot_complex</a>(p.<a class="code" href="structnfft__plan.html#o3">f</a>,M_re)/<a class="code" href="group__nfftutil.html#ga15">nfft_dot_complex</a>(cp_y,M));
00168   fprintf(stderr,<span class="stringliteral">"r=%1.2e, "</span>,r);
00169   printf(<span class="stringliteral">"$%1.1e$ &amp; "</span>,r);
00170 
00171   <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;cp);
00172   <a class="code" href="group__nfftutil.html#ga26">nfft_upd_axpy_complex</a>(&amp;cp.<a class="code" href="structnfft__plan.html#o3">f</a>[M_re],-1,&amp;cp_y[M_re],M_cv);
00173   r=sqrt(<a class="code" href="group__nfftutil.html#ga15">nfft_dot_complex</a>(&amp;cp.<a class="code" href="structnfft__plan.html#o3">f</a>[M_re],M_cv)/<a class="code" href="group__nfftutil.html#ga15">nfft_dot_complex</a>(cp_y,M));
00174   fprintf(stderr,<span class="stringliteral">"r_1=%1.2e\t"</span>,r);
00175   printf(<span class="stringliteral">"$%1.1e$ &amp; "</span>,r);     
00176 
00177   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;cp);
00178   <a class="code" href="group__solver.html#ga4">infft_finalize</a>(&amp;ip);  
00179   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;p);  
00180 }
00181 
00182 
<a name="l00184"></a><a class="code" href="group__examples__solver__glacier.html#ga3">00184</a> <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
00185 {
00186   <span class="keywordtype">int</span> M_cv;
00187 
00188   <span class="keywordflow">if</span>(argc&lt;3)
00189     {
00190       fprintf(stderr,<span class="stringliteral">"Call this program from the Matlab script glacier.m!"</span>);
00191       exit(-1);
00192     }
00193   
00194   <span class="keywordflow">if</span>(argc==3)
00195     <a class="code" href="group__examples__solver__glacier.html#ga1">glacier</a>(atoi(argv[1]),atoi(argv[2]));
00196   <span class="keywordflow">else</span>
00197     <span class="keywordflow">for</span>(M_cv=atoi(argv[3]);M_cv&lt;=atoi(argv[5]);M_cv+=atoi(argv[4]))
00198       {
00199   fprintf(stderr,<span class="stringliteral">"\nM_cv=%d,\t"</span>,M_cv);
00200   printf(<span class="stringliteral">"$%d$ &amp; "</span>,M_cv);
00201   fprintf(stderr,<span class="stringliteral">"cgne+damp: "</span>);
00202   <a class="code" href="group__examples__solver__glacier.html#ga2">glacier_cv</a>(atoi(argv[1]),atoi(argv[2]),M_cv,<a class="code" href="group__solver.html#ga38">CGNE</a>| <a class="code" href="group__solver.html#ga41">PRECOMPUTE_DAMP</a>);
00203   <span class="comment">//fprintf(stderr,"cgne: ");</span>
00204   <span class="comment">//glacier_cv(atoi(argv[1]),atoi(argv[2]),M_cv,CGNE);</span>
00205   fprintf(stderr,<span class="stringliteral">"cgnr: "</span>);
00206   <a class="code" href="group__examples__solver__glacier.html#ga2">glacier_cv</a>(atoi(argv[1]),atoi(argv[2]),M_cv,<a class="code" href="group__solver.html#ga37">CGNR</a>);
00207   fprintf(stderr,<span class="stringliteral">"cgnr: "</span>);
00208   <a class="code" href="group__examples__solver__glacier.html#ga2">glacier_cv</a>(atoi(argv[1])/4,atoi(argv[2]),M_cv,<a class="code" href="group__solver.html#ga37">CGNR</a>);
00209   printf(<span class="stringliteral">"XXX \\\\\n"</span>);
00210       }
00211 
00212   fprintf(stderr,<span class="stringliteral">"\n"</span>);
00213 
00214   <span class="keywordflow">return</span> 1;
00215 }
00216 <span class="comment">/* \} */</span>
</pre></div>    <hr size="1"/>
    Generated on 5 Feb 2007 by Doxygen 1.4.1
  </body>
</html>
