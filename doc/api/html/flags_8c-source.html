<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.2 API Reference - NFFT: flags.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.2 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">examples</a>&nbsp;/&nbsp;<a class="el" href="dir_000018.html">nfft</a></div>
<h1>flags.c</h1><a href="flags_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00009 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00010 <span class="preprocessor">#include &lt;math.h&gt;</span>
00011 <span class="preprocessor">#include &lt;string.h&gt;</span>
00012 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00013 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00015 <span class="preprocessor">#include "options.h"</span>
00016 
00017 <span class="preprocessor">#ifdef GAUSSIAN</span>
00018 <span class="preprocessor"></span>  <span class="keywordtype">unsigned</span> test_fg=1;
00019 <span class="preprocessor">#else</span>
00020 <span class="preprocessor"></span>  <span class="keywordtype">unsigned</span> test_fg=0;
00021 <span class="preprocessor">#endif</span>
00022 <span class="preprocessor"></span>
00023 <span class="preprocessor">#ifdef MEASURE_TIME_FFTW</span>
00024 <span class="preprocessor"></span>  <span class="keywordtype">unsigned</span> test_fftw=1;
00025 <span class="preprocessor">#else</span>
00026 <span class="preprocessor"></span>  <span class="keywordtype">unsigned</span> test_fftw=0;
00027 <span class="preprocessor">#endif</span>
00028 <span class="preprocessor"></span>
00029 <span class="preprocessor">#ifdef MEASURE_TIME</span>
00030 <span class="preprocessor"></span>  <span class="keywordtype">unsigned</span> test=1;
00031 <span class="preprocessor">#else</span>
00032 <span class="preprocessor"></span>  <span class="keywordtype">unsigned</span> test=0;
00033 <span class="preprocessor">#endif</span>
00034 <span class="preprocessor"></span>
00035 <span class="keywordtype">void</span> flags_cp(<a class="code" href="structnfft__plan.html">nfft_plan</a> *dst, <a class="code" href="structnfft__plan.html">nfft_plan</a> *src)
00036 {
00037   dst-&gt;x=src-&gt;x;
00038   dst-&gt;f_hat=src-&gt;f_hat;
00039   dst-&gt;f=src-&gt;f;
00040   dst-&gt;g1=src-&gt;g1;
00041   dst-&gt;g2=src-&gt;g2;
00042   dst-&gt;my_fftw_plan1=src-&gt;my_fftw_plan1;
00043   dst-&gt;my_fftw_plan2=src-&gt;my_fftw_plan2;
00044 }
00045 
00046 <span class="keywordtype">void</span> time_accuracy(<span class="keywordtype">int</span> d, <span class="keywordtype">int</span> N, <span class="keywordtype">int</span> M, <span class="keywordtype">int</span> n, <span class="keywordtype">int</span> m, <span class="keywordtype">unsigned</span> test_ndft,
00047                    <span class="keywordtype">unsigned</span> test_pre_full_psi)
00048 {
00049   <span class="keywordtype">int</span> r, NN[d], nn[d];
00050   <span class="keywordtype">double</span> t_ndft, t, e;
00051   <span class="keywordtype">double</span> complex *swapndft;
00052 
00053   <a class="code" href="structnfft__plan.html">nfft_plan</a> p;
00054   <a class="code" href="structnfft__plan.html">nfft_plan</a> p_pre_phi_hut;
00055   <a class="code" href="structnfft__plan.html">nfft_plan</a> p_fg_psi;
00056   <a class="code" href="structnfft__plan.html">nfft_plan</a> p_pre_lin_psi;
00057   <a class="code" href="structnfft__plan.html">nfft_plan</a> p_pre_fg_psi;
00058   <a class="code" href="structnfft__plan.html">nfft_plan</a> p_pre_psi;
00059   <a class="code" href="structnfft__plan.html">nfft_plan</a> p_pre_full_psi;
00060 
00061   printf(<span class="stringliteral">"%d\t%d\t"</span>, d, N);
00062 
00063   <span class="keywordflow">for</span>(r=0; r&lt;d; r++)
00064     {
00065       NN[r]=N;
00066       nn[r]=n;
00067     }
00068 
00070   <span class="keywordflow">if</span>(test_ndft)
00071     swapndft=(<span class="keywordtype">double</span> complex*)fftw_malloc(M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00072 
00073   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;p, d, NN, M, nn, m,
00074                  MALLOC_X| MALLOC_F_HAT| MALLOC_F|
00075      FFTW_INIT| FFT_OUT_OF_PLACE,
00076      FFTW_MEASURE| FFTW_DESTROY_INPUT);
00077 
00079   <a class="code" href="group__nfftutil.html#ga47">nfft_vrand_shifted_unit_double</a>(p.<a class="code" href="structnfft__plan.html#o14">x</a>, p.<a class="code" href="structnfft__plan.html#o4">d</a>*p.<a class="code" href="structnfft__plan.html#o1">M_total</a>);
00080 
00081   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;p_pre_phi_hut, d, NN, M, nn, m, PRE_PHI_HUT,0);
00082   flags_cp(&amp;p_pre_phi_hut, &amp;p);
00083   <a class="code" href="group__nfft.html#ga10">nfft_precompute_one_psi</a>(&amp;p_pre_phi_hut);
00084 
00085   <span class="keywordflow">if</span>(test_fg)
00086     {
00087       <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;p_fg_psi, d, NN, M, nn, m, FG_PSI,0);
00088       flags_cp(&amp;p_fg_psi, &amp;p);
00089       <a class="code" href="group__nfft.html#ga10">nfft_precompute_one_psi</a>(&amp;p_fg_psi);
00090     }
00091 
00092   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;p_pre_lin_psi, d, NN, M, nn, m, PRE_LIN_PSI,0);
00093   flags_cp(&amp;p_pre_lin_psi, &amp;p);
00094   <a class="code" href="group__nfft.html#ga10">nfft_precompute_one_psi</a>(&amp;p_pre_lin_psi);
00095 
00096   <span class="keywordflow">if</span>(test_fg)
00097     {
00098       <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;p_pre_fg_psi, d, NN, M, nn, m, PRE_FG_PSI,0);
00099       flags_cp(&amp;p_pre_fg_psi, &amp;p);
00100       <a class="code" href="group__nfft.html#ga10">nfft_precompute_one_psi</a>(&amp;p_pre_fg_psi);
00101     }
00102 
00103   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;p_pre_psi, d, NN, M, nn, m, PRE_PSI,0);
00104   flags_cp(&amp;p_pre_psi, &amp;p);
00105   <a class="code" href="group__nfft.html#ga10">nfft_precompute_one_psi</a>(&amp;p_pre_psi);
00106 
00107   <span class="keywordflow">if</span>(test_pre_full_psi)
00108     {
00109       <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;p_pre_full_psi, d, NN, M, nn, m, PRE_FULL_PSI,0);
00110       flags_cp(&amp;p_pre_full_psi, &amp;p);
00111       <a class="code" href="group__nfft.html#ga10">nfft_precompute_one_psi</a>(&amp;p_pre_full_psi);
00112     }
00113 
00115   <a class="code" href="group__nfftutil.html#ga46">nfft_vrand_unit_complex</a>(p.<a class="code" href="structnfft__plan.html#o2">f_hat</a>, p.<a class="code" href="structnfft__plan.html#o0">N_total</a>);
00116 
00118   <span class="keywordflow">if</span>(test_ndft)
00119     {
00120       <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(p.<a class="code" href="structnfft__plan.html#o3">f</a>,swapndft);
00121       
00122       t_ndft=0;
00123       r=0; 
00124       <span class="keywordflow">while</span>(t_ndft&lt;0.01)
00125         {
00126           r++;
00127           t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00128           <a class="code" href="group__nfft.html#ga0">ndft_trafo</a>(&amp;p);
00129           t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-t;
00130           t_ndft+=t;
00131         }
00132       t_ndft/=r;
00133 
00134       <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(p.<a class="code" href="structnfft__plan.html#o3">f</a>,swapndft);
00135     }
00136   <span class="keywordflow">else</span>
00137     t_ndft=nan(<span class="stringliteral">""</span>);
00138 
00140   <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;p);
00141   <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;p_pre_phi_hut);
00142   <span class="keywordflow">if</span>(test_fg)
00143     <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;p_fg_psi);
00144   <span class="keywordflow">else</span>
00145     p_fg_psi.<a class="code" href="structnfft__plan.html#o15">MEASURE_TIME_t</a>[2]=nan(<span class="stringliteral">""</span>);
00146   <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;p_pre_lin_psi);
00147   <span class="keywordflow">if</span>(test_fg)
00148     <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;p_pre_fg_psi);
00149   <span class="keywordflow">else</span>
00150     p_pre_fg_psi.<a class="code" href="structnfft__plan.html#o15">MEASURE_TIME_t</a>[2]=nan(<span class="stringliteral">""</span>);
00151   <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;p_pre_psi);
00152   <span class="keywordflow">if</span>(test_pre_full_psi)
00153     <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;p_pre_full_psi);
00154   <span class="keywordflow">else</span>
00155     p_pre_full_psi.<a class="code" href="structnfft__plan.html#o15">MEASURE_TIME_t</a>[2]=nan(<span class="stringliteral">""</span>);
00156 
00157   <span class="keywordflow">if</span>(test_fftw==0)
00158     p.<a class="code" href="structnfft__plan.html#o15">MEASURE_TIME_t</a>[1]=nan(<span class="stringliteral">""</span>);
00159 
00160   <span class="keywordflow">if</span>(test_ndft)
00161     e=<a class="code" href="group__nfftutil.html#ga41">nfft_error_l_2_complex</a>(swapndft, p.<a class="code" href="structnfft__plan.html#o3">f</a>, p.<a class="code" href="structnfft__plan.html#o1">M_total</a>);
00162   <span class="keywordflow">else</span>
00163     e=nan(<span class="stringliteral">""</span>);
00164 
00165   printf(<span class="stringliteral">"%.2e\t%d\t%.2e\t%.2e\t%.2e\t%.2e\t%.2e\t%.2e\t%.2e\t%.2e\t%.2e\t%.2e\n"</span>,
00166          t_ndft,
00167          m,
00168          e,
00169          p.<a class="code" href="structnfft__plan.html#o15">MEASURE_TIME_t</a>[0],
00170          p_pre_phi_hut.<a class="code" href="structnfft__plan.html#o15">MEASURE_TIME_t</a>[0],
00171 
00172          p.<a class="code" href="structnfft__plan.html#o15">MEASURE_TIME_t</a>[1],
00173 
00174          p.<a class="code" href="structnfft__plan.html#o15">MEASURE_TIME_t</a>[2],
00175          p_fg_psi.<a class="code" href="structnfft__plan.html#o15">MEASURE_TIME_t</a>[2],
00176          p_pre_lin_psi.<a class="code" href="structnfft__plan.html#o15">MEASURE_TIME_t</a>[2],
00177          p_pre_fg_psi.<a class="code" href="structnfft__plan.html#o15">MEASURE_TIME_t</a>[2],
00178          p_pre_psi.<a class="code" href="structnfft__plan.html#o15">MEASURE_TIME_t</a>[2],
00179          p_pre_full_psi.<a class="code" href="structnfft__plan.html#o15">MEASURE_TIME_t</a>[2]);
00180 
00181   fflush(stdout);
00182 
00184   <span class="keywordflow">if</span>(test_pre_full_psi)
00185     <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;p_pre_full_psi);
00186   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;p_pre_psi);
00187   <span class="keywordflow">if</span>(test_fg)
00188     <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;p_pre_fg_psi);
00189   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;p_pre_lin_psi);
00190   <span class="keywordflow">if</span>(test_fg)
00191     <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;p_fg_psi);
00192   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;p_pre_phi_hut);
00193   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;p);
00194 
00195   <span class="keywordflow">if</span>(test_ndft)
00196     fftw_free(swapndft);
00197 }
00198 
<a name="l00199"></a><a class="code" href="flags_8c.html#a5">00199</a> <span class="keywordtype">void</span> <a class="code" href="flags_8c.html#a5">accuracy_pre_lin_psi</a>(<span class="keywordtype">int</span> d, <span class="keywordtype">int</span> N, <span class="keywordtype">int</span> M, <span class="keywordtype">int</span> n, <span class="keywordtype">int</span> m, <span class="keywordtype">int</span> K)
00200 {
00201   <span class="keywordtype">int</span> r, NN[d], nn[d];
00202   <span class="keywordtype">double</span> e;
00203   <span class="keywordtype">double</span> complex *swapndft;
00204 
00205   <a class="code" href="structnfft__plan.html">nfft_plan</a> p;
00206 
00207   <span class="keywordflow">for</span>(r=0; r&lt;d; r++)
00208     {
00209       NN[r]=N;
00210       nn[r]=n;
00211     }
00212 
00214   swapndft=(<span class="keywordtype">double</span> complex*)fftw_malloc(M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00215 
00216   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;p, d, NN, M, nn, m,
00217                  <a class="code" href="group__nfft.html#ga22">MALLOC_X</a>| <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>| <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>|
00218                  <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#ga18">PRE_LIN_PSI</a>|
00219      <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a>| <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00220      FFTW_MEASURE| FFTW_DESTROY_INPUT);
00221 
00223   fftw_free(p.<a class="code" href="structnfft__plan.html#o19">psi</a>);
00224   p.<a class="code" href="structnfft__plan.html#o11">K</a>=K;
00225   p.<a class="code" href="structnfft__plan.html#o19">psi</a>=(<span class="keywordtype">double</span>*) fftw_malloc((p.<a class="code" href="structnfft__plan.html#o11">K</a>+1)*p.<a class="code" href="structnfft__plan.html#o4">d</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00226 
00228   <a class="code" href="group__nfft.html#ga10">nfft_precompute_one_psi</a>(&amp;p);
00229 
00231   <a class="code" href="group__nfftutil.html#ga47">nfft_vrand_shifted_unit_double</a>(p.<a class="code" href="structnfft__plan.html#o14">x</a>, p.<a class="code" href="structnfft__plan.html#o4">d</a>*p.<a class="code" href="structnfft__plan.html#o1">M_total</a>);
00232 
00234   <a class="code" href="group__nfftutil.html#ga46">nfft_vrand_unit_complex</a>(p.<a class="code" href="structnfft__plan.html#o2">f_hat</a>, p.<a class="code" href="structnfft__plan.html#o0">N_total</a>);
00235 
00237   <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(p.<a class="code" href="structnfft__plan.html#o3">f</a>,swapndft);
00238   <a class="code" href="group__nfft.html#ga0">ndft_trafo</a>(&amp;p);
00239   <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(p.<a class="code" href="structnfft__plan.html#o3">f</a>,swapndft);
00240 
00242   <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;p);
00243   e=<a class="code" href="group__nfftutil.html#ga41">nfft_error_l_2_complex</a>(swapndft, p.<a class="code" href="structnfft__plan.html#o3">f</a>, p.<a class="code" href="structnfft__plan.html#o1">M_total</a>);
00244 
00245   <span class="comment">//  printf("%d\t%d\t%d\t%d\t%.2e\n",d,N,m,K,e);</span>
00246   printf(<span class="stringliteral">"$%.1e$&amp;\t"</span>,e);
00247 
00248   fflush(stdout);
00249 
00251   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;p);
00252   fftw_free(swapndft);
00253 }
00254 
00255 
<a name="l00256"></a><a class="code" href="flags_8c.html#a6">00256</a> <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a>(<span class="keywordtype">int</span> argc,<span class="keywordtype">char</span> **argv)
00257 {
00258   <span class="keywordtype">int</span> l,m,d,trial,N;
00259 
00260   <span class="keywordflow">if</span>(argc&lt;=2)
00261     {
00262       fprintf(stderr,<span class="stringliteral">"flags type first last trials d m\n"</span>);
00263       <span class="keywordflow">return</span> -1;
00264     }
00265 
00266   <span class="keywordflow">if</span>((test==0)&amp;&amp;(atoi(argv[1])&lt;2))
00267     {
00268       fprintf(stderr,<span class="stringliteral">"MEASURE_TIME in options.h not set\n"</span>);
00269       <span class="keywordflow">return</span> -1;
00270     }
00271 
00272   fprintf(stderr,<span class="stringliteral">"Testing different precomputation schemes for the nfft.\n"</span>);
00273   fprintf(stderr,<span class="stringliteral">"Columns: d, N=M, t_ndft, e_nfft, t_D, t_pre_phi_hut, "</span>);
00274   fprintf(stderr,<span class="stringliteral">"t_fftw, t_B, t_fg_psi, t_pre_lin_psi, t_pre_fg_psi, "</span>);
00275   fprintf(stderr,<span class="stringliteral">"t_pre_psi, t_pre_full_psi\n\n"</span>);
00276 
00277   d=atoi(argv[5]);
00278   m=atoi(argv[6]);
00279 
00280   <span class="comment">/* time vs. N=M */</span>
00281   <span class="keywordflow">if</span>(atoi(argv[1])==0)
00282     <span class="keywordflow">for</span>(l=atoi(argv[2]); l&lt;=atoi(argv[3]); l++)
00283       <span class="keywordflow">for</span>(trial=0; trial&lt;atoi(argv[4]); trial++)
00284   {
00285     <span class="keywordflow">if</span>(l&lt;=20)
00286       time_accuracy(d, (1U&lt;&lt; l), (1U&lt;&lt; (d*l)), (1U&lt;&lt; (l+1)), m, 0, 0);
00287     <span class="keywordflow">else</span>
00288       time_accuracy(d, (1U&lt;&lt; l), (1U&lt;&lt; (d*l)), (1U&lt;&lt; (l+1)), m, 0, 0);
00289   }
00290 
00291   d=atoi(argv[5]);
00292   N=atoi(argv[6]);
00293 
00294   <span class="comment">/* accuracy vs. time */</span>
00295   <span class="keywordflow">if</span>(atoi(argv[1])==1)
00296     <span class="keywordflow">for</span>(m=atoi(argv[2]); m&lt;=atoi(argv[3]); m++)
00297       <span class="keywordflow">for</span>(trial=0; trial&lt;atoi(argv[4]); trial++)
00298         time_accuracy(d, N, (<span class="keywordtype">int</span>)pow(N,d), 2*N, m, 1, 1);
00299 
00300   d=atoi(argv[5]);
00301   N=atoi(argv[6]);
00302   m=atoi(argv[7]);
00303 
00304   <span class="comment">/* accuracy vs. K for linear interpolation, assumes (m+1)|K */</span>
00305   <span class="keywordflow">if</span>(atoi(argv[1])==2)
00306     {
00307       printf(<span class="stringliteral">"$\\log_2(K/(m+1))$&amp;\t"</span>);
00308       <span class="keywordflow">for</span>(l=atoi(argv[2]); l&lt;atoi(argv[3]); l++)
00309   printf(<span class="stringliteral">"$%d$&amp;\t"</span>,l);
00310 
00311       printf(<span class="stringliteral">"$%d$\\\\\n"</span>,atoi(argv[3]));
00312 
00313       printf(<span class="stringliteral">"$\\tilde E_2$&amp;\t"</span>);
00314       <span class="keywordflow">for</span>(l=atoi(argv[2]); l&lt;=atoi(argv[3]); l++)
00315   <a class="code" href="flags_8c.html#a5">accuracy_pre_lin_psi</a>(d, N, (<span class="keywordtype">int</span>)pow(N,d), 2*N, m, (m+1)*(1U&lt;&lt; l));
00316 
00317       printf(<span class="stringliteral">"\n"</span>);
00318     }
00319       
00320   <span class="keywordflow">return</span> 1;
00321 }
</pre></div>    <hr size="1"/>
    Generated on 22 Jan 2007 by Doxygen 1.4.1
  </body>
</html>
