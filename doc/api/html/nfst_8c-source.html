<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.3 API Reference - NFFT: nfst.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.3 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000003.html">kernel</a>&nbsp;/&nbsp;<a class="el" href="dir_000026.html">nfst</a></div>
<h1>nfst.c</h1><div class="fragment"><pre class="fragment">00001 
00007 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00008 <span class="preprocessor">#include &lt;math.h&gt;</span>
00009 <span class="preprocessor">#include &lt;string.h&gt;</span>
00010 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00011 
00012 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00013 <span class="preprocessor">#include "options.h"</span>
00014 <span class="preprocessor">#include "window_defines.h"</span>
00015 
00016 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00017 
00018 
00022 <span class="preprocessor">#define NFST_DEFAULT_FLAGS   PRE_PHI_HUT|\</span>
00023 <span class="preprocessor">                             PRE_PSI|\</span>
00024 <span class="preprocessor">                             MALLOC_X|\</span>
00025 <span class="preprocessor">                             MALLOC_F_HAT|\</span>
00026 <span class="preprocessor">                             MALLOC_F|\</span>
00027 <span class="preprocessor">                             FFTW_INIT|\</span>
00028 <span class="preprocessor">                             FFT_OUT_OF_PLACE</span>
00029 <span class="preprocessor"></span>
00030 <span class="preprocessor">#define FFTW_DEFAULT_FLAGS   FFTW_ESTIMATE|\</span>
00031 <span class="preprocessor">                             FFTW_DESTROY_INPUT</span>
00032 <span class="preprocessor"></span>
00033 <span class="preprocessor">#define NFST_SUMMANDS ( 2 * ths-&gt;m + 2)</span>
00034 <span class="preprocessor"></span><span class="preprocessor">#define NODE(p,r) ( ths-&gt;x[(p) * ths-&gt;d + (r)])</span>
00035 <span class="preprocessor"></span>
00036 <span class="preprocessor">#define MACRO_ndst_init_result_trafo      \</span>
00037 <span class="preprocessor">  memset( f, 0, ths-&gt;M_total * sizeof( double));</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_ndst_init_result_adjoint \</span>
00039 <span class="preprocessor">  memset( f_hat, 0, ths-&gt;N_total * sizeof( double));</span>
00040 <span class="preprocessor"></span>
00041 
00042 <span class="preprocessor">#define MACRO_nfst_D_init_result_A        \</span>
00043 <span class="preprocessor">  memset(g_hat, 0, nfst_prod_minus_a_int( ths-&gt;n, 0, ths-&gt;d) * sizeof( double));  </span>
00044 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_nfst_D_init_result_T        \</span>
00045 <span class="preprocessor">  memset(f_hat, 0, ths-&gt;N_total * sizeof( double));  </span>
00046 <span class="preprocessor"></span>
00047 <span class="preprocessor">#define MACRO_nfst_B_init_result_A        \</span>
00048 <span class="preprocessor">  memset(f, 0,     ths-&gt;M_total * sizeof( double));  </span>
00049 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_nfst_B_init_result_T        \</span>
00050 <span class="preprocessor">  memset(g, 0, nfst_prod_minus_a_int( ths-&gt;n, 0, ths-&gt;d) * sizeof( double));  </span>
00051 <span class="preprocessor"></span>
00052  
00053 <span class="preprocessor">#define NFST_PRE_WINFUN( d)  ths-&gt;N[d] = 2 * ths-&gt;N[d];         \</span>
00054 <span class="preprocessor">                             ths-&gt;n[d] = nfst_fftw_2N( ths-&gt;n[d]);</span>
00055 <span class="preprocessor"></span>
00056 <span class="preprocessor">#define NFST_POST_WINFUN( d) ths-&gt;N[d] = ((int)(0.5 * ths-&gt;N[d]));   \</span>
00057 <span class="preprocessor">                             ths-&gt;n[d] = nfst_fftw_2N_rev( ths-&gt;n[d]);</span>
00058 <span class="preprocessor"></span>
00059 
00060 <span class="preprocessor">#define NFST_WINDOW_HELP_INIT  WINDOW_HELP_INIT</span>
00061 <span class="preprocessor"></span>
00062 
<a name="l00063"></a><a class="code" href="group__nfsct.html#ga28">00063</a> <span class="keywordtype">double</span> <a class="code" href="group__nfsct.html#ga28">nfst_phi_hut</a>( <a class="code" href="structnfst__plan.html">nfst_plan</a> *ths, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> d)
00064 {
00065   NFST_PRE_WINFUN( d);
00066   <span class="keywordtype">double</span> phi_hut_tmp = PHI_HUT( k, d);
00067   NFST_POST_WINFUN( d);
00068 
00069   <span class="keywordflow">return</span> phi_hut_tmp;
00070 }
00071 
<a name="l00072"></a><a class="code" href="group__nfsct.html#ga29">00072</a> <span class="keywordtype">double</span> <a class="code" href="group__nfsct.html#ga29">nfst_phi</a>( <a class="code" href="structnfst__plan.html">nfst_plan</a> *ths, <span class="keywordtype">double</span> x, <span class="keywordtype">int</span> d)
00073 {
00074   NFST_PRE_WINFUN( d); 
00075   <span class="keywordtype">double</span> phi_tmp = PHI( x, d); 
00076   NFST_POST_WINFUN( d); 
00077  
00078   <span class="keywordflow">return</span> phi_tmp; 
00079 } 
00080 
<a name="l00081"></a><a class="code" href="group__nfsct.html#ga30">00081</a> <span class="keywordtype">int</span> <a class="code" href="group__nfsct.html#ga30">nfst_fftw_2N</a>( <span class="keywordtype">int</span> n)
00082 {
00083   <span class="keywordflow">return</span> 2 * ( n + 1);
00084 }
00085 
<a name="l00086"></a><a class="code" href="group__nfsct.html#ga31">00086</a> <span class="keywordtype">int</span> <a class="code" href="group__nfsct.html#ga31">nfst_fftw_2N_rev</a>( <span class="keywordtype">int</span> n)
00087 {
00088   div_t n_div;
00089   
00090   n_div = div(n, 2);
00091   <span class="keywordflow">return</span> n_div.quot - 1;
00092 }
00093 
00094 <span class="preprocessor">#define MACRO_with_sin_vec     sin_vec[t][ka[t]] </span>
00095 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_without_sin_vec  sin( 2.0 * PI * (ka[t]+1) * NODE(j,t)) </span>
00096 <span class="preprocessor"></span> 
00097  
00098 <span class="preprocessor">#define MACRO_with_PRE_PHI_HUT     ths-&gt;c_phi_inv[t][kg[t]]; </span>
00099 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_compute_PHI_HUT_INV  (1.0 / (nfst_phi_hut( ths, kg[t]+1, t)))</span>
00100 <span class="preprocessor"></span>
00101 <span class="preprocessor">#define MACRO_with_PRE_PSI     ths-&gt;psi[(j * ths-&gt;d + t) * NFST_SUMMANDS + lc[t]];  </span>
00102 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_compute_PSI      \</span>
00103 <span class="preprocessor">  nfst_phi( ths, NODE(j,t) - (( double)(lc[t] + lb[t])) / nfst_fftw_2N( ths-&gt;n[t]), t)  </span>
00104 <span class="preprocessor"></span>
00105 
00106 
00122 <span class="preprocessor">#define MACRO_ndst_malloc__sin_vec                                              \</span>
00123 <span class="preprocessor">                                                                                \</span>
00124 <span class="preprocessor">  double **sin_vec;                                                             \</span>
00125 <span class="preprocessor">  sin_vec = (double**)malloc( ths-&gt;d * sizeof( double*));                       \</span>
00126 <span class="preprocessor">  for( t = 0; t &lt; ths-&gt;d; t++)                                                  \</span>
00127 <span class="preprocessor">    sin_vec[t] = (double*)malloc( ( ths-&gt;N[t] - 1) * sizeof( double));          \</span>
00128 <span class="preprocessor"></span>
00129 <span class="preprocessor"></span>
00130 
00131 
00132 <span class="preprocessor">#define MACRO_ndst_free__sin_vec                                                \</span>
00133 <span class="preprocessor">{                                                                               \</span>
00134 <span class="preprocessor">  </span><span class="comment">/* free allocated memory */</span>                                                   \
00135   for( t = 0; t &lt; ths-&gt;d; t++)                                                  \
00136     free( sin_vec[t]);                                                          \
00137   free( sin_vec);                                                               \
00138 }
00139 
00140 
00141 
00142 <span class="preprocessor">#define MACRO_ndst_init__sin_vec                                                \</span>
00143 <span class="preprocessor">{                                                                               \</span>
00144 <span class="preprocessor">  for( t = 0; t &lt; ths-&gt;d; t++)                                                  \</span>
00145 <span class="preprocessor">  {                                                                             \</span>
00146 <span class="preprocessor">    cos_x[t] = cos( 2.0 * PI * NODE(j,t));                                      \</span>
00147 <span class="preprocessor">    sin_vec[t][0] = sin( 2.0 * PI * NODE(j,t));                                 \</span>
00148 <span class="preprocessor">    sin_vec[t][1] = sin( 4.0 * PI * NODE(j,t));                                 \</span>
00149 <span class="preprocessor">    for( k = 2; k &lt; ths-&gt;N[t] - 1; k++)                                         \</span>
00150 <span class="preprocessor">      sin_vec[t][k] = 2.0 * cos_x[t] * sin_vec[t][k-1]                          \</span>
00151 <span class="preprocessor">                      - sin_vec[t][k-2];                                        \</span>
00152 <span class="preprocessor">  }                                                                             \</span>
00153 <span class="preprocessor">}</span>
00154 <span class="preprocessor"></span>
00155 
00156 <span class="preprocessor">#define MACRO_ndst_init__k__sin_k( which_one)                                   \</span>
00157 <span class="preprocessor">{                                                                               \</span>
00158 <span class="preprocessor">  sin_k[0] = 1.0;                                                               \</span>
00159 <span class="preprocessor">  for( t = 0; t &lt; ths-&gt;d; t++)                                                  \</span>
00160 <span class="preprocessor">    ka[t] = 0;                                                                  \</span>
00161 <span class="preprocessor">                                                                                \</span>
00162 <span class="preprocessor">  for( t = 0; t &lt; ths-&gt;d; t++)                                                  \</span>
00163 <span class="preprocessor">  {                                                                             \</span>
00164 <span class="preprocessor">    sin_k[t+1] = sin_k[t] * MACRO_ ##which_one;                                 \</span>
00165 <span class="preprocessor">  }                                                                             \</span>
00166 <span class="preprocessor">}</span>
00167 <span class="preprocessor"></span>
00168 
00169 <span class="preprocessor">#define MACRO_ndst_count__k__sin_k( which_one)                                  \</span>
00170 <span class="preprocessor">{                                                                               \</span>
00171 <span class="preprocessor">  ka[ths-&gt;d-1]++;                                                               \</span>
00172 <span class="preprocessor">  i = ths-&gt;d - 1;                                                               \</span>
00173 <span class="preprocessor">  while( ( ka[i] == ths-&gt;N[i] - 1) &amp;&amp; ( i &gt; 0))                                 \</span>
00174 <span class="preprocessor">  {                                                                             \</span>
00175 <span class="preprocessor">    ka[i - 1]++;                                                                \</span>
00176 <span class="preprocessor">    ka[i] = 0;                                                                  \</span>
00177 <span class="preprocessor">                                                                                \</span>
00178 <span class="preprocessor">    i--;                                                                        \</span>
00179 <span class="preprocessor">  }                                                                             \</span>
00180 <span class="preprocessor">  for( t = i; t &lt; ths-&gt;d; t++)                                                  \</span>
00181 <span class="preprocessor">    sin_k[t+1] = sin_k[t] * MACRO_ ##which_one;                                 \</span>
00182 <span class="preprocessor">}</span>
00183 <span class="preprocessor"></span>
00184 
00185 <span class="preprocessor">#define MACRO_ndst_compute__trafo                                               \</span>
00186 <span class="preprocessor">{                                                                               \</span>
00187 <span class="preprocessor">  f[j] += f_hat[k] * sin_k[ths-&gt;d];                                             \</span>
00188 <span class="preprocessor">}</span>
00189 <span class="preprocessor"></span>
00190 <span class="preprocessor">#define MACRO_ndst_compute__adjoint                                             \</span>
00191 <span class="preprocessor">{                                                                               \</span>
00192 <span class="preprocessor">  f_hat[k] += f[j] * sin_k[ths-&gt;d];                                             \</span>
00193 <span class="preprocessor">}</span>
00194 <span class="preprocessor"></span>
00195 
00196 <span class="comment">/* slow (trafo) transform */</span>
00197 <span class="preprocessor">#define MACRO_ndst( which_one)                                                  \</span>
00198 <span class="preprocessor">  void ndst_ ## which_one ( nfst_plan *ths)                                     \</span>
00199 <span class="preprocessor">  {                                                                             \</span>
00200 <span class="preprocessor">    int j, k, t, i;                                                             \</span>
00201 <span class="preprocessor">    int ka[ths-&gt;d];                                                             \</span>
00202 <span class="preprocessor">    double sin_k[ths-&gt;d+1];                                                     \</span>
00203 <span class="preprocessor">    double cos_x[ths-&gt;d];                                                       \</span>
00204 <span class="preprocessor">                                                                                \</span>
00205 <span class="preprocessor">    double *f     = ths-&gt;f;                                                     \</span>
00206 <span class="preprocessor">    double *f_hat = ths-&gt;f_hat;                                                 \</span>
00207 <span class="preprocessor">                                                                                \</span>
00208 <span class="preprocessor">    MACRO_ndst_init_result_ ## which_one;                                       \</span>
00209 <span class="preprocessor">                                                                                \</span>
00210 <span class="preprocessor">    if( ths-&gt;d == 1)                                                            \</span>
00211 <span class="preprocessor">      for( j = 0; j &lt; ths-&gt;M_total; j++)                                        \</span>
00212 <span class="preprocessor">        for( k = 0; k &lt; ths-&gt;N_total; k++)                                      \</span>
00213 <span class="preprocessor">        {                                                                       \</span>
00214 <span class="preprocessor">          sin_k[ths-&gt;d] = sin( 2.0 * PI * (k+1) * NODE(j,0));                   \</span>
00215 <span class="preprocessor">          MACRO_ndst_compute__ ## which_one;                                    \</span>
00216 <span class="preprocessor">        }                                                                       \</span>
00217 <span class="preprocessor">    else                                                                        \</span>
00218 <span class="preprocessor">      if( 1 == 0) </span><span class="comment">/*FIXME: remove slow slow ... */</span>                              \
00219         <span class="comment">/* slow ndst */</span>                                                         \
00220         for( j = 0; j &lt; ths-&gt;M_total; j++)                                      \
00221         {                                                                       \
00222           MACRO_ndst_init__k__sin_k(without_sin_vec);                           \
00223                                                                                 \
00224           for( k = 0; k &lt; ths-&gt;N_total; k++)                                    \
00225           {                                                                     \
00226             MACRO_ndst_compute__ ## which_one;                                  \
00227                                                                                 \
00228             MACRO_ndst_count__k__sin_k(without_sin_vec);                        \
00229           }                                                                     \
00230         }                                                                       \
00231       else                                                                      \
00232       {                                                                         \
00233         <span class="comment">/* fast ndst_trafo */</span>                                                   \
00234         MACRO_ndst_malloc__sin_vec;                                             \
00235                                                                                 \
00236         for( j = 0; j &lt; ths-&gt;M_total; j++)                                      \
00237         {                                                                       \
00238           MACRO_ndst_init__sin_vec;                                             \
00239                                                                                 \
00240           MACRO_ndst_init__k__sin_k(with_sin_vec);                              \
00241                                                                                 \
00242           for( k = 0; k &lt; ths-&gt;N_total; k++)                                    \
00243           {                                                                     \
00244             MACRO_ndst_compute__ ## which_one;                                  \
00245                                                                                 \
00246             MACRO_ndst_count__k__sin_k(with_sin_vec);                           \
00247           }                                                                     \
00248         }                                                                       \
00249         MACRO_ndst_free__sin_vec;                                               \
00250       }                                                                         \
00251   } <span class="comment">/* ndst_{trafo, adjoint} */</span>
00252 
00253  
<a name="l00254"></a><a class="code" href="group__nfsct.html#ga23">00254</a> MACRO_ndst(trafo)
<a name="l00255"></a><a class="code" href="group__nfsct.html#ga25">00255</a> MACRO_ndst(adjoint)
00256 
00257 
00258 
00259 
00274 #define MACRO_nfst__lower_boundary( j,act_dim)                                  \
00275 {                                                                               \
00276   lb[(act_dim)] =                                                               \
00277     ((int)(NODE((j),(act_dim)) * <a class="code" href="group__nfsct.html#ga30">nfst_fftw_2N</a>( ths-&gt;n[(act_dim)]))) - ths-&gt;m;   \
00278 }
00279 
00280 <span class="preprocessor">#define MACRO_nfst_D_compute_A                                                  \</span>
00281 <span class="preprocessor">{                                                                               \</span>
00282 <span class="preprocessor">  g_hat[kg_plain[ths-&gt;d]] = f_hat[k_L] * c_phi_inv_k[ths-&gt;d];                   \</span>
00283 <span class="preprocessor">}</span>
00284 <span class="preprocessor"></span>
00285 <span class="preprocessor">#define MACRO_nfst_D_compute_T                                                  \</span>
00286 <span class="preprocessor">{                                                                               \</span>
00287 <span class="preprocessor">  f_hat[k_L] = g_hat[kg_plain[ths-&gt;d]] * c_phi_inv_k[ths-&gt;d];                   \</span>
00288 <span class="preprocessor">}</span>
00289 <span class="preprocessor"></span>
00290 
00291 <span class="preprocessor">#define MACRO_init__kg                                                          \</span>
00292 <span class="preprocessor">{                                                                               \</span>
00293 <span class="preprocessor">  for( t = 0; t &lt; ths-&gt;d; t++)                                                  \</span>
00294 <span class="preprocessor">    kg[t] = 0;                                                                  \</span>
00295 <span class="preprocessor">                                                                                \</span>
00296 <span class="preprocessor">  i = 0;                                                                        \</span>
00297 <span class="preprocessor">}</span>
00298 <span class="preprocessor"></span>
00299 
00300 <span class="preprocessor">#define MACRO_count__kg                                                         \</span>
00301 <span class="preprocessor">{                                                                               \</span>
00302 <span class="preprocessor">  kg[ths-&gt;d - 1]++;                                                             \</span>
00303 <span class="preprocessor">  i = ths-&gt;d - 1;                                                               \</span>
00304 <span class="preprocessor">  while( ( kg[i] == ths-&gt;N[i] - 1) &amp;&amp; ( i &gt; 0))                                 \</span>
00305 <span class="preprocessor">  {                                                                             \</span>
00306 <span class="preprocessor">    kg[i - 1]++;                                                                \</span>
00307 <span class="preprocessor">    kg[i] = 0;                                                                  \</span>
00308 <span class="preprocessor">                                                                                \</span>
00309 <span class="preprocessor">    i--;                                                                        \</span>
00310 <span class="preprocessor">  }                                                                             \</span>
00311 <span class="preprocessor">}</span>
00312 <span class="preprocessor"></span>
00313   
00314 <span class="preprocessor">#define MACRO_update__c_phi_inv_k__lg_plain( which_one, which_phi)              \</span>
00315 <span class="preprocessor">{                                                                               \</span>
00316 <span class="preprocessor">  for( t = i; t &lt; ths-&gt;d; t++) {                                                \</span>
00317 <span class="preprocessor">    MACRO__c_phi_inv_k( which_phi);                                             \</span>
00318 <span class="preprocessor">    kg_plain[t+1] = kg_plain[t] * ths-&gt;n[t] + kg[t];                            \</span>
00319 <span class="preprocessor">  }                                                                             \</span>
00320 <span class="preprocessor">}</span>
00321 <span class="preprocessor"></span>
00322 
00323 <span class="preprocessor">#define MACRO__c_phi_inv_k( which_phi)                                          \</span>
00324 <span class="preprocessor">{                                                                               \</span>
00325 <span class="preprocessor">  c_phi_inv_k[t+1] = 0.5 * c_phi_inv_k[t] * MACRO_ ## which_phi;                \</span>
00326 <span class="preprocessor">}</span>
00327 <span class="preprocessor"></span>
00328 
00329 <span class="preprocessor">#define MACRO_nfst_D(which_one)                                                 \</span>
00330 <span class="preprocessor">inline void nfst_D_ ## which_one (nfst_plan *ths)                               \</span>
00331 <span class="preprocessor">{                                                                               \</span>
00332 <span class="preprocessor">  int k_L;                                    \</span>
00333 <span class="preprocessor">                                                                                \</span>
00334 <span class="preprocessor">  int i, t;                                                                     \</span>
00335 <span class="preprocessor">  int kg[ths-&gt;d];                             \</span>
00336 <span class="preprocessor">  double c_phi_inv_k[ths-&gt;d+1];               \</span>
00337 <span class="preprocessor">  int kg_plain[ths-&gt;d+1];                     \</span>
00338 <span class="preprocessor">                                                                                \</span>
00339 <span class="preprocessor">  double *g_hat, *f_hat;                      \</span>
00340 <span class="preprocessor">                                                                                \</span>
00341 <span class="preprocessor">  g_hat = ths-&gt;g_hat;                                                           \</span>
00342 <span class="preprocessor">  f_hat = ths-&gt;f_hat;                                                           \</span>
00343 <span class="preprocessor">                                                                                \</span>
00344 <span class="preprocessor">  MACRO_nfst_D_init_result_ ## which_one                                        \</span>
00345 <span class="preprocessor">                                                                                \</span>
00346 <span class="preprocessor">  c_phi_inv_k[0] = 1;                                                           \</span>
00347 <span class="preprocessor">  kg_plain[0]    = 0;                                                           \</span>
00348 <span class="preprocessor">                                                                                \</span>
00349 <span class="preprocessor">  MACRO_init__kg;                                                               \</span>
00350 <span class="preprocessor">                                                                                \</span>
00351 <span class="preprocessor">  if( ths-&gt;nfst_flags &amp; PRE_PHI_HUT)                                            \</span>
00352 <span class="preprocessor">                                                                                \</span>
00353 <span class="preprocessor">    for( k_L = 0; k_L &lt; ths-&gt;N_total; k_L++)                                    \</span>
00354 <span class="preprocessor">    {                                                                           \</span>
00355 <span class="preprocessor">      MACRO_update__c_phi_inv_k__lg_plain( which_one, with_PRE_PHI_HUT);        \</span>
00356 <span class="preprocessor">                                                                                \</span>
00357 <span class="preprocessor">      MACRO_nfst_D_compute_ ## which_one;                                       \</span>
00358 <span class="preprocessor">                                                                                \</span>
00359 <span class="preprocessor">      MACRO_count__kg;                                                          \</span>
00360 <span class="preprocessor">                                                                                \</span>
00361 <span class="preprocessor">    } </span><span class="comment">/* for(k_L) */</span>                                                            \
00362                                                                                 \
00363   else                                                                          \
00364                                                                                 \
00365     for( k_L = 0; k_L &lt; ths-&gt;N_total; k_L++)                                    \
00366     {                                                                           \
00367       MACRO_update__c_phi_inv_k__lg_plain( which_one, compute_PHI_HUT_INV);     \
00368                                                                                 \
00369       MACRO_nfst_D_compute_ ## which_one;                                       \
00370                                                                                 \
00371       MACRO_count__kg                                                           \
00372                                                                                 \
00373     } <span class="comment">/* for(k_L) */</span>                                                            \
00374 } <span class="comment">/* nfst_D */</span>
00375   
00376 MACRO_nfst_D(A)
00377 MACRO_nfst_D(T)
00378 
00379 
00380 
00381 
00382 
00383 
00384 
00388 #define MACRO_nfst_B_PRE_FULL_PSI_compute_A                                     \
00389 {                                                                               \
00390   (*fj) += ths-&gt;psi[ix] * g[ths-&gt;psi_index_g[ix]];                              \
00391 }
00392 
00393 <span class="preprocessor">#define MACRO_nfst_B_PRE_FULL_PSI_compute_T                                     \</span>
00394 <span class="preprocessor">{                                                                               \</span>
00395 <span class="preprocessor">  g[ths-&gt;psi_index_g[ix]] += ths-&gt;psi[ix] * (*fj);                              \</span>
00396 <span class="preprocessor">}</span>
00397 <span class="preprocessor"></span>
00398 
00399 
00400 <span class="preprocessor">#define MACRO_nfst_B_compute_A                                                  \</span>
00401 <span class="preprocessor">{                                                                               \</span>
00402 <span class="preprocessor">  (*fj) += phi_tilde[ths-&gt;d] * g[lg_plain[ths-&gt;d]];                             \</span>
00403 <span class="preprocessor">}</span>
00404 <span class="preprocessor"></span>
00405 <span class="preprocessor">#define MACRO_nfst_B_compute_T                                                  \</span>
00406 <span class="preprocessor">{                                                                               \</span>
00407 <span class="preprocessor">  g[lg_plain[ths-&gt;d]] += phi_tilde[ths-&gt;d] * (*fj);                             \</span>
00408 <span class="preprocessor">}</span>
00409 <span class="preprocessor"></span>
00410 
00411 
00412 <span class="preprocessor">#define MACRO_compute_lg_offset__count_lg( i0)                                  \</span>
00413 <span class="preprocessor">{                                                                               \</span>
00414 <span class="preprocessor">  </span><span class="comment">/* determine index in g-array corresponding to lb[(i0)] */</span>                    \
00415   if( lb[(i0)] &lt; 0)                                                             \
00416   {                                                                             \
00417     lg_offset[(i0)] =                                                           \
00418       (lb[(i0)] % nfst_fftw_2N( ths-&gt;n[(i0)])) + nfst_fftw_2N( ths-&gt;n[(i0)]);   \
00419   }                                                                             \
00420   else                                                                          \
00421   {                                                                             \
00422     lg_offset[(i0)] = lb[(i0)] % nfst_fftw_2N( ths-&gt;n[(i0)]);                   \
00423   }                                                                             \
00424                                                                                 \
00425   if( lg_offset[(i0)] &gt; ths-&gt;n[(i0)]+1)                                         \
00426       lg_offset[(i0)] = -( nfst_fftw_2N( ths-&gt;n[(i0)]) - lg_offset[(i0)]);      \
00427 }
00428 
00429 
00430 
00431 <span class="preprocessor">#define MACRO_set__lg__to__lg_offset                                            \</span>
00432 <span class="preprocessor">{                                                                               \</span>
00433 <span class="preprocessor">  if( lg_offset[i] &lt;= 0)                                                        \</span>
00434 <span class="preprocessor">  {                                                                             \</span>
00435 <span class="preprocessor">    lg[i] = -lg_offset[i];                                                      \</span>
00436 <span class="preprocessor">    count_lg[i] = -1;                                                           \</span>
00437 <span class="preprocessor">  }                                                                             \</span>
00438 <span class="preprocessor">  else                                                                          \</span>
00439 <span class="preprocessor">  {                                                                             \</span>
00440 <span class="preprocessor">    lg[i] = +lg_offset[i];                                                      \</span>
00441 <span class="preprocessor">    count_lg[i] = +1;                                                           \</span>
00442 <span class="preprocessor">  }                                                                             \</span>
00443 <span class="preprocessor">}</span>
00444 <span class="preprocessor"></span>
00445 
00446 
00447 <span class="preprocessor">#define MACRO_count__lg(dim)                                                    \</span>
00448 <span class="preprocessor">{                                                                               \</span>
00449 <span class="preprocessor">  </span><span class="comment">/* turn around when we hit one of the boundaries */</span>                           \
00450   if( ((lg[(dim)] == 0) || (lg[(dim)] == (ths-&gt;n[(dim)] + 1))) )                \
00451     count_lg[(dim)] *= -1;                                                      \
00452                                                                                 \
00453   lg[(dim)] += count_lg[(dim)];                                                 \
00454 }
00455 
00456 
00457 
00458 <span class="preprocessor">#define MACRO_init_lb_lg_lc_phi_tilde_lg_plain( which_psi)                      \</span>
00459 <span class="preprocessor">{                                                                               \</span>
00460 <span class="preprocessor">  for( i = 0; i &lt; ths-&gt;d; i++)                                                  \</span>
00461 <span class="preprocessor">  {                                                                             \</span>
00462 <span class="preprocessor">    MACRO_nfst__lower_boundary( j, i);                                          \</span>
00463 <span class="preprocessor">                                                                                \</span>
00464 <span class="preprocessor">    MACRO_compute_lg_offset__count_lg( i);                                      \</span>
00465 <span class="preprocessor">    MACRO_set__lg__to__lg_offset;                                               \</span>
00466 <span class="preprocessor">                                                                                \</span>
00467 <span class="preprocessor">    </span><span class="comment">/* counter for lg */</span>                                                        \
00468     lc[i] = 0;                                                                  \
00469   }                                                                             \
00470                                                                                 \
00471   for( t = 0; t &lt; ths-&gt;d; t++)                                                  \
00472   {                                                                             \
00473     if( lg[t] == 0)                                                             \
00474     {                                                                           \
00475       lg_plain[t+1]  = lg_plain[t] * ths-&gt;n[t];                                 \
00476       phi_tilde[t+1] = 0.0;                                                     \
00477     }                                                                           \
00478     else                                                                        \
00479       if( lg[t] == ths-&gt;n[t]+1)                                                 \
00480       {                                                                         \
00481         lg_plain[t+1]  = lg_plain[t] * ths-&gt;n[t] + ths-&gt;n[t]-1;                 \
00482         phi_tilde[t+1] = 0.0;                                                   \
00483       }                                                                         \
00484       else                                                                      \
00485       {                                                                         \
00486         MACRO__phi_tilde( which_psi);                                           \
00487         lg_plain[t+1]  = lg_plain[t] * ths-&gt;n[t] + lg[t]-1;                     \
00488       }                                                                         \
00489   }                                                                             \
00490                                                                                 \
00491   i = 0;                                                                        \
00492 }
00493 
00494 
00495 
00496 <span class="preprocessor">#define MACRO_count__lg_lc                                                      \</span>
00497 <span class="preprocessor">{                                                                               \</span>
00498 <span class="preprocessor">  MACRO_count__lg( ths-&gt;d-1);                                                   \</span>
00499 <span class="preprocessor">                                                                                \</span>
00500 <span class="preprocessor">  lc[ths-&gt;d - 1]++;                                                             \</span>
00501 <span class="preprocessor">  i = ths-&gt;d - 1;                                                               \</span>
00502 <span class="preprocessor">                                                                                \</span>
00503 <span class="preprocessor">  while( (lc[i] == NFST_SUMMANDS) &amp;&amp; (i &gt; 0))                                   \</span>
00504 <span class="preprocessor">  {                                                                             \</span>
00505 <span class="preprocessor">    lc[i - 1]++;                                                                \</span>
00506 <span class="preprocessor">    lc[i] = 0;                                                                  \</span>
00507 <span class="preprocessor">                                                                                \</span>
00508 <span class="preprocessor">    </span><span class="comment">/* ansonsten lg[i-1] verschieben */</span>                                         \
00509     MACRO_count__lg( i - 1);                                                    \
00510     <span class="comment">/* lg[i] = anfangswert */</span>                                                   \
00511     MACRO_set__lg__to__lg_offset;                                               \
00512                                                                                 \
00513     i--;                                                                        \
00514   }                                                                             \
00515 }
00516 
00517 
00518 <span class="preprocessor">#define MACRO_update__phi_tilde__lg_plain( which_psi)                           \</span>
00519 <span class="preprocessor">{                                                                               \</span>
00520 <span class="preprocessor">  for( t = i; t &lt; ths-&gt;d; t++)                                                  \</span>
00521 <span class="preprocessor">  {                                                                             \</span>
00522 <span class="preprocessor">    if( (lg[t] != 0) &amp;&amp; (lg[t] != ths-&gt;n[t]+1))                                 \</span>
00523 <span class="preprocessor">    {                                                                           \</span>
00524 <span class="preprocessor">      MACRO__phi_tilde( which_psi);                                             \</span>
00525 <span class="preprocessor">      lg_plain[t+1] = lg_plain[t] * ths-&gt;n[t] + lg[t]-1;                        \</span>
00526 <span class="preprocessor">    }                                                                           \</span>
00527 <span class="preprocessor">    else                                                                        \</span>
00528 <span class="preprocessor">      phi_tilde[t+1] = 0.0;                                                     \</span>
00529 <span class="preprocessor">  }                                                                             \</span>
00530 <span class="preprocessor">}</span>
00531 <span class="preprocessor"></span>
00532 
00533 
00534 <span class="preprocessor">#define MACRO__phi_tilde( which_psi)                                            \</span>
00535 <span class="preprocessor">{                                                                               \</span>
00536 <span class="preprocessor">  phi_tilde[t+1] = (double)count_lg[t] * phi_tilde[t] * MACRO_ ## which_psi;    \</span>
00537 <span class="preprocessor">}</span>
00538 <span class="preprocessor"></span>
00539 
00540 
00541 
00542 <span class="preprocessor">#define MACRO_nfst_B( which_one)                                                \</span>
00543 <span class="preprocessor">  inline void nfst_B_ ## which_one ( nfst_plan *ths)                            \</span>
00544 <span class="preprocessor">  { </span><span class="comment">/* MACRO_nfst_B */</span>                                                          \
00545     int lb[ths-&gt;d];                       \
00546     int j, t, i;                          \
00547     int lprod, l_L, ix;                   \
00548     int lc[ths-&gt;d];                       \
00549     int lg[ths-&gt;d];                       \
00550     int lg_offset[ths-&gt;d];                \
00551     int count_lg[ths-&gt;d];                 \
00552     int lg_plain[ths-&gt;d+1];               \
00553     double *f, *g;                        \
00554     double phi_tilde[ths-&gt;d+1];           \
00555     double *fj;                           \
00556                                                                                 \
00557     f = ths-&gt;f; g = ths-&gt;g;                                                     \
00558                                                                                 \
00559     MACRO_nfst_B_init_result_ ## which_one                                      \
00560                                                                                 \
00561     <span class="comment">/* both flags are set */</span>                                                    \
00562     if( (ths-&gt;nfst_flags &amp; PRE_PSI) &amp;&amp; (ths-&gt;nfst_flags &amp; PRE_FULL_PSI))        \
00563     {                                                                           \
00564       for( ix = 0, j = 0, fj = &amp;f[0]; j &lt; ths-&gt;M_total; j++, fj += 1)           \
00565         for( l_L = 0; l_L &lt; ths-&gt;psi_index_f[j]; l_L++, ix++)                   \
00566         {                                                                       \
00567           MACRO_nfst_B_PRE_FULL_PSI_compute_ ## which_one;                      \
00568         }                                                                       \
00569     }                                                                           \
00570     else                                                                        \
00571     {                                                                           \
00572       phi_tilde[0] = 1;                                                         \
00573       lg_plain[0]  = 0;                                                         \
00574                                                                                 \
00575       for( t = 0, lprod = 1; t &lt; ths-&gt;d; t++)                                   \
00576         lprod *= NFST_SUMMANDS;                                                 \
00577                                                                                 \
00578       <span class="comment">/* PRE_PSI flag is set */</span>                                                 \
00579       if( ths-&gt;nfst_flags &amp; PRE_PSI)                                            \
00580       {                                                                         \
00581         for( j = 0, fj = &amp;f[0]; j &lt; ths-&gt;M_total; j++, fj += 1)                 \
00582         {                                                                       \
00583           MACRO_init_lb_lg_lc_phi_tilde_lg_plain( with_PRE_PSI);                \
00584                                                                                 \
00585           for( l_L = 0; l_L &lt; lprod; l_L++)                                     \
00586           {                                                                     \
00587             MACRO_update__phi_tilde__lg_plain( with_PRE_PSI);                   \
00588                                                                                 \
00589             MACRO_nfst_B_compute_ ## which_one;                                 \
00590                                                                                 \
00591             MACRO_count__lg_lc;                                                 \
00592                                                                                 \
00593           } <span class="comment">/* for( l_L) */</span>                                                     \
00594         } <span class="comment">/* for( j) */</span>                                                         \
00595       } <span class="comment">/* if( PRE_PSI) */</span>                                                      \
00596                                                                                 \
00597       <span class="comment">/* no PSI flag is set */</span>                                                  \
00598       else                                                                      \
00599       {                                                                         \
00600         for( j = 0, fj = &amp;f[0]; j &lt; ths-&gt;M_total; j++, fj += 1)                 \
00601         {                                                                       \
00602           MACRO_init_lb_lg_lc_phi_tilde_lg_plain( compute_PSI);                 \
00603                                                                                 \
00604           for( l_L = 0; l_L &lt; lprod; l_L++)                                     \
00605           {                                                                     \
00606             MACRO_update__phi_tilde__lg_plain( compute_PSI);                    \
00607                                                                                 \
00608             MACRO_nfst_B_compute_ ## which_one;                                 \
00609                                                                                 \
00610             MACRO_count__lg_lc;                                                 \
00611                                                                                 \
00612           } <span class="comment">/* for(l_L) */</span>                                                      \
00613         } <span class="comment">/* for(j) */</span>                                                          \
00614       } <span class="comment">/* else(PRE_PSI) */</span>                                                     \
00615     }<span class="comment">/* else( PRE_PRE &amp;&amp; FULL_PRE_PSI) */</span>                                       \
00616 } <span class="comment">/* nfst_B */</span>
00617   
00618 MACRO_nfst_B(A)
00619 MACRO_nfst_B(T)
00620 
00621 
00622 
00623 
00624 
00625 
<a name="l00630"></a><a class="code" href="group__nfsct.html#ga22">00630</a> <span class="keywordtype">void</span> nfst_trafo( <a class="code" href="structnfst__plan.html">nfst_plan</a> *ths)
00631 {
00636   ths-&gt;g_hat = ths-&gt;g1;
00637   ths-&gt;g     = ths-&gt;g2;
00638 
00639  
00645   TIC(0)
00646   nfst_D_A( ths);
00647   TOC(0)
00648 
00649 
00650   
00656   TIC(1)
00657   fftw_execute( ths-&gt;my_fftw_r2r_plan);
00658   TOC(1)
00659 
00660 
00661   
00666   TIC(2)
00667   nfst_B_A( ths);
00668   TOC(2)
00669 
00670 } <span class="comment">/* nfst_trafo */</span>
00671 
00672 
00673 
00674 
<a name="l00675"></a><a class="code" href="group__nfsct.html#ga24">00675</a> <span class="keywordtype">void</span> <a class="code" href="group__nfsct.html#ga24">nfst_adjoint</a>( <a class="code" href="structnfst__plan.html">nfst_plan</a> *ths)
00676 {
00681   ths-&gt;g_hat = ths-&gt;g2;
00682   ths-&gt;g     = ths-&gt;g1;
00683 
00684 
00690   TIC(2)
00691   nfst_B_T( ths);
00692   TOC(2)
00693       
00694 
00695   
00701   TIC(1)
00702   fftw_execute( ths-&gt;my_fftw_r2r_plan);
00703   TOC(1)
00704 
00705   
00706   
00711   TIC(0)
00712   nfst_D_T( ths);
00713   TOC(0)
00714 
00715 } <span class="comment">/* nfst_adjoint */</span>
00716 
00717 
00718 
00723 <span class="keywordtype">void</span> nfst_precompute_phi_hut( <a class="code" href="structnfst__plan.html">nfst_plan</a> *ths)
00724 {
00725   <span class="keywordtype">int</span> kg[ths-&gt;d];                      
00726   <span class="keywordtype">int</span> t;                               
00728   ths-&gt;c_phi_inv = (<span class="keywordtype">double</span>**)fftw_malloc( ths-&gt;d * <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>*));
00729 
00730   <span class="keywordflow">for</span>( t = 0; t &lt; ths-&gt;d; t++)
00731   {
00732     ths-&gt;c_phi_inv[t] = (<span class="keywordtype">double</span>*)fftw_malloc( ( ths-&gt;N[t] - 1) * <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>));
00733     
00734     <span class="keywordflow">for</span>( kg[t] = 0; kg[t] &lt; ths-&gt;N[t] - 1; kg[t]++)
00735     {
00736       ths-&gt;c_phi_inv[t][kg[t]] = MACRO_compute_PHI_HUT_INV;
00737     }
00738   }
00739 } <span class="comment">/* nfst_phi_hut */</span>
00740 
00741 
00742 
<a name="l00743"></a><a class="code" href="group__nfsct.html#ga21">00743</a> <span class="keywordtype">void</span> <a class="code" href="group__nfsct.html#ga21">nfst_precompute_psi</a>( <a class="code" href="structnfst__plan.html">nfst_plan</a> *ths)
00744 {
00745   <span class="keywordtype">int</span> t;                                
00746   <span class="keywordtype">int</span> j;                                
00747   <span class="keywordtype">int</span> lc[ths-&gt;d];                       
00748   <span class="keywordtype">int</span> lb[ths-&gt;d];                       
00750   <span class="keywordflow">for</span> (t = 0; t &lt; ths-&gt;d; t++)
00751   {
00752     <span class="keywordflow">for</span>(j = 0; j &lt; ths-&gt;M_total; j++)
00753     {
00754       MACRO_nfst__lower_boundary( j, t);
00755 
00756       <span class="keywordflow">for</span>( lc[t] = 0; lc[t] &lt; NFST_SUMMANDS; lc[t]++)
00757         ths-&gt;psi[(j * ths-&gt;d + t) * NFST_SUMMANDS + lc[t]] = MACRO_compute_PSI;
00758 
00759     } <span class="comment">/* for(j) */</span>
00760   }  <span class="comment">/* for(t) */</span>
00761 
00762   <span class="comment">/* full precomputation of psi */</span>
00763   <span class="keywordflow">if</span> ( ths-&gt;nfst_flags &amp; <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>)
00764     <a class="code" href="group__nfsct.html#ga27">nfst_full_psi</a>( ths, ths-&gt;nfst_full_psi_eps);
00765 
00766 } <span class="comment">/* nfst_precompute_psi */</span>
00767 
00768 
00769 
<a name="l00771"></a><a class="code" href="group__nfsct.html#ga27">00771</a> <span class="keywordtype">void</span> <a class="code" href="group__nfsct.html#ga27">nfst_full_psi</a>(<a class="code" href="structnfst__plan.html">nfst_plan</a> *ths, <span class="keywordtype">double</span> eps)
00772 {
00773   <span class="keywordtype">int</span> t, i;                             
00774   <span class="keywordtype">int</span> j;                                
00775   <span class="keywordtype">int</span> l_L;                              
00776   <span class="keywordtype">int</span> lc[ths-&gt;d];                       
00777   <span class="keywordtype">int</span> lg_plain[ths-&gt;d+1];               
00778   <span class="keywordtype">int</span> count_lg[ths-&gt;d];
00779   <span class="keywordtype">int</span> lg_offset[ths-&gt;d];
00780   <span class="keywordtype">int</span> lg[ths-&gt;d];
00781   <span class="keywordtype">int</span> lprod;                            
00782   <span class="keywordtype">int</span> lb[ths-&gt;d];                       
00784   <span class="keywordtype">double</span> phi_tilde[ths-&gt;d+1];
00785 
00786   <span class="keywordtype">int</span> *index_g, *index_f;
00787   <span class="keywordtype">double</span> *new_psi;
00788   <span class="keywordtype">int</span> ix, ix_old, size_psi;
00789 
00790   phi_tilde[0] = 1.0;
00791   lg_plain[0]  =   0;
00792 
00793   <span class="keywordflow">if</span>(ths-&gt;nfst_flags &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00794   {
00795     size_psi = ths-&gt;M_total;
00796     index_f  =    (<span class="keywordtype">int</span>*)malloc( ths-&gt;M_total  * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span>));
00797     index_g  =    (<span class="keywordtype">int</span>*)malloc( size_psi * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span>));
00798     new_psi  = (<span class="keywordtype">double</span>*)malloc( size_psi * <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>));
00799     
00800     <span class="keywordflow">for</span>( t = 0,lprod = 1; t &lt; ths-&gt;d; t++)
00801     {
00802       lprod *= NFST_SUMMANDS;
00803       eps *= PHI( 0, t);
00804     }
00805     
00806     <span class="keywordflow">for</span>( ix = 0, ix_old = 0, j = 0; j &lt; ths-&gt;M_total; j++)
00807     {
00808       MACRO_init_lb_lg_lc_phi_tilde_lg_plain( with_PRE_PSI);
00809           
00810       <span class="keywordflow">for</span>( l_L = 0; l_L &lt; lprod; l_L++)
00811       {
00812         MACRO_update__phi_tilde__lg_plain( with_PRE_PSI);
00813 
00814         <span class="keywordflow">if</span>( fabs(phi_tilde[ths-&gt;d]) &gt; eps)
00815         {
00816           index_g[ix] =  lg_plain[ths-&gt;d];
00817           new_psi[ix] = phi_tilde[ths-&gt;d];
00818   
00819           ix++;
00820           <span class="keywordflow">if</span>( ix == size_psi)
00821           {
00822             size_psi += ths-&gt;M_total;
00823             index_g   =    (<span class="keywordtype">int</span>*)realloc( index_g, size_psi * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span>));
00824             new_psi   = (<span class="keywordtype">double</span>*)realloc( new_psi, size_psi * <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>));
00825           }
00826         }
00827         MACRO_count__lg_lc;
00828 
00829       } <span class="comment">/* for(l_L) */</span>
00830       
00831       index_f[j] = ix - ix_old;
00832       ix_old     = ix;
00833       
00834     } <span class="comment">/* for(j) */</span>
00835     
00836     free( ths-&gt;psi);
00837 
00838     size_psi      = ix;
00839     ths-&gt;size_psi = size_psi;
00840     index_g       = (<span class="keywordtype">int</span>*)realloc( index_g, size_psi * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span>));
00841     new_psi       = (<span class="keywordtype">double</span>*)realloc( new_psi, size_psi * <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>));
00842     
00843     ths-&gt;psi         = new_psi;
00844     ths-&gt;psi_index_g = index_g; 
00845     ths-&gt;psi_index_f = index_f;
00846     
00847   } <span class="comment">/* if(PRE_PSI) */</span>
00848 } <span class="comment">/* nfst_full_psi */</span>
00849 
00850 
00851 
00852 
00853 <span class="keywordtype">void</span> nfst_init_help( <a class="code" href="structnfst__plan.html">nfst_plan</a> *ths)
00854 {
00855   <span class="keywordtype">int</span> t;                                
00857   ths-&gt;N_total = <a class="code" href="group__nfftutil.html#ga12">nfst_prod_minus_a_int</a>( ths-&gt;N, 1, ths-&gt;d);
00858 
00859   ths-&gt;sigma   = (<span class="keywordtype">double</span>*)fftw_malloc( ths-&gt;d * <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>));
00860 
00861   <span class="keywordflow">for</span>( t = 0; t &lt; ths-&gt;d; t++) 
00862     <span class="comment">/* FIXME: n/N or (n+1)/N */</span>
00863     ths-&gt;sigma[t] = ((double)ths-&gt;n[t] + 1) / ths-&gt;N[t];
00864 
00865   <span class="comment">/* assign r2r transform kinds for each dimension */</span>
00866   ths-&gt;r2r_kind = (fftw_r2r_kind*) fftw_malloc ( ths-&gt;d * <span class="keyword">sizeof</span>( fftw_r2r_kind));
00867   <span class="keywordflow">for</span> (t = 0; t &lt; ths-&gt;d; t++)
00868     ths-&gt;r2r_kind[t] = FFTW_RODFT00;
00869 
00870 
00871   WINDOW_HELP_INIT;
00872 
00873   if(ths-&gt;nfst_flags &amp; MALLOC_X)
00874     ths-&gt;x = (<span class="keywordtype">double</span>*)fftw_malloc( ths-&gt;d * ths-&gt;M_total * sizeof( <span class="keywordtype">double</span>));
00875 
00876   if(ths-&gt;nfst_flags &amp; MALLOC_F_HAT)
00877     ths-&gt;f_hat = (<span class="keywordtype">double</span>*)fftw_malloc( ths-&gt;N_total * sizeof( <span class="keywordtype">double</span>));
00878 
00879   if(ths-&gt;nfst_flags &amp; MALLOC_F)
00880     ths-&gt;f = (<span class="keywordtype">double</span>*)fftw_malloc( ths-&gt;M_total * sizeof( <span class="keywordtype">double</span>));
00881 
00882   if(ths-&gt;nfst_flags &amp; PRE_PHI_HUT)
00883     nfst_precompute_phi_hut( ths);
00884 
00885   <span class="comment">/* NO FFTW_MALLOC HERE */</span>
00886   if(ths-&gt;nfst_flags &amp; PRE_PSI)
00887   {
00888     ths-&gt;psi =
00889       (<span class="keywordtype">double</span>*)malloc( ths-&gt;M_total * ths-&gt;d * NFST_SUMMANDS * <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>));
00890 
00894     ths-&gt;nfst_full_psi_eps = pow(10, -10);
00895   }
00896   
00897   <span class="keywordflow">if</span>(ths-&gt;nfst_flags &amp; <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a>)
00898   {
00899       ths-&gt;g1 =
00900         (<span class="keywordtype">double</span>*)fftw_malloc( <a class="code" href="group__nfftutil.html#ga12">nfst_prod_minus_a_int</a>( ths-&gt;n, 0, ths-&gt;d) * <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>));
00901 
00902       <span class="keywordflow">if</span>(ths-&gt;nfst_flags &amp; <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>)
00903         ths-&gt;g2 =
00904           (<span class="keywordtype">double</span>*)fftw_malloc( <a class="code" href="group__nfftutil.html#ga12">nfst_prod_minus_a_int</a>( ths-&gt;n, 0, ths-&gt;d) * <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>));
00905       <span class="keywordflow">else</span>
00906         ths-&gt;g2 = ths-&gt;g1;
00907 
00908       ths-&gt;my_fftw_r2r_plan = 
00909         fftw_plan_r2r( ths-&gt;d, ths-&gt;n, ths-&gt;g1, ths-&gt;g2, ths-&gt;r2r_kind, ths-&gt;fftw_flags);
00910   }
00911 }
00912 
<a name="l00913"></a><a class="code" href="group__nfsct.html#ga18">00913</a> <span class="keywordtype">void</span> <a class="code" href="group__nfsct.html#ga18">nfst_init</a>( <a class="code" href="structnfst__plan.html">nfst_plan</a> *ths, <span class="keywordtype">int</span> d, <span class="keywordtype">int</span> *N, <span class="keywordtype">int</span> M_total)
00914 {
00915   <span class="keywordtype">int</span> t;                                
00917   ths-&gt;d = d;
00918 
00919   ths-&gt;N      = (<span class="keywordtype">int</span>*)fftw_malloc( ths-&gt;d * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span>));
00920 
00921   <span class="keywordflow">for</span>(t = 0;t &lt; d; t++)
00922     ths-&gt;N[t] = N[t];
00923 
00924   ths-&gt;n      = (<span class="keywordtype">int</span>*)fftw_malloc( ths-&gt;d * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span>));
00925 
00926   <span class="keywordflow">for</span>( t = 0; t &lt; d; t++)
00927     ths-&gt;n[t] = 2 * <a class="code" href="group__nfftutil.html#ga4">nfft_next_power_of_2</a>( ths-&gt;N[t]) - 1;
00928 
00929   ths-&gt;M_total = M_total;
00930 
00931   WINDOW_HELP_ESTIMATE_m;
00932 
00933   ths-&gt;nfst_flags = NFST_DEFAULT_FLAGS;
00934   ths-&gt;fftw_flags = FFTW_DEFAULT_FLAGS;
00935 
00936   nfst_init_help( ths);    
00937 }
00938 
00939 
<a name="l00940"></a><a class="code" href="group__nfsct.html#ga19">00940</a> <span class="keywordtype">void</span> <a class="code" href="group__nfsct.html#ga19">nfst_init_m</a>( <a class="code" href="structnfst__plan.html">nfst_plan</a> *ths, <span class="keywordtype">int</span> d, <span class="keywordtype">int</span> *N, <span class="keywordtype">int</span> M_total, <span class="keywordtype">int</span> m)
00941 {
00942   <span class="keywordtype">int</span> t, n[d];
00943 
00944   <span class="keywordflow">for</span>( t = 0; t &lt; d; t++) 
00945     n[t] = <a class="code" href="group__nfsct.html#ga30">nfst_fftw_2N</a>( <a class="code" href="group__nfftutil.html#ga4">nfft_next_power_of_2</a>( N[t])); 
00946 
00947   <a class="code" href="group__nfsct.html#ga20">nfst_init_guru</a>( ths, d, N, M_total, n, m, NFST_DEFAULT_FLAGS, FFTW_DEFAULT_FLAGS);
00948 }
00949 
00950 
<a name="l00951"></a><a class="code" href="group__nfsct.html#ga20">00951</a> <span class="keywordtype">void</span> <a class="code" href="group__nfsct.html#ga20">nfst_init_guru</a>( <a class="code" href="structnfst__plan.html">nfst_plan</a> *ths, <span class="keywordtype">int</span> d, <span class="keywordtype">int</span> *N,
00952      <span class="keywordtype">int</span> M_total, <span class="keywordtype">int</span> *n, <span class="keywordtype">int</span> m,
00953      <span class="keywordtype">unsigned</span> nfst_flags, <span class="keywordtype">unsigned</span> fftw_flags)
00954 {
00955   <span class="keywordtype">int</span> t;             
00957   ths-&gt;d = d;
00958   ths-&gt;M_total = M_total;
00959 
00960   ths-&gt;N      = (<span class="keywordtype">int</span>*)fftw_malloc( ths-&gt;d * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span>));
00961 
00962   <span class="keywordflow">for</span>( t = 0; t &lt; d; t++)
00963     ths-&gt;N[t]      = N[t];
00964 
00965   ths-&gt;n      = (<span class="keywordtype">int</span>*)fftw_malloc( ths-&gt;d * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span>));
00966 
00967   <span class="keywordflow">for</span>( t = 0; t &lt; d; t++)
00968     ths-&gt;n[t]      = n[t];
00969 
00970   ths-&gt;m = m;
00971 
00972   ths-&gt;nfst_flags = nfst_flags;
00973   ths-&gt;fftw_flags = fftw_flags;
00974 
00975   nfst_init_help( ths);  
00976 }
00977 
00978 
<a name="l00979"></a><a class="code" href="group__nfsct.html#ga15">00979</a> <span class="keywordtype">void</span> <a class="code" href="group__nfsct.html#ga15">nfst_init_1d</a>( <a class="code" href="structnfst__plan.html">nfst_plan</a> *ths, <span class="keywordtype">int</span> N0, <span class="keywordtype">int</span> M_total)
00980 {
00981   <span class="keywordtype">int</span> N[1];
00982 
00983   N[0] = N0;
00984   <a class="code" href="group__nfsct.html#ga18">nfst_init</a>( ths, 1, N, M_total);
00985 }
00986 
<a name="l00987"></a><a class="code" href="group__nfsct.html#ga16">00987</a> <span class="keywordtype">void</span> <a class="code" href="group__nfsct.html#ga16">nfst_init_2d</a>( <a class="code" href="structnfst__plan.html">nfst_plan</a> *ths, <span class="keywordtype">int</span> N0, <span class="keywordtype">int</span> N1, <span class="keywordtype">int</span> M_total)
00988 {
00989   <span class="keywordtype">int</span> N[2];
00990 
00991   N[0] = N0;
00992   N[1] = N1;
00993   <a class="code" href="group__nfsct.html#ga18">nfst_init</a>( ths, 2, N, M_total);
00994 }
00995 
<a name="l00996"></a><a class="code" href="group__nfsct.html#ga17">00996</a> <span class="keywordtype">void</span> <a class="code" href="group__nfsct.html#ga17">nfst_init_3d</a>( <a class="code" href="structnfst__plan.html">nfst_plan</a> *ths, <span class="keywordtype">int</span> N0, <span class="keywordtype">int</span> N1, <span class="keywordtype">int</span> N2, <span class="keywordtype">int</span> M_total)
00997 {
00998   <span class="keywordtype">int</span> N[3];
00999 
01000   N[0] = N0;
01001   N[1] = N1;
01002   N[2] = N2;
01003   <a class="code" href="group__nfsct.html#ga18">nfst_init</a>( ths, 3, N, M_total);
01004 }
01005 
<a name="l01006"></a><a class="code" href="group__nfsct.html#ga26">01006</a> <span class="keywordtype">void</span> <a class="code" href="group__nfsct.html#ga26">nfst_finalize</a>( <a class="code" href="structnfst__plan.html">nfst_plan</a> *ths)
01007 {
01008   <span class="keywordtype">int</span> t; <span class="comment">/* index over dimensions */</span>
01009 
01010   <span class="keywordflow">if</span>( ths-&gt;nfst_flags &amp; <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a>)
01011   {
01012     fftw_destroy_plan( ths-&gt;my_fftw_r2r_plan);
01013       
01014     <span class="keywordflow">if</span>( ths-&gt;nfst_flags &amp; <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>)
01015       fftw_free( ths-&gt;g2);
01016       
01017     fftw_free( ths-&gt;g1);
01018   }
01019 
01020   <span class="comment">/* NO FFTW_FREE HERE */</span>
01021   <span class="keywordflow">if</span>( ths-&gt;nfst_flags &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
01022   {
01023     <span class="keywordflow">if</span>( ths-&gt;nfst_flags &amp; <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>)
01024     {
01025       free( ths-&gt;psi_index_g);
01026       free( ths-&gt;psi_index_f);
01027     }
01028     
01029     free( ths-&gt;psi);
01030   }
01031 
01032   <span class="keywordflow">if</span>( ths-&gt;nfst_flags &amp; <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>) {
01033     <span class="keywordflow">for</span>( t = 0; t &lt; ths-&gt;d; t++)
01034       fftw_free( ths-&gt;c_phi_inv[t]);
01035     fftw_free( ths-&gt;c_phi_inv);
01036   }
01037 
01038   <span class="keywordflow">if</span>( ths-&gt;nfst_flags &amp; <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>)
01039     fftw_free( ths-&gt;f);
01040 
01041   <span class="keywordflow">if</span>( ths-&gt;nfst_flags &amp; <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>)
01042     fftw_free( ths-&gt;f_hat);
01043   
01044   <span class="keywordflow">if</span>( ths-&gt;nfst_flags &amp; <a class="code" href="group__nfft.html#ga22">MALLOC_X</a>)
01045     fftw_free( ths-&gt;x);
01046  
01047   WINDOW_HELP_FINALIZE;
01048 
01049   fftw_free( ths-&gt;N);
01050   fftw_free( ths-&gt;n);
01051   fftw_free( ths-&gt;sigma);
01052 
01053 } <span class="comment">/* nfst_finalize */</span>
01054 
</pre></div>    <hr size="1"/>
    Generated on 5 Feb 2007 by Doxygen 1.4.1
  </body>
</html>
