<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.2 API Reference - NFFT: nsfft_test.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.2 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">examples</a>&nbsp;/&nbsp;<a class="el" href="dir_000029.html">nsfft</a></div>
<h1>nsfft_test.c</h1><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00002 <span class="preprocessor">#include &lt;math.h&gt;</span>
00003 <span class="preprocessor">#include &lt;string.h&gt;</span>
00004 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00005 
00006 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00007 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00008 
00009 <span class="keywordtype">void</span> accuracy_nsfft(<span class="keywordtype">int</span> d, <span class="keywordtype">int</span> J, <span class="keywordtype">int</span> M, <span class="keywordtype">int</span> m)
00010 {
00011   <a class="code" href="structnsfft__plan.html">nsfft_plan</a> p;
00012   <span class="keywordtype">double</span> complex *swap_sndft_trafo, *swap_sndft_adjoint;
00013 
00014   <a class="code" href="group__nsfft.html#ga6">nsfft_init</a>(&amp;p, d, J, M, m, NSDFT);
00015 
00016   swap_sndft_trafo=(<span class="keywordtype">double</span> complex*) fftw_malloc(p.<a class="code" href="structnsfft__plan.html#o1">M_total</a>*
00017              <span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00018   swap_sndft_adjoint=(<span class="keywordtype">double</span> complex*) fftw_malloc(p.<a class="code" href="structnsfft__plan.html#o0">N_total</a>*
00019                <span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00020 
00021   <a class="code" href="group__nsfft.html#ga5">nsfft_init_random_nodes_coeffs</a>(&amp;p);
00022 
00024   <a class="code" href="group__nsfft.html#ga0">nsdft_trafo</a>(&amp;p);
00025   
00026   <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(swap_sndft_trafo,p.<a class="code" href="structnsfft__plan.html#o3">f</a>);
00027 
00029   <a class="code" href="group__nsfft.html#ga2">nsfft_trafo</a>(&amp;p);
00030   
00031   printf(<span class="stringliteral">"%5d\t %+.5E\t"</span>,J, 
00032          <a class="code" href="group__nfftutil.html#ga39">nfft_error_l_infty_1_complex</a>(swap_sndft_trafo, p.<a class="code" href="structnsfft__plan.html#o3">f</a>, p.<a class="code" href="structnsfft__plan.html#o1">M_total</a>,
00033                                  p.<a class="code" href="structnsfft__plan.html#o2">f_hat</a>, p.<a class="code" href="structnsfft__plan.html#o0">N_total</a>));
00034   fflush(stdout);
00035 
00036   <a class="code" href="group__nfftutil.html#ga46">nfft_vrand_unit_complex</a>(p.<a class="code" href="structnsfft__plan.html#o3">f</a>, p.<a class="code" href="structnsfft__plan.html#o1">M_total</a>);
00037 
00039   <a class="code" href="group__nsfft.html#ga1">nsdft_adjoint</a>(&amp;p);
00040   
00041   <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(swap_sndft_adjoint,p.<a class="code" href="structnsfft__plan.html#o2">f_hat</a>);
00042 
00044   <a class="code" href="group__nsfft.html#ga3">nsfft_adjoint</a>(&amp;p);
00045   
00046   printf(<span class="stringliteral">"%+.5E\n"</span>, 
00047          <a class="code" href="group__nfftutil.html#ga39">nfft_error_l_infty_1_complex</a>(swap_sndft_adjoint, p.<a class="code" href="structnsfft__plan.html#o2">f_hat</a>,
00048                                  p.<a class="code" href="structnsfft__plan.html#o0">N_total</a>,
00049                                  p.<a class="code" href="structnsfft__plan.html#o3">f</a>, p.<a class="code" href="structnsfft__plan.html#o1">M_total</a>));
00050   fflush(stdout);
00051 
00052   fftw_free(swap_sndft_adjoint);
00053   fftw_free(swap_sndft_trafo);
00054 
00056   <a class="code" href="group__nsfft.html#ga7">nsfft_finalize</a>(&amp;p);
00057 }
00058 
00059 <span class="keywordtype">void</span> time_nsfft(<span class="keywordtype">int</span> d, <span class="keywordtype">int</span> J, <span class="keywordtype">int</span> M, <span class="keywordtype">unsigned</span> test_nsdft, <span class="keywordtype">unsigned</span> test_nfft)
00060 {
00061   <span class="keywordtype">int</span> r, N[d], n[d];
00062   <span class="keywordtype">int</span> m, m_nfft, m_nsfft;
00063   <span class="keywordtype">double</span> t, t_nsdft, t_nfft, t_nsfft;
00064 
00065   <a class="code" href="structnsfft__plan.html">nsfft_plan</a> p;
00066   <a class="code" href="structnfft__plan.html">nfft_plan</a> np;
00067 
00068   <span class="keywordflow">for</span>(r=0;r&lt;d;r++)
00069   {
00070     N[r]=<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J+2);
00071     n[r]=(3*N[r])/2;
00072     <span class="comment">/*n[r]=2*N[r];*/</span>
00073   }
00074 
00076   m=<a class="code" href="group__nfftutil.html#ga1">nfft_total_used_memory</a>();
00077   <a class="code" href="group__nsfft.html#ga6">nsfft_init</a>(&amp;p, d, J, M, 4, NSDFT);
00078   m_nsfft=<a class="code" href="group__nfftutil.html#ga1">nfft_total_used_memory</a>()-m;
00079   <a class="code" href="group__nsfft.html#ga5">nsfft_init_random_nodes_coeffs</a>(&amp;p);
00080 
00081   <span class="comment">/* transforms */</span>
00082   <span class="keywordflow">if</span>(test_nsdft)
00083   {
00084     t_nsdft=0;
00085     r=0;
00086     <span class="keywordflow">while</span>(t_nsdft&lt;0.1)
00087     {
00088       r++;
00089       t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00090       <a class="code" href="group__nsfft.html#ga0">nsdft_trafo</a>(&amp;p);
00091       t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-t;
00092       t_nsdft+=t;
00093     }
00094     t_nsdft/=r;
00095   }
00096   <span class="keywordflow">else</span>
00097     t_nsdft=nan(<span class="stringliteral">""</span>);   
00098 
00099   <span class="keywordflow">if</span>(test_nfft)
00100   {
00101     m=<a class="code" href="group__nfftutil.html#ga1">nfft_total_used_memory</a>();
00102     <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;np,d,N,M,n,6, FG_PSI| MALLOC_F_HAT| MALLOC_F| FFTW_INIT,
00103        FFTW_MEASURE);
00104     m_nfft=<a class="code" href="group__nfftutil.html#ga1">nfft_total_used_memory</a>()-m;
00105     np.x=p.<a class="code" href="structnsfft__plan.html#o10">act_nfft_plan</a>-&gt;<a class="code" href="structnfft__plan.html#o14">x</a>;
00106     <span class="keywordflow">if</span>(np.nfft_flags &amp; <a class="code" href="group__nfft.html#ga27">PRE_ONE_PSI</a>)
00107       <a class="code" href="group__nfft.html#ga10">nfft_precompute_one_psi</a>(&amp;np);
00108     <a class="code" href="group__nsfft.html#ga4">nsfft_cp</a>(&amp;p, &amp;np);
00109 
00110     t_nfft=0;
00111     r=0;
00112     <span class="keywordflow">while</span>(t_nfft&lt;0.1)
00113     {
00114       r++;
00115       t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00116       <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;np);
00117       t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-t;
00118       t_nfft+=t;
00119     }
00120     t_nfft/=r;
00121 
00122     <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;np);
00123   }
00124   <span class="keywordflow">else</span>
00125   {
00126     t_nfft=nan(<span class="stringliteral">""</span>); 
00127     m_nfft=-1;
00128   }
00129 
00130   t_nsfft=0;
00131   r=0;
00132   <span class="keywordflow">while</span>(t_nsfft&lt;0.1)
00133     {
00134       r++;
00135       t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00136       <a class="code" href="group__nsfft.html#ga2">nsfft_trafo</a>(&amp;p);
00137       t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-t;
00138       t_nsfft+=t;
00139     }
00140   t_nsfft/=r;
00141 
00142   printf(<span class="stringliteral">"%d\t%.2e\t%.2e\t%.2e\t%d\t%d\n"</span>,
00143    J,
00144          t_nsdft,
00145    t_nfft,
00146    t_nsfft,
00147          m_nfft,
00148    m_nsfft);
00149 
00150   fflush(stdout);
00151 
00153   <a class="code" href="group__nsfft.html#ga7">nsfft_finalize</a>(&amp;p);
00154 }
00155 
00156 
00157 <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a>(<span class="keywordtype">int</span> argc,<span class="keywordtype">char</span> **argv)
00158 {
00159   <span class="keywordtype">int</span> d, J, M;
00160     
00161   <span class="keywordflow">if</span>(argc&lt;=2)
00162   {
00163     fprintf(stderr,<span class="stringliteral">"nsfft_test type d [first last trials]\n"</span>);
00164     <span class="keywordflow">return</span> -1;
00165   }
00166 
00167   d=atoi(argv[2]);
00168   fprintf(stderr,<span class="stringliteral">"Testing the nfft on the hyperbolic cross (nsfft).\n"</span>);
00169 
00170   <span class="keywordflow">if</span>(atoi(argv[1])==1)
00171   {
00172     fprintf(stderr,<span class="stringliteral">"Testing the accuracy of the nsfft vs. nsdft\n"</span>);
00173     fprintf(stderr,<span class="stringliteral">"Columns: d, E_{1,\\infty}(trafo) E_{1,\\infty}(adjoint)\n\n"</span>);
00174     <span class="keywordflow">for</span>(J=1; J&lt;10; J++)
00175       accuracy_nsfft(d, J, 1000, 6);
00176   }
00177  
00178   <span class="keywordflow">if</span>(atoi(argv[1])==2)
00179   {
00180     fprintf(stderr,<span class="stringliteral">"Testing the computation time of the nsdft, nfft, and nsfft\n"</span>);
00181     fprintf(stderr,<span class="stringliteral">"Columns: d, J, M, t_nsdft, t_nfft, t_nsfft\n\n"</span>);
00182     <span class="keywordflow">for</span>(J=atoi(argv[3]); J&lt;=atoi(argv[4]); J++)
00183     {
00184       <span class="keywordflow">if</span>(d==2)
00185   M=(J+4)*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J+1);
00186       <span class="keywordflow">else</span>
00187   M=6*<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(J)*(<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>((J+1)/2+1)-1)+<a class="code" href="group__nfftutil.html#ga3">nfft_int_2_pow</a>(3*(J/2+1));
00188       
00189       <span class="keywordflow">if</span>(d*(J+2)&lt;=24)
00190   time_nsfft(d, J, M, 1, 1);
00191       <span class="keywordflow">else</span>
00192   <span class="keywordflow">if</span>(d*(J+2)&lt;=24)
00193     time_nsfft(d, J, M, 0, 1);
00194   <span class="keywordflow">else</span>
00195     time_nsfft(d, J, M, 0, 0);  
00196     }
00197   }
00198 
00199   <span class="keywordflow">return</span> 1;
00200 }
</pre></div>    <hr size="1"/>
    Generated on 22 Jan 2007 by Doxygen 1.4.1
  </body>
</html>
