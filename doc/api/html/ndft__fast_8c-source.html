<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.2 API Reference - NFFT: ndft_fast.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.2 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">examples</a>&nbsp;/&nbsp;<a class="el" href="dir_000018.html">nfft</a></div>
<h1>ndft_fast.c</h1><a href="ndft__fast_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00008 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00009 <span class="preprocessor">#include &lt;math.h&gt;</span>
00010 <span class="preprocessor">#include &lt;string.h&gt;</span>
00011 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00012 <span class="preprocessor">#include &lt;complex.h&gt;</span>
00013 
00014 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00016 
00017 <span class="keywordtype">void</span> ndft_horner_trafo(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths)
00018 {
00019   <span class="keywordtype">int</span> j,k;
00020   <span class="keywordtype">double</span> complex *f_hat_k, *f_j;
00021   <span class="keywordtype">double</span> complex exp_omega_0;
00022 
00023   <span class="keywordflow">for</span>(j=0, f_j=ths-&gt;f; j&lt;ths-&gt;M_total; j++, f_j++)
00024     (*f_j) =0;
00025 
00026   <span class="keywordflow">for</span>(j=0, f_j=ths-&gt;f; j&lt;ths-&gt;M_total; j++, f_j++)
00027     {
00028       exp_omega_0 = cexp(+2*PI*I*ths-&gt;x[j]);
00029       <span class="keywordflow">for</span>(k=0, f_hat_k= ths-&gt;f_hat; k&lt;ths-&gt;N[0]; k++, f_hat_k++)
00030         {
00031           (*f_j)+=(*f_hat_k);
00032           (*f_j)*=exp_omega_0;
00033   }
00034       (*f_j)*=cexp(-PI*I*ths-&gt;N[0]*ths-&gt;x[j]);
00035     }
00036 } <span class="comment">/* ndft_horner_trafo */</span>
00037 
00038 <span class="keywordtype">void</span> ndft_pre_full_trafo(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths, <span class="keywordtype">double</span> complex *A)
00039 {
00040   <span class="keywordtype">int</span> j,k;
00041   <span class="keywordtype">double</span> complex *f_hat_k, *f_j;
00042   <span class="keywordtype">double</span> complex *A_local;
00043 
00044   <span class="keywordflow">for</span>(j=0, f_j=ths-&gt;f; j&lt;ths-&gt;M_total; j++, f_j++)
00045     (*f_j) =0;
00046 
00047   <span class="keywordflow">for</span>(j=0, f_j=ths-&gt;f, A_local=A; j&lt;ths-&gt;M_total; j++, f_j++)
00048     <span class="keywordflow">for</span>(k=0, f_hat_k= ths-&gt;f_hat; k&lt;ths-&gt;N[0]; k++, f_hat_k++, A_local++)
00049       (*f_j) += (*f_hat_k)*(*A_local);
00050 } <span class="comment">/* ndft_pre_full_trafo */</span>
00051 
00052 <span class="keywordtype">void</span> ndft_pre_full_init(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths, <span class="keywordtype">double</span> complex *A)
00053 {
00054   <span class="keywordtype">int</span> j,k;
00055   <span class="keywordtype">double</span> complex *f_hat_k, *f_j, *A_local;
00056 
00057   <span class="keywordflow">for</span>(j=0, f_j=ths-&gt;f, A_local=A; j&lt;ths-&gt;M_total; j++, f_j++)
00058     <span class="keywordflow">for</span>(k=0, f_hat_k= ths-&gt;f_hat; k&lt;ths-&gt;N[0]; k++, f_hat_k++, A_local++)
00059       (*A_local) = cexp(-2*PI*I*(k-ths-&gt;N[0]/2)*ths-&gt;x[j]);
00060 
00061 } <span class="comment">/* ndft_pre_full_init */</span>
00062 
00063 <span class="keywordtype">void</span> ndft_time(<span class="keywordtype">int</span> N, <span class="keywordtype">int</span> M, <span class="keywordtype">unsigned</span> test_ndft, <span class="keywordtype">unsigned</span> test_pre_full)
00064 {
00065   <span class="keywordtype">int</span> r;
00066   <span class="keywordtype">double</span> t, t_ndft, t_horner, t_pre_full, t_nfft;
00067   <span class="keywordtype">double</span> complex *A;
00068 
00069   <a class="code" href="structnfft__plan.html">nfft_plan</a> np;
00070 
00071   printf(<span class="stringliteral">"%d\t%d\t"</span>,N, M);
00072 
00073   <a class="code" href="group__nfft.html#ga4">nfft_init_1d</a>(&amp;np, N, M);
00074 
00076   <a class="code" href="group__nfftutil.html#ga47">nfft_vrand_shifted_unit_double</a>(np.<a class="code" href="structnfft__plan.html#o14">x</a>, np.<a class="code" href="structnfft__plan.html#o1">M_total</a>);
00077 
00078   <span class="keywordflow">if</span>(test_pre_full)
00079    {
00080      A=(<span class="keywordtype">double</span> complex*)fftw_malloc(N*M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00081      ndft_pre_full_init(&amp;np, A);
00082    }
00083 
00085   <a class="code" href="group__nfftutil.html#ga46">nfft_vrand_unit_complex</a>(np.<a class="code" href="structnfft__plan.html#o2">f_hat</a>, np.<a class="code" href="structnfft__plan.html#o0">N_total</a>);
00086  
00088   <span class="keywordflow">if</span>(test_ndft)
00089     {
00090       t_ndft=0;
00091       r=0;
00092       <span class="keywordflow">while</span>(t_ndft&lt;0.1)
00093         {
00094           r++;
00095           t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00096           <a class="code" href="group__nfft.html#ga0">ndft_trafo</a>(&amp;np);
00097           t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-t;
00098           t_ndft+=t;
00099         }
00100       t_ndft/=r;
00101 
00102       printf(<span class="stringliteral">"%.2e\t"</span>,t_ndft);
00103     }
00104   <span class="keywordflow">else</span>
00105     printf(<span class="stringliteral">"nan\t\t"</span>);
00106 
00108   t_horner=0;
00109   r=0;
00110   <span class="keywordflow">while</span>(t_horner&lt;0.1)
00111     {
00112       r++;
00113       t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00114       ndft_horner_trafo(&amp;np);
00115       t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-t;
00116       t_horner+=t;
00117     }
00118   t_horner/=r;
00119 
00120   printf(<span class="stringliteral">"%.2e\t"</span>, t_horner);
00121 
00123   <span class="keywordflow">if</span>(test_pre_full)
00124     {
00125       t_pre_full=0;
00126       r=0;
00127       <span class="keywordflow">while</span>(t_pre_full&lt;0.1)
00128         {
00129           r++;
00130           t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00131           ndft_pre_full_trafo(&amp;np,A);
00132           t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-t;
00133           t_pre_full+=t;
00134         }
00135       t_pre_full/=r;
00136 
00137       printf(<span class="stringliteral">"%.2e\t"</span>, t_pre_full);
00138     }
00139   <span class="keywordflow">else</span>
00140     printf(<span class="stringliteral">"nan\t\t"</span>);
00141 
00142   t_nfft=0;
00143   r=0;
00144   <span class="keywordflow">while</span>(t_nfft&lt;0.1)
00145     {
00146       r++;
00147       t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00148       <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;np);
00149       t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-t;
00150       t_nfft+=t;
00151     }
00152   t_nfft/=r;
00153 
00154   printf(<span class="stringliteral">"%.2e\n"</span>, t_nfft);
00155 
00156   fflush(stdout);
00157 
00158   <span class="keywordflow">if</span>(test_pre_full)
00159     fftw_free(A);
00160 
00161   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;np);
00162 }
00163 
<a name="l00164"></a><a class="code" href="ndft__fast_8c.html#a4">00164</a> <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a>(<span class="keywordtype">int</span> argc,<span class="keywordtype">char</span> **argv)
00165 {
00166   <span class="keywordtype">int</span> l,trial;
00167 
00168   <span class="keywordflow">if</span>(argc&lt;=2)
00169     {
00170       fprintf(stderr,<span class="stringliteral">"ndft_fast type first last trials\n"</span>);
00171       <span class="keywordflow">return</span> -1;
00172     }
00173   
00174   fprintf(stderr,<span class="stringliteral">"Testing ndft, Horner-like ndft, fully precomputed ndft.\n"</span>);
00175   fprintf(stderr,<span class="stringliteral">"Columns: N, M, t_ndft, t_horner, t_pre_full, t_nfft\n\n"</span>);
00176 
00177   <span class="comment">/* time vs. N=M */</span>
00178   <span class="keywordflow">if</span>(atoi(argv[1])==0)
00179     {
00180       <span class="keywordflow">for</span>(l=atoi(argv[2]); l&lt;=atoi(argv[3]); l++)
00181         <span class="keywordflow">for</span>(trial=0; trial&lt;atoi(argv[4]); trial++)
00182           <span class="keywordflow">if</span>(l&lt;=13)
00183             ndft_time((1U&lt;&lt; l), (1U&lt;&lt; l), 1, 1);
00184           <span class="keywordflow">else</span>
00185             <span class="keywordflow">if</span>(l&lt;=15)
00186               ndft_time((1U&lt;&lt; l), (1U&lt;&lt; l), 1, 0);
00187             <span class="keywordflow">else</span>
00188               ndft_time((1U&lt;&lt; l), (1U&lt;&lt; l), 0, 0);
00189     }
00190 
00191   <span class="keywordflow">return</span> 1;
00192 }
</pre></div>    <hr size="1"/>
    Generated on 22 Jan 2007 by Doxygen 1.4.1
  </body>
</html>
