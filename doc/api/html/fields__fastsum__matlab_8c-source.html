<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.2 API Reference - NFFT: fields_fastsum_matlab.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.2 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000006.html">applications</a>&nbsp;/&nbsp;<a class="el" href="dir_000017.html">potential</a></div>
<h1>fields_fastsum_matlab.c</h1><div class="fragment"><pre class="fragment">00001 
00009 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00010 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00011 <span class="preprocessor">#include &lt;string.h&gt;</span>
00012 <span class="preprocessor">#include &lt;math.h&gt;</span>
00013 <span class="preprocessor">#include &lt;time.h&gt;</span>
00014 
00015 <span class="preprocessor">#include "<a class="code" href="fields__fastsum_8h.html">fields_fastsum.h</a>"</span>
00016 
00017 <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
00018 {
00019   <span class="keywordtype">int</span> j,k,t;                                         
00020   <span class="keywordtype">int</span> N;                                             
00021   <span class="keywordtype">int</span> n;                                             
00022   <span class="keywordtype">int</span> m;                                             
00023   <span class="keywordtype">int</span> p;                                             
00024   <a class="code" href="structfields__fastsum__plan__.html">fields_fastsum_plan</a> my_plan;                      
00025   <span class="keywordtype">double</span> *direct;                                   
00026   <span class="keywordtype">double</span> time;                                       
00027   <span class="keywordtype">double</span> error=0.0;                                  
00028   <span class="keywordtype">double</span> norm_direct;
00029   <span class="keywordtype">double</span> norm_diff;
00030   <span class="keywordtype">double</span> sum_error_direct;
00031   <span class="keywordtype">double</span> sum_error_diff;
00032   <span class="keywordtype">double</span> eps_I;                                      
00033   <span class="keywordtype">double</span> eps_B;                                      
00034   FILE *fid1, *fid2;
00035 
00036   <span class="keywordflow">if</span> (argc!=7)
00037   {
00038     printf(<span class="stringliteral">"\nfastsum_test N n m p eps_I eps_B\n\n"</span>);
00039     printf(<span class="stringliteral">"  N       number of nodes    \n"</span>);
00040     printf(<span class="stringliteral">"  n       expansion degree          \n"</span>);
00041     printf(<span class="stringliteral">"  m       cut-off parameter         \n"</span>);
00042     printf(<span class="stringliteral">"  p       degree of smoothness      \n"</span>);
00043     printf(<span class="stringliteral">"  eps_I   inner boundary            \n"</span>);
00044     printf(<span class="stringliteral">"  eps_B   outer boundary            \n\n"</span>);
00045     exit(-1);
00046   }
00047   <span class="keywordflow">else</span>
00048   {
00049     N=atoi(argv[1]);
00050     n=atoi(argv[2]);
00051     m=atoi(argv[3]);
00052     p=atoi(argv[4]);
00053     eps_I=atof(argv[5]);
00054     eps_B=atof(argv[6]);
00055   }
00056   printf(<span class="stringliteral">"N=%d, n=%d, m=%d, p=%d, eps_I=%g, eps_B=%g \n"</span>,N,n,m,p,eps_I,eps_B);
00057 
00058   <a class="code" href="fields__fastsum_8c.html#a0">fields_fastsum_init</a>(&amp;my_plan, N, 0, n, m, p, eps_I, eps_B);
00059 
00061   fid1=fopen(<span class="stringliteral">"r.dat"</span>,<span class="stringliteral">"r"</span>);
00062   fid2=fopen(<span class="stringliteral">"q.dat"</span>,<span class="stringliteral">"r"</span>);
00063   <span class="keywordflow">for</span> (k=0; k&lt;N; k++)
00064   {
00065     <span class="keywordflow">for</span> (t=0; t&lt;3; t++)
00066     {
00067       fscanf(fid1,<span class="stringliteral">"%le"</span>,&amp;my_plan.<a class="code" href="structfields__fastsum__plan__.html#o2">r</a>[k*3+t]);
00068     }
00069     fscanf(fid2,<span class="stringliteral">"%le"</span>,&amp;my_plan.<a class="code" href="structfields__fastsum__plan__.html#o1">q</a>[k]);
00070   }
00071   fclose(fid1);
00072   fclose(fid2);
00073 
00075   printf(<span class="stringliteral">"direct computation: "</span>); fflush(NULL);
00076   time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00077   <a class="code" href="fields__fastsum_8c.html#a2">fields_fastsum_exact</a>(&amp;my_plan);
00078   time=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-time;
00079   printf(<span class="stringliteral">"%fsec\n"</span>,time);
00080 
00082   direct = (<span class="keywordtype">double</span> *)malloc(3*my_plan.<a class="code" href="structfields__fastsum__plan__.html#o0">N_total</a>*(<span class="keyword">sizeof</span>(complex)));
00083   <span class="keywordflow">for</span> (j=0; j&lt;my_plan.<a class="code" href="structfields__fastsum__plan__.html#o0">N_total</a>; j++)
00084     for (t=0; t &lt; 3; t++)
00085       direct[j*3+t]=my_plan.E[j*3+t];
00086 
00088   printf("fast computation:   "); fflush(NULL);
00089   time=nfft_second();
00090   fields_fastsum_precompute(&amp;my_plan);
00091   fields_fastsum_trafo(&amp;my_plan);
00092   time=nfft_second()-time;
00093   printf("%fsec\n",time);
00094 
00096   error=0.0;
00097   sum_error_direct = 0.0;
00098   sum_error_diff = 0.0;
00099   for (j=0; j&lt;my_plan.N_total; j++)
00100   {
00101     norm_direct = 0.0;
00102     norm_diff = 0.0;
00103     <span class="keywordflow">for</span> (t=0; t &lt; 3; t++) {
00104       norm_direct += direct[j*3+t] * direct[j*3+t];
00105       norm_diff += (my_plan.E[j*3+t] - direct[j*3+t]) * (my_plan.E[j*3+t] - direct[j*3+t]);
00106     }
00107     sum_error_direct += norm_direct;
00108     sum_error_diff += norm_diff;
00109     norm_direct = sqrt(norm_direct);
00110     norm_diff = sqrt(norm_diff);
00111     <span class="keywordflow">if</span> (fabs(norm_diff)/fabs(norm_direct)&gt;error)
00112       error=fabs(norm_diff)/fabs(norm_direct);
00113   }
00114   printf("max relative error: %e\n",error);
00115   printf("error epsilon_2(slow,fast) (p.7): %e\n", sqrt(sum_error_diff)/sqrt(sum_error_direct));
00116 
00118   fid1=fopen("E.dat","w+");
00119   fid2=fopen("E_direct.dat","w+");
00120   if (fid1==NULL)
00121   {
00122     printf(<span class="stringliteral">"Fehler!\n"</span>);
00123     exit(-1);
00124   }
00125   <span class="keywordflow">for</span> (j=0; j&lt;N; j++)
00126   {
00127     <span class="keywordflow">for</span> (t=0; t &lt; 3; t++) {
00128       fprintf(fid1,<span class="stringliteral">"  % .16e"</span>,my_plan.E[j*3+t]);
00129       fprintf(fid2,<span class="stringliteral">"  % .16e"</span>,direct[j*3+t]);
00130     }
00131     fprintf(fid1,<span class="stringliteral">"\n"</span>);
00132     fprintf(fid2,<span class="stringliteral">"\n"</span>);
00133   }
00134   fclose(fid1);
00135   fclose(fid2);
00136 
00138   <a class="code" href="fields__fastsum_8c.html#a1">fields_fastsum_finalize</a>(&amp;my_plan);
00139 
00140   <span class="keywordflow">return</span> 0;
00141 }
</pre></div>    <hr size="1"/>
    Generated on 22 Jan 2007 by Doxygen 1.4.1
  </body>
</html>
