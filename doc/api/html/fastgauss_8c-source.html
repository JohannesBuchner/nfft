<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.2 API Reference - NFFT: fastgauss.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.2 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000006.html">applications</a>&nbsp;/&nbsp;<a class="el" href="dir_000015.html">fastgauss</a></div>
<h1>fastgauss.c</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">/* $Id$ */</span>
00002 
00009 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00010 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00011 <span class="preprocessor">#include &lt;math.h&gt;</span>
00012 <span class="preprocessor">#include &lt;sys/resource.h&gt;</span>
00013 <span class="preprocessor">#include &lt;time.h&gt;</span>
00014 <span class="preprocessor">#include &lt;complex.h&gt;</span>
00015 
00016 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00018 
<a name="l00027"></a><a class="code" href="group__applications__fastgauss.html#ga13">00027</a> <span class="preprocessor">#define DGT_PRE_CEXP     (1U&lt;&lt; 0)</span>
00028 <span class="preprocessor"></span>
<a name="l00038"></a><a class="code" href="group__applications__fastgauss.html#ga14">00038</a> <span class="preprocessor">#define FGT_NDFT         (1U&lt;&lt; 1)</span>
00039 <span class="preprocessor"></span>
<a name="l00048"></a><a class="code" href="group__applications__fastgauss.html#ga15">00048</a> <span class="preprocessor">#define FGT_APPROX_B     (1U&lt;&lt; 2)</span>
00049 <span class="preprocessor"></span>
<a name="l00051"></a><a class="code" href="structfgt__plan.html">00051</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
00052 <span class="keyword"></span>{
<a name="l00053"></a><a class="code" href="structfgt__plan.html#o0">00053</a>   <span class="keywordtype">int</span> N;                                
<a name="l00054"></a><a class="code" href="structfgt__plan.html#o1">00054</a>   <span class="keywordtype">int</span> M;                                
<a name="l00056"></a><a class="code" href="structfgt__plan.html#o2">00056</a>   <span class="keywordtype">double</span> complex *alpha;                
<a name="l00057"></a><a class="code" href="structfgt__plan.html#o3">00057</a>   <span class="keywordtype">double</span> complex *f;                    
<a name="l00059"></a><a class="code" href="structfgt__plan.html#o4">00059</a>   <span class="keywordtype">unsigned</span> flags;                       
<a name="l00062"></a><a class="code" href="structfgt__plan.html#o5">00062</a>   <span class="keywordtype">double</span> complex sigma;                 
<a name="l00064"></a><a class="code" href="structfgt__plan.html#o6">00064</a>   <span class="keywordtype">double</span> *x;                            
<a name="l00065"></a><a class="code" href="structfgt__plan.html#o7">00065</a>   <span class="keywordtype">double</span> *y;                            
<a name="l00067"></a><a class="code" href="structfgt__plan.html#o8">00067</a>   <span class="keywordtype">double</span> complex *pre_cexp;             
<a name="l00069"></a><a class="code" href="structfgt__plan.html#o9">00069</a>   <span class="keywordtype">int</span> n;                                
<a name="l00070"></a><a class="code" href="structfgt__plan.html#o10">00070</a>   <span class="keywordtype">double</span> p;                             
<a name="l00072"></a><a class="code" href="structfgt__plan.html#o11">00072</a>   <span class="keywordtype">double</span> complex *b;                    
<a name="l00074"></a><a class="code" href="structfgt__plan.html#o12">00074</a>   <a class="code" href="structnfft__plan.html">nfft_plan</a> *nplan1;                    
<a name="l00075"></a><a class="code" href="structfgt__plan.html#o13">00075</a>   <a class="code" href="structnfft__plan.html">nfft_plan</a> *nplan2;                    
00077 } <a class="code" href="structfgt__plan.html">fgt_plan</a>;
00078 
<a name="l00086"></a><a class="code" href="group__applications__fastgauss.html#ga0">00086</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__fastgauss.html#ga0">dgt_trafo</a>(<a class="code" href="structfgt__plan.html">fgt_plan</a> *ths)
00087 {
00088   <span class="keywordtype">int</span> j,k,l;
00089   
00090   <span class="keywordflow">for</span>(j=0; j&lt;ths-&gt;M; j++)
00091     ths-&gt;f[j] = 0;
00092   
00093   <span class="keywordflow">if</span>(ths-&gt;flags &amp; <a class="code" href="group__applications__fastgauss.html#ga13">DGT_PRE_CEXP</a>)
00094     <span class="keywordflow">for</span>(j=0,l=0; j&lt;ths-&gt;M; j++)
00095       <span class="keywordflow">for</span>(k=0; k&lt;ths-&gt;N; k++,l++)
00096         ths-&gt;f[j] += ths-&gt;alpha[k]*ths-&gt;pre_cexp[l];
00097   <span class="keywordflow">else</span>
00098     <span class="keywordflow">for</span>(j=0; j&lt;ths-&gt;M; j++)
00099       <span class="keywordflow">for</span>(k=0; k&lt;ths-&gt;N; k++)
00100         ths-&gt;f[j] += ths-&gt;alpha[k]*cexp(-ths-&gt;sigma*(ths-&gt;y[j]-ths-&gt;x[k])*
00101           (ths-&gt;y[j]-ths-&gt;x[k]));
00102 }
00103 
<a name="l00111"></a><a class="code" href="group__applications__fastgauss.html#ga1">00111</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__fastgauss.html#ga1">fgt_trafo</a>(<a class="code" href="structfgt__plan.html">fgt_plan</a> *ths)
00112 {
00113   <span class="keywordtype">int</span> l;
00114 
00115   <span class="keywordflow">if</span>(ths-&gt;flags &amp; <a class="code" href="group__applications__fastgauss.html#ga14">FGT_NDFT</a>)
00116     {
00117       <a class="code" href="group__nfft.html#ga1">ndft_adjoint</a>(ths-&gt;nplan1);
00118 
00119       <span class="keywordflow">for</span>(l=0; l&lt;ths-&gt;n; l++)
00120         ths-&gt;nplan1-&gt;f_hat[l] *= ths-&gt;b[l];
00121   
00122       <a class="code" href="group__nfft.html#ga0">ndft_trafo</a>(ths-&gt;nplan2);
00123     }
00124   <span class="keywordflow">else</span>
00125     {
00126       <a class="code" href="group__nfft.html#ga3">nfft_adjoint</a>(ths-&gt;nplan1);
00127 
00128       <span class="keywordflow">for</span>(l=0; l&lt;ths-&gt;n; l++)
00129         ths-&gt;nplan1-&gt;f_hat[l] *= ths-&gt;b[l];
00130   
00131       <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(ths-&gt;nplan2);
00132     }
00133 }
00134 
<a name="l00149"></a><a class="code" href="group__applications__fastgauss.html#ga2">00149</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__fastgauss.html#ga2">fgt_init_guru</a>(<a class="code" href="structfgt__plan.html">fgt_plan</a> *ths, <span class="keywordtype">int</span> N, <span class="keywordtype">int</span> M, <span class="keywordtype">double</span> complex sigma, <span class="keywordtype">int</span> n,
00150        <span class="keywordtype">double</span> p, <span class="keywordtype">int</span> m, <span class="keywordtype">unsigned</span> flags)
00151 {
00152   <span class="keywordtype">int</span> j,n_fftw;
00153   fftw_plan fplan;
00154 
00155   ths-&gt;M = M;
00156   ths-&gt;N = N;
00157   ths-&gt;sigma = sigma;
00158   ths-&gt;flags = flags;
00159 
00160   ths-&gt;x = (<span class="keywordtype">double</span>*)fftw_malloc(ths-&gt;N*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00161   ths-&gt;y = (<span class="keywordtype">double</span>*)fftw_malloc(ths-&gt;M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00162   ths-&gt;alpha = (<span class="keywordtype">double</span> complex*)fftw_malloc(ths-&gt;N*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00163   ths-&gt;f = (<span class="keywordtype">double</span> complex*)fftw_malloc(ths-&gt;M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00164 
00165   ths-&gt;n = n;
00166   ths-&gt;p = p;
00167 
00168   ths-&gt;b = (<span class="keywordtype">double</span> complex*)fftw_malloc(ths-&gt;n*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00169 
00170   ths-&gt;nplan1 = (<a class="code" href="structnfft__plan.html">nfft_plan</a>*) fftw_malloc(<span class="keyword">sizeof</span>(<a class="code" href="structnfft__plan.html">nfft_plan</a>));
00171   ths-&gt;nplan2 = (nfft_plan*) fftw_malloc(<span class="keyword">sizeof</span>(nfft_plan));
00172 
00173   n_fftw=<a class="code" href="group__nfftutil.html#ga4">nfft_next_power_of_2</a>(2*ths-&gt;n);
00174 
00175   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(ths-&gt;nplan1, 1, &amp;(ths-&gt;n), ths-&gt;N, &amp;n_fftw, m, <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>|
00176                  <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>| <a class="code" href="group__nfft.html#ga22">MALLOC_X</a>| <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>| <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a>, FFTW_MEASURE);
00177   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(ths-&gt;nplan2, 1, &amp;(ths-&gt;n), ths-&gt;M, &amp;n_fftw, m, <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>|
00178                  <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>| <a class="code" href="group__nfft.html#ga22">MALLOC_X</a>| <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a>, FFTW_MEASURE);
00179 
00180   ths-&gt;nplan1-&gt;f = ths-&gt;alpha;
00181   ths-&gt;nplan2-&gt;f_hat = ths-&gt;nplan1-&gt;f_hat;
00182   ths-&gt;nplan2-&gt;f = ths-&gt;f;
00183 
00184   <span class="keywordflow">if</span>(ths-&gt;flags &amp; <a class="code" href="group__applications__fastgauss.html#ga15">FGT_APPROX_B</a>)
00185     {
00186       fplan = fftw_plan_dft_1d(ths-&gt;n, ths-&gt;b, ths-&gt;b, FFTW_FORWARD,
00187                                FFTW_MEASURE);
00188 
00189       <span class="keywordflow">for</span>(j=0; j&lt;ths-&gt;n; j++)
00190   ths-&gt;b[j] = cexp(-ths-&gt;p*ths-&gt;p*ths-&gt;sigma*(j-ths-&gt;n/2)*(j-ths-&gt;n/2)/
00191                           ((<span class="keywordtype">double</span>)ths-&gt;n*ths-&gt;n)) / ths-&gt;n;
00192       
00193       <a class="code" href="group__nfftutil.html#ga36">nfft_fftshift_complex</a>(ths-&gt;b, 1, &amp;ths-&gt;n);  
00194       fftw_execute(fplan);
00195       <a class="code" href="group__nfftutil.html#ga36">nfft_fftshift_complex</a>(ths-&gt;b, 1, &amp;ths-&gt;n);
00196       
00197       fftw_destroy_plan(fplan);
00198     }
00199   <span class="keywordflow">else</span>
00200     {
00201       <span class="keywordflow">for</span>(j=0; j&lt;ths-&gt;n; j++)
00202   ths-&gt;b[j] = 1.0/ths-&gt;p * csqrt(<a class="code" href="group__nfftutil.html#ga57">PI</a>/ths-&gt;sigma)*
00203     cexp(-<a class="code" href="group__nfftutil.html#ga57">PI</a>*<a class="code" href="group__nfftutil.html#ga57">PI</a>*(j-ths-&gt;n/2)*(j-ths-&gt;n/2)/
00204          (ths-&gt;p*ths-&gt;p*ths-&gt;sigma));
00205     }
00206 }
00207 
<a name="l00219"></a><a class="code" href="group__applications__fastgauss.html#ga3">00219</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__fastgauss.html#ga3">fgt_init</a>(<a class="code" href="structfgt__plan.html">fgt_plan</a> *ths, <span class="keywordtype">int</span> N, <span class="keywordtype">int</span> M, <span class="keywordtype">double</span> complex sigma, <span class="keywordtype">double</span> eps)
00220 {
00221   <span class="keywordtype">double</span> p;
00222   <span class="keywordtype">int</span> n;
00223 
00224   p=0.5+sqrt(-log(eps)/creal(sigma));
00225   <span class="keywordflow">if</span>(p&lt;1)
00226     p=1;
00227 
00228   n=2*((int)ceil(p*cabs(sigma)/<a class="code" href="group__nfftutil.html#ga57">PI</a> * sqrt(-log(eps)/creal(sigma))));
00229 
00230   <span class="keywordflow">if</span>(N*M&lt;=((int)(1U&lt;&lt;20)))
00231     <a class="code" href="group__applications__fastgauss.html#ga2">fgt_init_guru</a>(ths, N, M, sigma, n, p, 7, <a class="code" href="group__applications__fastgauss.html#ga13">DGT_PRE_CEXP</a>);
00232   <span class="keywordflow">else</span>
00233     <a class="code" href="group__applications__fastgauss.html#ga2">fgt_init_guru</a>(ths, N, M, sigma, n, p, 7, 0);
00234 }
00235 
<a name="l00242"></a><a class="code" href="group__applications__fastgauss.html#ga4">00242</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__fastgauss.html#ga4">fgt_init_node_dependent</a>(<a class="code" href="structfgt__plan.html">fgt_plan</a> *ths)
00243 {
00244   <span class="keywordtype">int</span> j,k,l;
00245 
00246   <span class="keywordflow">if</span>(ths-&gt;flags &amp; <a class="code" href="group__applications__fastgauss.html#ga13">DGT_PRE_CEXP</a>)
00247    {
00248      ths-&gt;pre_cexp=(<span class="keywordtype">double</span> complex*)fftw_malloc(ths-&gt;M*ths-&gt;N*
00249             <span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00250 
00251      <span class="keywordflow">for</span>(j=0,l=0; j&lt;ths-&gt;M; j++)
00252        <span class="keywordflow">for</span>(k=0; k&lt;ths-&gt;N; k++,l++)
00253          ths-&gt;pre_cexp[l]=cexp(-ths-&gt;sigma*(ths-&gt;y[j]-ths-&gt;x[k])*
00254                                 (ths-&gt;y[j]-ths-&gt;x[k]));
00255    }
00256 
00257   <span class="keywordflow">for</span>(j=0; j&lt;ths-&gt;nplan1-&gt;M_total; j++)
00258     ths-&gt;nplan1-&gt;x[j] = ths-&gt;x[j]/ths-&gt;p;
00259   <span class="keywordflow">for</span>(j=0; j&lt;ths-&gt;nplan2-&gt;M_total; j++)
00260     ths-&gt;nplan2-&gt;x[j] = ths-&gt;y[j]/ths-&gt;p;
00261   
00262   <span class="keywordflow">if</span>(ths-&gt;nplan1-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00263     <a class="code" href="group__nfft.html#ga12">nfft_precompute_psi</a>(ths-&gt;nplan1);
00264   <span class="keywordflow">if</span>(ths-&gt;nplan2-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00265     <a class="code" href="group__nfft.html#ga12">nfft_precompute_psi</a>(ths-&gt;nplan2);
00266 }
00267 
<a name="l00274"></a><a class="code" href="group__applications__fastgauss.html#ga5">00274</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__fastgauss.html#ga5">fgt_finalize</a>(<a class="code" href="structfgt__plan.html">fgt_plan</a> *ths)
00275 {
00276   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(ths-&gt;nplan2);
00277   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(ths-&gt;nplan1);
00278 
00279   fftw_free(ths-&gt;nplan2);
00280   fftw_free(ths-&gt;nplan1);
00281 
00282   fftw_free(ths-&gt;b);
00283 
00284   fftw_free(ths-&gt;f);
00285   fftw_free(ths-&gt;y);
00286 
00287   fftw_free(ths-&gt;alpha);
00288   fftw_free(ths-&gt;x);
00289 }
00290 
<a name="l00297"></a><a class="code" href="group__applications__fastgauss.html#ga6">00297</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__fastgauss.html#ga6">fgt_test_init_rand</a>(<a class="code" href="structfgt__plan.html">fgt_plan</a> *ths)
00298 {
00299   <span class="keywordtype">int</span> j,k;
00300 
00301   <span class="keywordflow">for</span>(k=0; k&lt;ths-&gt;N; k++)
00302     ths-&gt;x[k] = (double)rand()/(2.0*RAND_MAX)-1.0/4.0;
00303 
00304   <span class="keywordflow">for</span>(j=0; j&lt;ths-&gt;M; j++)
00305     ths-&gt;y[j] = (double)rand()/(2.0*RAND_MAX)-1.0/4.0;
00306 
00307   <span class="keywordflow">for</span>(k=0; k&lt;ths-&gt;N; k++)
00308     ths-&gt;alpha[k] =   (double)rand()/(RAND_MAX)-1.0/2.0
00309             + I*(double)rand()/(RAND_MAX)-I/2.0;
00310 }
00311 
<a name="l00320"></a><a class="code" href="group__applications__fastgauss.html#ga7">00320</a> <span class="keywordtype">double</span> <a class="code" href="group__applications__fastgauss.html#ga7">fgt_test_measure_time</a>(<a class="code" href="structfgt__plan.html">fgt_plan</a> *ths, <span class="keywordtype">unsigned</span> dgt)
00321 {
00322   <span class="keywordtype">int</span> r;
00323   <span class="keywordtype">double</span> t_out,t; 
00324   <span class="keywordtype">double</span> tau=0.01;
00325 
00326   t_out=0;
00327   r=0; 
00328   <span class="keywordflow">while</span>(t_out&lt;tau)
00329     {
00330       r++;
00331       <span class="keywordflow">if</span>(dgt)
00332         {
00333           t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00334           <a class="code" href="group__applications__fastgauss.html#ga0">dgt_trafo</a>(ths);
00335         }
00336       <span class="keywordflow">else</span>
00337         {
00338           t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00339           <a class="code" href="group__applications__fastgauss.html#ga1">fgt_trafo</a>(ths);
00340         }
00341       t_out+=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-t;
00342     }
00343   t_out/=r;
00344 
00345   <span class="keywordflow">return</span> t_out;
00346 }
00347 
<a name="l00357"></a><a class="code" href="group__applications__fastgauss.html#ga8">00357</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__fastgauss.html#ga8">fgt_test_simple</a>(<span class="keywordtype">int</span> N, <span class="keywordtype">int</span> M, <span class="keywordtype">double</span> complex sigma, <span class="keywordtype">double</span> eps)
00358 {
00359   <a class="code" href="structfgt__plan.html">fgt_plan</a> my_plan;
00360   <span class="keywordtype">double</span> complex *swap_dgt;
00361      
00362   <a class="code" href="group__applications__fastgauss.html#ga3">fgt_init</a>(&amp;my_plan, N, M, sigma, eps);
00363   swap_dgt = (<span class="keywordtype">double</span> complex*)fftw_malloc(my_plan.<a class="code" href="structfgt__plan.html#o1">M</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00364 
00365   <a class="code" href="group__applications__fastgauss.html#ga6">fgt_test_init_rand</a>(&amp;my_plan);
00366   <a class="code" href="group__applications__fastgauss.html#ga4">fgt_init_node_dependent</a>(&amp;my_plan);   
00367 
00368   <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(swap_dgt,my_plan.<a class="code" href="structfgt__plan.html#o3">f</a>);
00369   <a class="code" href="group__applications__fastgauss.html#ga0">dgt_trafo</a>(&amp;my_plan);
00370   <a class="code" href="group__nfftutil.html#ga45">nfft_vpr_complex</a>(my_plan.<a class="code" href="structfgt__plan.html#o3">f</a>,my_plan.<a class="code" href="structfgt__plan.html#o1">M</a>,<span class="stringliteral">"discrete gauss transform"</span>);
00371   <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(swap_dgt,my_plan.<a class="code" href="structfgt__plan.html#o3">f</a>);
00372 
00373   <a class="code" href="group__applications__fastgauss.html#ga1">fgt_trafo</a>(&amp;my_plan);
00374   <a class="code" href="group__nfftutil.html#ga45">nfft_vpr_complex</a>(my_plan.<a class="code" href="structfgt__plan.html#o3">f</a>,my_plan.<a class="code" href="structfgt__plan.html#o1">M</a>,<span class="stringliteral">"fast gauss transform"</span>);
00375 
00376   printf(<span class="stringliteral">"\n relative error: %1.3e\n"</span>, <a class="code" href="group__nfftutil.html#ga39">nfft_error_l_infty_1_complex</a>(swap_dgt,
00377          my_plan.<a class="code" href="structfgt__plan.html#o3">f</a>, my_plan.<a class="code" href="structfgt__plan.html#o1">M</a>, my_plan.<a class="code" href="structfgt__plan.html#o2">alpha</a>, my_plan.<a class="code" href="structfgt__plan.html#o0">N</a>));
00378 
00379   fftw_free(swap_dgt);
00380   <a class="code" href="group__applications__fastgauss.html#ga5">fgt_finalize</a>(&amp;my_plan);
00381 }
00382 
<a name="l00392"></a><a class="code" href="group__applications__fastgauss.html#ga9">00392</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__fastgauss.html#ga9">fgt_test_andersson</a>()
00393 {
00394   <a class="code" href="structfgt__plan.html">fgt_plan</a> my_plan;
00395   <span class="keywordtype">double</span> complex *swap_dgt;
00396   <span class="keywordtype">int</span> N;
00397 
00398   <span class="keywordtype">double</span> complex sigma=4*(138+I*100);
00399   <span class="keywordtype">int</span> n=128;
00400   <span class="keywordtype">int</span> N_dgt_pre_exp=(int)(1U&lt;&lt;11);
00401   <span class="keywordtype">int</span> N_dgt=(int)(1U&lt;&lt;19);
00402 
00403   printf(<span class="stringliteral">"n=%d, sigma=%1.3e+i%1.3e\n"</span>,n,creal(sigma),cimag(sigma));
00404 
00405   <span class="keywordflow">for</span>(N=((int)(1U&lt;&lt;6)); N&lt;((int)(1U&lt;&lt;22)); N=N&lt;&lt;1)
00406     {
00407       printf(<span class="stringliteral">"$%d$\t &amp; "</span>,N);
00408 
00409       <span class="keywordflow">if</span>(N&lt;N_dgt_pre_exp)
00410         <a class="code" href="group__applications__fastgauss.html#ga2">fgt_init_guru</a>(&amp;my_plan, N, N, sigma, n, 1, 7, <a class="code" href="group__applications__fastgauss.html#ga13">DGT_PRE_CEXP</a>);
00411       <span class="keywordflow">else</span>
00412         <a class="code" href="group__applications__fastgauss.html#ga2">fgt_init_guru</a>(&amp;my_plan, N, N, sigma, n, 1, 7, 0);
00413 
00414       swap_dgt = (<span class="keywordtype">double</span> complex*)fftw_malloc(my_plan.<a class="code" href="structfgt__plan.html#o1">M</a>*
00415                 <span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00416 
00417       <a class="code" href="group__applications__fastgauss.html#ga6">fgt_test_init_rand</a>(&amp;my_plan);
00418       
00419       <a class="code" href="group__applications__fastgauss.html#ga4">fgt_init_node_dependent</a>(&amp;my_plan);      
00420 
00421       <span class="keywordflow">if</span>(N&lt;N_dgt)
00422   {
00423           <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(swap_dgt,my_plan.<a class="code" href="structfgt__plan.html#o3">f</a>);
00424           <span class="keywordflow">if</span>(N&lt;N_dgt_pre_exp)
00425             my_plan.<a class="code" href="structfgt__plan.html#o4">flags</a>^=<a class="code" href="group__applications__fastgauss.html#ga13">DGT_PRE_CEXP</a>;
00426  
00427     printf(<span class="stringliteral">"$%1.1e$\t &amp; "</span>,<a class="code" href="group__applications__fastgauss.html#ga7">fgt_test_measure_time</a>(&amp;my_plan, 1));
00428           <span class="keywordflow">if</span>(N&lt;N_dgt_pre_exp)
00429             my_plan.<a class="code" href="structfgt__plan.html#o4">flags</a>^=<a class="code" href="group__applications__fastgauss.html#ga13">DGT_PRE_CEXP</a>;
00430           <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(swap_dgt,my_plan.<a class="code" href="structfgt__plan.html#o3">f</a>);  
00431   }
00432       <span class="keywordflow">else</span>
00433   printf(<span class="stringliteral">"\t\t &amp; "</span>);  
00434 
00435       <span class="keywordflow">if</span>(N&lt;N_dgt_pre_exp)
00436   printf(<span class="stringliteral">"$%1.1e$\t &amp; "</span>,<a class="code" href="group__applications__fastgauss.html#ga7">fgt_test_measure_time</a>(&amp;my_plan, 1));
00437       <span class="keywordflow">else</span>
00438   printf(<span class="stringliteral">"\t\t &amp; "</span>);  
00439 
00440       my_plan.<a class="code" href="structfgt__plan.html#o4">flags</a>^=<a class="code" href="group__applications__fastgauss.html#ga14">FGT_NDFT</a>;
00441       printf(<span class="stringliteral">"$%1.1e$\t &amp; "</span>,<a class="code" href="group__applications__fastgauss.html#ga7">fgt_test_measure_time</a>(&amp;my_plan, 0));
00442       my_plan.<a class="code" href="structfgt__plan.html#o4">flags</a>^=<a class="code" href="group__applications__fastgauss.html#ga14">FGT_NDFT</a>;
00443 
00444       printf(<span class="stringliteral">"$%1.1e$\t &amp; "</span>,<a class="code" href="group__applications__fastgauss.html#ga7">fgt_test_measure_time</a>(&amp;my_plan, 0));
00445 
00446       printf(<span class="stringliteral">"$%1.1e$\t \\\\ \n"</span>,
00447        <a class="code" href="group__nfftutil.html#ga39">nfft_error_l_infty_1_complex</a>(swap_dgt, my_plan.<a class="code" href="structfgt__plan.html#o3">f</a>, my_plan.<a class="code" href="structfgt__plan.html#o1">M</a>,
00448             my_plan.<a class="code" href="structfgt__plan.html#o2">alpha</a>, my_plan.<a class="code" href="structfgt__plan.html#o0">N</a>));
00449       fflush(stdout);
00450 
00451       fftw_free(swap_dgt);
00452       <a class="code" href="group__applications__fastgauss.html#ga5">fgt_finalize</a>(&amp;my_plan);
00453       fftw_cleanup();
00454     }
00455 }
00456 
<a name="l00463"></a><a class="code" href="group__applications__fastgauss.html#ga10">00463</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__fastgauss.html#ga10">fgt_test_error</a>()
00464 {
00465   <a class="code" href="structfgt__plan.html">fgt_plan</a> my_plan;
00466   <span class="keywordtype">double</span> complex *swap_dgt;
00467   <span class="keywordtype">int</span> n,mi;
00468 
00469   <span class="keywordtype">double</span> complex sigma=4*(138+I*100);
00470   <span class="keywordtype">int</span> N=1000;
00471   <span class="keywordtype">int</span> M=1000;
00472   <span class="keywordtype">int</span> m[2]={7,3};
00473   
00474   printf(<span class="stringliteral">"N=%d;\tM=%d;\nsigma=%1.3e+i*%1.3e;\n"</span>,N,M,creal(sigma),cimag(sigma));
00475   printf(<span class="stringliteral">"error=[\n"</span>);
00476 
00477   swap_dgt = (<span class="keywordtype">double</span> complex*)fftw_malloc(M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00478 
00479   <span class="keywordflow">for</span>(n=8; n&lt;=128; n+=4)
00480     {
00481       printf(<span class="stringliteral">"%d\t"</span>,n);
00482       <span class="keywordflow">for</span>(mi=0;mi&lt;2;mi++)
00483         {
00484           <a class="code" href="group__applications__fastgauss.html#ga2">fgt_init_guru</a>(&amp;my_plan, N, M, sigma, n, 1, m[mi], 0);
00485           <a class="code" href="group__applications__fastgauss.html#ga6">fgt_test_init_rand</a>(&amp;my_plan);    
00486           <a class="code" href="group__applications__fastgauss.html#ga4">fgt_init_node_dependent</a>(&amp;my_plan);    
00487 
00488           <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(swap_dgt,my_plan.<a class="code" href="structfgt__plan.html#o3">f</a>);
00489           <a class="code" href="group__applications__fastgauss.html#ga0">dgt_trafo</a>(&amp;my_plan);
00490           <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(swap_dgt,my_plan.<a class="code" href="structfgt__plan.html#o3">f</a>);
00491 
00492           <a class="code" href="group__applications__fastgauss.html#ga1">fgt_trafo</a>(&amp;my_plan);
00493 
00494           printf(<span class="stringliteral">"%1.3e\t"</span>, <a class="code" href="group__nfftutil.html#ga39">nfft_error_l_infty_1_complex</a>(swap_dgt, my_plan.<a class="code" href="structfgt__plan.html#o3">f</a>,
00495                  my_plan.<a class="code" href="structfgt__plan.html#o1">M</a>, my_plan.<a class="code" href="structfgt__plan.html#o2">alpha</a>, my_plan.<a class="code" href="structfgt__plan.html#o0">N</a>));
00496           fflush(stdout);
00497 
00498           <a class="code" href="group__applications__fastgauss.html#ga5">fgt_finalize</a>(&amp;my_plan);
00499           fftw_cleanup();
00500         }
00501       printf(<span class="stringliteral">"\n"</span>);
00502     }
00503   printf(<span class="stringliteral">"];\n"</span>);
00504 
00505   fftw_free(swap_dgt);
00506 }
00507 
<a name="l00514"></a><a class="code" href="group__applications__fastgauss.html#ga11">00514</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__fastgauss.html#ga11">fgt_test_error_p</a>()
00515 {
00516   <a class="code" href="structfgt__plan.html">fgt_plan</a> my_plan;
00517   <span class="keywordtype">double</span> complex *swap_dgt;
00518   <span class="keywordtype">int</span> n,pi;
00519 
00520   <span class="keywordtype">double</span> complex sigma=20+40I;
00521   <span class="keywordtype">int</span> N=1000;
00522   <span class="keywordtype">int</span> M=1000;
00523   <span class="keywordtype">double</span> p[3]={1,1.5,2};
00524   
00525   printf(<span class="stringliteral">"N=%d;\tM=%d;\nsigma=%1.3e+i*%1.3e;\n"</span>,N,M,creal(sigma),cimag(sigma));
00526   printf(<span class="stringliteral">"error=[\n"</span>);
00527 
00528   swap_dgt = (<span class="keywordtype">double</span> complex*)fftw_malloc(M*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00529 
00530   <span class="keywordflow">for</span>(n=8; n&lt;=128; n+=4)
00531     {
00532       printf(<span class="stringliteral">"%d\t"</span>,n);
00533       <span class="keywordflow">for</span>(pi=0;pi&lt;3;pi++)
00534         {
00535           <a class="code" href="group__applications__fastgauss.html#ga2">fgt_init_guru</a>(&amp;my_plan, N, M, sigma, n, p[pi], 7, 0);
00536           <a class="code" href="group__applications__fastgauss.html#ga6">fgt_test_init_rand</a>(&amp;my_plan);    
00537           <a class="code" href="group__applications__fastgauss.html#ga4">fgt_init_node_dependent</a>(&amp;my_plan);    
00538 
00539           <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(swap_dgt,my_plan.<a class="code" href="structfgt__plan.html#o3">f</a>);
00540           <a class="code" href="group__applications__fastgauss.html#ga0">dgt_trafo</a>(&amp;my_plan);
00541           <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(swap_dgt,my_plan.<a class="code" href="structfgt__plan.html#o3">f</a>);
00542 
00543           <a class="code" href="group__applications__fastgauss.html#ga1">fgt_trafo</a>(&amp;my_plan);
00544 
00545           printf(<span class="stringliteral">"%1.3e\t"</span>, <a class="code" href="group__nfftutil.html#ga39">nfft_error_l_infty_1_complex</a>(swap_dgt, my_plan.<a class="code" href="structfgt__plan.html#o3">f</a>,
00546                  my_plan.<a class="code" href="structfgt__plan.html#o1">M</a>, my_plan.<a class="code" href="structfgt__plan.html#o2">alpha</a>, my_plan.<a class="code" href="structfgt__plan.html#o0">N</a>));
00547           fflush(stdout);
00548 
00549           <a class="code" href="group__applications__fastgauss.html#ga5">fgt_finalize</a>(&amp;my_plan);
00550           fftw_cleanup();
00551         }
00552       printf(<span class="stringliteral">"\n"</span>);
00553     }
00554   printf(<span class="stringliteral">"];\n"</span>);  
00555 }
00556 
<a name="l00562"></a><a class="code" href="group__applications__fastgauss.html#ga12">00562</a> <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a>(<span class="keywordtype">int</span> argc,<span class="keywordtype">char</span> **argv)
00563 {
00564   <span class="keywordflow">if</span>(argc!=2)
00565     {
00566       fprintf(stderr,<span class="stringliteral">"fastgauss type\n"</span>);
00567       fprintf(stderr,<span class="stringliteral">" type\n"</span>);
00568       fprintf(stderr,<span class="stringliteral">"  0 - Simple test.\n"</span>);
00569       fprintf(stderr,<span class="stringliteral">"  1 - Compares accuracy and execution time.\n"</span>);
00570       fprintf(stderr,<span class="stringliteral">"      Pipe to output_andersson.tex\n"</span>);
00571       fprintf(stderr,<span class="stringliteral">"  2 - Compares accuracy.\n"</span>);
00572       fprintf(stderr,<span class="stringliteral">"      Pipe to output_error.m\n"</span>);
00573       fprintf(stderr,<span class="stringliteral">"  3 - Compares accuracy.\n"</span>);
00574       fprintf(stderr,<span class="stringliteral">"      Pipe to output_error_p.m\n"</span>);
00575       <span class="keywordflow">return</span> -1;
00576     }
00577 
00578   <span class="keywordflow">if</span>(atoi(argv[1])==0)
00579     <a class="code" href="group__applications__fastgauss.html#ga8">fgt_test_simple</a>(10, 10, 5+3*I, 0.001);
00580 
00581   <span class="keywordflow">if</span>(atoi(argv[1])==1)
00582     <a class="code" href="group__applications__fastgauss.html#ga9">fgt_test_andersson</a>();
00583 
00584   <span class="keywordflow">if</span>(atoi(argv[1])==2)
00585     <a class="code" href="group__applications__fastgauss.html#ga10">fgt_test_error</a>();
00586 
00587   <span class="keywordflow">if</span>(atoi(argv[1])==3)
00588     <a class="code" href="group__applications__fastgauss.html#ga11">fgt_test_error_p</a>();
00589 
00590   <span class="keywordflow">return</span> 1;
00591 }
00592 <span class="comment">/* \} */</span>
</pre></div>    <hr size="1"/>
    Generated on 22 Jan 2007 by Doxygen 1.4.1
  </body>
</html>
