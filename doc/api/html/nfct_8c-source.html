<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.3 API Reference - NFFT: nfct.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.3 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000003.html">kernel</a>&nbsp;/&nbsp;<a class="el" href="dir_000024.html">nfct</a></div>
<h1>nfct.c</h1><div class="fragment"><pre class="fragment">00001 
00007 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00008 <span class="preprocessor">#include &lt;math.h&gt;</span>
00009 <span class="preprocessor">#include &lt;string.h&gt;</span>
00010 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00011 
00012 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00013 <span class="preprocessor">#include "options.h"</span>
00014 <span class="preprocessor">#include "window_defines.h"</span>
00015 
00016 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00017 
00018 
00022 <span class="preprocessor">#define NFCT_DEFAULT_FLAGS   PRE_PHI_HUT|\</span>
00023 <span class="preprocessor">                             PRE_PSI|\</span>
00024 <span class="preprocessor">                             MALLOC_X|\</span>
00025 <span class="preprocessor">                             MALLOC_F_HAT|\</span>
00026 <span class="preprocessor">                             MALLOC_F|\</span>
00027 <span class="preprocessor">                             FFTW_INIT|\</span>
00028 <span class="preprocessor">                             FFT_OUT_OF_PLACE</span>
00029 <span class="preprocessor"></span>
00030 <span class="preprocessor">#define FFTW_DEFAULT_FLAGS   FFTW_ESTIMATE|\</span>
00031 <span class="preprocessor">                             FFTW_DESTROY_INPUT</span>
00032 <span class="preprocessor"></span>
00033 <span class="preprocessor">#define NFCT_SUMMANDS ( 2 * ths-&gt;m + 2)</span>
00034 <span class="preprocessor"></span><span class="preprocessor">#define NODE(p,r) ( ths-&gt;x[(p) * ths-&gt;d + (r)])</span>
00035 <span class="preprocessor"></span>
00036 <span class="preprocessor">#define MACRO_ndct_init_result_trafo       \</span>
00037 <span class="preprocessor">  memset( f, 0, ths-&gt;M_total * sizeof( double));</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_ndct_init_result_adjoint     \</span>
00039 <span class="preprocessor">  memset( f_hat, 0, ths-&gt;N_total * sizeof( double));</span>
00040 <span class="preprocessor"></span>
00041 
00042 <span class="preprocessor">#define MACRO_nfct_D_init_result_A         \</span>
00043 <span class="preprocessor">  memset(g_hat,   0, nfct_prod_int(ths-&gt;n, ths-&gt;d) * sizeof( double));</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_nfct_D_init_result_T         \</span>
00045 <span class="preprocessor">  memset(f_hat, 0, ths-&gt;N_total * sizeof( double));</span>
00046 <span class="preprocessor"></span>
00047 <span class="preprocessor">#define MACRO_nfct_B_init_result_A         \</span>
00048 <span class="preprocessor">  memset(f, 0, ths-&gt;M_total * sizeof( double));</span>
00049 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_nfct_B_init_result_T         \</span>
00050 <span class="preprocessor">  memset(g, 0, nfct_prod_int( ths-&gt;n, ths-&gt;d) * sizeof( double));</span>
00051 <span class="preprocessor"></span>
00052 
00053 <span class="preprocessor">#define NFCT_PRE_WINFUN( d)  ths-&gt;N[d] = 2 * ths-&gt;N[d];             \</span>
00054 <span class="preprocessor">                             ths-&gt;n[d] = nfct_fftw_2N( ths-&gt;n[d]);</span>
00055 <span class="preprocessor"></span>
00056 <span class="preprocessor">#define NFCT_POST_WINFUN( d) ths-&gt;N[d] = (int)(0.5 * ths-&gt;N[d]);    \</span>
00057 <span class="preprocessor">                             ths-&gt;n[d] = nfct_fftw_2N_rev( ths-&gt;n[d]);</span>
00058 <span class="preprocessor"></span>
00059 
00060 <span class="preprocessor">#define NFCT_WINDOW_HELP_INIT  WINDOW_HELP_INIT</span>
00061 <span class="preprocessor"></span>
00062 
<a name="l00063"></a><a class="code" href="group__nfsct.html#ga11">00063</a> <span class="keywordtype">double</span> <a class="code" href="group__nfsct.html#ga11">nfct_phi_hut</a>( <a class="code" href="structnfct__plan.html">nfct_plan</a> *ths, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> d)
00064 {
00065   NFCT_PRE_WINFUN( d);
00066   <span class="keywordtype">double</span> phi_hut_tmp = PHI_HUT( k, d);
00067   NFCT_POST_WINFUN( d);
00068 
00069   <span class="keywordflow">return</span> phi_hut_tmp;
00070 }
00071 
<a name="l00072"></a><a class="code" href="group__nfsct.html#ga12">00072</a> <span class="keywordtype">double</span> <a class="code" href="group__nfsct.html#ga12">nfct_phi</a>( <a class="code" href="structnfct__plan.html">nfct_plan</a> *ths, <span class="keywordtype">double</span> x, <span class="keywordtype">int</span> d)
00073 {
00074   NFCT_PRE_WINFUN( d); 
00075   <span class="keywordtype">double</span> phi_tmp = PHI( x, d); 
00076   NFCT_POST_WINFUN( d); 
00077 
00078   <span class="keywordflow">return</span> phi_tmp; 
00079 } 
00080 
<a name="l00081"></a><a class="code" href="group__nfsct.html#ga13">00081</a> <span class="keywordtype">int</span> <a class="code" href="group__nfsct.html#ga13">nfct_fftw_2N</a>( <span class="keywordtype">int</span> n)
00082 {
00083   <span class="keywordflow">return</span> 2 * ( n - 1);
00084 }
00085 
<a name="l00086"></a><a class="code" href="group__nfsct.html#ga14">00086</a> <span class="keywordtype">int</span> <a class="code" href="group__nfsct.html#ga14">nfct_fftw_2N_rev</a>( <span class="keywordtype">int</span> n)
00087 {
00088   <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)(0.5 * n) + 1;
00089 }
00090 
00091 
00092 <span class="preprocessor">#define MACRO_with_cos_vec       cos_vec[t][ka[t]]</span>
00093 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_without_cos_vec    cos( 2.0 * PI * ka[t] * NODE(j,t))</span>
00094 <span class="preprocessor"></span>
00095 
00096 <span class="preprocessor">#define MACRO_with_PRE_PHI_HUT      ths-&gt;c_phi_inv[t][kg[t]]; </span>
00097 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_compute_PHI_HUT_INV   (1.0 / (nfct_phi_hut( ths, kg[t], t))) </span>
00098 <span class="preprocessor"></span>
00099 <span class="preprocessor">#define MACRO_with_PRE_PSI   ths-&gt;psi[(j * ths-&gt;d + t) * NFCT_SUMMANDS + lc[t]] </span>
00100 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_compute_PSI    nfct_phi( ths, NODE(j,t) - (( double)(lc[t] + lb[t])) / (double)nfct_fftw_2N( ths-&gt;n[t]), t) </span>
00101 <span class="preprocessor"></span>
00102 
00103 
00104 
00121 <span class="preprocessor">#define MACRO_ndct_malloc__cos_vec                                      \</span>
00122 <span class="preprocessor">                                                                        \</span>
00123 <span class="preprocessor">  double **cos_vec;                                                     \</span>
00124 <span class="preprocessor">  cos_vec = (double**) malloc( ths-&gt;d * sizeof( double*));              \</span>
00125 <span class="preprocessor">  for( t = 0; t &lt; ths-&gt;d; t++)                                          \</span>
00126 <span class="preprocessor">    cos_vec[t] = (double*) malloc( ths-&gt;N[t] * sizeof( double));        \</span>
00127 <span class="preprocessor"></span>
00128 <span class="preprocessor"></span>
00129 
00130 
00131 <span class="preprocessor">#define MACRO_ndct_free__cos_vec                                        \</span>
00132 <span class="preprocessor">{                                                                 \</span>
00133 <span class="preprocessor">  </span><span class="comment">/* free allocated memory */</span>                                           \
00134   for( t = 0; t &lt; ths-&gt;d; t++)                                          \
00135     free( cos_vec[t]);                                              \
00136   free( cos_vec);                                                       \
00137 }
00138 
00139 
00140 
00141 <span class="preprocessor">#define MACRO_ndct_init__cos_vec                                        \</span>
00142 <span class="preprocessor">{                                                                       \</span>
00143 <span class="preprocessor">  for( t = 0; t &lt; ths-&gt;d; t++)                                          \</span>
00144 <span class="preprocessor">  {                                                                     \</span>
00145 <span class="preprocessor">    cos_vec[t][0] = 1.0;                                                \</span>
00146 <span class="preprocessor">    cos_vec[t][1] = cos( 2.0 * PI * NODE(j,t));                         \</span>
00147 <span class="preprocessor">    for( k = 2; k &lt; ths-&gt;N[t]; k++)               \</span>
00148 <span class="preprocessor">      cos_vec[t][k] = 2.0 * cos_vec[t][1] * cos_vec[t][k-1]             \</span>
00149 <span class="preprocessor">                      - cos_vec[t][k-2];                                \</span>
00150 <span class="preprocessor">  }                                                                     \</span>
00151 <span class="preprocessor">}</span>
00152 <span class="preprocessor"></span>
00153 
00154 
00155 <span class="preprocessor">#define MACRO_ndct_init__k__cos_k( which_one)                           \</span>
00156 <span class="preprocessor">{                                                                       \</span>
00157 <span class="preprocessor">  cos_k[0] = 1.0;                                                       \</span>
00158 <span class="preprocessor">  for( t = 0; t &lt; ths-&gt;d; t++)                                          \</span>
00159 <span class="preprocessor">    ka[t] = 0;                                                          \</span>
00160 <span class="preprocessor">                                                                        \</span>
00161 <span class="preprocessor">    for( t = 0; t &lt; ths-&gt;d; t++)                                        \</span>
00162 <span class="preprocessor">    {                                                                   \</span>
00163 <span class="preprocessor">      cos_k[t+1] = cos_k[t] * MACRO_ ##which_one;                       \</span>
00164 <span class="preprocessor">    }                                                                   \</span>
00165 <span class="preprocessor">}</span>
00166 <span class="preprocessor"></span>
00167 
00168 
00169 <span class="preprocessor">#define MACRO_ndct_count__k__cos_k( which_one)                          \</span>
00170 <span class="preprocessor">{                                                                       \</span>
00171 <span class="preprocessor">  ka[ths-&gt;d-1]++;                                                       \</span>
00172 <span class="preprocessor">  i = ths-&gt;d - 1;                                                       \</span>
00173 <span class="preprocessor">  while( ( ka[i] == ths-&gt;N[i]) &amp;&amp; ( i&gt;0))                               \</span>
00174 <span class="preprocessor">  {                                                                     \</span>
00175 <span class="preprocessor">    ka[i - 1]++;                                                        \</span>
00176 <span class="preprocessor">    ka[i] = 0;                                                          \</span>
00177 <span class="preprocessor">                                                                        \</span>
00178 <span class="preprocessor">    i--;                                                                \</span>
00179 <span class="preprocessor">  }                                                                     \</span>
00180 <span class="preprocessor">  for( t = i; t &lt; ths-&gt;d; t++)                                          \</span>
00181 <span class="preprocessor">    cos_k[t+1] = cos_k[t] * MACRO_ ##which_one;                         \</span>
00182 <span class="preprocessor">}</span>
00183 <span class="preprocessor"></span>
00184 
00185 
00186 <span class="preprocessor">#define MACRO_ndct_compute__trafo                                       \</span>
00187 <span class="preprocessor">{                                                                       \</span>
00188 <span class="preprocessor">  f[j] += f_hat[k] * cos_k[ths-&gt;d];                                 \</span>
00189 <span class="preprocessor">}</span>
00190 <span class="preprocessor"></span>
00191 <span class="preprocessor">#define MACRO_ndct_compute__adjoint                                     \</span>
00192 <span class="preprocessor">{                                                                       \</span>
00193 <span class="preprocessor">  f_hat[k] += f[j] * cos_k[ths-&gt;d];                                     \</span>
00194 <span class="preprocessor">}</span>
00195 <span class="preprocessor"></span>
00196 <span class="comment">/* slow (trafo) transform */</span>
00197 <span class="preprocessor">#define MACRO_ndct(which_one)                                           \</span>
00198 <span class="preprocessor">  void ndct_ ## which_one ( nfct_plan *ths)                             \</span>
00199 <span class="preprocessor">  {                                                                     \</span>
00200 <span class="preprocessor">    int j, k, t, i;                                                     \</span>
00201 <span class="preprocessor">    int ka[ths-&gt;d];                                                     \</span>
00202 <span class="preprocessor">    double cos_k[ths-&gt;d+1];                                             \</span>
00203 <span class="preprocessor">                                                                        \</span>
00204 <span class="preprocessor">    double *f     = ths-&gt;f;                                             \</span>
00205 <span class="preprocessor">    double *f_hat = ths-&gt;f_hat;                                         \</span>
00206 <span class="preprocessor">                                                                        \</span>
00207 <span class="preprocessor">    MACRO_ndct_init_result_ ## which_one;         \</span>
00208 <span class="preprocessor">    if( ths-&gt;d == 1)                                                    \</span>
00209 <span class="preprocessor">      for( j = 0; j &lt; ths-&gt;M_total; j++)                                \</span>
00210 <span class="preprocessor">      {                                                                 \</span>
00211 <span class="preprocessor">        for( k = 0; k &lt; ths-&gt;N[0]; k++)                                 \</span>
00212 <span class="preprocessor">        {                                                               \</span>
00213 <span class="preprocessor">    cos_k[ths-&gt;d] = cos( 2.0 * PI * k * NODE(j,0));               \</span>
00214 <span class="preprocessor">          MACRO_ndct_compute__ ## which_one;                            \</span>
00215 <span class="preprocessor">        }                     \</span>
00216 <span class="preprocessor">      }                                                                 \</span>
00217 <span class="preprocessor">    else   </span><span class="comment">/*FIXME: remove slow slow ... */</span>                             \
00218       if( 1 == 0)                                                       \
00219         <span class="comment">/* slow ndct */</span>                                                 \
00220         for( j = 0; j &lt; ths-&gt;M_total; j++)                              \
00221         {                                                               \
00222           MACRO_ndct_init__k__cos_k(without_cos_vec);                   \
00223                                                                         \
00224           for( k = 0; k &lt; ths-&gt;N_total; k++)                            \
00225           {                                                             \
00226             MACRO_ndct_compute__ ## which_one;                          \
00227                                                                         \
00228             MACRO_ndct_count__k__cos_k(without_cos_vec);                \
00229           }                               \
00230         }                                                               \
00231       else                                                              \
00232         {                                                               \
00233           <span class="comment">/* fast ndct_trafo */</span>                                         \
00234           MACRO_ndct_malloc__cos_vec;                                   \
00235                                                                         \
00236           for( j = 0; j &lt; ths-&gt;M_total; j++)                            \
00237           {                                                             \
00238                                                                         \
00239             MACRO_ndct_init__cos_vec;                                   \
00240                                                                         \
00241             MACRO_ndct_init__k__cos_k(with_cos_vec);                    \
00242                                                                         \
00243             for( k = 0; k &lt; ths-&gt;N_total; k++)                          \
00244             {                                                           \
00245                                                                         \
00246               MACRO_ndct_compute__ ## which_one;                        \
00247                               \
00248               MACRO_ndct_count__k__cos_k(with_cos_vec);                 \
00249             }                                                           \
00250           }                                                             \
00251           MACRO_ndct_free__cos_vec;                                     \
00252         }                                                               \
00253 } <span class="comment">/* ndct_{trafo, adjoint} */</span>
00254 
00255 
<a name="l00256"></a><a class="code" href="group__nfsct.html#ga7">00256</a> MACRO_ndct(trafo)
<a name="l00257"></a><a class="code" href="group__nfsct.html#ga9">00257</a> MACRO_ndct(adjoint)
00258 
00259 
00260 
00261 
00278 #define MACRO_nfct__lower_boundary( j,act_dim)                                  \
00279 {                                                                               \
00280   lb[(act_dim)] =                                                               \
00281     (int)( NODE((j),(act_dim)) * <a class="code" href="group__nfsct.html#ga13">nfct_fftw_2N</a>( ths-&gt;n[(act_dim)])) - ths-&gt;m;    \
00282 }
00283 
00284 <span class="preprocessor">#define MACRO_nfct_D_compute_A                    \</span>
00285 <span class="preprocessor">{                                                                               \</span>
00286 <span class="preprocessor">  g_hat[kg_plain[ths-&gt;d]] = f_hat[k_L] * c_phi_inv_k[ths-&gt;d];                 \</span>
00287 <span class="preprocessor">}</span>
00288 <span class="preprocessor"></span>
00289 <span class="preprocessor">#define MACRO_nfct_D_compute_T                                                  \</span>
00290 <span class="preprocessor">{                                                                               \</span>
00291 <span class="preprocessor">  f_hat[k_L] = g_hat[kg_plain[ths-&gt;d]] * c_phi_inv_k[ths-&gt;d];                   \</span>
00292 <span class="preprocessor">}</span>
00293 <span class="preprocessor"></span>
00294 
00295 
00296 <span class="preprocessor">#define MACRO_init__kg                      \</span>
00297 <span class="preprocessor">{                                                                               \</span>
00298 <span class="preprocessor">  for( t = 0; t &lt; ths-&gt;d; t++)                          \</span>
00299 <span class="preprocessor">    kg[t] = 0;                              \</span>
00300 <span class="preprocessor">                                \</span>
00301 <span class="preprocessor">  i = 0;                        \</span>
00302 <span class="preprocessor">}</span>
00303 <span class="preprocessor"></span>
00304 
00305 <span class="preprocessor">#define MACRO_count__kg                                                         \</span>
00306 <span class="preprocessor">{                                                                               \</span>
00307 <span class="preprocessor">                                                                                \</span>
00308 <span class="preprocessor">  kg[ths-&gt;d - 1]++;                                                             \</span>
00309 <span class="preprocessor">  i = ths-&gt;d - 1;                                                               \</span>
00310 <span class="preprocessor">  while( ( kg[i] == ths-&gt;N[i]) &amp;&amp; ( i &gt; 0))                                     \</span>
00311 <span class="preprocessor">  {                                                                             \</span>
00312 <span class="preprocessor">    kg[i - 1]++;                                                                \</span>
00313 <span class="preprocessor">    kg[i] = 0;                                                                  \</span>
00314 <span class="preprocessor">                                                                                \</span>
00315 <span class="preprocessor">    i--;                                                                        \</span>
00316 <span class="preprocessor">  }                                                                             \</span>
00317 <span class="preprocessor">}</span>
00318 <span class="preprocessor"></span>
00319 
00320 <span class="preprocessor">#define MACRO_update__phi_inv_k__kg_plain( what_kind, which_phi)          \</span>
00321 <span class="preprocessor">{                                                                               \</span>
00322 <span class="preprocessor">  for( t = i; t &lt; ths-&gt;d; t++)                                                  \</span>
00323 <span class="preprocessor">  {                                                                             \</span>
00324 <span class="preprocessor">    MACRO__c_phi_inv_k__ ## what_kind( which_phi);                              \</span>
00325 <span class="preprocessor">    kg_plain[t+1] = kg_plain[t] * ths-&gt;n[t] + kg[t];                            \</span>
00326 <span class="preprocessor">  }                                                                             \</span>
00327 <span class="preprocessor">}</span>
00328 <span class="preprocessor"></span>
00329 
00330 <span class="preprocessor">#define MACRO__c_phi_inv_k__A( which_phi)                                       \</span>
00331 <span class="preprocessor">{                                                                               \</span>
00332 <span class="preprocessor">  if( kg[t] == 0)                                                               \</span>
00333 <span class="preprocessor">  {                                                                             \</span>
00334 <span class="preprocessor">    c_phi_inv_k[t+1] = c_phi_inv_k[t] * MACRO_ ## which_phi;                  \</span>
00335 <span class="preprocessor">  }                                                                             \</span>
00336 <span class="preprocessor">  else                                                                          \</span>
00337 <span class="preprocessor">  {                                                                             \</span>
00338 <span class="preprocessor">    c_phi_inv_k[t+1] = 0.5 * c_phi_inv_k[t] * MACRO_ ## which_phi;          \</span>
00339 <span class="preprocessor">  }                                                                             \</span>
00340 <span class="preprocessor">}</span>
00341 <span class="preprocessor"></span>
00342 
00343 <span class="preprocessor">#define MACRO__c_phi_inv_k__T( which_phi)                                       \</span>
00344 <span class="preprocessor">{                                                                               \</span>
00345 <span class="preprocessor">  c_phi_inv_k[t+1] = c_phi_inv_k[t] * MACRO_ ## which_phi;                    \</span>
00346 <span class="preprocessor">}</span>
00347 <span class="preprocessor"></span>
00348 
00349 
00350 <span class="preprocessor">#define MACRO_nfct_D(which_one)                                                 \</span>
00351 <span class="preprocessor">inline void nfct_D_ ## which_one (nfct_plan *ths)                               \</span>
00352 <span class="preprocessor">{                                                             \</span>
00353 <span class="preprocessor">                                                                                \</span>
00354 <span class="preprocessor">  int k_L;                                \</span>
00355 <span class="preprocessor">                                                                                \</span>
00356 <span class="preprocessor">  int i, t;                                                                     \</span>
00357 <span class="preprocessor">  int kg[ths-&gt;d];                         \</span>
00358 <span class="preprocessor">  double c_phi_inv_k[ths-&gt;d+1];           \</span>
00359 <span class="preprocessor">  int kg_plain[ths-&gt;d+1];                 \</span>
00360 <span class="preprocessor">                                                                                \</span>
00361 <span class="preprocessor">  double *g_hat, *f_hat;                  \</span>
00362 <span class="preprocessor">                                                                                \</span>
00363 <span class="preprocessor">  g_hat = ths-&gt;g_hat;                                                           \</span>
00364 <span class="preprocessor">  f_hat = ths-&gt;f_hat;                                                           \</span>
00365 <span class="preprocessor">                                                                                \</span>
00366 <span class="preprocessor">  MACRO_nfct_D_init_result_ ## which_one                                        \</span>
00367 <span class="preprocessor">                                                                                \</span>
00368 <span class="preprocessor">  c_phi_inv_k[0] = 1.0;                                                         \</span>
00369 <span class="preprocessor">  kg_plain[0]    =   0;                                                         \</span>
00370 <span class="preprocessor">                                                                                \</span>
00371 <span class="preprocessor">  MACRO_init__kg;                                                               \</span>
00372 <span class="preprocessor">                                                                                \</span>
00373 <span class="preprocessor">  if( ths-&gt;nfct_flags &amp; PRE_PHI_HUT)                                            \</span>
00374 <span class="preprocessor">    for( k_L = 0; k_L &lt; ths-&gt;N_total; k_L++)                                    \</span>
00375 <span class="preprocessor">    {                                                                           \</span>
00376 <span class="preprocessor">      MACRO_update__phi_inv_k__kg_plain( which_one, with_PRE_PHI_HUT);          \</span>
00377 <span class="preprocessor">                                                                                \</span>
00378 <span class="preprocessor">      MACRO_nfct_D_compute_ ## which_one;                                       \</span>
00379 <span class="preprocessor">                                                                                \</span>
00380 <span class="preprocessor">      MACRO_count__kg;                                                          \</span>
00381 <span class="preprocessor">                                                                                \</span>
00382 <span class="preprocessor">    } </span><span class="comment">/* for(k_L) */</span>                                                            \
00383   else                                                                          \
00384     for( k_L = 0; k_L &lt; ths-&gt;N_total; k_L++)                                    \
00385     {                                                                           \
00386       MACRO_update__phi_inv_k__kg_plain( which_one,compute_PHI_HUT_INV);        \
00387                                                                                 \
00388       MACRO_nfct_D_compute_ ## which_one;                                       \
00389                                                                                 \
00390       MACRO_count__kg;                                                          \
00391                                                                                 \
00392     } <span class="comment">/* for(k_L) */</span>                                                            \
00393 } <span class="comment">/* nfct_D */</span>
00394 
00395 MACRO_nfct_D(A)
00396 MACRO_nfct_D(T)
00397 
00398 
00399 
00400 
00401 
00402 
00403 
00407 #define MACRO_nfct_B_PRE_FULL_PSI_compute_A                                     \
00408 {                                                                               \
00409   (*fj) += ths-&gt;psi[ix] * g[ths-&gt;psi_index_g[ix]];                              \
00410 }
00411 
00412 <span class="preprocessor">#define MACRO_nfct_B_PRE_FULL_PSI_compute_T                                     \</span>
00413 <span class="preprocessor">{                                                                               \</span>
00414 <span class="preprocessor">  g[ths-&gt;psi_index_g[ix]] += ths-&gt;psi[ix] * (*fj);                              \</span>
00415 <span class="preprocessor">}</span>
00416 <span class="preprocessor"></span>
00417 
00418 
00419 <span class="preprocessor">#define MACRO_nfct_B_compute_A                                                  \</span>
00420 <span class="preprocessor">{                                                                               \</span>
00421 <span class="preprocessor">  (*fj) += phi_tilde[ths-&gt;d] * g[lg_plain[ths-&gt;d]];                             \</span>
00422 <span class="preprocessor">}</span>
00423 <span class="preprocessor"></span>
00424 <span class="preprocessor">#define MACRO_nfct_B_compute_T                                                  \</span>
00425 <span class="preprocessor">{                                                                               \</span>
00426 <span class="preprocessor">  g[lg_plain[ths-&gt;d]] += phi_tilde[ths-&gt;d] * (*fj);                             \</span>
00427 <span class="preprocessor">}</span>
00428 <span class="preprocessor"></span>
00429 
00430 <span class="preprocessor">#define MACRO_compute_lg_offset__count_lg(i0)           \</span>
00431 <span class="preprocessor">{                                                                               \</span>
00432 <span class="preprocessor">  </span><span class="comment">/* determine index in g-array corresponding to lb[(i0)] */</span>                    \
00433   if( lb[(i0)] &lt; 0)                                                             \
00434     lg_offset[(i0)] =                                                           \
00435       (lb[(i0)] % nfct_fftw_2N( ths-&gt;n[(i0)])) + nfct_fftw_2N( ths-&gt;n[(i0)]);   \
00436   else                                                                          \
00437     lg_offset[(i0)] = lb[(i0)] % (nfct_fftw_2N( ths-&gt;n[(i0)]));                 \
00438     if( lg_offset[(i0)] &gt;= ths-&gt;n[(i0)])                                        \
00439       lg_offset[(i0)] = -( nfct_fftw_2N( ths-&gt;n[(i0)]) - lg_offset[(i0)]);      \
00440 }
00441 
00442 <span class="preprocessor">#define MACRO_set__lg__to__lg_offset                                            \</span>
00443 <span class="preprocessor">{                                                                               \</span>
00444 <span class="preprocessor">  if( lg_offset[i] &lt;= 0)                                                        \</span>
00445 <span class="preprocessor">  {                                                                             \</span>
00446 <span class="preprocessor">    lg[i] = -lg_offset[i];                                                      \</span>
00447 <span class="preprocessor">    count_lg[i] = -1;                                                           \</span>
00448 <span class="preprocessor">  }                                                                             \</span>
00449 <span class="preprocessor">  else                                                                          \</span>
00450 <span class="preprocessor">  {                                                                             \</span>
00451 <span class="preprocessor">    lg[i] = +lg_offset[i];                                                      \</span>
00452 <span class="preprocessor">    count_lg[i] = +1;                                                           \</span>
00453 <span class="preprocessor">  }                                                                             \</span>
00454 <span class="preprocessor">}</span>
00455 <span class="preprocessor"></span>
00456 <span class="preprocessor">#define MACRO_count__lg(dim)                                                    \</span>
00457 <span class="preprocessor">{                                                                               \</span>
00458 <span class="preprocessor">                                                                                \</span>
00459 <span class="preprocessor">  </span><span class="comment">/* turn around if we hit one of the boundaries */</span>                             \
00460   if( (lg[(dim)] == 0) || (lg[(dim)] == ths-&gt;n[(dim)]-1))                       \
00461     count_lg[(dim)] *= -1;                                                      \
00462   <span class="comment">/* move array index */</span>                                                        \
00463   lg[(dim)] += count_lg[(dim)];                                                 \
00464 }
00465 
00466 
00467 
00468 
00469 <span class="preprocessor">#define MACRO_init_lb_lg_lc                                                     \</span>
00470 <span class="preprocessor">{                                                                               \</span>
00471 <span class="preprocessor">  for( i = 0; i &lt; ths-&gt;d; i++)                                                  \</span>
00472 <span class="preprocessor">  {                                                                             \</span>
00473 <span class="preprocessor">    MACRO_nfct__lower_boundary( j, i);                                          \</span>
00474 <span class="preprocessor">                                                                                \</span>
00475 <span class="preprocessor">    MACRO_compute_lg_offset__count_lg( i);                                      \</span>
00476 <span class="preprocessor">    MACRO_set__lg__to__lg_offset;                                               \</span>
00477 <span class="preprocessor">                                                                                \</span>
00478 <span class="preprocessor">    </span><span class="comment">/* counter for lg */</span>                                                        \
00479     lc[i] = 0;                                                                  \
00480    }                                                                            \
00481                                                                                 \
00482    i = 0;                                                                       \
00483 }
00484 
00485 
00486 
00487 <span class="preprocessor">#define MACRO_count__lg_lc                                                      \</span>
00488 <span class="preprocessor">{                                                                               \</span>
00489 <span class="preprocessor">  MACRO_count__lg( ths-&gt;d-1);                                                   \</span>
00490 <span class="preprocessor">                                                                                \</span>
00491 <span class="preprocessor">  lc[ths-&gt;d - 1]++;                                                             \</span>
00492 <span class="preprocessor">  i = ths-&gt;d - 1;                                                               \</span>
00493 <span class="preprocessor">  while( ( lc[i] == NFCT_SUMMANDS) &amp;&amp; ( i &gt; 0))                                 \</span>
00494 <span class="preprocessor">  {                                                                             \</span>
00495 <span class="preprocessor">    lc[i - 1]++;                                                                \</span>
00496 <span class="preprocessor">    lc[i] = 0;                                                                  \</span>
00497 <span class="preprocessor">                                                                                \</span>
00498 <span class="preprocessor">    </span><span class="comment">/* ansonsten lg[i-1] verschieben */</span>                                         \
00499     MACRO_count__lg( i - 1);                                                    \
00500     <span class="comment">/* lg[i] = anfangswert */</span>                                                   \
00501     MACRO_set__lg__to__lg_offset;                                               \
00502                                                                                 \
00503     i--;                                                                        \
00504   }                                                                             \
00505 }
00506 
00507 <span class="preprocessor">#define  MACRO_update_phi_tilde_lg_plain( which_one, which_psi)                 \</span>
00508 <span class="preprocessor">{                                                                               \</span>
00509 <span class="preprocessor">  for( t = i; t &lt; ths-&gt;d; t++)                                                  \</span>
00510 <span class="preprocessor">  {                                                                             \</span>
00511 <span class="preprocessor">    MACRO__phi_tilde__ ## which_one( which_psi);                                \</span>
00512 <span class="preprocessor">    lg_plain[t+1]  = lg_plain[t]  * ths-&gt;n[t] + lg[t];                          \</span>
00513 <span class="preprocessor">  }                                                                             \</span>
00514 <span class="preprocessor">}</span>
00515 <span class="preprocessor"></span>
00516 <span class="preprocessor">#define MACRO__phi_tilde__A( which_psi)                                         \</span>
00517 <span class="preprocessor">{                                                                               \</span>
00518 <span class="preprocessor">  phi_tilde[t+1] = phi_tilde[t] * MACRO_ ## which_psi;                          \</span>
00519 <span class="preprocessor">}</span>
00520 <span class="preprocessor"></span>
00521 <span class="preprocessor">#define MACRO__phi_tilde__T( which_psi)                                         \</span>
00522 <span class="preprocessor">{                                                                               \</span>
00523 <span class="preprocessor">  if( lg[t] == 0 || lg[t] == ths-&gt;n[t] - 1)                                     \</span>
00524 <span class="preprocessor">  {                                                                             \</span>
00525 <span class="preprocessor">    phi_tilde[t+1] = phi_tilde[t] * MACRO_ ## which_psi;                        \</span>
00526 <span class="preprocessor">  }                                                                             \</span>
00527 <span class="preprocessor">  else                                                                          \</span>
00528 <span class="preprocessor">  {                                                                             \</span>
00529 <span class="preprocessor">    phi_tilde[t+1] = 0.5 * phi_tilde[t] * MACRO_ ## which_psi;            \</span>
00530 <span class="preprocessor">  }                                                                             \</span>
00531 <span class="preprocessor">}</span>
00532 <span class="preprocessor"></span>
00533 
00534 
00535 <span class="preprocessor">#define MACRO_nfct_B( which_one)                                                \</span>
00536 <span class="preprocessor">inline void nfct_B_ ## which_one ( nfct_plan *ths)                              \</span>
00537 <span class="preprocessor">{ </span><span class="comment">/* MACRO_nfct_B */</span>                                                            \
00538   int lb[ths-&gt;d];                         \
00539   int j, t, i;                            \
00540   int lprod, l_L, ix;                     \
00541   int lc[ths-&gt;d];                         \
00542   int lg[ths-&gt;d];                         \
00543   int lg_offset[ths-&gt;d];                  \
00544   int count_lg[ths-&gt;d];                   \
00545   int lg_plain[ths-&gt;d+1];                 \
00546   double *f, *g;                          \
00547   double phi_tilde[ths-&gt;d+1];             \
00548   double *fj;                             \
00549                                                                                 \
00550   f = ths-&gt;f; g = ths-&gt;g;                                                       \
00551                                                                                 \
00552   MACRO_nfct_B_init_result_ ## which_one                                        \
00553                                                                                 \
00554   <span class="comment">/* both flags are set */</span>                                                      \
00555   if(( ths-&gt;nfct_flags &amp; PRE_PSI)&amp;&amp;( ths-&gt;nfct_flags &amp; PRE_FULL_PSI))           \
00556   {                                                                             \
00557     for( ix = 0, j = 0, fj = &amp;f[0]; j &lt; ths-&gt;M_total; j++, fj += 1)             \
00558       for( l_L = 0; l_L &lt; ths-&gt;psi_index_f[j]; l_L++, ix++)                     \
00559       {                                                                         \
00560         MACRO_nfct_B_PRE_FULL_PSI_compute_ ## which_one;                        \
00561       }                                                                         \
00562   }                                                                             \
00563   else                                                                          \
00564   {                                                                             \
00565     phi_tilde[0] = 1;                                                           \
00566     lg_plain[0]  = 0;                                                           \
00567                                                                                 \
00568     for( t = 0, lprod = 1; t &lt; ths-&gt;d; t++)                                     \
00569       lprod *= NFCT_SUMMANDS;                                                   \
00570                                                                                 \
00571                                                                             \
00572     <span class="comment">/* PRE_PSI flag is set */</span>                                                   \
00573                                                                             \
00574     if( ths-&gt;nfct_flags &amp; PRE_PSI)                                              \
00575       for( j = 0, fj = &amp;f[0]; j &lt; ths-&gt;M_total; j++, fj += 1)                   \
00576         {                                                                       \
00577           MACRO_init_lb_lg_lc;                                                  \
00578                                                                                 \
00579           for( l_L = 0; l_L &lt; lprod; l_L++)                                     \
00580           {                                                                     \
00581             MACRO_update_phi_tilde_lg_plain( which_one, with_PRE_PSI);          \
00582                                                                                 \
00583             MACRO_nfct_B_compute_ ## which_one;                                 \
00584                                                                                 \
00585             MACRO_count__lg_lc;                                                 \
00586           } <span class="comment">/* for( l_L) */</span>                                                     \
00587         } <span class="comment">/* for( j) */</span>                                                         \
00588                                                                                 \
00589                                                                             \
00590     <span class="comment">/*  no PSI flag is set */</span>                                                   \
00591                                                                             \
00592     else                                                                        \
00593       for( j = 0, fj = &amp;f[0]; j &lt; ths-&gt;M_total; j++, fj += 1)                   \
00594       {                                                                         \
00595         MACRO_init_lb_lg_lc;                                                    \
00596                                                                                 \
00597         for( l_L = 0; l_L &lt; lprod; l_L++)                                       \
00598         {                                                                       \
00599           MACRO_update_phi_tilde_lg_plain( which_one,compute_PSI);              \
00600                                                                                 \
00601           MACRO_nfct_B_compute_ ## which_one;                                   \
00602                                                                                 \
00603           MACRO_count__lg_lc;                                                   \
00604                                                                                 \
00605         } <span class="comment">/* for(l_L) */</span>                                                        \
00606       } <span class="comment">/* for(j) */</span>                                                            \
00607   } <span class="comment">/* else( PRE_PSI &amp;&amp; FULL_PRE_PSI) */</span>                                        \
00608 } <span class="comment">/* nfct_B */</span>
00609 
00610 MACRO_nfct_B(A)
00611 MACRO_nfct_B(T)
00612 
00613 
00614 
00615 
00617 #define MACRO_nfct_full_psi( which_one)                                         \
00618 <span class="keywordtype">void</span> nfct_full_psi__ ## which_one( <a class="code" href="structnfct__plan.html">nfct_plan</a> *ths)                              \
00619 {                                                                               \
00620   <span class="keywordtype">int</span> t, i;                             \
00621   <span class="keywordtype">int</span> j;                                \
00622   <span class="keywordtype">int</span> l_L;                              \
00623   <span class="keywordtype">int</span> lc[ths-&gt;d];                       \
00624   <span class="keywordtype">int</span> lg_plain[ths-&gt;d+1];               \
00625   <span class="keywordtype">int</span> count_lg[ths-&gt;d];                                                         \
00626   <span class="keywordtype">int</span> lg_offset[ths-&gt;d];                                                        \
00627   <span class="keywordtype">int</span> lg[ths-&gt;d];                                                               \
00628   <span class="keywordtype">int</span> lprod;                            \
00629   <span class="keywordtype">int</span> lb[ths-&gt;d];                       \
00630                                                                                 \
00631   <span class="keywordtype">double</span> phi_tilde[ths-&gt;d+1];                                                   \
00632   <span class="keywordtype">double</span> eps = ths-&gt;nfct_full_psi_eps;                                          \
00633                                                                                 \
00634   <span class="keywordtype">int</span> *index_g, *index_f;                                                       \
00635   <span class="keywordtype">double</span> *new_psi;                                                              \
00636   <span class="keywordtype">int</span> ix, ix_old, size_psi;                                                     \
00637                                                                                 \
00638   phi_tilde[0] = 1.0;                                                           \
00639   lg_plain[0]  =   0;                                                           \
00640                                                                                 \
00641   <span class="keywordflow">if</span>( ths-&gt;nfct_flags &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)                                                \
00642   {                                                                             \
00643     size_psi = ths-&gt;M_total;                                                    \
00644     index_f  =    (<span class="keywordtype">int</span>*) malloc( ths-&gt;M_total  * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span>));                 \
00645     index_g  =    (<span class="keywordtype">int</span>*) malloc( size_psi * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span>));                      \
00646     new_psi  = (<span class="keywordtype">double</span>*) malloc( size_psi * <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>));                   \
00647                                                                                 \
00648     <span class="keywordflow">for</span>( t = 0,lprod = 1; t &lt; ths-&gt;d; t++)                                      \
00649     {                                                                           \
00650       lprod *= NFCT_SUMMANDS;                                                   \
00651       eps *= <a class="code" href="group__nfsct.html#ga12">nfct_phi</a>( ths, 0, t);                                              \
00652     }                                                                           \
00653                                                                                 \
00654     <span class="keywordflow">for</span>( ix = 0, ix_old = 0, j = 0; j &lt; ths-&gt;M_total; j++)                      \
00655     {                                                                           \
00656       MACRO_init_lb_lg_lc;                                                      \
00657                                                                                 \
00658       <span class="keywordflow">for</span>( l_L = 0; l_L &lt; lprod; l_L++)                                         \
00659       {                                                                         \
00660         MACRO_update_phi_tilde_lg_plain( which_one, with_PRE_PSI);              \
00661                                                                                 \
00662         <span class="keywordflow">if</span>( phi_tilde[ths-&gt;d] &gt; eps)                                            \
00663         {                                                           \
00664           index_g[ix] =  lg_plain[ths-&gt;d];                                      \
00665           new_psi[ix] = phi_tilde[ths-&gt;d];                                      \
00666                                                                                 \
00667           ix++;                                                                 \
00668           <span class="keywordflow">if</span>( ix == size_psi)                                                   \
00669           {                                                                     \
00670             size_psi += ths-&gt;M_total;                                           \
00671             index_g   =    (<span class="keywordtype">int</span>*)realloc( index_g,                              \
00672                                           size_psi * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span>));             \
00673             new_psi   = (<span class="keywordtype">double</span>*)realloc( new_psi,                              \
00674                                           size_psi * <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>));          \
00675           }                                                                     \
00676         }                                                                       \
00677                                                                                 \
00678         MACRO_count__lg_lc;                                                     \
00679                                                                                 \
00680       } <span class="comment">/* for(l_L) */</span>                                                          \
00681                                                                                 \
00682       index_f[j] = ix - ix_old;                                                 \
00683       ix_old     = ix;                                                          \
00684                                                                                 \
00685     } <span class="comment">/* for(j) */</span>                                                              \
00686                                                                                 \
00687     free( ths-&gt;psi);                                                            \
00688     size_psi = ix;                                                              \
00689     ths-&gt;size_psi = size_psi;                                                   \
00690                                                                                 \
00691     index_g =    (<span class="keywordtype">int</span>*)realloc( index_g, size_psi * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span>));              \
00692     new_psi = (<span class="keywordtype">double</span>*)realloc( new_psi, size_psi * <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>));           \
00693                                                                                 \
00694     ths-&gt;psi         = new_psi;                                                 \
00695     ths-&gt;psi_index_g = index_g;                                                 \
00696     ths-&gt;psi_index_f = index_f;                                                 \
00697                                                                                 \
00698   } <span class="comment">/* if(PRE_PSI) */</span>                                                           \
00699 }
00700 
00701 MACRO_nfct_full_psi( A)
00702 MACRO_nfct_full_psi( T)
00703 
00704 
00705 
00706 
00707 
<a name="l00711"></a><a class="code" href="group__nfsct.html#ga6">00711</a> <span class="keywordtype">void</span> nfct_trafo( <a class="code" href="structnfct__plan.html">nfct_plan</a> *ths)
00712 {
00717   ths-&gt;g_hat = ths-&gt;g1;
00718   ths-&gt;g     = ths-&gt;g2;
00719 
00720 
00726   TIC(0)
00727   nfct_D_A( ths);
00728   TOC(0)
00729 
00730 
00731   
00737   TIC(1)
00738   fftw_execute( ths-&gt;my_fftw_r2r_plan);
00739   TOC(1)
00740 
00741 
00742   <span class="keywordflow">if</span>( ths-&gt;nfct_flags &amp; <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>)
00743     nfct_full_psi__A( ths);
00744 
00745 
00751   TIC(2)
00752   nfct_B_A( ths);
00753   TOC(2)
00754 
00755   <span class="keywordflow">if</span>(ths-&gt;nfct_flags &amp; <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>) {
00756     free( ths-&gt;psi_index_g);
00757     free( ths-&gt;psi_index_f);
00758   }
00759 
00760 } <span class="comment">/* nfct_trafo */</span>
00761 
00762 
00763 
00764 
<a name="l00765"></a><a class="code" href="group__nfsct.html#ga8">00765</a> <span class="keywordtype">void</span> <a class="code" href="group__nfsct.html#ga8">nfct_adjoint</a>( <a class="code" href="structnfct__plan.html">nfct_plan</a> *ths)
00766 {
00771   ths-&gt;g_hat = ths-&gt;g2;
00772   ths-&gt;g     = ths-&gt;g1;
00773 
00774   <span class="keywordflow">if</span>( ths-&gt;nfct_flags &amp; <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>)
00775     nfct_full_psi__T( ths);
00776 
00782   TIC(2)
00783   nfct_B_T( ths);
00784   TOC(2)
00785 
00786   <span class="keywordflow">if</span>(ths-&gt;nfct_flags &amp; <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>) {
00787     free( ths-&gt;psi_index_g);
00788     free( ths-&gt;psi_index_f);
00789   }
00790 
00797   TIC(1)
00798   fftw_execute( ths-&gt;my_fftw_r2r_plan);
00799   TOC(1)
00800 
00801   
00806   TIC(0)
00807   nfct_D_T( ths);
00808   TOC(0)
00809 
00810 } <span class="comment">/* nfct_adjoint */</span>
00811 
00812 
00813 
00818 <span class="keywordtype">void</span> nfct_precompute_phi_hut( <a class="code" href="structnfct__plan.html">nfct_plan</a> *ths)
00819 {
00820   <span class="keywordtype">int</span> kg[ths-&gt;d];                       
00821   <span class="keywordtype">int</span> t;                                
00823   ths-&gt;c_phi_inv = (<span class="keywordtype">double</span>**)fftw_malloc( ths-&gt;d * <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>*));
00824 
00825   <span class="keywordflow">for</span>( t = 0; t &lt; ths-&gt;d; t++)
00826   {
00827     ths-&gt;c_phi_inv[t] = (<span class="keywordtype">double</span>*)fftw_malloc( ths-&gt;N[t] * <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>));
00828 
00829     <span class="keywordflow">for</span>( kg[t] = 0; kg[t] &lt; ths-&gt;N[t]; kg[t]++)
00830     {
00831       ths-&gt;c_phi_inv[t][kg[t]] = MACRO_compute_PHI_HUT_INV;
00832     }
00833   }
00834 } <span class="comment">/* nfct_phi_hut */</span>
00835 
00836 
00837 
<a name="l00838"></a><a class="code" href="group__nfsct.html#ga5">00838</a> <span class="keywordtype">void</span> <a class="code" href="group__nfsct.html#ga5">nfct_precompute_psi</a>( <a class="code" href="structnfct__plan.html">nfct_plan</a> *ths)
00839 {
00840   <span class="keywordtype">int</span> t;                                
00841   <span class="keywordtype">int</span> j;                                
00842   <span class="keywordtype">int</span> lc[ths-&gt;d];                       
00843   <span class="keywordtype">int</span> lb[ths-&gt;d];                       
00845   <span class="keywordflow">for</span> (t = 0; t &lt; ths-&gt;d; t++)
00846   {
00847     <span class="keywordflow">for</span>(j = 0; j &lt; ths-&gt;M_total; j++)
00848     {
00849 
00850       MACRO_nfct__lower_boundary( j, t);
00851 
00852       <span class="keywordflow">for</span>( lc[t] = 0; lc[t] &lt; NFCT_SUMMANDS; lc[t]++)
00853   ths-&gt;psi[(j * ths-&gt;d + t) * NFCT_SUMMANDS + lc[t]] = MACRO_compute_PSI;
00854 
00855     } <span class="comment">/* for(j) */</span>
00856   } <span class="comment">/* for(t) */</span>
00857 } <span class="comment">/* nfct_precompute_psi */</span>
00858 
00859 
00860 
00861 
00862 
00863 
00864 
00865 <span class="keywordtype">void</span> nfct_init_help( <a class="code" href="structnfct__plan.html">nfct_plan</a> *ths)
00866 {
00867   <span class="keywordtype">int</span> t;                                
00869   ths-&gt;N_total = <a class="code" href="group__nfftutil.html#ga11">nfct_prod_int</a>( ths-&gt;N, ths-&gt;d);
00870 
00871   ths-&gt;sigma   = (<span class="keywordtype">double</span>*)fftw_malloc( ths-&gt;d * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00872   
00873   <span class="keywordflow">for</span>( t = 0; t &lt; ths-&gt;d; t++)
00874     ths-&gt;sigma[t] = ((double)( ths-&gt;n[t] - 1)) / ths-&gt;N[t];
00875 
00879   ths-&gt;r2r_kind = (fftw_r2r_kind*)fftw_malloc ( ths-&gt;d * sizeof (fftw_r2r_kind));
00880   <span class="keywordflow">for</span> (t = 0; t &lt; ths-&gt;d; t++)
00881     ths-&gt;r2r_kind[t] = FFTW_REDFT00;
00882 
00883 
00884   NFCT_WINDOW_HELP_INIT;
00885 
00886   if(ths-&gt;nfct_flags &amp; MALLOC_X)
00887     ths-&gt;x = (<span class="keywordtype">double</span>*)fftw_malloc( ths-&gt;d * ths-&gt;M_total * sizeof( <span class="keywordtype">double</span>));
00888 
00889   if(ths-&gt;nfct_flags &amp; MALLOC_F_HAT)
00890     ths-&gt;f_hat = (<span class="keywordtype">double</span>*)fftw_malloc( ths-&gt;N_total * sizeof( <span class="keywordtype">double</span>));
00891 
00892   if(ths-&gt;nfct_flags &amp; MALLOC_F)
00893     ths-&gt;f = (<span class="keywordtype">double</span>*)fftw_malloc( ths-&gt;M_total * sizeof( <span class="keywordtype">double</span>));
00894 
00895   if(ths-&gt;nfct_flags &amp; PRE_PHI_HUT)
00896     nfct_precompute_phi_hut(ths);
00897 
00898   <span class="comment">/* NO FFTW_MALLOC HERE */</span>
00899   if(ths-&gt;nfct_flags &amp; PRE_PSI)
00900   {
00901     ths-&gt;psi =
00902       (<span class="keywordtype">double</span>*) malloc(ths-&gt;M_total * ths-&gt;d * NFCT_SUMMANDS * <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>));
00903 
00907     ths-&gt;nfct_full_psi_eps = pow(10, -10);
00908   }
00909   
00910   <span class="keywordflow">if</span>(ths-&gt;nfct_flags &amp; <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a>)
00911   {
00912     ths-&gt;g1 =
00913       (<span class="keywordtype">double</span>*)fftw_malloc( <a class="code" href="group__nfftutil.html#ga11">nfct_prod_int</a>(ths-&gt;n, ths-&gt;d) * <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>));
00914 
00915     <span class="keywordflow">if</span>(ths-&gt;nfct_flags &amp; <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>)
00916       ths-&gt;g2 =
00917   (<span class="keywordtype">double</span>*) fftw_malloc( <a class="code" href="group__nfftutil.html#ga11">nfct_prod_int</a>(ths-&gt;n, ths-&gt;d) * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00918     <span class="keywordflow">else</span>
00919       ths-&gt;g2 = ths-&gt;g1;
00920     
00921     ths-&gt;my_fftw_r2r_plan = 
00922       fftw_plan_r2r( ths-&gt;d, ths-&gt;n, ths-&gt;g1, ths-&gt;g2, 
00923          ths-&gt;r2r_kind, ths-&gt;fftw_flags);
00924   }
00925 }
00926 
00927 
00928 
00929 
00930 
<a name="l00931"></a><a class="code" href="group__nfsct.html#ga3">00931</a> <span class="keywordtype">void</span> <a class="code" href="group__nfsct.html#ga3">nfct_init</a>( <a class="code" href="structnfct__plan.html">nfct_plan</a> *ths, <span class="keywordtype">int</span> d, <span class="keywordtype">int</span> *N, <span class="keywordtype">int</span> M_total)
00932 {
00933   <span class="keywordtype">int</span> t;
00934 
00935   ths-&gt;d       = d;
00936   ths-&gt;M_total = M_total;
00937 
00938   ths-&gt;N = (<span class="keywordtype">int</span>*) fftw_malloc( ths-&gt;d * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span>));
00939 
00940   <span class="keywordflow">for</span>(t = 0;t &lt; d; t++)
00941     ths-&gt;N[t] = N[t];
00942 
00943   ths-&gt;n = (<span class="keywordtype">int</span>*) fftw_malloc( ths-&gt;d * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span>));
00944 
00945   <span class="keywordflow">for</span>( t = 0; t &lt; d; t++)
00946     ths-&gt;n[t] = <a class="code" href="group__nfsct.html#ga13">nfct_fftw_2N</a>( <a class="code" href="group__nfftutil.html#ga4">nfft_next_power_of_2</a>( ths-&gt;N[t]));
00947 
00948   WINDOW_HELP_ESTIMATE_m;
00949 
00950   ths-&gt;nfct_flags = NFCT_DEFAULT_FLAGS;
00951   ths-&gt;fftw_flags = FFTW_DEFAULT_FLAGS;
00952 
00953   nfct_init_help( ths);    
00954 }
00955 
00956 
00957 <span class="keywordtype">void</span> nfct_init_m( <a class="code" href="structnfct__plan.html">nfct_plan</a> *ths, <span class="keywordtype">int</span> d, <span class="keywordtype">int</span> *N, <span class="keywordtype">int</span> M_total, <span class="keywordtype">int</span> m)
00958 {
00959   <span class="keywordtype">int</span> t, n[d]; 
00960  
00961   <span class="keywordflow">for</span>( t = 0; t &lt; d; t++)  
00962     n[t] = <a class="code" href="group__nfsct.html#ga13">nfct_fftw_2N</a>( <a class="code" href="group__nfftutil.html#ga4">nfft_next_power_of_2</a>( N[t]));  
00963  
00964   <a class="code" href="group__nfsct.html#ga4">nfct_init_guru</a>( ths, d, N, M_total, n, m, NFCT_DEFAULT_FLAGS, FFTW_DEFAULT_FLAGS); 
00965 } 
00966 
00967 
<a name="l00968"></a><a class="code" href="group__nfsct.html#ga4">00968</a> <span class="keywordtype">void</span> <a class="code" href="group__nfsct.html#ga4">nfct_init_guru</a>( <a class="code" href="structnfct__plan.html">nfct_plan</a> *ths, <span class="keywordtype">int</span> d, <span class="keywordtype">int</span> *N,
00969          <span class="keywordtype">int</span> M_total, <span class="keywordtype">int</span> *n, <span class="keywordtype">int</span> m,
00970          <span class="keywordtype">unsigned</span> nfct_flags, <span class="keywordtype">unsigned</span> fftw_flags)
00971 {
00972   <span class="keywordtype">int</span> t;             
00974   ths-&gt;d = d;
00975   ths-&gt;M_total = M_total;
00976 
00977   ths-&gt;N = (<span class="keywordtype">int</span>*)fftw_malloc( ths-&gt;d * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span>));
00978 
00979   <span class="keywordflow">for</span>( t = 0; t &lt; d; t++)
00980     ths-&gt;N[t] = N[t];
00981 
00982   ths-&gt;n = (<span class="keywordtype">int</span>*)fftw_malloc( ths-&gt;d * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span>));
00983 
00984   <span class="keywordflow">for</span>( t = 0; t &lt; d; t++)
00985     ths-&gt;n[t] = n[t];
00986 
00987   ths-&gt;m = m;
00988 
00989   ths-&gt;nfct_flags = nfct_flags;
00990   ths-&gt;fftw_flags = fftw_flags;
00991 
00992   nfct_init_help( ths);  
00993 }
00994 
00995 
<a name="l00996"></a><a class="code" href="group__nfsct.html#ga0">00996</a> <span class="keywordtype">void</span> <a class="code" href="group__nfsct.html#ga0">nfct_init_1d</a>( <a class="code" href="structnfct__plan.html">nfct_plan</a> *ths, <span class="keywordtype">int</span> N0, <span class="keywordtype">int</span> M_total)
00997 {
00998   <span class="keywordtype">int</span> N[1];
00999 
01000   N[0] = N0;
01001   <a class="code" href="group__nfsct.html#ga3">nfct_init</a>( ths, 1, N, M_total);
01002 }
01003 
<a name="l01004"></a><a class="code" href="group__nfsct.html#ga1">01004</a> <span class="keywordtype">void</span> <a class="code" href="group__nfsct.html#ga1">nfct_init_2d</a>( <a class="code" href="structnfct__plan.html">nfct_plan</a> *ths, <span class="keywordtype">int</span> N0, <span class="keywordtype">int</span> N1, <span class="keywordtype">int</span> M_total)
01005 {
01006   <span class="keywordtype">int</span> N[2];
01007 
01008   N[0] = N0;
01009   N[1] = N1;
01010   <a class="code" href="group__nfsct.html#ga3">nfct_init</a>( ths, 2, N, M_total);
01011 }
01012 
<a name="l01013"></a><a class="code" href="group__nfsct.html#ga2">01013</a> <span class="keywordtype">void</span> <a class="code" href="group__nfsct.html#ga2">nfct_init_3d</a>( <a class="code" href="structnfct__plan.html">nfct_plan</a> *ths, <span class="keywordtype">int</span> N0, <span class="keywordtype">int</span> N1, <span class="keywordtype">int</span> N2, <span class="keywordtype">int</span> M_total)
01014 {
01015   <span class="keywordtype">int</span> N[3];
01016 
01017   N[0] = N0;
01018   N[1] = N1;
01019   N[2] = N2;
01020   <a class="code" href="group__nfsct.html#ga3">nfct_init</a>( ths, 3, N, M_total);
01021 }
01022 
01023 
<a name="l01027"></a><a class="code" href="group__nfsct.html#ga10">01027</a> <span class="keywordtype">void</span> <a class="code" href="group__nfsct.html#ga10">nfct_finalize</a>( <a class="code" href="structnfct__plan.html">nfct_plan</a> *ths)
01028 {
01032   <span class="keywordtype">int</span> t;
01033 
01034   <span class="keywordflow">if</span>( ths-&gt;nfct_flags &amp; <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a>)
01035   {
01036     fftw_destroy_plan( ths-&gt;my_fftw_r2r_plan);
01037      
01038     <span class="keywordflow">if</span>(ths-&gt;nfct_flags &amp; <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>)
01039       fftw_free( ths-&gt;g2);
01040       
01041     fftw_free( ths-&gt;g1);
01042   }
01043 
01044   <span class="comment">/* NO FFTW_FREE HERE */</span>
01045   <span class="keywordflow">if</span>( ths-&gt;nfct_flags &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
01046   {
01047     free( ths-&gt;psi);
01048   }
01049 
01050   <span class="keywordflow">if</span>(ths-&gt;nfct_flags &amp; <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>)
01051   {
01052     <span class="keywordflow">for</span>( t = 0; t &lt; ths-&gt;d; t++)
01053       fftw_free( ths-&gt;c_phi_inv[t]);
01054     fftw_free( ths-&gt;c_phi_inv);
01055   }
01056 
01057   <span class="keywordflow">if</span>( ths-&gt;nfct_flags &amp; <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>)
01058     fftw_free( ths-&gt;f);
01059 
01060   <span class="keywordflow">if</span>( ths-&gt;nfct_flags &amp; <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>)
01061     fftw_free( ths-&gt;f_hat);
01062 
01063   <span class="keywordflow">if</span>( ths-&gt;nfct_flags &amp; <a class="code" href="group__nfft.html#ga22">MALLOC_X</a>)
01064   fftw_free( ths-&gt;x);
01065  
01066   WINDOW_HELP_FINALIZE;
01067  
01068   fftw_free( ths-&gt;N);
01069   fftw_free( ths-&gt;n);
01070   fftw_free( ths-&gt;sigma);
01071 
01072 } <span class="comment">/* nfct_finalize */</span>
01073 
</pre></div>    <hr size="1"/>
    Generated on 5 Feb 2007 by Doxygen 1.4.1
  </body>
</html>
