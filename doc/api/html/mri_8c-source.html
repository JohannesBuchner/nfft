<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.2 API Reference - NFFT: mri.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.2 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000003.html">kernel</a>&nbsp;/&nbsp;<a class="el" href="dir_000023.html">mri</a></div>
<h1>mri.c</h1><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#include "string.h"</span>
00002 
00003 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00004 <span class="preprocessor">#include "options.h"</span>
00005 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00006 <span class="preprocessor">#include "window_defines.h"</span>
00007 <span class="preprocessor">#include "math.h"</span>
00008 
<a name="l00014"></a><a class="code" href="structwindow__funct__plan__.html">00014</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structwindow__funct__plan__.html">window_funct_plan_</a> {
00015   <span class="keywordtype">int</span> d;
00016   <span class="keywordtype">int</span> m;
00017   <span class="keywordtype">int</span> n[1];
00018   <span class="keywordtype">double</span> sigma[1];
00019   <span class="keywordtype">double</span> *b;
<a name="l00020"></a><a class="code" href="structwindow__funct__plan__.html#o5">00020</a>   <span class="keywordtype">double</span> *<a class="code" href="structwindow__funct__plan__.html#o5">spline_coeffs</a>;                
00022 } <a class="code" href="structwindow__funct__plan__.html">window_funct_plan</a>;
00023 
00024 
00028 <span class="keywordtype">void</span> window_funct_init(<a class="code" href="structwindow__funct__plan__.html">window_funct_plan</a>* ths, <span class="keywordtype">int</span> m, <span class="keywordtype">int</span> n, <span class="keywordtype">double</span> sigma) {
00029   ths-&gt;d=1;
00030   ths-&gt;m=m;
00031   ths-&gt;n[0]=n;
00032   ths-&gt;sigma[0]=sigma;
00033   WINDOW_HELP_INIT
00034 }
00035 
00036 <span class="comment">/*</span>
00037 <span class="comment"> * mri_inh_2d1d</span>
00038 <span class="comment"> */</span>
00039                                                                        
<a name="l00040"></a><a class="code" href="group__mri.html#ga0">00040</a> <span class="keywordtype">void</span> <a class="code" href="group__mri.html#ga0">mri_inh_2d1d_trafo</a>(<a class="code" href="structmri__inh__2d1d__plan.html">mri_inh_2d1d_plan</a> *that) {
00041   <span class="keywordtype">int</span> l,j;
00042   complex <span class="keywordtype">double</span> *f = (complex <span class="keywordtype">double</span>*) fftw_malloc(that-&gt;M_total*<span class="keyword">sizeof</span>(complex <span class="keywordtype">double</span>));
00043   complex <span class="keywordtype">double</span> *f_hat = (complex <span class="keywordtype">double</span>*) fftw_malloc(that-&gt;N_total*<span class="keyword">sizeof</span>(complex <span class="keywordtype">double</span>));
00044 
00045   <a class="code" href="structwindow__funct__plan__.html">window_funct_plan</a> *ths = (<a class="code" href="structwindow__funct__plan__.html">window_funct_plan</a>*) fftw_malloc(<span class="keyword">sizeof</span>(<a class="code" href="structwindow__funct__plan__.html">window_funct_plan</a>));
00046   window_funct_init(ths,that-&gt;plan.<a class="code" href="structwindow__funct__plan__.html#o1">m</a>,that-&gt;N3,that-&gt;sigma3);
00047   
00048   <span class="comment">/* the pointers that-&gt;f and that-&gt;f_hat have been modified by the solver */</span>
00049   that-&gt;plan.f = that-&gt;f;
00050   that-&gt;plan.f_hat = that-&gt;f_hat;
00051 
00052   
00053   memset(f,0,that-&gt;M_total*<span class="keyword">sizeof</span>(complex <span class="keywordtype">double</span>));
00054   <span class="keywordflow">for</span>(j=0;j&lt;that-&gt;N_total;j++)
00055   {
00056     f_hat[j]=that-&gt;f_hat[j];
00057   }
00058 
00059   <span class="keywordflow">for</span>(l=-ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]/2;l&lt;=ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]/2;l++) {
00060     <span class="keywordflow">for</span>(j=0;j&lt;that-&gt;N_total;j++)
00061       that-&gt;f_hat[j]*=cexp(-2*<a class="code" href="group__nfftutil.html#ga57">PI</a>*I*that-&gt;w[j]*((<span class="keywordtype">double</span>)l))/PHI_HUT(ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]*that-&gt;w[j],0);
00062     <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;that-&gt;plan);
00063     <span class="keywordflow">for</span>(j=0;j&lt;that-&gt;M_total;j++){
00064       <span class="comment">/* PHI has compact support */</span>
00065       <span class="keywordflow">if</span>(fabs(that-&gt;t[j]-((<span class="keywordtype">double</span>)l)/((<span class="keywordtype">double</span>)ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]))&lt;that-&gt;plan.m/((double)ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0])) 
00066         f[j]+=that-&gt;f[j]*PHI(that-&gt;t[j]-((<span class="keywordtype">double</span>)l)/((<span class="keywordtype">double</span>)ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]),0);
00067     }
00068     <span class="keywordflow">for</span>(j=0;j&lt;that-&gt;N_total;j++)
00069       that-&gt;f_hat[j]=f_hat[j];
00070   }
00071 
00072   fftw_free(that-&gt;plan.f);
00073   that-&gt;f=f;
00074   that-&gt;plan.f = that-&gt;f;
00075   
00076   fftw_free(f_hat);
00077   
00078   WINDOW_HELP_FINALIZE
00079   fftw_free(ths);
00080 }
00081 
<a name="l00082"></a><a class="code" href="group__mri.html#ga1">00082</a> <span class="keywordtype">void</span> <a class="code" href="group__mri.html#ga1">mri_inh_2d1d_adjoint</a>(<a class="code" href="structmri__inh__2d1d__plan.html">mri_inh_2d1d_plan</a> *that) {
00083   <span class="keywordtype">int</span> l,j;
00084   complex <span class="keywordtype">double</span> *f = (complex <span class="keywordtype">double</span>*) fftw_malloc(that-&gt;M_total*<span class="keyword">sizeof</span>(complex <span class="keywordtype">double</span>));
00085   complex <span class="keywordtype">double</span> *f_hat = (complex <span class="keywordtype">double</span>*) fftw_malloc(that-&gt;N_total*<span class="keyword">sizeof</span>(complex <span class="keywordtype">double</span>));
00086 
00087   <a class="code" href="structwindow__funct__plan__.html">window_funct_plan</a> *ths = (<a class="code" href="structwindow__funct__plan__.html">window_funct_plan</a>*) fftw_malloc(<span class="keyword">sizeof</span>(<a class="code" href="structwindow__funct__plan__.html">window_funct_plan</a>));
00088   window_funct_init(ths,that-&gt;plan.<a class="code" href="structwindow__funct__plan__.html#o1">m</a>,that-&gt;N3,that-&gt;sigma3);
00089   
00090   memset(f_hat,0,that-&gt;N_total*<span class="keyword">sizeof</span>(complex <span class="keywordtype">double</span>));
00091   
00092   <span class="comment">/* the pointers that-&gt;f and that-&gt;f_hat have been modified by the solver */</span>
00093   that-&gt;plan.f = that-&gt;f;
00094   that-&gt;plan.f_hat = that-&gt;f_hat;
00095   
00096   <span class="keywordflow">for</span>(j=0;j&lt;that-&gt;M_total;j++)
00097   {
00098     f[j]=that-&gt;f[j];
00099   }
00100 
00101 
00102   
00103   <span class="keywordflow">for</span>(l=-ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]/2;l&lt;=ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]/2;l++) {
00104     
00105     <span class="keywordflow">for</span>(j=0;j&lt;that-&gt;M_total;j++) {
00106       <span class="comment">/* PHI has compact support */</span>
00107       <span class="keywordflow">if</span>(fabs(that-&gt;t[j]-((<span class="keywordtype">double</span>)l)/((<span class="keywordtype">double</span>)ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]))&lt;that-&gt;plan.m/((double)ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0])) 
00108         that-&gt;f[j]*=PHI(that-&gt;t[j]-((<span class="keywordtype">double</span>)l)/((<span class="keywordtype">double</span>)ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]),0);
00109       <span class="keywordflow">else</span>
00110         that-&gt;f[j]=0.0;
00111     }
00112     <a class="code" href="group__nfft.html#ga3">nfft_adjoint</a>(&amp;that-&gt;plan);
00113     <span class="keywordflow">for</span>(j=0;j&lt;that-&gt;N_total;j++)
00114       f_hat[j]+=that-&gt;f_hat[j]*cexp(2*<a class="code" href="group__nfftutil.html#ga57">PI</a>*I*that-&gt;w[j]*((<span class="keywordtype">double</span>)l));
00115     <span class="keywordflow">for</span>(j=0;j&lt;that-&gt;M_total;j++)
00116       that-&gt;f[j]=f[j];
00117   }
00118 
00119   <span class="keywordflow">for</span>(j=0;j&lt;that-&gt;N_total;j++)
00120   {
00121     f_hat[j] /= PHI_HUT(ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]*that-&gt;w[j],0);
00122   }
00123 
00124   fftw_free(that-&gt;plan.f_hat);
00125   that-&gt;f_hat=f_hat;
00126   that-&gt;plan.f_hat = that-&gt;f_hat;
00127   
00128   fftw_free(f);
00129   
00130   WINDOW_HELP_FINALIZE
00131   fftw_free(ths);
00132 }
00133 
<a name="l00134"></a><a class="code" href="group__mri.html#ga2">00134</a> <span class="keywordtype">void</span> <a class="code" href="group__mri.html#ga2">mri_inh_2d1d_init_guru</a>(<a class="code" href="structmri__inh__2d1d__plan.html">mri_inh_2d1d_plan</a> *ths, <span class="keywordtype">int</span> *N, <span class="keywordtype">int</span> M, <span class="keywordtype">int</span> *n,
00135                     <span class="keywordtype">int</span> m, <span class="keywordtype">double</span> sigma, <span class="keywordtype">unsigned</span> nfft_flags, <span class="keywordtype">unsigned</span> fftw_flags) {
00136 
00137   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;ths-&gt;plan,2,N,M,n,m,nfft_flags,fftw_flags);
00138   ths-&gt;N3=N[2];
00139   ths-&gt;sigma3=sigma;
00140   ths-&gt;N_total = ths-&gt;plan.N_total;
00141   ths-&gt;M_total = ths-&gt;plan.M_total;
00142   ths-&gt;f = ths-&gt;plan.f;
00143   ths-&gt;f_hat = ths-&gt;plan.f_hat;
00144   
00145   ths-&gt;t = (<span class="keywordtype">double</span>*) fftw_malloc(ths-&gt;M_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00146   ths-&gt;w = (<span class="keywordtype">double</span>*) fftw_malloc(ths-&gt;N_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00147 }
00148 
<a name="l00149"></a><a class="code" href="group__mri.html#ga3">00149</a> <span class="keywordtype">void</span> <a class="code" href="group__mri.html#ga3">mri_inh_2d1d_finalize</a>(<a class="code" href="structmri__inh__2d1d__plan.html">mri_inh_2d1d_plan</a> *ths) {
00150   fftw_free(ths-&gt;t);
00151   fftw_free(ths-&gt;w);
00152   
00153   <span class="comment">/* the pointers ths-&gt;f and ths-&gt;f_hat have been modified by the solver */</span>
00154   ths-&gt;plan.f = ths-&gt;f;
00155   ths-&gt;plan.f_hat = ths-&gt;f_hat;
00156   
00157   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;ths-&gt;plan);
00158 }
00159 
00160 <span class="comment">/*</span>
00161 <span class="comment"> * mri_inh_3d</span>
00162 <span class="comment"> */</span>
00163 
<a name="l00164"></a><a class="code" href="group__mri.html#ga4">00164</a> <span class="keywordtype">void</span> <a class="code" href="group__mri.html#ga4">mri_inh_3d_trafo</a>(<a class="code" href="structmri__inh__3d__plan.html">mri_inh_3d_plan</a> *that) {
00165   <span class="keywordtype">int</span> l,j;
00166   <a class="code" href="structwindow__funct__plan__.html">window_funct_plan</a> *ths = (<a class="code" href="structwindow__funct__plan__.html">window_funct_plan</a>*) fftw_malloc(<span class="keyword">sizeof</span>(<a class="code" href="structwindow__funct__plan__.html">window_funct_plan</a>));
00167   window_funct_init(ths,that-&gt;plan.<a class="code" href="structwindow__funct__plan__.html#o1">m</a>,that-&gt;N3,that-&gt;sigma3);
00168 
00169   <span class="comment">/* the pointers that-&gt;f has been modified by the solver */</span>
00170   that-&gt;plan.f =that-&gt;f ;
00171   
00172 
00173 
00174   <span class="keywordflow">for</span>(j=0;j&lt;that-&gt;N_total;j++) {
00175     <span class="keywordflow">for</span>(l=-ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]/2;l&lt;ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]/2;l++)
00176     {
00177       <span class="comment">/* PHI has compact support */</span>
00178       <span class="keywordflow">if</span>(fabs(that-&gt;w[j]-((<span class="keywordtype">double</span>)l)/((<span class="keywordtype">double</span>)ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]))&lt;ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o1">m</a>/((double)ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0])) 
00179         that-&gt;plan.f_hat[j*ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]+(l+ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]/2)]= that-&gt;f_hat[j]*PHI(that-&gt;w[j]-((<span class="keywordtype">double</span>)l)/((<span class="keywordtype">double</span>)ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]),0);
00180       <span class="keywordflow">else</span>
00181         that-&gt;plan.f_hat[j*ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]+(l+ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]/2)]=0.0;
00182     }
00183   }
00184   
00185   <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;that-&gt;plan);
00186   
00187   <span class="keywordflow">for</span>(j=0;j&lt;that-&gt;M_total;j++)
00188   {
00189     that-&gt;f[j] /= PHI_HUT(ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]*that-&gt;plan.x[3*j+2],0);
00190   }
00191 
00192   WINDOW_HELP_FINALIZE
00193   fftw_free(ths);
00194 }
00195 
<a name="l00196"></a><a class="code" href="group__mri.html#ga5">00196</a> <span class="keywordtype">void</span> <a class="code" href="group__mri.html#ga5">mri_inh_3d_adjoint</a>(<a class="code" href="structmri__inh__3d__plan.html">mri_inh_3d_plan</a> *that) {
00197   <span class="keywordtype">int</span> l,j;
00198   <a class="code" href="structwindow__funct__plan__.html">window_funct_plan</a> *ths = (<a class="code" href="structwindow__funct__plan__.html">window_funct_plan</a>*) fftw_malloc(<span class="keyword">sizeof</span>(<a class="code" href="structwindow__funct__plan__.html">window_funct_plan</a>));
00199   window_funct_init(ths,that-&gt;plan.<a class="code" href="structwindow__funct__plan__.html#o1">m</a>,that-&gt;N3,that-&gt;sigma3);
00200 
00201   <span class="comment">/* the pointers that-&gt;f has been modified by the solver */</span>
00202   that-&gt;plan.f =that-&gt;f ;
00203   
00204   <span class="keywordflow">for</span>(j=0;j&lt;that-&gt;M_total;j++)
00205   {
00206     that-&gt;f[j] /= PHI_HUT(ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]*that-&gt;plan.x[3*j+2],0);
00207   }
00208   
00209   <a class="code" href="group__nfft.html#ga3">nfft_adjoint</a>(&amp;that-&gt;plan);
00210 
00211   <span class="keywordflow">for</span>(j=0;j&lt;that-&gt;N_total;j++) {
00212     that-&gt;f_hat[j]=0.0;
00213     <span class="keywordflow">for</span>(l=-ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]/2;l&lt;ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]/2;l++)
00214     {
00215       <span class="comment">/* PHI has compact support */</span>
00216       <span class="keywordflow">if</span>(fabs(that-&gt;w[j]-((<span class="keywordtype">double</span>)l)/((<span class="keywordtype">double</span>)ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]))&lt;ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o1">m</a>/((double)ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0])) 
00217         that-&gt;f_hat[j]+= that-&gt;plan.f_hat[j*ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]+(l+ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]/2)]*PHI(that-&gt;w[j]-((<span class="keywordtype">double</span>)l)/((<span class="keywordtype">double</span>)ths-&gt;<a class="code" href="structwindow__funct__plan__.html#o2">n</a>[0]),0);
00218     }
00219   }
00220 
00221   
00222   WINDOW_HELP_FINALIZE
00223   fftw_free(ths);
00224 }
00225 
00226 <span class="keywordtype">void</span> mri_inh_3d_init_guru(<a class="code" href="structmri__inh__3d__plan.html">mri_inh_3d_plan</a> *ths, <span class="keywordtype">int</span> *N, <span class="keywordtype">int</span> M, <span class="keywordtype">int</span> *n,
00227                     <span class="keywordtype">int</span> m, <span class="keywordtype">double</span> sigma, <span class="keywordtype">unsigned</span> nfft_flags, <span class="keywordtype">unsigned</span> fftw_flags) {
00228   ths-&gt;N3=N[2];
00229   ths-&gt;sigma3=sigma;
00230   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;ths-&gt;plan,3,N,M,n,m,nfft_flags,fftw_flags);
00231   ths-&gt;N_total = N[0]*N[1];
00232   ths-&gt;M_total = ths-&gt;plan.M_total;
00233   ths-&gt;f = ths-&gt;plan.f;
00234   ths-&gt;f_hat = (complex <span class="keywordtype">double</span>*) fftw_malloc(ths-&gt;N_total*<span class="keyword">sizeof</span>(complex <span class="keywordtype">double</span>));
00235   ths-&gt;w = (<span class="keywordtype">double</span>*) fftw_malloc(ths-&gt;N_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00236 }
00237 
<a name="l00238"></a><a class="code" href="group__mri.html#ga7">00238</a> <span class="keywordtype">void</span> <a class="code" href="group__mri.html#ga7">mri_inh_3d_finalize</a>(<a class="code" href="structmri__inh__3d__plan.html">mri_inh_3d_plan</a> *ths) {
00239   fftw_free(ths-&gt;w);
00240   fftw_free(ths-&gt;f_hat);
00241   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;ths-&gt;plan);
00242 }
</pre></div>    <hr size="1"/>
    Generated on 22 Jan 2007 by Doxygen 1.4.1
  </body>
</html>
