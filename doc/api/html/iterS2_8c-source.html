<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.2 API Reference - NFFT: iterS2.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.2 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000006.html">applications</a>&nbsp;/&nbsp;<a class="el" href="dir_000012.html">iterS2</a></div>
<h1>iterS2.c</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">/* $Id$</span>
00002 <span class="comment"> *</span>
00003 <span class="comment"> * iterS2 - Iterative reconstruction on the sphere S2</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * Copyright (C) 2006 Jens Keiner</span>
00006 <span class="comment"> */</span>
00007 
00014 <span class="comment">/* Include standard C headers. */</span>
00015 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00016 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00017 <span class="preprocessor">#include &lt;math.h&gt;</span>
00018 
00019 <span class="comment">/* Include NFFT3 library header. */</span>
00020 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00021 
00022 <span class="comment">/* Include NFFT 3 utilities headers. */</span>
00023 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00024 
00025 <span class="preprocessor">#include "legendre.h"</span>
00026 
<a name="l00028"></a><a class="code" href="group__applications__iterS2__matlab.html#ga1">00028</a> <span class="keyword">enum</span> <span class="keywordtype">boolean</span> {NO = 0, YES = 1};
00029 
<a name="l00040"></a><a class="code" href="group__applications__iterS2__matlab.html#ga0">00040</a> <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
00041 {
00042   <span class="keywordtype">int</span> T;
00043   <span class="keywordtype">int</span> N;
00044   <span class="keywordtype">int</span> M;
00045   <span class="keywordtype">int</span> M2;
00046 
00047   <span class="keywordtype">int</span> t;                       <span class="comment">/* Index variable for testcases                */</span>
00048   <span class="keywordtype">double</span> time;                 <span class="comment">/* Time for fast algorithm in seconds          */</span>
00049   <span class="keywordtype">double</span> err_f;                <span class="comment">/* Error E_infty for fast algorithm            */</span>
00050   <a class="code" href="structnfsft__plan.html">nfsft_plan</a> plan;             <span class="comment">/* NFSFT plan                                  */</span>
00051   <a class="code" href="structnfsft__plan.html">nfsft_plan</a> plan2;            <span class="comment">/* NFSFT plan                                  */</span>
00052   <a class="code" href="structinfsft__plan.html">infsft_plan</a> iplan;           <span class="comment">/* NFSFT plan                                  */</span>
00053   <span class="keywordtype">int</span> j;                       <span class="comment">/*                                             */</span>
00054   <span class="keywordtype">int</span> k;                       <span class="comment">/*                                             */</span>
00055   <span class="keywordtype">int</span> m;                       <span class="comment">/*                                             */</span>
00056   <span class="keywordtype">int</span> n;                       <span class="comment">/*                                             */</span>
00057   <span class="keywordtype">int</span> use_nfsft;               <span class="comment">/*                                             */</span>
00058   <span class="keywordtype">int</span> use_nfft;                <span class="comment">/*                                             */</span>
00059   <span class="keywordtype">int</span> use_fpt;                 <span class="comment">/*                                             */</span>
00060   <span class="keywordtype">int</span> cutoff;                  
00061   <span class="keywordtype">double</span> threshold;            
00062   <span class="keywordtype">double</span> re;
00063   <span class="keywordtype">double</span> im;
00064   <span class="keywordtype">double</span> a,b;
00065   <span class="keywordtype">double</span> *scratch;
00066   <span class="keywordtype">double</span> xs;
00067   <span class="keywordtype">double</span> *ys;
00068   <span class="keywordtype">double</span> *temp;
00069   <span class="keywordtype">double</span> complex *temp2;
00070   <span class="keywordtype">int</span> qlength;
00071   <span class="keywordtype">double</span> *qweights;
00072   fftw_plan fplan;
00073   <a class="code" href="structfpt__set__s__.html">fpt_set</a> set;
00074   <span class="keywordtype">int</span> npt;
00075   <span class="keywordtype">int</span> npt_exp;
00076   <span class="keywordtype">double</span> *alpha, *beta, *gamma;
00077 
00078   <span class="comment">/* Read the number of testcases. */</span>
00079   fscanf(stdin,<span class="stringliteral">"testcases=%d\n"</span>,&amp;T);
00080   fprintf(stderr,<span class="stringliteral">"%d\n"</span>,T);
00081 
00082   <span class="comment">/* Process each testcase. */</span>
00083   <span class="keywordflow">for</span> (t = 0; t &lt; T; t++)
00084   {
00085     <span class="comment">/* Check if the fast transform shall be used. */</span>
00086     fscanf(stdin,<span class="stringliteral">"nfsft=%d\n"</span>,&amp;use_nfsft);
00087     fprintf(stderr,<span class="stringliteral">"%d\n"</span>,use_nfsft);
00088     <span class="keywordflow">if</span> (use_nfsft != NO)
00089     {
00090       <span class="comment">/* Check if the NFFT shall be used. */</span>
00091       fscanf(stdin,<span class="stringliteral">"nfft=%d\n"</span>,&amp;use_nfft);
00092       fprintf(stderr,<span class="stringliteral">"%d\n"</span>,use_nfsft);
00093       <span class="keywordflow">if</span> (use_nfft != NO)
00094       {
00095         <span class="comment">/* Read the cut-off parameter. */</span>
00096         fscanf(stdin,<span class="stringliteral">"cutoff=%d\n"</span>,&amp;cutoff);
00097         fprintf(stderr,<span class="stringliteral">"%d\n"</span>,cutoff);
00098       }
00099       <span class="keywordflow">else</span>
00100       {
00101         <span class="comment">/* TODO remove this */</span>
00102         <span class="comment">/* Initialize unused variable with dummy value. */</span>
00103         cutoff = 1;
00104       }
00105       <span class="comment">/* Check if the fast polynomial transform shall be used. */</span>
00106       fscanf(stdin,<span class="stringliteral">"fpt=%d\n"</span>,&amp;use_fpt);
00107       fprintf(stderr,<span class="stringliteral">"%d\n"</span>,use_fpt);
00108       <span class="keywordflow">if</span> (use_fpt != NO)
00109       {
00110         <span class="comment">/* Read the NFSFT threshold parameter. */</span>
00111         fscanf(stdin,<span class="stringliteral">"threshold=%lf\n"</span>,&amp;threshold);
00112         fprintf(stderr,<span class="stringliteral">"%lf\n"</span>,threshold);
00113       }
00114       <span class="keywordflow">else</span>
00115       {
00116         <span class="comment">/* TODO remove this */</span>
00117         <span class="comment">/* Initialize unused variable with dummy value. */</span>
00118         threshold = 1000.0;
00119       }
00120     }
00121     <span class="keywordflow">else</span>
00122     {
00123       <span class="comment">/* TODO remove this */</span>
00124       <span class="comment">/* Set dummy values. */</span>
00125       use_nfft = NO;
00126       use_fpt = NO;
00127       cutoff = 3;
00128       threshold = 1000.0;
00129     }
00130 
00131     <span class="comment">/* Read the bandwidth. */</span>
00132     fscanf(stdin,<span class="stringliteral">"bandwidth=%d\n"</span>,&amp;N);
00133     fprintf(stderr,<span class="stringliteral">"%d\n"</span>,N);
00134 
00135     <span class="comment">/* Do precomputation. */</span>
00136     <a class="code" href="group__nfsft.html#ga4">nfsft_precompute</a>(N,threshold,
00137       ((use_nfsft==NO)?(<a class="code" href="group__nfsft.html#ga38">NFSFT_NO_FAST_ALGORITHM</a>):(0U<span class="comment">/*NFSFT_NO_DIRECT_ALGORITHM*/</span>)), 0U);
00138 
00139     <span class="comment">/* Read the number of nodes. */</span>
00140     fscanf(stdin,<span class="stringliteral">"nodes=%d\n"</span>,&amp;M);
00141     fprintf(stderr,<span class="stringliteral">"%d\n"</span>,M);
00142 
00143     <span class="comment">/* */</span>
00144     <span class="keywordflow">if</span> ((N+1)*(N+1) &gt; M)
00145     {
00146       <a class="code" href="group__nfftutil.html#ga5">nfft_next_power_of_2_exp</a>(N, &amp;npt, &amp;npt_exp);
00147       fprintf(stderr, <span class="stringliteral">"npt = %d, npt_exp = %d\n"</span>, npt, npt_exp);
00148       fprintf(stderr,<span class="stringliteral">"Optimal interpolation!\n"</span>);
00149       scratch = (<span class="keywordtype">double</span>*) malloc(4*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00150       ys = (<span class="keywordtype">double</span>*) malloc((N+1)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00151       temp = (<span class="keywordtype">double</span>*) malloc((2*N+1)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00152       temp2 = (<span class="keywordtype">double</span> complex*) malloc((N+1)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00153 
00154       a = 0.0;
00155       <span class="keywordflow">for</span> (j = 0; j &lt;= N; j++)
00156       {
00157         xs = 2.0 + (2.0*j)/(N+1);
00158         ys[j] = (2.0-((j == 0)?(1.0):(0.0)))*4.0*<a class="code" href="group__nfftutil.html#ga8">nfft_bspline</a>(4,xs,scratch);
00159         <span class="comment">//fprintf(stdout,"%3d: g(%le) = %le\n",j,xs,ys[j]);</span>
00160         a += ys[j];
00161       }
00162       <span class="comment">//fprintf(stdout,"a = %le\n",a);</span>
00163       <span class="keywordflow">for</span> (j = 0; j &lt;= N; j++)
00164       {
00165         ys[j] *= 1.0/a;
00166       }
00167 
00168       qlength = 2*N+1;
00169       qweights = (<span class="keywordtype">double</span>*) malloc(qlength*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00170 
00171       fplan = fftw_plan_r2r_1d(N+1, qweights, qweights, FFTW_REDFT00, 0U);
00172       <span class="keywordflow">for</span> (j = 0; j &lt; N+1; j++)
00173       {
00174         qweights[j] = -2.0/(4*j*j-1);
00175       }
00176       fftw_execute(fplan);
00177       qweights[0] *= 0.5;
00178 
00179       <span class="keywordflow">for</span> (j = 0; j &lt; N+1; j++)
00180       {
00181         qweights[j] *= 1.0/(2.0*N+1.0);
00182         qweights[2*N+1-1-j] = qweights[j];
00183       }
00184 
00185       fplan = fftw_plan_r2r_1d(2*N+1, temp, temp, FFTW_REDFT00, 0U);
00186       <span class="keywordflow">for</span> (j = 0; j &lt;= N; j++)
00187       {
00188         temp[j] = ((j==0 || j == 2*N)?(1.0):(0.5))*ys[j];
00189       }
00190       <span class="keywordflow">for</span> (j = N+1; j &lt; 2*N+1; j++)
00191       {
00192         temp[j] = 0.0;
00193       }
00194       fftw_execute(fplan);
00195 
00196       <span class="keywordflow">for</span> (j = 0; j &lt; 2*N+1; j++)
00197       {
00198         temp[j] *= qweights[j];
00199       }
00200 
00201       fftw_execute(fplan);
00202 
00203       <span class="keywordflow">for</span> (j = 0; j &lt; 2*N+1; j++)
00204       {
00205         temp[j] *= ((j==0 || j == 2*N)?(1.0):(0.5));
00206         <span class="keywordflow">if</span> (j &lt;= N)
00207         {
00208           temp2[j] = temp[j];
00209         }
00210       }
00211 
00212       set = <a class="code" href="group__fpt.html#ga1">fpt_init</a>(0, npt_exp, 0U);
00213 
00214       alpha = (<span class="keywordtype">double</span>*) malloc((N+2)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00215       beta = (<span class="keywordtype">double</span>*) malloc((N+2)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00216       gamma = (<span class="keywordtype">double</span>*) malloc((N+2)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00217 
00218       alpha_al_row(alpha, N, 0);
00219       beta_al_row(beta, N, 0);
00220       gamma_al_row(gamma, N, 0);
00221 
00222       <a class="code" href="group__fpt.html#ga2">fpt_precompute</a>(set, 0, alpha, beta, gamma, 0, 1000.0);
00223 
00224       <a class="code" href="group__fpt.html#ga6">fpt_transposed</a>(set,0, temp2, temp2, N, 0U);
00225 
00226       <span class="keywordflow">for</span> (j = 0; j &lt;= N; j++)
00227       {
00228         <span class="comment">//temp2[j] *= (2*j+1.0)/2.0;</span>
00229         <span class="comment">//fprintf(stdout,"temp2[%d] = %le\n",j,cabs(temp2[j]));</span>
00230       }
00231 
00232       <a class="code" href="group__fpt.html#ga7">fpt_finalize</a>(set);
00233 
00234       free(alpha);
00235       free(beta);
00236       free(gamma);
00237 
00238       fftw_destroy_plan(fplan);
00239 
00240       free(scratch);
00241       free(qweights);
00242       free(ys);
00243       free(temp);
00244       <span class="comment">//free(temp2);</span>
00245       <span class="comment">//return EXIT_SUCCESS;</span>
00246     }
00247 
00248     <span class="comment">/* Init transform plans. */</span>
00249     <a class="code" href="group__nfsft.html#ga3">nfsft_init_guru</a>(&amp;plan, N, M,
00250       ((use_nfft!=0)?(0U):(<a class="code" href="group__nfsft.html#ga26">NFSFT_USE_NDFT</a>)) |
00251       ((use_fpt!=0)?(0U):(<a class="code" href="group__nfsft.html#ga27">NFSFT_USE_DPT</a>)) | <a class="code" href="group__nfsft.html#ga30">NFSFT_MALLOC_F</a> | <a class="code" href="group__nfsft.html#ga28">NFSFT_MALLOC_X</a> |
00252       <a class="code" href="group__nfsft.html#ga29">NFSFT_MALLOC_F_HAT</a> | <a class="code" href="group__nfsft.html#ga25">NFSFT_NORMALIZED</a> | <a class="code" href="group__nfsft.html#ga39">NFSFT_ZERO_F_HAT</a>,
00253       <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a> | <a class="code" href="group__nfft.html#ga20">PRE_PSI</a> | <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a> |
00254       <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00255       cutoff);
00256 
00257     <span class="keywordflow">if</span> ((N+1)*(N+1) &gt; M)
00258     {
00259       <a class="code" href="group__solver.html#ga31">infsft_init_advanced</a> (&amp;iplan, &amp;plan, <a class="code" href="group__solver.html#ga38">CGNE</a> | <a class="code" href="group__solver.html#ga41">PRECOMPUTE_DAMP</a>);
00260     }
00261     <span class="keywordflow">else</span>
00262     {
00263       <a class="code" href="group__solver.html#ga31">infsft_init_advanced</a> (&amp;iplan, &amp;plan, <a class="code" href="group__solver.html#ga37">CGNR</a> | <a class="code" href="group__solver.html#ga40">PRECOMPUTE_WEIGHT</a> | <a class="code" href="group__solver.html#ga41">PRECOMPUTE_DAMP</a>);
00264     }
00265 
00266     <span class="comment">/* Read the nodes and function values. */</span>
00267     <span class="keywordflow">for</span> (j = 0; j &lt; M; j++)
00268     {
00269       fscanf(stdin,<span class="stringliteral">"%le %le %le %le\n"</span>,&amp;plan.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j+1],&amp;plan.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j],&amp;re,&amp;im);
00270       plan.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j+1] = plan.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j+1]/(2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00271       plan.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j] = plan.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j]/(2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00272       <span class="keywordflow">if</span> (plan.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j] &gt;= 0.5)
00273       {
00274         plan.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j] = plan.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j] - 1;
00275       }
00276       iplan.<a class="code" href="structinfsft__plan.html#o4">y</a>[j] = re + I * im;
00277       fprintf(stderr,<span class="stringliteral">"%le %le %le %le\n"</span>,plan.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j+1],plan.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j],
00278         creal(iplan.<a class="code" href="structinfsft__plan.html#o4">y</a>[j]),cimag(iplan.<a class="code" href="structinfsft__plan.html#o4">y</a>[j]));
00279     }
00280 
00281     <span class="comment">/* Read the number of nodes. */</span>
00282     fscanf(stdin,<span class="stringliteral">"nodes_eval=%d\n"</span>,&amp;M2);
00283     fprintf(stderr,<span class="stringliteral">"%d\n"</span>,M2);
00284 
00285     <span class="comment">/* Init transform plans. */</span>
00286     <a class="code" href="group__nfsft.html#ga3">nfsft_init_guru</a>(&amp;plan2, N, M2,
00287       ((use_nfft!=0)?(0U):(<a class="code" href="group__nfsft.html#ga26">NFSFT_USE_NDFT</a>)) |
00288       ((use_fpt!=0)?(0U):(<a class="code" href="group__nfsft.html#ga27">NFSFT_USE_DPT</a>)) | <a class="code" href="group__nfsft.html#ga30">NFSFT_MALLOC_F</a> | <a class="code" href="group__nfsft.html#ga28">NFSFT_MALLOC_X</a> |
00289       <a class="code" href="group__nfsft.html#ga29">NFSFT_MALLOC_F_HAT</a> | <a class="code" href="group__nfsft.html#ga25">NFSFT_NORMALIZED</a> | <a class="code" href="group__nfsft.html#ga39">NFSFT_ZERO_F_HAT</a>,
00290       <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a> | <a class="code" href="group__nfft.html#ga20">PRE_PSI</a> | <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a> |
00291       <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00292       cutoff);
00293 
00294     <span class="comment">/* Read the nodes and function values. */</span>
00295     <span class="keywordflow">for</span> (j = 0; j &lt; M2; j++)
00296     {
00297       fscanf(stdin,<span class="stringliteral">"%le %le\n"</span>,&amp;plan2.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j+1],&amp;plan2.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j]);
00298       plan2.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j+1] = plan2.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j+1]/(2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00299       plan2.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j] = plan2.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j]/(2.0*<a class="code" href="group__nfftutil.html#ga57">PI</a>);
00300       <span class="keywordflow">if</span> (plan2.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j] &gt;= 0.5)
00301       {
00302         plan2.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j] = plan2.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j] - 1;
00303       }
00304       fprintf(stderr,<span class="stringliteral">"%le %le\n"</span>,plan2.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j+1],plan2.<a class="code" href="structnfsft__plan.html#o5">x</a>[2*j]);
00305     }
00306 
00307     nfsft_precompute_x(&amp;plan);
00308 
00309     nfsft_precompute_x(&amp;plan2);
00310 
00311     <span class="comment">/* Frequency weights. */</span>
00312     <span class="keywordflow">if</span> ((N+1)*(N+1) &gt; M)
00313     {
00314       <span class="comment">/* Compute Voronoi weights. */</span>
00315       <span class="comment">//nfft_voronoi_weights_S2(iplan.w, plan.x, M);</span>
00316 
00317       <span class="comment">/* Print out Voronoi weights. */</span>
00318       <span class="comment">/*a = 0.0;</span>
00319 <span class="comment">      for (j = 0; j &lt; plan.M_total; j++)</span>
00320 <span class="comment">      {</span>
00321 <span class="comment">        fprintf(stderr,"%le\n",iplan.w[j]);</span>
00322 <span class="comment">        a += iplan.w[j];</span>
00323 <span class="comment">      }</span>
00324 <span class="comment">      fprintf(stderr,"sum = %le\n",a);*/</span>
00325 
00326       <span class="keywordflow">for</span> (j = 0; j &lt; plan.<a class="code" href="structnfsft__plan.html#o0">N_total</a>; j++)
00327       {
00328         iplan.<a class="code" href="structinfsft__plan.html#o3">w_hat</a>[j] = 0.0;
00329       }
00330 
00331       <span class="keywordflow">for</span> (k = 0; k &lt;= N; k++)
00332       {
00333         <span class="keywordflow">for</span> (j = -k; j &lt;= k; j++)
00334         {
00335           iplan.<a class="code" href="structinfsft__plan.html#o3">w_hat</a>[<a class="code" href="group__nfsft.html#ga40">NFSFT_INDEX</a>(k,j,&amp;plan)] = 1.0/(pow(k+1.0,2.0)); <span class="comment">/*temp2[j]*/</span>;
00336         }
00337       }
00338     }
00339     <span class="keywordflow">else</span>
00340     {
00341       <span class="keywordflow">for</span> (j = 0; j &lt; plan.<a class="code" href="structnfsft__plan.html#o0">N_total</a>; j++)
00342       {
00343         iplan.<a class="code" href="structinfsft__plan.html#o3">w_hat</a>[j] = 0.0;
00344       }
00345 
00346       <span class="keywordflow">for</span> (k = 0; k &lt;= N; k++)
00347       {
00348         <span class="keywordflow">for</span> (j = -k; j &lt;= k; j++)
00349         {
00350           iplan.<a class="code" href="structinfsft__plan.html#o3">w_hat</a>[<a class="code" href="group__nfsft.html#ga40">NFSFT_INDEX</a>(k,j,&amp;plan)] = 1/(pow(k+1.0,2.5));
00351         }
00352       }
00353 
00354       <span class="comment">/* Compute Voronoi weights. */</span>
00355       <a class="code" href="group__nfftutil.html#ga49">nfft_voronoi_weights_S2</a>(iplan.<a class="code" href="structinfsft__plan.html#o2">w</a>, plan.<a class="code" href="structnfsft__plan.html#o5">x</a>, M);
00356 
00357       <span class="comment">/* Print out Voronoi weights. */</span>
00358       a = 0.0;
00359       <span class="keywordflow">for</span> (j = 0; j &lt; plan.<a class="code" href="structnfsft__plan.html#o1">M_total</a>; j++)
00360       {
00361         fprintf(stderr,<span class="stringliteral">"%le\n"</span>,iplan.<a class="code" href="structinfsft__plan.html#o2">w</a>[j]);
00362         a += iplan.<a class="code" href="structinfsft__plan.html#o2">w</a>[j];
00363       }
00364       fprintf(stderr,<span class="stringliteral">"sum = %le\n"</span>,a);
00365     }
00366 
00367     fprintf(stderr, <span class="stringliteral">"N_total = %d\n"</span>, plan.<a class="code" href="structnfsft__plan.html#o0">N_total</a>);
00368     fprintf(stderr, <span class="stringliteral">"M_total = %d\n"</span>, plan.<a class="code" href="structnfsft__plan.html#o1">M_total</a>);
00369 
00370     <span class="comment">/* init some guess */</span>
00371     <span class="keywordflow">for</span> (k = 0; k &lt; plan.<a class="code" href="structnfsft__plan.html#o0">N_total</a>; k++)
00372     {
00373       iplan.<a class="code" href="structinfsft__plan.html#o5">f_hat_iter</a>[k] = 0.0;
00374     }
00375 
00376     <span class="comment">/* inverse trafo */</span>
00377     <a class="code" href="group__solver.html#ga32">infsft_before_loop</a>(&amp;iplan);
00378 
00379     <span class="comment">/*for (k = 0; k &lt; plan.M_total; k++)</span>
00380 <span class="comment">    {</span>
00381 <span class="comment">      printf("%le %le\n",creal(iplan.r_iter[k]),cimag(iplan.r_iter[k]));</span>
00382 <span class="comment">    }*/</span>
00383 
00384     <span class="keywordflow">for</span> (m = 0; m &lt; 29; m++)
00385     {
00386       fprintf(stderr,<span class="stringliteral">"Residual ||r||=%e,\n"</span>,sqrt(iplan.<a class="code" href="structinfsft__plan.html#o12">dot_r_iter</a>));
00387       <a class="code" href="group__solver.html#ga33">infsft_loop_one_step</a>(&amp;iplan);
00388     }
00389 
00390     <span class="comment">/*NFFT_SWAP_complex(iplan.f_hat_iter, plan.f_hat);</span>
00391 <span class="comment">    nfsft_trafo(&amp;plan);</span>
00392 <span class="comment">    NFFT_SWAP_complex(iplan.f_hat_iter, plan.f_hat);</span>
00393 <span class="comment"></span>
00394 <span class="comment">    a = 0.0;</span>
00395 <span class="comment">    b = 0.0;</span>
00396 <span class="comment">    for (k = 0; k &lt; plan.M_total; k++)</span>
00397 <span class="comment">    {</span>
00398 <span class="comment">      printf("%le %le %le\n",cabs(iplan.y[k]),cabs(plan.f[k]),</span>
00399 <span class="comment">        cabs(iplan.y[k]-plan.f[k]));</span>
00400 <span class="comment">      a += cabs(iplan.y[k]-plan.f[k])*cabs(iplan.y[k]-plan.f[k]);</span>
00401 <span class="comment">      b += cabs(iplan.y[k])*cabs(iplan.y[k]);</span>
00402 <span class="comment">    }</span>
00403 <span class="comment"></span>
00404 <span class="comment">    fprintf(stderr,"relative error in 2-norm: %le\n",a/b);*/</span>
00405 
00406     <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(iplan.<a class="code" href="structinfsft__plan.html#o5">f_hat_iter</a>, plan2.<a class="code" href="structnfsft__plan.html#o2">f_hat</a>);
00407     <a class="code" href="group__nfsft.html#ga8">nfsft_trafo</a>(&amp;plan2);
00408     <a class="code" href="group__nfftutil.html#ga55">NFFT_SWAP_complex</a>(iplan.<a class="code" href="structinfsft__plan.html#o5">f_hat_iter</a>, plan2.<a class="code" href="structnfsft__plan.html#o2">f_hat</a>);
00409     <span class="keywordflow">for</span> (k = 0; k &lt; plan2.<a class="code" href="structnfsft__plan.html#o1">M_total</a>; k++)
00410     {
00411       fprintf(stdout,<span class="stringliteral">"%le\n"</span>,cabs(plan2.<a class="code" href="structnfsft__plan.html#o3">f</a>[k]));
00412     }
00413 
00414     <a class="code" href="group__solver.html#ga34">infsft_finalize</a> (&amp;iplan);
00415 
00416     <a class="code" href="group__nfsft.html#ga10">nfsft_finalize</a>(&amp;plan);
00417 
00418     <a class="code" href="group__nfsft.html#ga10">nfsft_finalize</a>(&amp;plan2);
00419 
00420     <span class="comment">/* Delete precomputed data. */</span>
00421     <a class="code" href="group__nfsft.html#ga5">nfsft_forget</a>();
00422 
00423     <span class="keywordflow">if</span> ((N+1)*(N+1) &gt; M)
00424     {
00425       free(temp2);
00426     }
00427 
00428   } <span class="comment">/* Process each testcase. */</span>
00429 
00430   <span class="comment">/* Return exit code for successful run. */</span>
00431   <span class="keywordflow">return</span> EXIT_SUCCESS;
00432 }
00433 <span class="comment">/* \} */</span>
</pre></div>    <hr size="1"/>
    Generated on 22 Jan 2007 by Doxygen 1.4.1
  </body>
</html>
