<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.3 API Reference - NFFT: radon.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.3 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000006.html">applications</a>&nbsp;/&nbsp;<a class="el" href="dir_000022.html">radon</a></div>
<h1>radon.c</h1><a href="radon_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00020 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00021 <span class="preprocessor">#include &lt;math.h&gt;</span>
00022 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00023 <span class="preprocessor">#include &lt;string.h&gt;</span>
00024 
00025 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00026 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00027 
00029 <span class="comment">/*#define KERNEL(r) 1.0 */</span>
<a name="l00030"></a><a class="code" href="radon_8c.html#a0">00030</a> <span class="preprocessor">#define KERNEL(r) (1.0-fabs((double)(r))/((double)R/2))</span>
00031 <span class="preprocessor"></span>
<a name="l00035"></a><a class="code" href="radon_8c.html#a1">00035</a> <span class="keywordtype">int</span> <a class="code" href="group__applications__polarFFT__polar.html#ga0">polar_grid</a>(<span class="keywordtype">int</span> T, <span class="keywordtype">int</span> R, <span class="keywordtype">double</span> *x, <span class="keywordtype">double</span> *w)
00036 {
00037   <span class="keywordtype">int</span> t, r;
00038   <span class="keywordtype">double</span> W=(double)T*(((double)R/2.0)*((double)R/2.0)+1.0/4.0);
00039 
00040   <span class="keywordflow">for</span>(t=-T/2; t&lt;T/2; t++)
00041   {
00042     <span class="keywordflow">for</span>(r=-R/2; r&lt;R/2; r++)
00043     {
00044       x[2*((t+T/2)*R+(r+R/2))+0] = (double)r/R*cos(<a class="code" href="group__nfftutil.html#ga57">PI</a>*t/T);
00045       x[2*((t+T/2)*R+(r+R/2))+1] = (double)r/R*sin(<a class="code" href="group__nfftutil.html#ga57">PI</a>*t/T);
00046       <span class="keywordflow">if</span> (r==0)
00047         w[(t+T/2)*R+(r+R/2)] = 1.0/4.0/W;
00048       <span class="keywordflow">else</span>
00049         w[(t+T/2)*R+(r+R/2)] = fabs((<span class="keywordtype">double</span>)r)/W;
00050     }
00051   }
00052 
00053   <span class="keywordflow">return</span> 0;
00054 }
00055 
<a name="l00059"></a><a class="code" href="radon_8c.html#a2">00059</a> <span class="keywordtype">int</span> <a class="code" href="group__applications__polarFFT__linogramm.html#ga1">linogram_grid</a>(<span class="keywordtype">int</span> T, <span class="keywordtype">int</span> R, <span class="keywordtype">double</span> *x, <span class="keywordtype">double</span> *w)
00060 {
00061   <span class="keywordtype">int</span> t, r;
00062   <span class="keywordtype">double</span> W=(double)T*(((double)R/2.0)*((double)R/2.0)+1.0/4.0);
00063 
00064   <span class="keywordflow">for</span>(t=-T/2; t&lt;T/2; t++)
00065   {
00066     <span class="keywordflow">for</span>(r=-R/2; r&lt;R/2; r++)
00067     {
00068       <span class="keywordflow">if</span>(t&lt;0)
00069       {
00070         x[2*((t+T/2)*R+(r+R/2))+0] = (double)r/R;
00071         x[2*((t+T/2)*R+(r+R/2))+1] = (double)4*(t+T/4)/T*r/R;
00072       }
00073       <span class="keywordflow">else</span>
00074       {
00075         x[2*((t+T/2)*R+(r+R/2))+0] = -(double)4*(t-T/4)/T*r/R;
00076         x[2*((t+T/2)*R+(r+R/2))+1] = (double)r/R;
00077       }
00078       <span class="keywordflow">if</span> (r==0)
00079         w[(t+T/2)*R+(r+R/2)] = 1.0/4.0/W;
00080       <span class="keywordflow">else</span>
00081         w[(t+T/2)*R+(r+R/2)] = fabs((<span class="keywordtype">double</span>)r)/W;
00082     }
00083   }
00084 
00085   <span class="keywordflow">return</span> 0;
00086 }
00087 
<a name="l00091"></a><a class="code" href="radon_8c.html#a3">00091</a> <span class="keywordtype">int</span> <a class="code" href="radon_8c.html#a3">Radon_trafo</a>(<span class="keywordtype">int</span> (*gridfcn)(), <span class="keywordtype">int</span> T, <span class="keywordtype">int</span> R, <span class="keywordtype">double</span> *f, <span class="keywordtype">int</span> NN, <span class="keywordtype">double</span> *Rf)
00092 {
00093   <span class="keywordtype">int</span> j,k;                              
00094   <a class="code" href="structnfft__plan.html">nfft_plan</a> my_nfft_plan;               
00096   fftw_complex *<a class="code" href="group__applications__mri3d__construct__data__1d2d.html#ga1">fft</a>;                    
00097   fftw_plan my_fftw_plan;               
00099   <span class="keywordtype">int</span> t,r;                              
00100   <span class="keywordtype">double</span> *x, *w;                        
00102   <span class="keywordtype">int</span> N[2],n[2];
00103   <span class="keywordtype">int</span> M=T*R;
00104 
00105   N[0]=NN; n[0]=2*N[0];
00106   N[1]=NN; n[1]=2*N[1];
00107 
00108   <a class="code" href="group__applications__mri3d__construct__data__1d2d.html#ga1">fft</a> = (fftw_complex *)fftw_malloc(R*<span class="keyword">sizeof</span>(fftw_complex));
00109   my_fftw_plan = fftw_plan_dft_1d(R,<a class="code" href="group__applications__mri3d__construct__data__1d2d.html#ga1">fft</a>,<a class="code" href="group__applications__mri3d__construct__data__1d2d.html#ga1">fft</a>,FFTW_BACKWARD,FFTW_MEASURE);
00110 
00111   x = (<span class="keywordtype">double</span> *)malloc(2*T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00112   <span class="keywordflow">if</span> (x==NULL)
00113     <span class="keywordflow">return</span> -1;
00114 
00115   w = (<span class="keywordtype">double</span> *)malloc(T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00116   <span class="keywordflow">if</span> (w==NULL)
00117     <span class="keywordflow">return</span> -1;
00118 
00120   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;my_nfft_plan, 2, N, M, n, 4,
00121                  <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>| <a class="code" href="group__nfft.html#ga22">MALLOC_X</a> | <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>| <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>| <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a> | <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00122                  FFTW_MEASURE| FFTW_DESTROY_INPUT);
00123 
00124 
00126   gridfcn(T,R,x,w);
00127   <span class="keywordflow">for</span>(j=0;j&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++)
00128   {
00129     my_nfft_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+0] = x[2*j+0];
00130     my_nfft_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+1] = x[2*j+1];
00131   }
00132 
00134   <span class="keywordflow">if</span>(my_nfft_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga18">PRE_LIN_PSI</a>)
00135     <a class="code" href="group__nfft.html#ga13">nfft_precompute_lin_psi</a>(&amp;my_nfft_plan);
00136 
00137   <span class="keywordflow">if</span>(my_nfft_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00138     <a class="code" href="group__nfft.html#ga12">nfft_precompute_psi</a>(&amp;my_nfft_plan);
00139 
00140   <span class="keywordflow">if</span>(my_nfft_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>)
00141     <a class="code" href="group__nfft.html#ga11">nfft_precompute_full_psi</a>(&amp;my_nfft_plan);
00142 
00144   <span class="keywordflow">for</span>(k=0;k&lt;my_nfft_plan.<a class="code" href="structnfft__plan.html#o0">N_total</a>;k++)
00145     my_nfft_plan.<a class="code" href="structnfft__plan.html#o2">f_hat</a>[k] = f[k] + I*0.0;
00146 
00148   <a class="code" href="group__nfft.html#ga2">nfft_trafo</a>(&amp;my_nfft_plan);
00149 
00151   <span class="keywordflow">for</span>(t=0; t&lt;T; t++)
00152   {
00153     <a class="code" href="group__applications__mri3d__construct__data__1d2d.html#ga1">fft</a>[0]=0.0;
00154     <span class="keywordflow">for</span>(r=-R/2+1; r&lt;R/2; r++)
00155       <a class="code" href="group__applications__mri3d__construct__data__1d2d.html#ga1">fft</a>[r+R/2] = <a class="code" href="inverse__radon_8c.html#a0">KERNEL</a>(r)*my_nfft_plan.<a class="code" href="structnfft__plan.html#o3">f</a>[t*R+(r+R/2)];
00156 
00157     <a class="code" href="group__nfftutil.html#ga36">nfft_fftshift_complex</a>(<a class="code" href="group__applications__mri3d__construct__data__1d2d.html#ga1">fft</a>, 1, &amp;R);
00158     fftw_execute(my_fftw_plan);
00159     <a class="code" href="group__nfftutil.html#ga36">nfft_fftshift_complex</a>(<a class="code" href="group__applications__mri3d__construct__data__1d2d.html#ga1">fft</a>, 1, &amp;R);
00160 
00161     <span class="keywordflow">for</span>(r=0; r&lt;R; r++)
00162       Rf[t*R+r] = creal(<a class="code" href="group__applications__mri3d__construct__data__1d2d.html#ga1">fft</a>[r])/R;
00163 
00164 <span class="comment">/*    for(r=0; r&lt;R/2; r++)</span>
00165 <span class="comment">      Rf[t*R+(r+R/2)] = creal(cexp(-I*PI*r)*fft[r]);</span>
00166 <span class="comment">    for(r=0; r&lt;R/2; r++)</span>
00167 <span class="comment">      Rf[t*R+r] = creal(cexp(-I*PI*r)*fft[r+R/2]);</span>
00168 <span class="comment"> */</span>
00169   }
00170 
00172   fftw_destroy_plan(my_fftw_plan);
00173   fftw_free(<a class="code" href="group__applications__mri3d__construct__data__1d2d.html#ga1">fft</a>);
00174   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;my_nfft_plan);
00175   free(x);
00176   free(w);
00177   <span class="keywordflow">return</span> 0;
00178 }
00179 
<a name="l00182"></a><a class="code" href="radon_8c.html#a4">00182</a> <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a>(<span class="keywordtype">int</span> argc,<span class="keywordtype">char</span> **argv)
00183 {
00184   int (*gridfcn)();                     
00185   <span class="keywordtype">int</span> T, R;                             
00186   FILE *fp;
00187   <span class="keywordtype">int</span> N;                                
00188   <span class="keywordtype">double</span> *f, *Rf;
00189 
00190   <span class="keywordflow">if</span>( argc!=5 )
00191   {
00192     printf(<span class="stringliteral">"radon gridfcn N T R\n"</span>);
00193     printf(<span class="stringliteral">"\n"</span>);
00194     printf(<span class="stringliteral">"gridfcn    \"polar\" or \"linogram\" \n"</span>);
00195     printf(<span class="stringliteral">"N          image size NxN            \n"</span>);
00196     printf(<span class="stringliteral">"T          number of slopes          \n"</span>);
00197     printf(<span class="stringliteral">"R          number of offsets         \n"</span>);
00198     exit(-1);
00199   }
00200 
00201   <span class="keywordflow">if</span> (strcmp(argv[1],<span class="stringliteral">"polar"</span>) == 0)
00202     gridfcn = <a class="code" href="group__applications__polarFFT__polar.html#ga0">polar_grid</a>;
00203   <span class="keywordflow">else</span>
00204     gridfcn = <a class="code" href="group__applications__polarFFT__linogramm.html#ga1">linogram_grid</a>;
00205 
00206   N = atoi(argv[2]);
00207   T = atoi(argv[3]);
00208   R = atoi(argv[4]);
00209   <span class="comment">/*printf("N=%d, %s grid with T=%d, R=%d. \n",N,argv[1],T,R);*/</span>
00210 
00211   f   = (<span class="keywordtype">double</span> *)malloc(N*N*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00212   Rf  = (<span class="keywordtype">double</span> *)malloc(T*R*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00213 
00215   fp=fopen(<span class="stringliteral">"input_data.bin"</span>,<span class="stringliteral">"rb"</span>);
00216   <span class="keywordflow">if</span> (fp==NULL)
00217     <span class="keywordflow">return</span>(-1);
00218   fread(f,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),N*N,fp);
00219   fclose(fp);
00220 
00222   <a class="code" href="radon_8c.html#a3">Radon_trafo</a>(gridfcn,T,R,f,N,Rf);
00223 
00225   fp=fopen(<span class="stringliteral">"sinogram_data.bin"</span>,<span class="stringliteral">"wb+"</span>);
00226   <span class="keywordflow">if</span> (fp==NULL)
00227     <span class="keywordflow">return</span>(-1);
00228   fwrite(Rf,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),T*R,fp);
00229   fclose(fp);
00230 
00232   free(f);
00233   free(Rf);
00234 
00235   <span class="keywordflow">return</span> EXIT_SUCCESS;
00236 }
</pre></div>    <hr size="1"/>
    Generated on 5 Feb 2007 by Doxygen 1.4.1
  </body>
</html>
