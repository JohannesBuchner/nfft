<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.3 API Reference - NFFT: reconstruct_data_2d.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.3 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000006.html">applications</a>&nbsp;/&nbsp;<a class="el" href="dir_000007.html">mri</a>&nbsp;/&nbsp;<a class="el" href="dir_000008.html">mri2d</a></div>
<h1>reconstruct_data_2d.c</h1><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#include &lt;math.h&gt;</span>
00002 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00003 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00004 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00005 
<a name="l00015"></a><a class="code" href="group__applications__mri2d__reconstruct__data__2d.html#ga0">00015</a> <span class="keywordtype">void</span> <a class="code" href="group__applications__mri2d__reconstruct__data__2d.html#ga0">reconstruct</a>(<span class="keywordtype">char</span>* filename,<span class="keywordtype">int</span> N,<span class="keywordtype">int</span> M,<span class="keywordtype">int</span> iteration, <span class="keywordtype">int</span> weight)
00016 {
00017   <span class="keywordtype">int</span> j,k,l;                    <span class="comment">/* some variables  */</span>
00018   <span class="keywordtype">double</span> real,imag,t;           <span class="comment">/* to read the real and imag part of a complex number */</span>
00019   <a class="code" href="structnfft__plan.html">nfft_plan</a> my_plan;            <span class="comment">/* plan for the two dimensional nfft  */</span>
00020   <a class="code" href="structinfft__plan.html">infft_plan</a> my_iplan;          <span class="comment">/* plan for the two dimensional infft */</span>
00021   FILE* fin;                    <span class="comment">/* input file                         */</span>
00022   FILE* fout_real;              <span class="comment">/* output file                        */</span>
00023   FILE* fout_imag;              <span class="comment">/* output file                        */</span>
00024   <span class="keywordtype">int</span> my_N[2],my_n[2];          <span class="comment">/* to init the nfft */</span>
00025   <span class="keywordtype">double</span> epsilon=0.0000003;     <span class="comment">/* epsilon is a the break criterium for</span>
00026 <span class="comment">                                   the iteration */</span>
00027   <span class="keywordtype">unsigned</span> infft_flags = <a class="code" href="group__solver.html#ga37">CGNR</a> | <a class="code" href="group__solver.html#ga41">PRECOMPUTE_DAMP</a>;  <span class="comment">/* flags for the infft*/</span>
00028   <span class="keywordtype">int</span> m = 6;
00029   <span class="keywordtype">double</span> alpha = 2.0;
00030   <span class="comment">/* initialise my_plan */</span>
00031   my_N[0]=N; my_n[0]=ceil(N*alpha);
00032   my_N[1]=N; my_n[1]=ceil(N*alpha);
00033   <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(&amp;my_plan, 2, my_N, M, my_n, m, <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>|
00034                          <a class="code" href="group__nfft.html#ga22">MALLOC_X</a>| <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>| <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>| 
00035                          <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a>| <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>,
00036                          FFTW_MEASURE| FFTW_DESTROY_INPUT);
00037   
00038   <span class="comment">/* precompute lin psi if set */</span>
00039   <span class="keywordflow">if</span>(my_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga18">PRE_LIN_PSI</a>)
00040     <a class="code" href="group__nfft.html#ga13">nfft_precompute_lin_psi</a>(&amp;my_plan);
00041   
00042   <span class="comment">/* set the flags for the infft*/</span>
00043   <span class="keywordflow">if</span> (weight)
00044     infft_flags = infft_flags | <a class="code" href="group__solver.html#ga40">PRECOMPUTE_WEIGHT</a>;
00045 
00046   <span class="comment">/* initialise my_iplan, advanced */</span>
00047   <a class="code" href="group__solver.html#ga1">infft_init_advanced</a>(&amp;my_iplan,&amp;my_plan, infft_flags );
00048 
00049   <span class="comment">/* get the weights */</span>
00050   <span class="keywordflow">if</span>(my_iplan.<a class="code" href="structinfft__plan.html#o1">flags</a> &amp; <a class="code" href="group__solver.html#ga40">PRECOMPUTE_WEIGHT</a>)
00051   {
00052     fin=fopen(<span class="stringliteral">"weights.dat"</span>,<span class="stringliteral">"r"</span>);
00053     <span class="keywordflow">for</span>(j=0;j&lt;my_plan.<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++) 
00054     {
00055         fscanf(fin,<span class="stringliteral">"%le "</span>,&amp;my_iplan.<a class="code" href="structinfft__plan.html#o2">w</a>[j]);
00056     }
00057     fclose(fin);
00058   }
00059   
00060   <span class="comment">/* get the damping factors */</span>
00061   <span class="keywordflow">if</span>(my_iplan.<a class="code" href="structinfft__plan.html#o1">flags</a> &amp; <a class="code" href="group__solver.html#ga41">PRECOMPUTE_DAMP</a>)
00062   {
00063     <span class="keywordflow">for</span>(j=0;j&lt;N;j++){
00064       <span class="keywordflow">for</span>(k=0;k&lt;N;k++) {
00065         <span class="keywordtype">int</span> j2= j-N/2;
00066         <span class="keywordtype">int</span> k2= k-N/2;
00067         <span class="keywordtype">double</span> r=sqrt(j2*j2+k2*k2);
00068         <span class="keywordflow">if</span>(r&gt;(double) N/2) 
00069           my_iplan.<a class="code" href="structinfft__plan.html#o3">w_hat</a>[j*N+k]=0.0;
00070         <span class="keywordflow">else</span>
00071           my_iplan.<a class="code" href="structinfft__plan.html#o3">w_hat</a>[j*N+k]=1.0;
00072       }   
00073     }
00074   }
00075   
00076   <span class="comment">/* open the input file */</span>
00077   fin=fopen(filename,<span class="stringliteral">"r"</span>); 
00078 
00079   <span class="comment">/* read x,y,freal and fimag from the knots */</span>
00080   <span class="keywordflow">for</span>(j=0;j&lt;my_plan.<a class="code" href="structnfft__plan.html#o1">M_total</a>;j++)
00081   {
00082     fscanf(fin,<span class="stringliteral">"%le %le %le %le "</span>,&amp;my_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+0],&amp;my_plan.<a class="code" href="structnfft__plan.html#o14">x</a>[2*j+1],
00083     &amp;real,&amp;imag);
00084     my_iplan.<a class="code" href="structinfft__plan.html#o4">y</a>[j] = real + I*imag;
00085   }
00086 
00087   fclose(fin);
00088   
00089   <span class="comment">/* precompute psi */</span>
00090   <span class="keywordflow">if</span>(my_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00091     <a class="code" href="group__nfft.html#ga12">nfft_precompute_psi</a>(&amp;my_plan);
00092 
00093   <span class="comment">/* precompute full psi */</span>
00094   <span class="keywordflow">if</span>(my_plan.<a class="code" href="structnfft__plan.html#o12">nfft_flags</a> &amp; <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>)
00095       <a class="code" href="group__nfft.html#ga11">nfft_precompute_full_psi</a>(&amp;my_plan);
00096 
00097   <span class="comment">/* init some guess */</span>
00098   <span class="keywordflow">for</span>(k=0;k&lt;my_plan.<a class="code" href="structnfft__plan.html#o0">N_total</a>;k++)
00099     my_iplan.<a class="code" href="structinfft__plan.html#o5">f_hat_iter</a>[k]=0.0;
00100 
00101   t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00102     
00103   <span class="comment">/* inverse trafo */</span>
00104   <a class="code" href="group__solver.html#ga2">infft_before_loop</a>(&amp;my_iplan);
00105   <span class="keywordflow">for</span>(l=0;l&lt;iteration;l++)
00106   {
00107     <span class="comment">/* break if dot_r_iter is smaller than epsilon*/</span>
00108     <span class="keywordflow">if</span>(my_iplan.<a class="code" href="structinfft__plan.html#o12">dot_r_iter</a>&lt;epsilon)
00109       <span class="keywordflow">break</span>;
00110     fprintf(stderr,<span class="stringliteral">"%e,  %i of %i\n"</span>,sqrt(my_iplan.<a class="code" href="structinfft__plan.html#o12">dot_r_iter</a>),
00111     l+1,iteration);
00112     <a class="code" href="group__solver.html#ga3">infft_loop_one_step</a>(&amp;my_iplan);
00113   }
00114 
00115   
00116   t=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-t;
00117 <span class="preprocessor">#ifdef HAVE_MALLINFO</span>
00118 <span class="preprocessor"></span>  fprintf(stderr,<span class="stringliteral">"time: %e seconds mem: %i \n"</span>,t,<a class="code" href="group__nfftutil.html#ga1">nfft_total_used_memory</a>());
00119 <span class="preprocessor">#else</span>
00120 <span class="preprocessor"></span>  fprintf(stderr,<span class="stringliteral">"time: %e seconds mem: mallinfo not available\n"</span>,t);
00121 <span class="preprocessor">#endif</span>
00122 <span class="preprocessor"></span>
00123   
00124   fout_real=fopen(<span class="stringliteral">"output_real.dat"</span>,<span class="stringliteral">"w"</span>);
00125   fout_imag=fopen(<span class="stringliteral">"output_imag.dat"</span>,<span class="stringliteral">"w"</span>);
00126 
00127   <span class="keywordflow">for</span>(k=0;k&lt;my_plan.<a class="code" href="structnfft__plan.html#o0">N_total</a>;k++) {
00128     fprintf(fout_real,<span class="stringliteral">"%le "</span>, creal(my_iplan.<a class="code" href="structinfft__plan.html#o5">f_hat_iter</a>[k]));
00129     fprintf(fout_imag,<span class="stringliteral">"%le "</span>, cimag(my_iplan.<a class="code" href="structinfft__plan.html#o5">f_hat_iter</a>[k]));
00130   }
00131 
00132   fclose(fout_real);
00133   fclose(fout_imag);
00134 
00135   <span class="comment">/* finalize the infft */</span>
00136   <a class="code" href="group__solver.html#ga4">infft_finalize</a>(&amp;my_iplan);
00137   
00138   <span class="comment">/* finalize the nfft */</span>
00139   <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(&amp;my_plan);
00140 }
00141 
00142 <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
00143 {
00144   <span class="keywordflow">if</span> (argc &lt;= 5) {
00145     printf(<span class="stringliteral">"usage: ./reconstruct_data_2d FILENAME N M ITER WEIGHTS\n"</span>);
00146     <span class="keywordflow">return</span> 1;
00147   }
00148   
00149   <a class="code" href="group__applications__mri2d__reconstruct__data__2d.html#ga0">reconstruct</a>(argv[1],atoi(argv[2]),atoi(argv[3]),atoi(argv[4]),atoi(argv[5]));
00150    
00151   <span class="keywordflow">return</span> 1;
00152 }
00153 <span class="comment">/* \} */</span>
</pre></div>    <hr size="1"/>
    Generated on 5 Feb 2007 by Doxygen 1.4.1
  </body>
</html>
