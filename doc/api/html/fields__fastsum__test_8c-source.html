<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.2 API Reference - NFFT: fields_fastsum_test.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.2 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000006.html">applications</a>&nbsp;/&nbsp;<a class="el" href="dir_000017.html">potential</a></div>
<h1>fields_fastsum_test.c</h1><a href="fields__fastsum__test_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00008 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00009 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00010 <span class="preprocessor">#include &lt;string.h&gt;</span>
00011 <span class="preprocessor">#include &lt;math.h&gt;</span>
00012 <span class="preprocessor">#include &lt;time.h&gt;</span>
00013 
00014 <span class="preprocessor">#include "<a class="code" href="fields__fastsum_8h.html">fields_fastsum.h</a>"</span>
00015 
00016 <span class="keywordtype">int</span> <a class="code" href="flags_8c.html#a6">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
00017 {
00018   <span class="keywordtype">int</span> j,k,t;                                         
00019   <span class="keywordtype">int</span> N;                                             
00020   <span class="keywordtype">int</span> n;                                             
00021   <span class="keywordtype">int</span> m;                                             
00022   <span class="keywordtype">int</span> p;                                             
00023   <a class="code" href="structfields__fastsum__plan__.html">fields_fastsum_plan</a> my_plan;                       
00024   <span class="keywordtype">double</span> *direct;                                    
00025   <span class="keywordtype">double</span> *simple;
00026   <span class="keywordtype">double</span> time_diff;                                  
00027   <span class="keywordtype">double</span> error=0.0;                                  
00028   <span class="keywordtype">double</span> error_simple_fast=0.0;                      
00029   <span class="keywordtype">double</span> norm_direct;                                
00030   <span class="keywordtype">double</span> norm_diff;                                  
00031   <span class="keywordtype">double</span> norm_simple;                                
00032   <span class="keywordtype">double</span> norm_diff_simple;                           
00033   <span class="keywordtype">double</span> sum_error_direct;                           
00034   <span class="keywordtype">double</span> sum_error_diff;                             
00035   <span class="keywordtype">double</span> eps_I;                                      
00036   <span class="keywordtype">double</span> eps_B = 0.0625;                             
00038   <span class="keywordflow">if</span> (argc &lt; 5)
00039   {
00040     printf(<span class="stringliteral">"\nfastsum_test N n m p [eps_I]\n\n"</span>);
00041     printf(<span class="stringliteral">"  N       number of nodes       \n"</span>);
00042     printf(<span class="stringliteral">"  n       expansion degree      \n"</span>);
00043     printf(<span class="stringliteral">"  m       cut-off parameter     \n"</span>);
00044     printf(<span class="stringliteral">"  p       degree of smoothness  \n"</span>);
00045     printf(<span class="stringliteral">"  eps_I   inner boundary        \n"</span>);
00046     exit(-1);
00047   }
00048   <span class="keywordflow">else</span>
00049   {
00050     N=atoi(argv[1]);
00051     n=atoi(argv[2]);
00052     m=atoi(argv[3]);
00053     p=atoi(argv[4]);
00054     <span class="keywordflow">if</span> (argc &gt; 5)
00055       eps_I=atof(argv[5]);
00056     else
00057       eps_I=(<span class="keywordtype">double</span>)p/n;
00058   }
00059   printf("N=%d, n=%d, m=%d, p=%d, eps_I=%g, eps_B=%g \n",N,n,m,p,eps_I,eps_B);
00060 
00061   <span class="comment">/* initialize the plan */</span>
00062   fields_fastsum_init(&amp;my_plan, N, 0, n, m, p, eps_I, eps_B);
00063 
00064   <span class="comment">/* initialize random generator with current time */</span>
00065   srand(time(NULL));
00066 
00068   <span class="keywordtype">double</span> r_2 = 0.0;
00069   for (k=0; k&lt;N; k++)
00070   {
00071     <span class="keywordflow">do</span> {
00072       my_plan.r[3*k] = (double)rand()/(double)RAND_MAX*2.0 - 1.0;
00073       my_plan.r[3*k+1] = (double)rand()/(double)RAND_MAX*2.0 - 1.0;
00074       my_plan.r[3*k+2] = (double)rand()/(double)RAND_MAX*2.0 - 1.0;
00075       r_2 = my_plan.r[3*k] * my_plan.r[3*k] + my_plan.r[3*k+1] * my_plan.r[3*k+1] + my_plan.r[3*k+2] * my_plan.r[3*k+2];
00076     } <span class="keywordflow">while</span>(r_2 &gt; 1.0);
00077     my_plan.<a class="code" href="structfields__fastsum__plan__.html#o2">r</a>[3*k] *= (0.25-eps_B/2.0);
00078     my_plan.<a class="code" href="structfields__fastsum__plan__.html#o2">r</a>[3*k+1] *= (0.25-eps_B/2.0);
00079     my_plan.<a class="code" href="structfields__fastsum__plan__.html#o2">r</a>[3*k+2] *= (0.25-eps_B/2.0);
00080 
00081     my_plan.<a class="code" href="structfields__fastsum__plan__.html#o1">q</a>[k] = (double)rand()/(double)RAND_MAX;
00082   }
00083 
00085   printf(<span class="stringliteral">"direct computation: "</span>); fflush(NULL);
00086   time_diff=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>();
00087   <a class="code" href="fields__fastsum_8c.html#a2">fields_fastsum_exact</a>(&amp;my_plan);
00088   time_diff=<a class="code" href="group__nfftutil.html#ga0">nfft_second</a>()-time_diff;
00089   printf(<span class="stringliteral">"%fsec\n"</span>,time_diff);
00090 
00092   direct = (<span class="keywordtype">double</span> *)malloc(3*my_plan.N_total*(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)));
00093   <span class="keywordflow">for</span> (j=0; j&lt;3*my_plan.N_total; j++)
00094     direct[j]=my_plan.E[j];
00095 
00097   printf("fast computation, simple:   "); fflush(NULL);
00098   time_diff=nfft_second();
00099   fields_fastsum_simple(&amp;my_plan);
00100   time_diff=nfft_second()-time_diff;
00101   printf("%fsec\n",time_diff);
00102 
00104   simple = (<span class="keywordtype">double</span> *)malloc(3*my_plan.N_total*(sizeof(<span class="keywordtype">double</span>)));
00105   for (j=0; j&lt;3*my_plan.N_total; j++)
00106     simple[j]=my_plan.E[j];
00107 
00109   printf("fast computation:   "); fflush(NULL);
00110   time_diff=nfft_second();
00111   fields_fastsum_precompute(&amp;my_plan);
00112   fields_fastsum_trafo(&amp;my_plan);
00113   time_diff=nfft_second()-time_diff;
00114   printf("%fsec\n",time_diff);
00115 
00117   if (my_plan.N_total &lt; 11) {
00118     <span class="keywordflow">for</span> (j=0; j &lt; my_plan.N_total; j++) {
00119       printf(<span class="stringliteral">"% .16e; "</span>, my_plan.q[j]);
00120       printf(<span class="stringliteral">"% .16e, "</span>, my_plan.r[j*3]);
00121       printf(<span class="stringliteral">"% .16e, "</span>, my_plan.r[j*3+1]);
00122       printf(<span class="stringliteral">"% .16e\n"</span>, my_plan.r[j*3+2]);
00123     }
00124   }
00125 
00127   error=0.0;
00128   error_simple_fast = 0.0;
00129   sum_error_direct = 0.0;
00130   sum_error_diff = 0.0;
00131   <span class="keywordflow">for</span> (j=0; j&lt;my_plan.N_total; j++)
00132   {
00133     norm_direct = 0.0;
00134     norm_diff = 0.0;
00135     norm_diff_simple = 0.0;
00136     norm_simple = 0.0;
00137     <span class="keywordflow">for</span> (t=0; t &lt; 3; t++) {
00138       <span class="keywordflow">if</span> (my_plan.N_total &lt; 11) {
00139         printf(<span class="stringliteral">" % .16e | "</span>, direct[j*3+t]);
00140         printf(<span class="stringliteral">"  % .16e\n"</span>, my_plan.E[j*3+t]);
00141       }
00142       norm_direct += direct[j*3+t] * direct[j*3+t];
00143       norm_simple += simple[j*3+t] * simple[j*3+t];
00144       norm_diff += (my_plan.E[j*3+t] - direct[j*3+t]) * (my_plan.E[j*3+t] - direct[j*3+t]);
00145       norm_diff_simple += (my_plan.E[j*3+t] - simple[j*3+t]) * (my_plan.E[j*3+t] - simple[j*3+t]);
00146     }
00147     sum_error_direct += norm_direct;
00148     sum_error_diff += norm_diff;
00149     norm_direct = sqrt(norm_direct);
00150     norm_simple = sqrt(norm_simple);
00151     norm_diff = sqrt(norm_diff);
00152     norm_diff_simple = sqrt(norm_diff_simple);
00153     <span class="keywordflow">if</span> (fabs(norm_diff)/fabs(norm_direct)&gt;error)
00154       error=fabs(norm_diff)/fabs(norm_direct);
00155 
00156     if (fabs(norm_diff_simple)/fabs(norm_simple)&gt;error_simple_fast)
00157       error_simple_fast = fabs(norm_diff_simple)/fabs(norm_simple);
00158   }
00159   printf("max relative error(slow,fast): %e\n",error);
00160   printf("max relative error(simple,fast): %e\n",error_simple_fast);
00161   printf("error epsilon_2(slow,fast) (p.7): %e\n", sqrt(sum_error_diff)/sqrt(sum_error_direct));
00162 
00164   fields_fastsum_finalize(&amp;my_plan);
00165 
00166   return 0;
00167 }
</pre></div>    <hr size="1"/>
    Generated on 22 Jan 2007 by Doxygen 1.4.1
  </body>
</html>
