<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
    <title>
      NFFT 3.0.3 API Reference - NFFT: nfft.c Source File
    </title>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <img src="images/logo.png" alt="NFFT Logo">
        </td>
        <td align="left" valign="bottom" width="100%">
          <H1nc>3.0.3 API Reference</H1nc>
        </td>
      </tr>
    </table>  
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000003.html">kernel</a>&nbsp;/&nbsp;<a class="el" href="dir_000025.html">nfft</a></div>
<h1>nfft.c</h1><div class="fragment"><pre class="fragment">00001 
00006 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00007 <span class="preprocessor">#include &lt;math.h&gt;</span>
00008 <span class="preprocessor">#include &lt;string.h&gt;</span>
00009 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00010 
00011 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00012 <span class="preprocessor">#include "options.h"</span>
00013 <span class="preprocessor">#include "window_defines.h"</span>
00014 
00015 <span class="preprocessor">#include "<a class="code" href="nfft3_8h.html">nfft3.h</a>"</span>
00016 
00040 <span class="preprocessor">#define MACRO_ndft_init_result_trafo memset(f,0,ths-&gt;M_total*                 \</span>
00041 <span class="preprocessor">                                            sizeof(double complex));</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_ndft_init_result_conjugated MACRO_ndft_init_result_trafo</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_ndft_init_result_adjoint memset(f_hat,0,ths-&gt;N_total*           \</span>
00044 <span class="preprocessor">                sizeof(double complex));</span>
00045 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_ndft_init_result_transposed MACRO_ndft_init_result_adjoint</span>
00046 <span class="preprocessor"></span>
00047 <span class="preprocessor">#define MACRO_ndft_sign_trafo      +2*PI*ths-&gt;x[j*ths-&gt;d+t]</span>
00048 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_ndft_sign_conjugated -2*PI*ths-&gt;x[j*ths-&gt;d+t]</span>
00049 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_ndft_sign_adjoint    +2*PI*ths-&gt;x[j*ths-&gt;d+t]</span>
00050 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_ndft_sign_transposed -2*PI*ths-&gt;x[j*ths-&gt;d+t]</span>
00051 <span class="preprocessor"></span>
00052 <span class="preprocessor">#define MACRO_init_k_N_Omega_x(which_one) {                                   \</span>
00053 <span class="preprocessor">for(t=0; t&lt;ths-&gt;d; t++)                                                       \</span>
00054 <span class="preprocessor">  {                                                                           \</span>
00055 <span class="preprocessor">    k[t]=-ths-&gt;N[t]/2;                                                        \</span>
00056 <span class="preprocessor">    x[t]= MACRO_ndft_sign_ ## which_one;                                      \</span>
00057 <span class="preprocessor">    Omega[t+1]=k[t]*x[t]+Omega[t];                                            \</span>
00058 <span class="preprocessor">  }                                                                           \</span>
00059 <span class="preprocessor">omega=Omega[ths-&gt;d];                                                          \</span>
00060 <span class="preprocessor">}                                                                             \</span>
00061 <span class="preprocessor"></span>
00062 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_count_k_N_Omega {                                               \</span>
00063 <span class="preprocessor">for(t = ths-&gt;d-1; (t &gt;= 1) &amp;&amp; (k[t] == ths-&gt;N[t]/2-1); t--)                   \</span>
00064 <span class="preprocessor">  k[t]-= ths-&gt;N[t]-1;                                                         \</span>
00065 <span class="preprocessor">                                                                              \</span>
00066 <span class="preprocessor">k[t]++;                                                                       \</span>
00067 <span class="preprocessor">                                                                              \</span>
00068 <span class="preprocessor">for(t2 = t; t2&lt;ths-&gt;d; t2++)                                                  \</span>
00069 <span class="preprocessor">  Omega[t2+1]=k[t2]*x[t2]+Omega[t2];                                          \</span>
00070 <span class="preprocessor">                                                                              \</span>
00071 <span class="preprocessor">omega=Omega[ths-&gt;d];                                                          \</span>
00072 <span class="preprocessor">}</span>
00073 <span class="preprocessor"></span>
00074 <span class="preprocessor">#define MACRO_ndft_compute_trafo (*fj) += (*f_hat_k)*cexp(-I*omega);</span>
00075 <span class="preprocessor"></span>
00076 <span class="preprocessor">#define MACRO_ndft_compute_conjugated MACRO_ndft_compute_trafo</span>
00077 <span class="preprocessor"></span>
00078 <span class="preprocessor">#define MACRO_ndft_compute_adjoint (*f_hat_k) += (*fj)*cexp(+I*omega);</span>
00079 <span class="preprocessor"></span>
00080 <span class="preprocessor">#define MACRO_ndft_compute_transposed MACRO_ndft_compute_adjoint</span>
00081 <span class="preprocessor"></span>
00082 <span class="preprocessor">#define MACRO_ndft(which_one)                                                 \</span>
00083 <span class="preprocessor">void ndft_ ## which_one (nfft_plan *ths)                                      \</span>
00084 <span class="preprocessor">{                                                                             \</span>
00085 <span class="preprocessor">  int j;                                \</span>
00086 <span class="preprocessor">  int t,t2;                             \</span>
00087 <span class="preprocessor">  int k_L;                              \</span>
00088 <span class="preprocessor">  double complex *f_hat, *f;            \</span>
00089 <span class="preprocessor">  double complex *f_hat_k;              \</span>
00090 <span class="preprocessor">  double complex *fj;                   \</span>
00091 <span class="preprocessor">  double x[ths-&gt;d];                     \</span>
00092 <span class="preprocessor">  int k[ths-&gt;d];                        \</span>
00093 <span class="preprocessor">  double omega, Omega[ths-&gt;d+1];        \</span>
00094 <span class="preprocessor">                                                                              \</span>
00095 <span class="preprocessor">  f_hat=ths-&gt;f_hat; f=ths-&gt;f;                                                 \</span>
00096 <span class="preprocessor">                                                                              \</span>
00097 <span class="preprocessor">  MACRO_ndft_init_result_ ## which_one                                        \</span>
00098 <span class="preprocessor">                                                                              \</span>
00099 <span class="preprocessor">  if(ths-&gt;d==1) </span><span class="comment">/* univariate case (due to performance) */</span>                    \
00100     {                                                                         \
00101       t=0;                                                                    \
00102       for(j=0, fj = f; j&lt;ths-&gt;M_total; j++, fj++)                             \
00103         {                                                                     \
00104     for(k_L=0, f_hat_k = f_hat; k_L&lt;ths-&gt;N_total; k_L++, f_hat_k++)     \
00105       {                                                                 \
00106         omega=(k_L-ths-&gt;N_total/2)* MACRO_ndft_sign_ ## which_one;      \
00107               MACRO_ndft_compute_ ## which_one;                               \
00108       }                                                                 \
00109         }                                                                     \
00110     }                                                                         \
00111   else <span class="comment">/* multivariate case */</span>                        \
00112     {                                                                         \
00113       Omega[0]=0;                                                             \
00114       for(j=0, fj=f; j&lt;ths-&gt;M_total; j++, fj++)                               \
00115         {                                                                     \
00116           MACRO_init_k_N_Omega_x(which_one);                                  \
00117           for(k_L=0, f_hat_k=f_hat; k_L&lt;ths-&gt;N_total; k_L++, f_hat_k++)       \
00118       {                                                                 \
00119               MACRO_ndft_compute_ ## which_one;                               \
00120         MACRO_count_k_N_Omega;                                          \
00121       } <span class="comment">/* for(k_L) */</span>                                                  \
00122         } <span class="comment">/* for(j) */</span>                                                        \
00123     } <span class="comment">/* else */</span>                                                              \
00124 } <span class="comment">/* ndft_trafo */</span>
00125 
00126 
<a name="l00129"></a><a class="code" href="group__nfft.html#ga0">00129</a> MACRO_ndft(trafo)
<a name="l00130"></a><a class="code" href="group__nfft.html#ga1">00130</a> MACRO_ndft(adjoint)
00131 
00157 <span class="keywordtype">void</span> nfft_uo(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths,<span class="keywordtype">int</span> j,<span class="keywordtype">int</span> *up,<span class="keywordtype">int</span> *op,<span class="keywordtype">int</span> act_dim)
00158 {
00159   <span class="keywordtype">double</span> c;
00160   <span class="keywordtype">int</span> u,o;
00161 
00162   c = ths-&gt;x[j*ths-&gt;d+act_dim] * ths-&gt;n[act_dim];
00163   u = c; o = c;
00164 
00165   <span class="keywordflow">if</span>(c &lt; 0)                  
00166     u = u-1;                  
00167   <span class="keywordflow">else</span>
00168     o = o+1;
00169 
00170   u = u - (ths-&gt;m); o = o + (ths-&gt;m);
00171 
00172   up[0]=u; op[0]=o;
00173 }
00174 
00175 <span class="preprocessor">#define MACRO_nfft_D_compute_A {                                              \</span>
00176 <span class="preprocessor"> g_hat[k_plain[ths-&gt;d]] = f_hat[ks_plain[ths-&gt;d]] * c_phi_inv_k[ths-&gt;d];      \</span>
00177 <span class="preprocessor">}</span>
00178 <span class="preprocessor"></span>
00179 <span class="preprocessor">#define MACRO_nfft_D_compute_T {                                              \</span>
00180 <span class="preprocessor"> f_hat[ks_plain[ths-&gt;d]] = g_hat[k_plain[ths-&gt;d]] * c_phi_inv_k[ths-&gt;d];      \</span>
00181 <span class="preprocessor">}</span>
00182 <span class="preprocessor"></span>
00183 <span class="preprocessor">#define MACRO_nfft_D_init_result_A  memset(g_hat,0,ths-&gt;n_total*              \</span>
00184 <span class="preprocessor">             sizeof(double complex));</span>
00185 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_nfft_D_init_result_T memset(f_hat,0,ths-&gt;N_total*               \</span>
00186 <span class="preprocessor">                                           sizeof(double complex));</span>
00187 <span class="preprocessor"></span>
00188 <span class="preprocessor">#define MACRO_with_PRE_PHI_HUT * ths-&gt;c_phi_inv[t2][ks[t2]];</span>
00189 <span class="preprocessor"></span><span class="preprocessor">#define MACRO_without_PRE_PHI_HUT / (PHI_HUT(ks[t2]-ths-&gt;N[t2]/2,t2));</span>
00190 <span class="preprocessor"></span>
00191 <span class="preprocessor">#define MACRO_init_k_ks {                                                     \</span>
00192 <span class="preprocessor">  for(t = ths-&gt;d-1; t&gt;=0; t--)                                                \</span>
00193 <span class="preprocessor">    {                                                                         \</span>
00194 <span class="preprocessor">      kp[t]= 0;                                                               \</span>
00195 <span class="preprocessor">      k[t] = 0;                                                               \</span>
00196 <span class="preprocessor">      ks[t] = ths-&gt;N[t]/2;                                                    \</span>
00197 <span class="preprocessor">    }                                                                         \</span>
00198 <span class="preprocessor">  t++;                                                                        \</span>
00199 <span class="preprocessor">}</span>
00200 <span class="preprocessor"></span>
00201 <span class="preprocessor">#define MACRO_update_c_phi_inv_k(which_one) {                                 \</span>
00202 <span class="preprocessor">  for(t2=t; t2&lt;ths-&gt;d; t2++)                                                  \</span>
00203 <span class="preprocessor">    {                                                                         \</span>
00204 <span class="preprocessor">      c_phi_inv_k[t2+1]= c_phi_inv_k[t2] MACRO_ ##which_one;                  \</span>
00205 <span class="preprocessor">      ks_plain[t2+1]= ks_plain[t2]*ths-&gt;N[t2]+ks[t2];                         \</span>
00206 <span class="preprocessor">      k_plain[t2+1]= k_plain[t2]*ths-&gt;n[t2]+k[t2];                            \</span>
00207 <span class="preprocessor">    }                                                                         \</span>
00208 <span class="preprocessor">}</span>
00209 <span class="preprocessor"></span>
00210 <span class="preprocessor">#define MACRO_count_k_ks {                                                    \</span>
00211 <span class="preprocessor">  for(t=ths-&gt;d-1; (t&gt;0)&amp;&amp; (kp[t]==ths-&gt;N[t]-1); t--)                          \</span>
00212 <span class="preprocessor">    {                                                                         \</span>
00213 <span class="preprocessor">      kp[t]= 0;                                                               \</span>
00214 <span class="preprocessor">      k[t]= 0;                                                                \</span>
00215 <span class="preprocessor">      ks[t]= ths-&gt;N[t]/2;                                                     \</span>
00216 <span class="preprocessor">    }                                                                         \</span>
00217 <span class="preprocessor">                                                                              \</span>
00218 <span class="preprocessor">  kp[t]++; k[t]++; ks[t]++;                                                   \</span>
00219 <span class="preprocessor">  if(kp[t]==ths-&gt;N[t]/2)                                                      \</span>
00220 <span class="preprocessor">    {                                                                         \</span>
00221 <span class="preprocessor">      k[t]= ths-&gt;n[t]-ths-&gt;N[t]/2;                                            \</span>
00222 <span class="preprocessor">      ks[t]= 0;                                                               \</span>
00223 <span class="preprocessor">    }                                                                         \</span>
00224 <span class="preprocessor">}                                                                             \</span>
00225 <span class="preprocessor"></span>
00226 <span class="preprocessor"></span>
00230 <span class="preprocessor">#define MACRO_nfft_D(which_one)                                               \</span>
00231 <span class="preprocessor">inline void nfft_D_ ## which_one (nfft_plan *ths)                             \</span>
00232 <span class="preprocessor">{                                                                             \</span>
00233 <span class="preprocessor">  int t, t2;                            \</span>
00234 <span class="preprocessor">  int k_L;                              \</span>
00235 <span class="preprocessor">  int kp[ths-&gt;d];                       \</span>
00236 <span class="preprocessor">  int k[ths-&gt;d];                        \</span>
00237 <span class="preprocessor">  int ks[ths-&gt;d];                       \</span>
00238 <span class="preprocessor">  double c_phi_inv_k[ths-&gt;d+1];         \</span>
00239 <span class="preprocessor">  int k_plain[ths-&gt;d+1];                \</span>
00240 <span class="preprocessor">  int ks_plain[ths-&gt;d+1];               \</span>
00241 <span class="preprocessor">  double complex *f_hat, *g_hat;        \</span>
00242 <span class="preprocessor">                                                                              \</span>
00243 <span class="preprocessor">  f_hat=ths-&gt;f_hat; g_hat=ths-&gt;g_hat;                                         \</span>
00244 <span class="preprocessor">  MACRO_nfft_D_init_result_ ## which_one;                                     \</span>
00245 <span class="preprocessor">                                                                              \</span>
00246 <span class="preprocessor">  c_phi_inv_k[0]=1;                                                           \</span>
00247 <span class="preprocessor">  k_plain[0]=0;                                                               \</span>
00248 <span class="preprocessor">  ks_plain[0]=0;                                                              \</span>
00249 <span class="preprocessor">                                                                              \</span>
00250 <span class="preprocessor">  if(ths-&gt;nfft_flags &amp; PRE_PHI_HUT)                                           \</span>
00251 <span class="preprocessor">    {                                                                         \</span>
00252 <span class="preprocessor">      MACRO_init_k_ks;                                                        \</span>
00253 <span class="preprocessor">                                                                              \</span>
00254 <span class="preprocessor">      for(k_L=0; k_L&lt;ths-&gt;N_total; k_L++)                                     \</span>
00255 <span class="preprocessor">  {                                                                     \</span>
00256 <span class="preprocessor">          MACRO_update_c_phi_inv_k(with_PRE_PHI_HUT);                         \</span>
00257 <span class="preprocessor">                                                                              \</span>
00258 <span class="preprocessor">    MACRO_nfft_D_compute_ ## which_one;                                 \</span>
00259 <span class="preprocessor">                                                                        \</span>
00260 <span class="preprocessor">    MACRO_count_k_ks;                                                   \</span>
00261 <span class="preprocessor">  } </span><span class="comment">/* for(k_L) */</span>                                                      \
00262     } <span class="comment">/* if(PRE_PHI_HUT) */</span>                                                   \
00263   else                                                                        \
00264     {                                                                         \
00265       MACRO_init_k_ks;                                                        \
00266                                                                               \
00267       for(k_L=0; k_L&lt;ths-&gt;N_total; k_L++)                                     \
00268   {                                                                     \
00269           MACRO_update_c_phi_inv_k(without_PRE_PHI_HUT);                      \
00270                                                                               \
00271     MACRO_nfft_D_compute_ ## which_one;                                 \
00272                                                                         \
00273     MACRO_count_k_ks;                                                   \
00274   } <span class="comment">/* for(k_L) */</span>                                                      \
00275     } <span class="comment">/* else(PRE_PHI_HUT) */</span>                                                 \
00276 } <span class="comment">/* nfft_D */</span>
00277 
00278 MACRO_nfft_D(A)
00279 MACRO_nfft_D(T)
00280 
00284 #define MACRO_nfft_B_init_result_A  memset(f,0,ths-&gt;M_total*                  \
00285                                            sizeof(<span class="keywordtype">double</span> complex));
00286 #define MACRO_nfft_B_init_result_T memset(g,0,ths-&gt;n_total*                   \
00287                                           sizeof(<span class="keywordtype">double</span> complex));
00288 
00289 #define MACRO_nfft_B_PRE_FULL_PSI_compute_A {                                 \
00290   (*fj) += ths-&gt;psi[ix] * g[ths-&gt;psi_index_g[ix]];            \
00291 }
00292 
00293 <span class="preprocessor">#define MACRO_nfft_B_PRE_FULL_PSI_compute_T {                                 \</span>
00294 <span class="preprocessor">  g[ths-&gt;psi_index_g[ix]] += ths-&gt;psi[ix] * (*fj);                            \</span>
00295 <span class="preprocessor">}</span>
00296 <span class="preprocessor"></span>
00297 <span class="preprocessor">#define MACRO_nfft_B_compute_A {                                              \</span>
00298 <span class="preprocessor">  (*fj) += phi_prod[ths-&gt;d] * g[ll_plain[ths-&gt;d]];                            \</span>
00299 <span class="preprocessor">}</span>
00300 <span class="preprocessor"></span>
00301 <span class="preprocessor">#define MACRO_nfft_B_compute_T {                                              \</span>
00302 <span class="preprocessor">  g[ll_plain[ths-&gt;d]] += phi_prod[ths-&gt;d] * (*fj);                            \</span>
00303 <span class="preprocessor">}</span>
00304 <span class="preprocessor"></span>
00305 <span class="preprocessor">#define MACRO_with_FG_PSI fg_psi[t2][lj[t2]]</span>
00306 <span class="preprocessor"></span>
00307 <span class="preprocessor">#define MACRO_with_PRE_PSI     ths-&gt;psi[(j*ths-&gt;d+t2)*(2*ths-&gt;m+2)+lj[t2]]</span>
00308 <span class="preprocessor"></span>
00309 <span class="preprocessor">#define MACRO_without_PRE_PSI  PHI(ths-&gt;x[j*ths-&gt;d+t2]-                       \</span>
00310 <span class="preprocessor">                                   ((double)l[t2])/ths-&gt;n[t2], t2)</span>
00311 <span class="preprocessor"></span>
00312 <span class="preprocessor">#define MACRO_init_uo_l_lj_t {                                                \</span>
00313 <span class="preprocessor">  for(t = ths-&gt;d-1; t&gt;=0; t--)                                                \</span>
00314 <span class="preprocessor">    {                                                                         \</span>
00315 <span class="preprocessor">      nfft_uo(ths,j,&amp;u[t],&amp;o[t],t);                                           \</span>
00316 <span class="preprocessor">      l[t] = u[t];                                                            \</span>
00317 <span class="preprocessor">      lj[t] = 0;                                                              \</span>
00318 <span class="preprocessor">    } </span><span class="comment">/* for(t) */</span>                                                            \
00319   t++;                                                                        \
00320 }
00321 
00322 <span class="preprocessor">#define MACRO_update_phi_prod_ll_plain(which_one) {                           \</span>
00323 <span class="preprocessor">  for(t2=t; t2&lt;ths-&gt;d; t2++)                                                  \</span>
00324 <span class="preprocessor">    {                                                                         \</span>
00325 <span class="preprocessor">      phi_prod[t2+1]=phi_prod[t2]* MACRO_ ## which_one;                       \</span>
00326 <span class="preprocessor">      ll_plain[t2+1]=ll_plain[t2]*ths-&gt;n[t2] +(l[t2]+ths-&gt;n[t2])%ths-&gt;n[t2];  \</span>
00327 <span class="preprocessor">    } </span><span class="comment">/* for(t2) */</span>                                                           \
00328 }
00329 
00330 <span class="preprocessor">#define MACRO_count_uo_l_lj_t {                                               \</span>
00331 <span class="preprocessor">  for(t = ths-&gt;d-1; (t&gt;0)&amp;&amp;(l[t]==o[t]); t--)                                 \</span>
00332 <span class="preprocessor">    {                                                                         \</span>
00333 <span class="preprocessor">      l[t] = u[t];                                                            \</span>
00334 <span class="preprocessor">      lj[t] = 0;                                                              \</span>
00335 <span class="preprocessor">    } </span><span class="comment">/* for(t) */</span>                                                            \
00336                                                                               \
00337   l[t]++;                                                                     \
00338   lj[t]++;                                                                    \
00339 }
00340 
00341 <span class="preprocessor">#define MACRO_nfft_B(which_one)                                               \</span>
00342 <span class="preprocessor">inline void nfft_B_ ## which_one (nfft_plan *ths)                             \</span>
00343 <span class="preprocessor">{                                                                             \</span>
00344 <span class="preprocessor">  int lprod;                            \</span>
00345 <span class="preprocessor">  int u[ths-&gt;d], o[ths-&gt;d];             \</span>
00346 <span class="preprocessor">  int t, t2;                            \</span>
00347 <span class="preprocessor">  int j;                                \</span>
00348 <span class="preprocessor">  int l_L, ix;                          \</span>
00349 <span class="preprocessor">  int l[ths-&gt;d];                        \</span>
00350 <span class="preprocessor">  int lj[ths-&gt;d];                       \</span>
00351 <span class="preprocessor">  int ll_plain[ths-&gt;d+1];               \</span>
00352 <span class="preprocessor">  double phi_prod[ths-&gt;d+1];            \</span>
00353 <span class="preprocessor">  double complex *f, *g;                \</span>
00354 <span class="preprocessor">  double complex *fj;                   \</span>
00355 <span class="preprocessor">  double y[ths-&gt;d];                                                           \</span>
00356 <span class="preprocessor">  double fg_psi[ths-&gt;d][2*ths-&gt;m+2];                                          \</span>
00357 <span class="preprocessor">  double fg_exp_l[ths-&gt;d][2*ths-&gt;m+2];                                        \</span>
00358 <span class="preprocessor">  int l_fg,lj_fg;                                                             \</span>
00359 <span class="preprocessor">  double tmpEXP1, tmpEXP2, tmpEXP2sq, tmp1, tmp2, tmp3;                       \</span>
00360 <span class="preprocessor">  double ip_w;                                                                \</span>
00361 <span class="preprocessor">  int ip_u;                                                                   \</span>
00362 <span class="preprocessor">  int ip_s=ths-&gt;K/(ths-&gt;m+1);                                                 \</span>
00363 <span class="preprocessor">                                                                              \</span>
00364 <span class="preprocessor">  f=ths-&gt;f; g=ths-&gt;g;                                                         \</span>
00365 <span class="preprocessor">                                                                              \</span>
00366 <span class="preprocessor">  MACRO_nfft_B_init_result_ ## which_one;                                     \</span>
00367 <span class="preprocessor">                                                                              \</span>
00368 <span class="preprocessor">  if(ths-&gt;nfft_flags &amp; PRE_FULL_PSI)                                          \</span>
00369 <span class="preprocessor">    {                                                                         \</span>
00370 <span class="preprocessor">      for(ix=0, j=0, fj=f; j&lt;ths-&gt;M_total; j++, fj++)                         \</span>
00371 <span class="preprocessor">        for(l_L=0; l_L&lt;ths-&gt;psi_index_f[j]; l_L++, ix++)                      \</span>
00372 <span class="preprocessor">    MACRO_nfft_B_PRE_FULL_PSI_compute_ ## which_one;                    \</span>
00373 <span class="preprocessor">      return;                                                                 \</span>
00374 <span class="preprocessor">    }                                                                         \</span>
00375 <span class="preprocessor">                                                                              \</span>
00376 <span class="preprocessor">  phi_prod[0]=1;                                                              \</span>
00377 <span class="preprocessor">  ll_plain[0]=0;                                                              \</span>
00378 <span class="preprocessor">                                                                              \</span>
00379 <span class="preprocessor">  for(t=0,lprod = 1; t&lt;ths-&gt;d; t++)                                           \</span>
00380 <span class="preprocessor">    lprod *= (2*ths-&gt;m+2);                                                    \</span>
00381 <span class="preprocessor">                                                                              \</span>
00382 <span class="preprocessor">  if(ths-&gt;nfft_flags &amp; PRE_PSI)                                               \</span>
00383 <span class="preprocessor">    {                                                                         \</span>
00384 <span class="preprocessor">      for(j=0, fj=f; j&lt;ths-&gt;M_total; j++, fj++)                               \</span>
00385 <span class="preprocessor">  {                                                                     \</span>
00386 <span class="preprocessor">          MACRO_init_uo_l_lj_t;                                               \</span>
00387 <span class="preprocessor">                                                                              \</span>
00388 <span class="preprocessor">    for(l_L=0; l_L&lt;lprod; l_L++)                                        \</span>
00389 <span class="preprocessor">      {                                                                 \</span>
00390 <span class="preprocessor">              MACRO_update_phi_prod_ll_plain(with_PRE_PSI);                   \</span>
00391 <span class="preprocessor">                                                                              \</span>
00392 <span class="preprocessor">        MACRO_nfft_B_compute_ ## which_one;                             \</span>
00393 <span class="preprocessor">                                                                  \</span>
00394 <span class="preprocessor">        MACRO_count_uo_l_lj_t;                                          \</span>
00395 <span class="preprocessor">            } </span><span class="comment">/* for(l_L) */</span>                                                  \
00396   } <span class="comment">/* for(j) */</span>                                                        \
00397       return;                                                                 \
00398     } <span class="comment">/* if(PRE_PSI) */</span>                                                       \
00399                                                                               \
00400   if(ths-&gt;nfft_flags &amp; PRE_FG_PSI)                                            \
00401     {                                                                         \
00402       for(t2=0; t2&lt;ths-&gt;d; t2++)                                              \
00403         {                                                                     \
00404           tmpEXP2 = exp(-1.0/ths-&gt;b[t2]);                                     \
00405           tmpEXP2sq = tmpEXP2*tmpEXP2;                                        \
00406           tmp2 = 1.0;                                                         \
00407           tmp3 = 1.0;                                                         \
00408           fg_exp_l[t2][0] = 1.0;                                              \
00409           for(lj_fg=1; lj_fg &lt;= (2*ths-&gt;m+2); lj_fg++)                        \
00410             {                                                                 \
00411               tmp3 = tmp2*tmpEXP2;                                            \
00412               tmp2 *= tmpEXP2sq;                                              \
00413               fg_exp_l[t2][lj_fg] = fg_exp_l[t2][lj_fg-1]*tmp3;               \
00414             }                                                                 \
00415         }                                                                     \
00416       for(j=0, fj=f; j&lt;ths-&gt;M_total; j++, fj++)                               \
00417   {                                                                     \
00418           MACRO_init_uo_l_lj_t;                                               \
00419                                                                               \
00420           for(t2=0; t2&lt;ths-&gt;d; t2++)                                          \
00421             {                                                                 \
00422               fg_psi[t2][0] = ths-&gt;psi[2*(j*ths-&gt;d+t2)];                      \
00423               tmpEXP1 = ths-&gt;psi[2*(j*ths-&gt;d+t2)+1];                          \
00424               tmp1 = 1.0;                                                     \
00425               for(l_fg=u[t2]+1, lj_fg=1; l_fg &lt;= o[t2]; l_fg++, lj_fg++)      \
00426                 {                                                             \
00427                   tmp1 *= tmpEXP1;                                            \
00428                   fg_psi[t2][lj_fg] = fg_psi[t2][0]*tmp1*fg_exp_l[t2][lj_fg]; \
00429                 }                                                             \
00430             }                                                                 \
00431                                                                               \
00432     for(l_L=0; l_L&lt;lprod; l_L++)                                        \
00433       {                                                                 \
00434               MACRO_update_phi_prod_ll_plain(with_FG_PSI);                    \
00435                                                                               \
00436         MACRO_nfft_B_compute_ ## which_one;                             \
00437                                                                   \
00438         MACRO_count_uo_l_lj_t;                                          \
00439             } <span class="comment">/* for(l_L) */</span>                                                  \
00440   } <span class="comment">/* for(j) */</span>                                                        \
00441       return;                                                                 \
00442     } <span class="comment">/* if(PRE_FG_PSI) */</span>                                                    \
00443                                                                               \
00444   if(ths-&gt;nfft_flags &amp; FG_PSI)                                                \
00445     {                                                                         \
00446       for(t2=0; t2&lt;ths-&gt;d; t2++)                                              \
00447         {                                                                     \
00448           tmpEXP2 = exp(-1.0/ths-&gt;b[t2]);                                     \
00449           tmpEXP2sq = tmpEXP2*tmpEXP2;                                        \
00450           tmp2 = 1.0;                                                         \
00451           tmp3 = 1.0;                                                         \
00452           fg_exp_l[t2][0] = 1.0;                                              \
00453           for(lj_fg=1; lj_fg &lt;= (2*ths-&gt;m+2); lj_fg++)                        \
00454             {                                                                 \
00455               tmp3 = tmp2*tmpEXP2;                                            \
00456               tmp2 *= tmpEXP2sq;                                              \
00457               fg_exp_l[t2][lj_fg] = fg_exp_l[t2][lj_fg-1]*tmp3;               \
00458             }                                                                 \
00459         }                                                                     \
00460       for(j=0, fj=f; j&lt;ths-&gt;M_total; j++, fj++)                               \
00461   {                                                                     \
00462           MACRO_init_uo_l_lj_t;                                               \
00463                                                                               \
00464           for(t2=0; t2&lt;ths-&gt;d; t2++)                                          \
00465             {                                                                 \
00466               fg_psi[t2][0] =                                                 \
00467                 (PHI((ths-&gt;x[j*ths-&gt;d+t2]-((double)u[t2])/ths-&gt;n[t2]),t2));   \
00468                                                                               \
00469               tmpEXP1 = exp(2.0*(ths-&gt;n[t2]*ths-&gt;x[j*ths-&gt;d+t2] - u[t2])      \
00470                       / ths-&gt;b[t2]);                                          \
00471               tmp1 = 1.0;                                                     \
00472               for(l_fg=u[t2]+1, lj_fg=1; l_fg &lt;= o[t2]; l_fg++, lj_fg++)      \
00473                 {                                                             \
00474                   tmp1 *= tmpEXP1;                                            \
00475                   fg_psi[t2][lj_fg] = fg_psi[t2][0]*tmp1*fg_exp_l[t2][lj_fg]; \
00476                 }                                                             \
00477             }                                                                 \
00478                                                                               \
00479     for(l_L=0; l_L&lt;lprod; l_L++)                                        \
00480       {                                                                 \
00481               MACRO_update_phi_prod_ll_plain(with_FG_PSI);                    \
00482                                                                               \
00483         MACRO_nfft_B_compute_ ## which_one;                             \
00484                                                                   \
00485         MACRO_count_uo_l_lj_t;                                          \
00486             } <span class="comment">/* for(l_L) */</span>                                                  \
00487   } <span class="comment">/* for(j) */</span>                                                        \
00488       return;                                                                 \
00489     } <span class="comment">/* if(FG_PSI) */</span>                                                        \
00490                                                                               \
00491                                                                               \
00492   if(ths-&gt;nfft_flags &amp; PRE_LIN_PSI)                                           \
00493     {                                                                         \
00494       for(j=0, fj=f; j&lt;ths-&gt;M_total; j++, fj++)                               \
00495   {                                                                     \
00496           MACRO_init_uo_l_lj_t;                                               \
00497                                                                               \
00498           for(t2=0; t2&lt;ths-&gt;d; t2++)                                          \
00499             {                                                                 \
00500               y[t2] = ((ths-&gt;n[t2]*ths-&gt;x[j*ths-&gt;d+t2]-                       \
00501                           (double)u[t2]) * ((double)ths-&gt;K))/(ths-&gt;m+1);      \
00502               ip_u  = (int)floor(y[t2]);                                      \
00503               ip_w  = y[t2]-ip_u;                                             \
00504               for(l_fg=u[t2], lj_fg=0; l_fg &lt;= o[t2]; l_fg++, lj_fg++)        \
00505                 {                                                             \
00506                   fg_psi[t2][lj_fg] = ths-&gt;psi[(ths-&gt;K+1)*t2+                 \
00507                  abs(ip_u-lj_fg*ip_s)]*         \
00508                                       (1-ip_w) +                              \
00509                                       ths-&gt;psi[(ths-&gt;K+1)*t2+                 \
00510                  abs(ip_u-lj_fg*ip_s+1)]*       \
00511                                        (ip_w);                                \
00512               }                                                               \
00513             }                                                                 \
00514                                                                               \
00515     for(l_L=0; l_L&lt;lprod; l_L++)                                        \
00516       {                                                                 \
00517               MACRO_update_phi_prod_ll_plain(with_FG_PSI);                    \
00518                                                                               \
00519         MACRO_nfft_B_compute_ ## which_one;                             \
00520                                                                   \
00521         MACRO_count_uo_l_lj_t;                                          \
00522             } <span class="comment">/* for(l_L) */</span>                                                  \
00523   } <span class="comment">/* for(j) */</span>                                                        \
00524       return;                                                                 \
00525     } <span class="comment">/* if(PRE_LIN_PSI) */</span>                                                   \
00526                                                                               \
00527   <span class="comment">/* no precomputed psi at all */</span>                                             \
00528   for(j=0, fj=f; j&lt;ths-&gt;M_total; j++, fj++)                                   \
00529     {                                                                         \
00530       MACRO_init_uo_l_lj_t;                                                   \
00531                                                                         \
00532       for(l_L=0; l_L&lt;lprod; l_L++)                                            \
00533       {                                                                     \
00534           MACRO_update_phi_prod_ll_plain(without_PRE_PSI);                    \
00535                                                                               \
00536           MACRO_nfft_B_compute_ ## which_one;                                 \
00537                                                                   \
00538           MACRO_count_uo_l_lj_t;                                              \
00539   } <span class="comment">/* for(l_L) */</span>                                                      \
00540     } <span class="comment">/* for(j) */</span>                                                            \
00541 } <span class="comment">/* nfft_B */</span>                                                                \
00542 
00543 MACRO_nfft_B(A)
00544 MACRO_nfft_B(T)
00545 
00546 
00549 <span class="keywordtype">void</span> nfft_trafo(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths)
<a name="l00550"></a><a class="code" href="group__nfft.html#ga2">00550</a> {
00551   <span class="comment">/* use ths-&gt;my_fftw_plan1 */</span>
00552   ths-&gt;g_hat=ths-&gt;g1;
00553   ths-&gt;g=ths-&gt;g2;
00554  
00558   TIC(0)
00559   nfft_D_A(ths);
00560   TOC(0)
00561 
00562   
00566   TIC_FFTW(1)
00567   fftw_execute(ths-&gt;my_fftw_plan1);
00568   TOC_FFTW(1)
00569 
00570   
00573   TIC(2)
00574   nfft_B_A(ths);
00575   TOC(2)
00576 } <span class="comment">/* nfft_trafo */</span>
00577 
00578 <span class="keywordtype">void</span> <a class="code" href="group__nfft.html#ga3">nfft_adjoint</a>(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths)
<a name="l00579"></a><a class="code" href="group__nfft.html#ga3">00579</a> {
00580   <span class="comment">/* use ths-&gt;my_fftw_plan2 */</span>
00581   ths-&gt;g_hat=ths-&gt;g1;
00582   ths-&gt;g=ths-&gt;g2;
00583   
00587   TIC(2)
00588   nfft_B_T(ths);
00589   TOC(2)
00590  
00591   
00595   TIC_FFTW(1)
00596   fftw_execute(ths-&gt;my_fftw_plan2);
00597   TOC_FFTW(1)
00598  
00599   
00602   TIC(0)
00603   nfft_D_T(ths);
00604   TOC(0)
00605 } <span class="comment">/* nfft_adjoint */</span>
00606 
00609 <span class="keywordtype">void</span> nfft_precompute_phi_hut(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths)
00610 {
00611   <span class="keywordtype">int</span> ks[ths-&gt;d];                       
00612   <span class="keywordtype">int</span> t;                                
00614   ths-&gt;c_phi_inv = (<span class="keywordtype">double</span>**) fftw_malloc(ths-&gt;d*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>*));
00615 
00616   <span class="keywordflow">for</span>(t=0; t&lt;ths-&gt;d; t++)
00617     {
00618       ths-&gt;c_phi_inv[t]= (<span class="keywordtype">double</span>*)fftw_malloc(ths-&gt;N[t]*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00619       <span class="keywordflow">for</span>(ks[t]=0; ks[t]&lt;ths-&gt;N[t]; ks[t]++)  
00620   ths-&gt;c_phi_inv[t][ks[t]]= 1.0/(PHI_HUT(ks[t]-ths-&gt;N[t]/2,t));
00621     }
00622 } <span class="comment">/* nfft_phi_hut */</span>
00623 
00629 <span class="keywordtype">void</span> <a class="code" href="group__nfft.html#ga13">nfft_precompute_lin_psi</a>(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths)
<a name="l00630"></a><a class="code" href="group__nfft.html#ga13">00630</a> {
00631   <span class="keywordtype">int</span> t;                                
00632   <span class="keywordtype">int</span> j;                                
00633   <span class="keywordtype">double</span> step;                          
00635   <span class="keywordflow">for</span> (t=0; t&lt;ths-&gt;d; t++)
00636     {
00637       step=((double)(ths-&gt;m+1))/(ths-&gt;K*ths-&gt;n[t]);
00638       <span class="keywordflow">for</span>(j=0;j&lt;=ths-&gt;K;j++)
00639   {
00640     ths-&gt;psi[(ths-&gt;K+1)*t + j] = PHI(j*step,t);
00641   } <span class="comment">/* for(j) */</span>
00642     } <span class="comment">/* for(t) */</span>
00643 }
00644 
00645 <span class="keywordtype">void</span> nfft_precompute_fg_psi(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths)
00646 {
00647   <span class="keywordtype">int</span> t;                                
00648   <span class="keywordtype">int</span> j;                                
00649   <span class="keywordtype">int</span> u, o;                             
00651   <span class="keywordflow">for</span> (t=0; t&lt;ths-&gt;d; t++)
00652     for(j=0;j&lt;ths-&gt;M_total;j++)
00653       {
00654   nfft_uo(ths,j,&amp;u,&amp;o,t);
00655 
00656         ths-&gt;psi[2*(j*ths-&gt;d+t)]=
00657             (PHI((ths-&gt;x[j*ths-&gt;d+t]-((<span class="keywordtype">double</span>)u)/ths-&gt;n[t]),t));
00658 
00659         ths-&gt;psi[2*(j*ths-&gt;d+t)+1]=
00660             exp(2.0*(ths-&gt;n[t]*ths-&gt;x[j*ths-&gt;d+t] - u) / ths-&gt;b[t]);   
00661       } <span class="comment">/* for(j) */</span>
00662   <span class="comment">/* for(t) */</span>
00663 } <span class="comment">/* nfft_precompute_fg_psi */</span>
00664 
00665 <span class="keywordtype">void</span> <a class="code" href="group__nfft.html#ga12">nfft_precompute_psi</a>(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths)
<a name="l00666"></a><a class="code" href="group__nfft.html#ga12">00666</a> {
00667   <span class="keywordtype">int</span> t;                                
00668   <span class="keywordtype">int</span> j;                                
00669   <span class="keywordtype">int</span> l;                                
00670   <span class="keywordtype">int</span> lj;                               
00671   <span class="keywordtype">int</span> u, o;                             
00673   <span class="keywordflow">for</span> (t=0; t&lt;ths-&gt;d; t++)
00674     <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total;j++)
00675       {
00676   nfft_uo(ths,j,&amp;u,&amp;o,t);
00677   
00678   <span class="keywordflow">for</span>(l=u, lj=0; l &lt;= o; l++, lj++)
00679     ths-&gt;psi[(j*ths-&gt;d+t)*(2*ths-&gt;m+2)+lj]=
00680       (PHI((ths-&gt;x[j*ths-&gt;d+t]-((<span class="keywordtype">double</span>)l)/ths-&gt;n[t]),t));
00681       } <span class="comment">/* for(j) */</span>
00682   <span class="comment">/* for(t) */</span>
00683 } <span class="comment">/* nfft_precompute_psi */</span>
00684 
00685 <span class="keywordtype">void</span> <a class="code" href="group__nfft.html#ga11">nfft_precompute_full_psi</a>(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths)
<a name="l00686"></a><a class="code" href="group__nfft.html#ga11">00686</a> {
00687   <span class="keywordtype">int</span> t,t2;                             
00688   <span class="keywordtype">int</span> j;                                
00689   <span class="keywordtype">int</span> l_L;                              
00690   <span class="keywordtype">int</span> l[ths-&gt;d];                        
00691   <span class="keywordtype">int</span> lj[ths-&gt;d];                       
00692   <span class="keywordtype">int</span> ll_plain[ths-&gt;d+1];               
00693   <span class="keywordtype">int</span> lprod;                            
00694   <span class="keywordtype">int</span> u[ths-&gt;d], o[ths-&gt;d];             
00696   <span class="keywordtype">double</span> phi_prod[ths-&gt;d+1];
00697 
00698   <span class="keywordtype">int</span> ix,ix_old;
00699 
00700   phi_prod[0]=1;
00701   ll_plain[0]=0;
00702 
00703   <span class="keywordflow">for</span>(t=0,lprod = 1; t&lt;ths-&gt;d; t++)
00704       lprod *= 2*ths-&gt;m+2;
00705 
00706   <span class="keywordflow">for</span>(j=0,ix=0,ix_old=0; j&lt;ths-&gt;M_total; j++)
00707     {
00708       MACRO_init_uo_l_lj_t;
00709       
00710       <span class="keywordflow">for</span>(l_L=0; l_L&lt;lprod; l_L++, ix++)
00711   {
00712     MACRO_update_phi_prod_ll_plain(without_PRE_PSI);
00713     
00714     ths-&gt;psi_index_g[ix]=ll_plain[ths-&gt;d];
00715     ths-&gt;psi[ix]=phi_prod[ths-&gt;d];
00716      
00717     MACRO_count_uo_l_lj_t;
00718   } <span class="comment">/* for(l_L) */</span>
00719       
00720       
00721       ths-&gt;psi_index_f[j]=ix-ix_old;
00722       ix_old=ix;
00723     } <span class="comment">/* for(j) */</span>
00724 }
00725 
00726 <span class="keywordtype">void</span> <a class="code" href="group__nfft.html#ga10">nfft_precompute_one_psi</a>(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths)
<a name="l00727"></a><a class="code" href="group__nfft.html#ga10">00727</a> {
00728   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga18">PRE_LIN_PSI</a>)
00729     <a class="code" href="group__nfft.html#ga13">nfft_precompute_lin_psi</a>(ths);
00730   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga19">PRE_FG_PSI</a>)
00731     nfft_precompute_fg_psi(ths);
00732   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00733     <a class="code" href="group__nfft.html#ga12">nfft_precompute_psi</a>(ths);
00734   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>)
00735     <a class="code" href="group__nfft.html#ga11">nfft_precompute_full_psi</a>(ths);
00736 }
00737 
00738 
00739 <span class="keywordtype">void</span> nfft_init_help(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths)
00740 {
00741   <span class="keywordtype">int</span> t;                                
00742   <span class="keywordtype">int</span> lprod;                            
00744   ths-&gt;N_total=<a class="code" href="group__nfftutil.html#ga10">nfft_prod_int</a>(ths-&gt;N, ths-&gt;d);
00745   ths-&gt;n_total=<a class="code" href="group__nfftutil.html#ga10">nfft_prod_int</a>(ths-&gt;n, ths-&gt;d);
00746 
00747   ths-&gt;sigma = (<span class="keywordtype">double</span>*) fftw_malloc(ths-&gt;d*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00748   <span class="keywordflow">for</span>(t = 0;t &lt; ths-&gt;d; t++)
00749     ths-&gt;sigma[t] = ((double)ths-&gt;n[t])/ths-&gt;N[t];
00750   
00751   WINDOW_HELP_INIT;
00752 
00753   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga22">MALLOC_X</a>)
00754     ths-&gt;x = (<span class="keywordtype">double</span>*)fftw_malloc(ths-&gt;d*ths-&gt;M_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00755 
00756   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>)
00757     ths-&gt;f_hat = (<span class="keywordtype">double</span> complex*)fftw_malloc(ths-&gt;N_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00758 
00759   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>)
00760     ths-&gt;f = (<span class="keywordtype">double</span> complex*)fftw_malloc(ths-&gt;M_total*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00761 
00762   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>)
00763     nfft_precompute_phi_hut(ths);
00764 
00765   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga18">PRE_LIN_PSI</a>)
00766   {
00767       ths-&gt;K=(1U&lt;&lt; 10)*(ths-&gt;m+1);
00768       ths-&gt;psi = (<span class="keywordtype">double</span>*) fftw_malloc((ths-&gt;K+1)*ths-&gt;d*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00769   }
00770 
00771   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga19">PRE_FG_PSI</a>)
00772     ths-&gt;psi = (<span class="keywordtype">double</span>*) fftw_malloc(ths-&gt;M_total*ths-&gt;d*2*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00773 
00774   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00775     ths-&gt;psi = (<span class="keywordtype">double</span>*) fftw_malloc(ths-&gt;M_total*ths-&gt;d*
00776              (2*ths-&gt;m+2)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00777 
00778   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>)
00779   {
00780       <span class="keywordflow">for</span>(t=0,lprod = 1; t&lt;ths-&gt;d; t++)
00781     lprod *= 2*ths-&gt;m+2;
00782       
00783       ths-&gt;psi = (<span class="keywordtype">double</span>*) fftw_malloc(ths-&gt;M_total*lprod*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00784 
00785       ths-&gt;psi_index_f = (<span class="keywordtype">int</span>*) fftw_malloc(ths-&gt;M_total*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
00786       ths-&gt;psi_index_g = (<span class="keywordtype">int</span>*) fftw_malloc(ths-&gt;M_total*lprod*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
00787   }
00788 
00789   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a>)
00790       {  
00791   ths-&gt;g1=(<span class="keywordtype">double</span> complex*)fftw_malloc(ths-&gt;n_total*
00792                <span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00793 
00794   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>)
00795       ths-&gt;g2 = (<span class="keywordtype">double</span> complex*) fftw_malloc(ths-&gt;n_total*
00796                <span class="keyword">sizeof</span>(<span class="keywordtype">double</span> complex));
00797   <span class="keywordflow">else</span>
00798       ths-&gt;g2 = ths-&gt;g1;
00799   
00800   ths-&gt;my_fftw_plan1 = 
00801       fftw_plan_dft(ths-&gt;d, ths-&gt;n, ths-&gt;g1, ths-&gt;g2,
00802         FFTW_FORWARD, ths-&gt;fftw_flags);
00803   ths-&gt;my_fftw_plan2 = 
00804       fftw_plan_dft(ths-&gt;d, ths-&gt;n, ths-&gt;g2, ths-&gt;g1,
00805         FFTW_BACKWARD, ths-&gt;fftw_flags);
00806       }
00807 }
00808 
00809 <span class="keywordtype">void</span> <a class="code" href="group__nfft.html#ga7">nfft_init</a>(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths, <span class="keywordtype">int</span> d, <span class="keywordtype">int</span> *N, <span class="keywordtype">int</span> M_total)
<a name="l00810"></a><a class="code" href="group__nfft.html#ga7">00810</a> {
00811   <span class="keywordtype">int</span> t;                                
00813   ths-&gt;d = d;
00814 
00815   ths-&gt;N=(<span class="keywordtype">int</span>*) fftw_malloc(d*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
00816   <span class="keywordflow">for</span>(t = 0;t &lt; d; t++)
00817     ths-&gt;N[t] = N[t];
00818 
00819   ths-&gt;M_total = M_total;
00820 
00821   ths-&gt;n = (<span class="keywordtype">int</span>*) fftw_malloc(d*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
00822   <span class="keywordflow">for</span>(t = 0;t &lt; d; t++)
00823     ths-&gt;n[t] = 2*<a class="code" href="group__nfftutil.html#ga4">nfft_next_power_of_2</a>(ths-&gt;N[t]);
00824 
00825   WINDOW_HELP_ESTIMATE_m;
00826 
00827   ths-&gt;nfft_flags = <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>| <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>| <a class="code" href="group__nfft.html#ga22">MALLOC_X</a>| <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>| <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>|
00828                     <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a>| <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>;
00829   ths-&gt;fftw_flags= FFTW_ESTIMATE| FFTW_DESTROY_INPUT;
00830 
00831   nfft_init_help(ths);    
00832 }
00833 
00834 <span class="keywordtype">void</span> <a class="code" href="group__nfft.html#ga9">nfft_init_guru</a>(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths, <span class="keywordtype">int</span> d, <span class="keywordtype">int</span> *N, <span class="keywordtype">int</span> M_total, <span class="keywordtype">int</span> *n,
<a name="l00835"></a><a class="code" href="group__nfft.html#ga9">00835</a>       <span class="keywordtype">int</span> m, <span class="keywordtype">unsigned</span> nfft_flags, <span class="keywordtype">unsigned</span> fftw_flags)
00836 {
00837   <span class="keywordtype">int</span> t;                                
00839   ths-&gt;d =d;
00840   ths-&gt;N= (<span class="keywordtype">int</span>*) fftw_malloc(ths-&gt;d*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
00841   <span class="keywordflow">for</span>(t=0; t&lt;d; t++)
00842     ths-&gt;N[t]= N[t];
00843   ths-&gt;M_total= M_total;
00844   ths-&gt;n= (<span class="keywordtype">int</span>*) fftw_malloc(ths-&gt;d*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
00845   <span class="keywordflow">for</span>(t=0; t&lt;d; t++)
00846     ths-&gt;n[t]= n[t];
00847   ths-&gt;m= m;
00848   ths-&gt;nfft_flags= nfft_flags;
00849   ths-&gt;fftw_flags= fftw_flags;
00850 
00851   nfft_init_help(ths);  
00852 }
00853 
00854 <span class="keywordtype">void</span> <a class="code" href="group__nfft.html#ga4">nfft_init_1d</a>(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths, <span class="keywordtype">int</span> N1, <span class="keywordtype">int</span> M_total)
<a name="l00855"></a><a class="code" href="group__nfft.html#ga4">00855</a> {
00856   <span class="keywordtype">int</span> N[1];
00857 
00858   N[0]=N1;
00859   <a class="code" href="group__nfft.html#ga7">nfft_init</a>(ths,1,N,M_total);
00860 }
00861 
00862 <span class="keywordtype">void</span> <a class="code" href="group__nfft.html#ga5">nfft_init_2d</a>(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths, <span class="keywordtype">int</span> N1, <span class="keywordtype">int</span> N2, <span class="keywordtype">int</span> M_total)
<a name="l00863"></a><a class="code" href="group__nfft.html#ga5">00863</a> {
00864   <span class="keywordtype">int</span> N[2];
00865 
00866   N[0]=N1;
00867   N[1]=N2;
00868   <a class="code" href="group__nfft.html#ga7">nfft_init</a>(ths,2,N,M_total);
00869 }
00870 
00871 <span class="keywordtype">void</span> <a class="code" href="group__nfft.html#ga6">nfft_init_3d</a>(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths, <span class="keywordtype">int</span> N1, <span class="keywordtype">int</span> N2, <span class="keywordtype">int</span> N3, <span class="keywordtype">int</span> M_total)
<a name="l00872"></a><a class="code" href="group__nfft.html#ga6">00872</a> {
00873   <span class="keywordtype">int</span> N[3];
00874 
00875   N[0]=N1;
00876   N[1]=N2;
00877   N[2]=N3;
00878   <a class="code" href="group__nfft.html#ga7">nfft_init</a>(ths,3,N,M_total);
00879 }
00880 
00881 <span class="keywordtype">void</span> <a class="code" href="group__nfft.html#ga14">nfft_check</a>(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths)
<a name="l00882"></a><a class="code" href="group__nfft.html#ga14">00882</a> {
00883   <span class="keywordtype">int</span> j;
00884  
00885   <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;M_total*ths-&gt;d;j++)
00886     <span class="keywordflow">if</span>((ths-&gt;x[j]&lt;-0.5) || (ths-&gt;x[j]&gt;=0.5))
00887       fprintf(stderr,<span class="stringliteral">"nfft_check: ths-&gt;x[%d]=%e out of range [-0.5,0.5)\n"</span>,
00888         j,ths-&gt;x[j]);
00889 
00890   <span class="keywordflow">for</span>(j=0;j&lt;ths-&gt;d;j++)
00891     {
00892       <span class="keywordflow">if</span>(ths-&gt;sigma[j]&lt;=1)
00893   fprintf(stderr,<span class="stringliteral">"nfft_check: oversampling factor too small\n"</span>);
00894 
00895       <span class="keywordflow">if</span>(ths-&gt;N[j]&lt;=ths-&gt;m)
00896   fprintf(stderr,
00897     <span class="stringliteral">"nfft_check: polynomial degree N is smaller than cut-off m\n"</span>);
00898 
00899       <span class="keywordflow">if</span>(ths-&gt;N[j]%2==1)
00900   fprintf(stderr,<span class="stringliteral">"nfft_check: polynomial degree N has to be even\n"</span>);
00901     }
00902 }
00903 
00904 <span class="keywordtype">void</span> <a class="code" href="group__nfft.html#ga15">nfft_finalize</a>(<a class="code" href="structnfft__plan.html">nfft_plan</a> *ths)
<a name="l00905"></a><a class="code" href="group__nfft.html#ga15">00905</a> {
00906   <span class="keywordtype">int</span> t; <span class="comment">/* index over dimensions */</span>
00907 
00908   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga26">FFTW_INIT</a>)
00909     {
00910   fftw_destroy_plan(ths-&gt;my_fftw_plan2);
00911   fftw_destroy_plan(ths-&gt;my_fftw_plan1);
00912 
00913   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga25">FFT_OUT_OF_PLACE</a>)
00914       fftw_free(ths-&gt;g2);
00915   
00916   fftw_free(ths-&gt;g1);
00917     }
00918 
00919   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga21">PRE_FULL_PSI</a>)
00920     {
00921       fftw_free(ths-&gt;psi_index_g);
00922       fftw_free(ths-&gt;psi_index_f);
00923       fftw_free(ths-&gt;psi);
00924     }
00925 
00926   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga20">PRE_PSI</a>)
00927     fftw_free(ths-&gt;psi);  
00928 
00929   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga19">PRE_FG_PSI</a>)
00930     fftw_free(ths-&gt;psi);
00931 
00932   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga18">PRE_LIN_PSI</a>)
00933     fftw_free(ths-&gt;psi);
00934       
00935   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga16">PRE_PHI_HUT</a>)
00936     {
00937       <span class="keywordflow">for</span>(t=0; t&lt;ths-&gt;d; t++)
00938         fftw_free(ths-&gt;c_phi_inv[t]);
00939       fftw_free(ths-&gt;c_phi_inv);
00940     }
00941 
00942   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga24">MALLOC_F</a>)
00943     fftw_free(ths-&gt;f);
00944 
00945   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga23">MALLOC_F_HAT</a>)
00946     fftw_free(ths-&gt;f_hat);
00947 
00948   <span class="keywordflow">if</span>(ths-&gt;nfft_flags &amp; <a class="code" href="group__nfft.html#ga22">MALLOC_X</a>)
00949   fftw_free(ths-&gt;x);
00950  
00951   WINDOW_HELP_FINALIZE;
00952  
00953   fftw_free(ths-&gt;sigma);
00954   fftw_free(ths-&gt;n);
00955   fftw_free(ths-&gt;N);
00956 }
</pre></div>    <hr size="1"/>
    Generated on 5 Feb 2007 by Doxygen 1.4.1
  </body>
</html>
